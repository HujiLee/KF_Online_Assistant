!function e(t,n,a){function o(r,l){if(!n[r]){if(!t[r]){var d="function"==typeof require&&require;if(!l&&d)return d(r,!0);if(i)return i(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var c=n[r]={exports:{}};t[r][0].call(c.exports,function(e){var n=t[r][1][e];return o(n?n:e)},c,c.exports,e,t,n,a)}return n[r].exports}for(var i="function"==typeof require&&require,r=0;r<a.length;r++)o(a[r]);return o}({1:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}var i=e("./module/Info"),r=o(i),l=e("./module/Config"),d=e("./module/Util"),s=a(d),c=e("./module/Const"),p=o(c),f=e("./module/Msg"),u=(a(f),e("./module/Dialog")),m=(a(u),e("./module/Log")),g=(a(m),e("./module/TmpLog")),h=a(g),v=e("./module/LootLog"),b=(a(v),e("./module/Script")),y=a(b),_=e("./module/Public"),x=a(_),k=e("./module/Index"),C=a(k),w=e("./module/Read"),I=a(w),L=e("./module/Post"),S=a(L),T=e("./module/Other"),D=a(T),A=e("./module/Bank"),E=a(A),M=e("./module/Card"),P=a(M),F=e("./module/Item"),B=a(F),U=e("./module/Loot"),N=a(U),O=e("./module/ConfigDialog"),j=(a(O),function(){try{r.default.w.Info=e("./module/Info").default,r.default.w.Util=e("./module/Util"),r.default.w.Const=e("./module/Const").default,r.default.w.Msg=e("./module/Msg"),r.default.w.Dialog=e("./module/Dialog"),r.default.w.Log=e("./module/Log"),r.default.w.TmpLog=e("./module/TmpLog"),r.default.w.LootLog=e("./module/LootLog"),r.default.w.Public=e("./module/Public"),r.default.w.Index=e("./module/Index"),r.default.w.Read=e("./module/Read"),r.default.w.Post=e("./module/Post"),r.default.w.Other=e("./module/Other"),r.default.w.Bank=e("./module/Bank"),r.default.w.Card=e("./module/Card"),r.default.w.Item=e("./module/Item"),r.default.w.Loot=e("./module/Loot"),r.default.w.Script=e("./module/Script");var t=e("./module/Config");r.default.w.readConfig=t.read,r.default.w.writeConfig=t.write}catch(e){console.log(e)}}),q=function(){var e=new Date;if(r.default.version="11.1.2",x.getUidAndUserName()){x.addPolyfill(),j(),(0,l.init)(),x.checkBrowserType(),x.appendCss(),x.addConfigAndLogDialogLink(),Config.animationEffectOffEnabled&&($.fx.off=!0),Config.customScriptEnabled&&y.runCustomScript("start"),x.repairBbsErrorCode(),window.addEventListener("beforeunload",x.preventCloseWindowWhenActioning),Config.showSearchLinkEnabled&&x.addSearchDialogLink(),x.bindSearchTypeSelectMenuClick(),x.makeSearchByBelowTwoKeyWordAvailable(),Config.addFastNavMenuEnabled&&x.addFastNavMenu(),Config.modifySideBarEnabled&&x.modifySideBar(),r.default.$userMenu.find('a[href^="login.php?action=quit"]').click(function(){return confirm("是否退出账号？")}),x.changeNewRateTipsColor(),r.default.isInHomePage?(C.handleIndexLink(),C.handleAtTips(),C.addSearchTypeSelectBox(),Config.smLevelUpAlertEnabled&&C.smLevelUpAlert(),Config.smRankChangeAlertEnabled&&C.smRankChangeAlert(),Config.showVipSurplusTimeEnabled&&C.showVipSurplusTime(),Config.homePageThreadFastGotoLinkEnabled&&C.addThreadFastGotoLink(),Config.fixedDepositDueAlertEnabled&&!s.getCookie(p.default.fixedDepositDueAlertCookieName)&&E.fixedDepositDueAlert(),2===parseInt(s.getCookie(p.default.lootCompleteCookieName))&&$("#pdLoot.indbox5").removeClass("indbox5").addClass("indbox6"),C.addPromoteHaloInterval(),Config.showChangePointsInfoEnabled&&C.addChangePointsInfoTips()):"/read.php"===location.pathname?(Config.turnPageViaKeyboardEnabled&&x.turnPageViaKeyboard(),I.fastGotoFloor(),Config.adjustThreadContentWidthEnabled&&I.adjustThreadContentWidth(),I.adjustThreadContentFontSize(),I.showAttachImageOutsideSellBox(),Config.parseMediaTagEnabled&&I.parseMediaTag(),Config.modifyKfOtherDomainEnabled&&I.modifyKFOtherDomainLink(),Config.customSmColorEnabled&&I.modifySmColor(),Config.customMySmColor&&I.modifyMySmColor(),Config.multiQuoteEnabled&&I.addMultiQuoteButton(),I.addFastGotoFloorInput(),I.addFloorGotoLink(),I.addStatAndBuyThreadBtn(),I.handleBuyThreadBtn(),I.addCopyBuyersListOption(),Config.userMemoEnabled&&I.addUserMemo(),I.addCopyCodeLink(),I.addMoreSmileLink(),S.addRedundantKeywordWarning(),$('a[href$="#install-script"]').length>0&&y.handleInstallScriptLink(),Config.preventCloseWindowWhenEditPostEnabled&&S.preventCloseWindowWhenEditPost(),Config.autoSavePostContentWhenSubmitEnabled&&S.savePostContentWhenSubmit()):"/thread.php"===location.pathname?(Config.highlightNewPostEnabled&&D.highlightNewPost(),Config.showFastGotoThreadPageEnabled&&D.addFastGotoThreadPageLink()):"/post.php"===location.pathname?(S.addRedundantKeywordWarning(),/\bmultiquote=1/i.test(location.href)?Config.multiQuoteEnabled&&S.handleMultiQuote(2):/\baction=quote/i.test(location.href)&&S.removeUnpairedBBCodeInQuoteContent(),S.addExtraPostEditorButton(),S.addExtraOptionInPostPage(),Config.preventCloseWindowWhenEditPostEnabled&&S.preventCloseWindowWhenEditPost(),Config.autoSavePostContentWhenSubmitEnabled&&S.savePostContentWhenSubmit(),r.default.isInMiaolaDomain&&S.addAttachChangeAlert()):"/kf_fw_ig_mybp.php"===location.pathname?B.init():"/kf_fw_ig_shop.php"===location.pathname||("/kf_fw_ig_pklist.php"===location.pathname?N.addUserLinkInPkListPage():"/kf_fw_ig_halo.php"===location.pathname?($(".kf_fw_ig1:first").on("click",'a[href^="kf_fw_ig_halo.php?do=buy&id="]',function(){if(!confirm("是否提升战力光环？"))return!1;h.deleteValue(p.default.haloInfoTmpLogName)}),N.addUserLinkInHaloPage()):/\/hack\.php\?H_name=bank$/i.test(location.href)?E.handleBankPage():/\/kf_fw_card_my\.php$/.test(location.href)?P.addStartBatchModeButton():/\/message\.php\?action=read&mid=\d+/i.test(location.href)?(D.addFastDrawMoneyLink(),Config.modifyKfOtherDomainEnabled&&I.modifyKFOtherDomainLink()):/\/message\.php($|\?action=receivebox)/i.test(location.href)?D.addMsgSelectButton():/\/profile\.php\?action=show/i.test(location.href)?(D.handleProfilePage(),D.addFollowAndBlockAndMemoUserLink()):/\/personal\.php\?action=post/i.test(location.href)?10===Config.perPageFloorNum&&D.modifyMyPostLink():"/kf_growup.php"===location.pathname?D.addAutoChangeIdColorButton():"/guanjianci.php"===location.pathname?D.highlightUnReadAtTipsMsg():/\/profile\.php\?action=modify$/i.test(location.href)?(D.syncModifyPerPageFloorNum(),r.default.isInMiaolaDomain&&D.addAvatarChangeAlert()):/\/job\.php\?action=preview$/i.test(location.href)?S.modifyPostPreviewPage():"/search.php"===location.pathname?Config.turnPageViaKeyboardEnabled&&x.turnPageViaKeyboard():"/kf_fw_1wkfb.php"===location.pathname?(/\/kf_fw_1wkfb\.php\?ping=(2|4)/i.test(location.href)?(D.highlightRatingErrorSize(),/\/kf_fw_1wkfb\.php\?ping=2/i.test(location.href)&&D.refreshWaitCheckRatingPage()):/\/kf_fw_1wkfb\.php\?do=1/i.test(location.href)&&D.showSelfRatingErrorSizeSubmitWarning(),D.addLinksInGoodPostPage()):"/kf_no1.php"===location.pathname&&D.addUserNameLinkInRankPage()),Config.blockUserEnabled&&x.blockUsers(),Config.blockThreadEnabled&&x.blockThread(),Config.followUserEnabled&&x.followUsers(),r.default.isMobile&&x.bindElementTitleClick(),r.default.isInMiaolaDomain&&Config.kfSmileEnhanceExtensionEnabled&&["/read.php","/post.php","/message.php"].includes(location.pathname)&&S.importKfSmileEnhanceExtension();var t=!1;Config.autoPromoteHaloEnabled&&!s.getCookie(p.default.promoteHaloCookieName)&&(t=!0,N.getPromoteHaloInfo("/kf_fw_ig_index.php"===location.pathname)),"/kf_fw_ig_index.php"!==location.pathname||t||N.init();var n=!1;"/kf_fw_ig_index.php"===location.pathname||s.getCookie(p.default.lootCompleteCookieName)||(Config.autoLootEnabled?s.getCookie(p.default.lootAttackingCookieName)||$.isNumeric(s.getCookie(p.default.changePointsInfoCookieName))||t||(n=!0,N.checkLoot()):Config.autoSaveLootLogInSpecialCaseEnabled&&(n=!0,N.autoSaveLootLog())),Config.getBonusAfterLootCompleteEnabled||(n=!1),!Config.autoGetDailyBonusEnabled||s.getCookie(p.default.getDailyBonusCookieName)||n||x.getDailyBonus(),Config.autoSaveCurrentDepositEnabled&&r.default.isInHomePage&&x.autoSaveCurrentDeposit(),Config.autoChangeIdColorEnabled&&!s.getCookie(p.default.autoChangeIdColorCookieName)&&x.changeIdColor(),Config.timingModeEnabled&&(r.default.isInHomePage||"/kf_fw_ig_index.php"===location.pathname)&&x.startTimingMode(),Config.customScriptEnabled&&y.runCustomScript("end");var a=new Date;console.log("【KF Online助手】初始化耗时："+(a-e)+"ms")}};"undefined"!=typeof jQuery&&$(document).ready(q)},{"./module/Bank":2,"./module/Card":3,"./module/Config":4,"./module/ConfigDialog":5,"./module/Const":6,"./module/Dialog":7,"./module/Index":8,"./module/Info":9,"./module/Item":10,"./module/Log":11,"./module/Loot":13,"./module/LootLog":14,"./module/Msg":15,"./module/Other":16,"./module/Post":17,"./module/Public":18,"./module/Read":19,"./module/Script":20,"./module/TmpLog":21,"./module/Util":22}],2:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.fixedDepositDueAlert=n.drawCurrentDeposit=n.handleBankPage=void 0;var o=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=e("./Util"),r=a(i),l=e("./Msg"),d=a(l),s=e("./Const"),c=function(e){return e&&e.__esModule?e:{default:e}}(s),p=e("./Log"),f=a(p),u=e("./TmpLog"),m=a(u),g=e("./Public"),h=a(g),v=(n.handleBankPage=function(){var e=$('.bank1 > tbody > tr:nth-child(2) > td:contains("当前所持：")');if(e.length){var t=e.html();e.html(t.replace(/当前所持：(-?\d+)KFB/,function(e,t){return'当前所持：<b id="pdCash" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b> KFB"}).replace(/活期存款：(-?\d+)KFB/,function(e,t){return'活期存款：<b id="pdCurrentDeposit" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b> KFB"}).replace(/定期存款：(-?\d+)KFB/,function(e,t){return'定期存款：<b id="pdFixedDeposit" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b> KFB"}).replace(/可获利息：(-?\d+)/,function(e,t){return'可获利息：<b id="pdInterest" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b> KFB "}).replace(/定期利息：([\d\.]+)%/,'定期利息：<b id="pdInterestRate" data-num="$1">$1</b>%').replace(/(，才可以获得利息）)/,'$1 <span id="pdExpireTime" style="color: #393;"></span>').replace(/(，取出定期将获得该数额的KFB利息\))/,'$1 <span id="pdExpectedInterest" style="color: #393;"></span>')),e.find("[data-num]").css("color","#f60");var n=$("#pdInterest"),a=parseInt(n.data("num"));a>0&&n.css("color","#393");var o=parseInt($("#pdFixedDeposit").data("num"));if(o>0&&0===a){var i=parseInt(m.getValue(c.default.fixedDepositDueTmpLogName));!isNaN(i)&&i>$.now()&&$("#pdExpireTime").text("(到期时间："+r.getDateString(new Date(i))+" "+r.getTimeString(new Date(i),":",!1)+")");var l=parseFloat($("#pdInterestRate").data("num"))/100,d=Math.round(o*l*c.default.fixedDepositDueTime);$("#pdExpectedInterest").text("(预期利息："+d.toLocaleString()+" KFB)")}$('form[name="form1"], form[name="form2"]').submit(function(){var e=$(this),t=0;t=e.is('[name="form2"]')?parseInt(e.find('input[name="drawmoney"]').val()):parseInt(e.find('input[name="savemoney"]').val()),2===parseInt(e.find('input[name="btype"]:checked').val())&&t>0&&m.setValue(c.default.fixedDepositDueTmpLogName,r.getDate("+"+c.default.fixedDepositDueTime+"d").getTime())}),$('form[name="form3"]').submit(function(){var e=parseInt($("#pdCurrentDeposit").data("num")),t=parseInt($("#pdFixedDeposit").data("num")),n=parseInt($('[name="to_money"]').val());if(!isNaN(n)&&t>0&&n>e&&!confirm("你的活期存款不足，转账金额将从定期存款里扣除，是否继续？"))return $(this).find('[type="submit"]').prop("disabled",!1),!1});var s=$('a[href="hack.php?H_name=bank&action=log"]').parent();s.html(s.html().replace(/\(手续费(\d+)%\)/,'(手续费<span id="pdFee" data-num="$1">$1</span>%)'));var p=$('form[name="form3"] > span:first');p.html(p.html().replace(/可转账额度：(\d+)/,function(e,t){return'可转账额度：<b id="pdTransferLimit" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b>"})),_(),$(document).on("change",'[name="savemoney"], [name="drawmoney"], [name="to_money"], [name="to_money"], [name="transfer_money"]',function(){var e=$(this),t=$.trim(e.val());t&&e.val(t.replace(/,/g,""))})}},function(e,t,n){var a=d.wait("<strong>正在存款中&hellip;</strong>");$.post("hack.php?H_name=bank",{action:"save",btype:1,savemoney:e},function(o){h.showFormatLog("存款",o);var i=r.getResponseMsg(o),l=i.msg;/完成存款/.test(l)?(d.remove(a),console.log("共有"+e+"KFB存入活期存款"),$("#pdCash").text((t-e).toLocaleString()).data("num",t-e),$("#pdCurrentDeposit").text((n+e).toLocaleString()).data("num",n+e),setTimeout(function(){$(document).dequeue("Bank")},c.default.bankActionInterval)):($(document).clearQueue("Bank"),alert("存款失败"))})}),b=(n.drawCurrentDeposit=function(e){var t=d.wait("<strong>正在取款中&hellip;</strong>");$.post("hack.php?H_name=bank",{action:"draw",btype:1,drawmoney:e},function(n){h.showFormatLog("取款",n);var a=r.getResponseMsg(n),o=a.msg;d.remove(t),/完成取款/.test(o)?(console.log("从活期存款中取出了"+e+"KFB"),d.show("<strong>从活期存款中取出了<em>"+e.toLocaleString()+"</em>KFB</strong>",-1)):d.show(o,-1)})},function(e,t,n,a,i){var l=0,s=0,p=0;$.each(e,function(n,u){var m=o(u,2),g=m[0],v=m[1];$(document).queue("Bank",function(){$.ajax({type:"POST",url:"hack.php?H_name=bank",timeout:c.default.defAjaxTimeout,data:"&action=virement&pwuser="+r.getGBKEncodeString(g)+"&to_money="+v+"&memo="+r.getGBKEncodeString(t),success:function(e){h.showFormatLog("批量转账",e);var t=r.getResponseMsg(e),n=t.msg,a=g+" <em>+"+v.toLocaleString()+"</em>";/完成转帐!/.test(n)?(l++,p+=v):(s++,/用户<b>.+?<\/b>不存在/.test(n)&&(n="用户不存在"),a+=' <span class="pd_notice">(错误：'+n+")</span>"),$(".pd_result:last").append("<li>"+a+"</li>")},error:function(){s++,$(".pd_result:last").append("\n<li>\n  "+g+":"+v.toLocaleString()+'\n  <span class="pd_notice">(错误：连接超时，转账可能失败，请到<a target="_blank" href="hack.php?H_name=bank&action=log">银行日志</a>里进行确认)</span>\n</li>\n')},complete:function(){var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1);var o=t.closest(".pd_msg").data("stop");o&&$(document).clearQueue("Bank"),o||n===e.length-1?(d.destroy(),l>0&&f.push("批量转账","共有`"+l+"`名用户转账成功",{pay:{KFB:-p}}),$("#pdCurrentDeposit").text((a-p).toLocaleString()).data("num",a-p),$("#pdTransferLimit").text((i-p).toLocaleString()).data("num",i-p),console.log("共有"+l+"名用户转账成功，共有"+s+"名用户转账失败，KFB-"+p),$(".pd_result:last").append("<li><b>共有<em>"+l+"</em>名用户转账成功"+(s>0?"，共有<em>"+s+"</em>名用户转账失败":"")+"：</b>KFB <ins>-"+p.toLocaleString()+"</ins></li>"),d.show("<strong>共有<em>"+l+"</em>名用户转账成功"+(s>0?"，共有<em>"+s+"</em>名用户转账失败":"")+"</strong><i>KFB<ins>-"+p.toLocaleString()+"</ins></i>",-1)):setTimeout(function(){return $(document).dequeue("Bank")},c.default.bankActionInterval)}})})}),n||$(document).dequeue("Bank")}),y=function(e){var t=e.find('[name="users"]'),n=t.val();if(!/^\s*\S+\s*$/m.test(n)||/^\s*:/m.test(n)||/:/.test(n)&&/:(\D|$)/m.test(n))return alert("用户列表格式不正确"),t.select().focus(),!1;if(/^\s*\S+?:0*[0-1]?\d\s*$/m.test(n))return alert("转帐金额不能小于20KFB"),t.select().focus(),!1;var a=e.find('[name="transfer_money"]'),o=parseInt(a.val());if(/^\s*[^:]+\s*$/m.test(n)){if(!$.isNumeric(o))return alert("通用转账金额格式不正确"),a.select().focus(),!1;if(o<20)return alert("转帐金额不能小于20KFB"),a.select().focus(),!1}return!0},_=function(){var e=$('\n<tr id="pdBankTransferArea">\n  <td style="vertical-align: top;">\n    使用说明：<br>每行一名用户，<br>如需单独设定金额，<br>可写为“用户名:金额”<br>（注意是<b>英文冒号</b>）<br>例子：<br>\n    <pre style="border: 1px solid #9999ff; padding: 5px;">张三\n李四:200\n王五:500\n信仰风</pre>\n  </td>\n  <td>\n  <form>\n    <div style="display: inline-block;">\n      <label>用户列表：<br>\n        <textarea class="pd_textarea" name="users" style="width: 270px; height: 250px;"></textarea>\n      </label>\n    </div>\n    <div style="display: inline-block; margin-left: 10px;">\n      <label>通用转帐金额（如所有用户都已设定单独金额则可留空）：<br>\n        <input class="pd_input" name="transfer_money" type="text" style="width: 217px;">\n      </label><br>\n      <label style="margin-top: 5px;">转帐附言（可留空）：<br>\n        <textarea class="pd_textarea" name="msg" style="width: 225px; height: 206px;"></textarea>\n      </label>\n    </div>\n    <div>\n      <button type="submit">批量转账</button>\n      <button type="reset">重置</button>\n      <button name="random" type="button" title="为用户列表上的每个用户设定指定范围内的随机金额">随机金额</button>\n      （活期存款不足时，将自动进行存款；批量转账金额不会从定期存款中扣除）\n      '+(r.isIE()||r.isEdge()?'<br><span class="pd_highlight">注：IE和Edge浏览器在批量转账给中文名用户时会出现乱码，请使用其它浏览器进行批量转账</span>':"")+"\n    </div>\n  </form>\n  </td>\n</tr>\n").appendTo(".bank1 > tbody");e.find("form").submit(function(t){if(t.preventDefault(),d.destroy(),y(e)){var n=parseInt(e.find('[name="transfer_money"]').val());n||(n=0);var a=e.find('[name="msg"]').val(),i=[],r=!0,l=!1,s=void 0;try{for(var c,p=e.find('[name="users"]').val().split("\n")[Symbol.iterator]();!(r=(c=p.next()).done);r=!0){var f=c.value;if(f=$.trim(f))if(f.includes(":")){var u=f.split(":"),m=o(u,2),g=m[0],h=m[1];if(void 0===h)continue;i.push([$.trim(g),parseInt(h)])}else i.push([f,n])}}catch(e){l=!0,s=e}finally{try{!r&&p.return&&p.return()}finally{if(l)throw s}}if(i.length){var _=parseInt($("#pdFee").data("num"));isNaN(_)&&(_=0);var x=0,k=!0,C=!1,w=void 0;try{for(var I,L=i[Symbol.iterator]();!(k=(I=L.next()).done);k=!0){x+=o(I.value,2)[1]}}catch(e){C=!0,w=e}finally{try{!k&&L.return&&L.return()}finally{if(C)throw w}}if(x=Math.floor(x*(1+_)),confirm("共计 "+i.length+" 名用户，总额 "+x.toLocaleString()+" KFB，是否转账？")){var S=d.wait("<strong>正在获取银行账户信息中&hellip;</strong>");$.get("hack.php?H_name=bank&t="+$.now(),function(t){d.remove(S);var n=0,o=0,r=0,l=/当前所持：(-?\d+)KFB/.exec(t);if(l&&(n=parseInt(l[1]),(l=/活期存款：(-?\d+)KFB/.exec(t))&&(o=parseInt(l[1]),l=/可转账额度：(\d+)/.exec(t)))){if(r=parseInt(l[1]),x>n+o)return void alert("资金不足");if(x>r)return void alert("转账额度不足");$(document).clearQueue("Bank");var s=!1,c=x-o;c>0&&(s=!0,$(document).queue("Bank",function(){v(c,n,o),n-=c,o+=c}),$(document).dequeue("Bank")),d.wait('<strong>正在批量转账中，请耐心等待&hellip;</strong><i>剩余：<em class="pd_countdown">'+i.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),e.find("> td:last-child").append('<ul class="pd_result pd_stat"><li><strong>转账结果：</strong></li></ul>'),b(i,a,s,o,r)}})}}}}).find('[name="random"]').click(function(){var t=[],n=!0,a=!1,o=void 0;try{for(var i,r=e.find('[name="users"]').val().split("\n")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;l=$.trim(l),l&&t.push($.trim(l.split(":")[0]))}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}if(t.length){var d=prompt("设定随机金额的范围（注：最低转账金额为20KFB）","20-100");if(null!==d){if(d=$.trim(d),!/^\d+-\d+$/.test(d))return void alert("随机金额范围格式不正确");var s=d.split("-"),c=parseInt(s[0]),p=parseInt(s[1]);if(p<c)return void alert("最大值不能低于最小值");var f="",u=!0,m=!1,g=void 0;try{for(var h,v=t[Symbol.iterator]();!(u=(h=v.next()).done);u=!0){f+=h.value+":"+Math.floor(Math.random()*(p-c+1)+c)+"\n"}}catch(e){m=!0,g=e}finally{try{!u&&v.return&&v.return()}finally{if(m)throw g}}e.find('[name="users"]').val(f)}}})};n.fixedDepositDueAlert=function(){console.log("定期存款到期提醒Start"),$.get("hack.php?H_name=bank&t="+$.now(),function(e){r.setCookie(c.default.fixedDepositDueAlertCookieName,1,r.getMidnightHourDate(1));var t=/可获利息：(\d+)/.exec(e);if(t){var n=parseInt(t[1]);n>0&&(r.setCookie(c.default.fixedDepositDueAlertCookieName,1,r.getMidnightHourDate(7)),confirm("您的定期存款已到期，共产生利息 "+n.toLocaleString()+" KFB，是否前往银行取款？")&&(location.href="hack.php?H_name=bank"))}})}},{"./Const":6,"./Log":11,"./Msg":15,"./Public":18,"./TmpLog":21,"./Util":22}],3:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.addStartBatchModeButton=void 0;var o=e("./Util"),i=a(o),r=e("./Const"),l=function(e){return e&&e.__esModule?e:{default:e}}(r),d=e("./Msg"),s=a(d),c=e("./Log"),p=a(c),f=e("./Public"),u=a(f),m=function(e,t){var n=0,a=0,o=0,r=0;$(document).clearQueue("ConvertCardsToVipTime"),$.each(e,function(d,c){$(document).queue("ConvertCardsToVipTime",function(){$.ajax({type:"GET",url:"kf_fw_card_doit.php?do=recard&id="+c+"&safeid="+t+"&t="+$.now(),timeout:l.default.defAjaxTimeout,success:function(e){u.showFormatLog("将卡片转换为VIP时间",e);var t=i.getResponseMsg(e),l=t.msg,d=/增加(\d+)小时VIP时间(?:.*?获得(\d+)点恢复能量)?/.exec(l);d?(n++,o+=parseInt(d[1]),void 0!==d[2]&&(r+=parseInt(d[2]))):a++},error:function(){a++},complete:function(){var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1);var i=t.closest(".pd_msg").data("stop");i&&$(document).clearQueue("ConvertCardsToVipTime"),i||d===e.length-1?(n>0&&p.push("将卡片转换为VIP时间","共有`"+n+"`张卡片成功为VIP时间",{gain:{"VIP小时":o,"能量":r},pay:{"卡片":-n}}),s.destroy(),console.log("共有"+n+"张卡片转换成功，共有"+a+"张卡片转换失败，VIP小时+"+o+"，能量+"+r),s.show("<strong>共有<em>"+n+"</em>张卡片转换成功"+(a>0?"，共有<em>"+a+"</em>张卡片转换失败":"")+"</strong><i>VIP小时<em>+"+o+"</em></i><i>能量<em>+"+r+"</em></i>",-1),$(".kf_fw_ig2 .pd_card_chk:checked").closest("td").fadeOut("normal",function(){var e=$(this).parent();$(this).remove(),e.children().length||e.remove()})):setTimeout(function(){$(document).dequeue("ConvertCardsToVipTime")},l.default.defAjaxInterval)}})})}),$(document).dequeue("ConvertCardsToVipTime")};n.addStartBatchModeButton=function(){var e=u.getSafeId();e&&$('.kf_fw_ig2 a[href^="kf_fw_card_my.php?id="]').length&&$('<div class="pd_item_btns"><button>开启批量模式</button></div>').insertAfter(".kf_fw_ig2").find("button").click(function(){var t=$(this),n=$(".kf_fw_ig2 > tbody > tr:gt(2)");if("开启批量模式"===t.text()){t.text("关闭批量模式"),n.on("click","a",function(e){e.preventDefault(),$(this).next(".pd_card_chk").click()}).find("td").has("a").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&$(this).css("position","relative").append('<input class="pd_card_chk" type="checkbox" value="'+e[1]+'">')});var a=[];$(".kf_fw_ig2 > tbody > tr:nth-child(2) > td").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&a.push(parseInt(e[1]))});var o=function(){var e=!0,t=!1,o=void 0;try{for(var i,r=a[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var l=i.value;n.find("td").has('a[href="kf_fw_card_my.php?id='+l+'"]').find('[type="checkbox"]').prop("checked",!1)}}catch(e){t=!0,o=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw o}}},r=$('\n<label><input name="uncheckPlayedCard" type="checkbox" checked> 不选已出战的卡片</label>\n<button name="selectOnlyOne" type="button">每类只保留一张</button>\n<button name="selectAll" type="button">全选</button>\n<button name="selectInverse" type="button">反选</button><br>\n<button name="convertCardsToVipTime" type="button">转换为VIP时间</button>\n').insertBefore(t);r.filter('[name="selectOnlyOne"]').click(function(){i.selectAll(n.find('[type="checkbox"]')),r.find('[name="uncheckPlayedCard"]').prop("checked")&&o();var e=new Set;n.find("a > img").each(function(){e.add($(this).attr("src"))});var t=!0,a=!1,l=void 0;try{for(var d,s=e[Symbol.iterator]();!(t=(d=s.next()).done);t=!0){var c=d.value,p=n.find("td").has('img[src="'+c+'"]'),f=p.length,u=p.has('[type="checkbox"]:checked').length;f>1?f===u&&p.eq(0).find('[type="checkbox"]:checked').prop("checked",!1):p.find('[type="checkbox"]:checked').prop("checked",!1)}}catch(e){a=!0,l=e}finally{try{!t&&s.return&&s.return()}finally{if(a)throw l}}}).end().filter('[name="selectAll"]').click(function(){i.selectAll(n.find('[type="checkbox"]')),r.find('[name="uncheckPlayedCard"]').prop("checked")&&o()}).end().filter('[name="selectInverse"]').click(function(){i.selectInverse(n.find('[type="checkbox"]')),r.find('[name="uncheckPlayedCard"]').prop("checked")&&o()}).end().filter('[name="convertCardsToVipTime"]').click(function(){s.destroy();var t=[];n.find('[type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length&&confirm("共选择了"+t.length+"张卡片，是否将卡片批量转换为VIP时间？")&&(s.wait('<strong>正在批量转换中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),m(t,e))})}else t.text("开启批量模式"),n.off("click").find(".pd_card_chk").remove(),t.prevAll().remove()})}},{"./Const":6,"./Log":11,"./Msg":15,"./Public":18,"./Util":22}],4:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.normalize=n.changeStorageType=n.clear=n.write=n.read=n.init=n.Config=void 0;var i=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e("./Info"),l=o(r),d=e("./Util"),s=a(d),c=e("./Const"),p=o(c),f=e("./Log"),u=a(f),m=e("./TmpLog"),g=a(m),h=e("./LootLog"),v=a(h),b=p.default.storagePrefix+"config",y=n.Config={timingModeEnabled:!1,showTimingModeTipsType:"auto",autoGetDailyBonusEnabled:!1,getBonusAfterLootCompleteEnabled:!1,getBonusAfterSpeakCompleteEnabled:!1,autoPromoteHaloEnabled:!1,promoteHaloCostType:1,promoteHaloInterval:8,promoteHaloAutoIntervalEnabled:!0,promoteHaloLimit:0,autoLootEnabled:!1,attackTargetLevel:0,autoSaveLootLogInSpecialCaseEnabled:!1,checkLootAfterTime:"00:05:00",lootLogSaveDays:7,showChangePointsInfoEnabled:!1,levelPointList:{},autoChangeLevelPointsEnabled:!1,customPointsScriptEnabled:!1,unusedPointNumAlertEnabled:!0,slowAttackEnabled:!1,alwaysOpenPointAreaEnabled:!1,showLevelEnemyStatEnabled:!1,showLiteLootLogEnabled:!1,atTipsHandleType:"no_highlight",smLevelUpAlertEnabled:!1,fixedDepositDueAlertEnabled:!1,smRankChangeAlertEnabled:!1,homePageThreadFastGotoLinkEnabled:!0,showVipSurplusTimeEnabled:!1,showFastGotoThreadPageEnabled:!1,maxFastGotoThreadPageNum:5,perPageFloorNum:10,highlightNewPostEnabled:!0,adjustThreadContentWidthEnabled:!1,threadContentFontSize:0,customMySmColor:"",customSmColorEnabled:!1,customSmColorConfigList:[],modifyKfOtherDomainEnabled:!0,multiQuoteEnabled:!0,userMemoEnabled:!1,userMemoList:{},parseMediaTagEnabled:!0,turnPageViaKeyboardEnabled:!1,buyThreadNoJumpEnabled:!0,preventCloseWindowWhenEditPostEnabled:!0,autoSavePostContentWhenSubmitEnabled:!1,kfSmileEnhanceExtensionEnabled:!1,defShowMsgDuration:-1,animationEffectOffEnabled:!1,showSearchLinkEnabled:!0,addFastNavMenuEnabled:!0,modifySideBarEnabled:!1,customCssEnabled:!1,customCssContent:"",customScriptEnabled:!1,customScriptList:[],browseType:"auto",followUserEnabled:!1,followUserList:[],highlightFollowUserThreadInHPEnabled:!0,highlightFollowUserThreadLinkEnabled:!0,blockUserEnabled:!1,blockUserDefaultType:0,blockUserAtTipsEnabled:!0,blockUserForumType:0,blockUserFidList:[],blockUserList:[],blockThreadEnabled:!1,blockThreadDefForumType:0,blockThreadDefFidList:[],blockThreadList:[],autoSaveCurrentDepositEnabled:!1,saveCurrentDepositAfterKfb:0,saveCurrentDepositKfb:0,logSaveDays:30,logSortType:"time",logStatType:"current",logStatDays:7,autoChangeIdColorEnabled:!1,autoChangeIdColorType:"random",autoChangeIdColorInterval:24,changeAllAvailableIdColorEnabled:!0,customAutoChangeIdColorList:[],slowActionEnabled:!1,armsMemo:{},smeltArmsAfterOpenBoxesEnabled:!1,useItemsAfterOpenBoxesEnabled:!1,sellItemsAfterOpenBoxesEnabled:!1,defOpenBoxTypeList:[],defSmeltArmTypeList:[],defUseItemTypeList:[],defSellItemTypeList:[]},_=(n.init=function(){l.default.w.Config=$.extend(!0,{},y),"undefined"!=typeof GM_getValue&&(l.default.storageType=GM_getValue("StorageType"),"ByUid"!==l.default.storageType&&"Global"!==l.default.storageType&&(l.default.storageType="Default")),_()},n.read=function(){var e=s.readData("ByUid"===l.default.storageType?b+"_"+l.default.uid:b);if(e){try{e=JSON.parse(e)}catch(e){return}e&&"object"===$.type(e)&&!$.isEmptyObject(e)&&(e=k(e),l.default.w.Config=$.extend(!0,{},y,e))}}),x=n.write=function(){var e=s.getDifferenceSetOfObject(y,l.default.w.Config);s.writeData("ByUid"===l.default.storageType?b+"_"+l.default.uid:b,JSON.stringify(e))},k=(n.clear=function(){return s.deleteData("ByUid"===l.default.storageType?b+"_"+l.default.uid:b)},n.changeStorageType=function(e){var t=u.read(),n=g.read(),a=v.read();l.default.storageType=e,"undefined"!=typeof GM_setValue&&GM_setValue("StorageType",l.default.storageType),s.deepEqual(y,l.default.w.Config)&&$.isEmptyObject(t)||confirm("是否将助手设置和日志转移到对应存储类型中？（对应存储类型中的数据将被覆盖）")&&(x(),u.write(t),g.write(n),v.write(a))},n.normalize=function(e){var t={};if("object"!==$.type(e))return t;var n=!0,a=!1,o=void 0;try{for(var r,l=s.entries(e)[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var d=i(r.value,2),c=d[0],p=d[1];c in y&&$.type(p)===$.type(y[c])&&(t[c]=p)}}catch(e){a=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}return void 0!==t.lootLogSaveDays&&t.lootLogSaveDays>20&&(t.lootLogSaveDays=20),t})},{"./Const":6,"./Info":9,"./Log":11,"./LootLog":14,"./TmpLog":21,"./Util":22}],5:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.show=void 0;var _slicedToArray=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Config=require("./Config"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_Public=require("./Public"),Public=_interopRequireWildcard(_Public),_Script=require("./Script"),Script=_interopRequireWildcard(_Script),show=exports.show=function(){if(!($("#pdConfigDialog").length>0)){(0,_Config.read)(),Script.runFunc("ConfigDialog.show_before_")
;var e='\n<div class="pd_cfg_main">\n  <div class="pd_cfg_nav">\n    <a class="pd_btn_link" data-name="clearTmpData" title="清除与助手有关的Cookies和本地存储数据（不包括助手设置和日志）" href="#">清除临时数据</a>\n    <a class="pd_btn_link" data-name="openRumCommandDialog" href="#">运行命令</a>\n    <a class="pd_btn_link" data-name="openImportOrExportSettingDialog" href="#">导入/导出设置</a>\n  </div>\n\n  <div class="pd_cfg_panel" style="margin-bottom: 5px;">\n    <fieldset>\n      <legend>\n        <label>\n          <input name="timingModeEnabled" type="checkbox"> 定时模式\n          <span class="pd_cfg_tips" title="可按时进行自动操作（包括自动领取每日奖励、自动提升战力光环、自动争夺，需开启相关功能）\n只在论坛首页和争夺首页生效（不开启此模式的话只能在刷新页面后才会进行操作）">[?]</span>\n        </label>\n      </legend>\n      <label>\n        标题提示方案\n        <select name="showTimingModeTipsType">\n          <option value="auto">停留一分钟后显示</option>\n          <option value="always">总是显示</option>\n          <option value="never">不显示</option>\n        </select>\n        <span class="pd_cfg_tips" title="在首页的网页标题上显示定时模式提示的方案">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label><input name="autoGetDailyBonusEnabled" type="checkbox"> 自动领取每日奖励</label>\n      </legend>\n      <label>\n        <input name="getBonusAfterLootCompleteEnabled" type="checkbox"> 完成争夺后才领取\n        <span class="pd_cfg_tips" title="在完成争夺奖励后才领取每日奖励">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="getBonusAfterSpeakCompleteEnabled" type="checkbox"> 完成发言后才领取\n        <span class="pd_cfg_tips" title="在完成发言奖励后才领取每日奖励">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label><input name="autoPromoteHaloEnabled" type="checkbox"> 自动提升战力光环</label>\n      </legend>\n      <label>\n        花费\n        <select name="promoteHaloCostType" required>\n          <option value="1">100KFB</option>\n          <option value="2">1000KFB</option>\n          <option value="11">0.2贡献</option>\n          <option value="12">2贡献</option>\n        </select>\n        <span class="pd_cfg_tips" title="提升战力光环的花费类型">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n         高于 <input name="promoteHaloLimit" type="number" min="0" step="0.1" style="width: 55px;" required>\n         <span data-id="promoteHaloLimitUnit">KFB</span>时\n         <span class="pd_cfg_tips" title="在操作后所剩余的KFB或贡献高于指定值时才自动提升战力光环，设为0表示不限制">[?]</span>\n      </label><br>\n      <label>\n        每隔 <input name="promoteHaloInterval" type="number" min="8" style="width: 40px;" required> 小时\n        <span class="pd_cfg_tips" title="自动提升战力光环的间隔时间，最低值：8小时">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="promoteHaloAutoIntervalEnabled" type="checkbox" data-mutex="[name=promoteHaloInterval]"> 自动判断\n        <span class="pd_cfg_tips" title="自动判断提升战力光环的间隔时间（在有剩余次数时尽可能使用）">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>争夺相关</legend>\n      <label>\n        <input name="autoLootEnabled" type="checkbox" data-mutex="[name=autoSaveLootLogInSpecialCaseEnabled]"> 自动争夺\n        <span class="pd_cfg_tips" title="当发现可以进行争夺时，会跳转到争夺首页进行自动攻击（点数分配等相关功能请在争夺首页上设置）">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        攻击到第 <input name="attackTargetLevel" type="number" min="0" style="width: 40px;" required> 层\n        <span class="pd_cfg_tips" title="自动争夺的目标攻击层数（设为0表示攻击到被击败为止）">[?]</span>\n      </label><br>\n      <label>\n        <input name="autoSaveLootLogInSpecialCaseEnabled" type="checkbox"> 在不使用助手争夺的情况下自动保存争夺记录\n        <span class="pd_cfg_tips" title="在不使用助手争夺的情况下自动检查并保存争夺记录（使用助手进行争夺的用户请勿勾选此选项）">[?]</span>\n      </label><br>\n      <label>\n        在 <input name="checkLootAfterTime" type="text" maxlength="8" style="width: 55px;" required> 之后争夺\n        <span class="pd_cfg_tips" title="在当天的指定时间之后检查争夺情况（本地时间），例：00:05:00">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        争夺记录保存天数 <input name="lootLogSaveDays" type="number" min="1" max="20" style="width: 40px;" required>\n        <span class="pd_cfg_tips" title="默认值：'+_Config.Config.lootLogSaveDays+'，最大值：20">[?]</span>\n      </label><br>\n      <label>\n        <input name="showChangePointsInfoEnabled" type="checkbox"> 在首页显示改点剩余次数\n        <span class="pd_cfg_tips" title="在首页显示改点剩余次数，冷却时则显示倒计时">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>帖子页面相关</legend>\n      <label>\n        帖子每页楼层数量\n        <select name="perPageFloorNum">\n          <option value="10">10</option>\n          <option value="20">20</option>\n          <option value="30">30</option>\n        </select>\n        <span class="pd_cfg_tips" title="用于电梯直达和帖子页数快捷链接等功能，如果修改了论坛设置里的“文章列表每页个数”，请在此修改成相同的数目">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        帖子内容字体大小 <input name="threadContentFontSize" type="number" min="7" max="72" style="width: 40px;"> px\n        <span class="pd_cfg_tips" title="帖子内容字体大小，留空表示使用默认大小，推荐值：14">[?]</span>\n      </label><br>\n      <label>\n        <input name="adjustThreadContentWidthEnabled" type="checkbox"> 调整帖子内容宽度\n        <span class="pd_cfg_tips" title="调整帖子内容宽度，使其保持一致">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="turnPageViaKeyboardEnabled" type="checkbox"> 通过左右键翻页\n        <span class="pd_cfg_tips" title="在帖子和搜索页面通过左右键进行翻页">[?]</span>\n      </label><br>\n      <label>\n        <input name="autoChangeIdColorEnabled" type="checkbox" data-disabled="[data-name=openAutoChangeSmColorPage]"> 自动更换ID颜色\n        <span class="pd_cfg_tips" title="可自动更换ID颜色，请点击详细设置前往相应页面进行自定义设置">[?]</span>\n      </label>\n      <a data-name="openAutoChangeSmColorPage" class="pd_cfg_ml" target="_blank" href="kf_growup.php">详细设置&raquo;</a><br>\n      <label>\n        自定义本人的神秘颜色 <input name="customMySmColor" maxlength="7" style="width: 50px;" type="text">\n        <input style="margin-left: 0;" type="color" data-name="customMySmColorSelect">\n        <span class="pd_cfg_tips" title="自定义本人的神秘颜色（包括帖子页面的ID显示颜色和楼层边框颜色，仅自己可见），例：#009cff，如无需求可留空">[?]</span>\n      </label><br>\n      <label>\n        <input name="customSmColorEnabled" type="checkbox" data-disabled="[data-name=openCustomSmColorDialog]"> 自定义各等级神秘颜色\n        <span class="pd_cfg_tips" title="自定义各等级神秘颜色（包括帖子页面的ID显示颜色和楼层边框颜色，仅自己可见），请点击详细设置自定义各等级颜色">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomSmColorDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="userMemoEnabled" type="checkbox" data-disabled="[data-name=openUserMemoDialog]"> 显示用户备注\n        <span class="pd_cfg_tips" title="在楼层内的用户名旁显示该用户的自定义备注，请点击详细设置自定义用户备注">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openUserMemoDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="modifyKfOtherDomainEnabled" type="checkbox"> 将绯月其它域名的链接修改为当前域名\n        <span class="pd_cfg_tips" title="将帖子和短消息中的绯月其它域名的链接修改为当前域名">[?]</span>\n      </label><br>\n      <label>\n        <input name="multiQuoteEnabled" type="checkbox"> 开启多重引用功能\n        <span class="pd_cfg_tips" title="在帖子页面开启多重回复和多重引用功能">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="parseMediaTagEnabled" type="checkbox"> 解析多媒体标签\n        <span class="pd_cfg_tips" title="在帖子页面解析HTML5多媒体标签，详见【常见问题12】">[?]</span>\n      </label><br>\n      <label>\n        <input name="buyThreadNoJumpEnabled" type="checkbox"> 购买帖子时不跳转\n        <span class="pd_cfg_tips" title="使用Ajax的方式购买帖子，购买时页面不会跳转">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="kfSmileEnhanceExtensionEnabled" type="checkbox" '+(_Info2.default.isInMiaolaDomain?"":"disabled")+'> 开启绯月表情增强插件\n        <span class="pd_cfg_tips" title="在发帖框上显示绯月表情增强插件（仅在miaola.info域名下生效），该插件由eddie32开发">[?]</span>\n      </label><br>\n      <label>\n        <input name="preventCloseWindowWhenEditPostEnabled" type="checkbox"> 写帖子时阻止关闭页面\n        <span class="pd_cfg_tips" title="在撰写发帖内容时，如不小心关闭了页面会进行提示">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="autoSavePostContentWhenSubmitEnabled" type="checkbox"> 提交时保存发帖内容\n        <span class="pd_cfg_tips" title="在提交时自动保存发帖内容，以便在出现意外情况时能够恢复发帖内容（需在不关闭当前标签页的情况下才能起效）">[?]</span>\n      </label>\n    </fieldset>\n  </div>\n\n  <div class="pd_cfg_panel">\n    <fieldset>\n      <legend>首页相关</legend>\n      <label>\n        @提醒\n        <select name="atTipsHandleType" style="width: 140px;">\n          <option value="no_highlight">取消已读提醒高亮</option>\n          <option value="no_highlight_extra">取消已读提醒高亮，并在无提醒时补上消息框</option>\n          <option value="hide_box_1">不显示已读提醒的消息框</option>\n          <option value="hide_box_2">永不显示消息框</option>\n          <option value="default">保持默认</option>\n          <option value="at_change_to_cao">将@改为艹(其他和方式2相同)</option>\n        </select>\n        <span class="pd_cfg_tips" title="对首页上的有人@你的消息框进行处理的方案">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="smLevelUpAlertEnabled" type="checkbox"> 神秘等级升级提醒\n        <span class="pd_cfg_tips" title="在神秘等级升级后进行提醒，只在首页生效">[?]</span>\n      </label><br>\n      <label>\n        <input name="fixedDepositDueAlertEnabled" type="checkbox"> 定期存款到期提醒\n        <span class="pd_cfg_tips" title="在定时存款到期时进行提醒，只在首页生效">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="smRankChangeAlertEnabled" type="checkbox"> 系数排名变化提醒\n        <span class="pd_cfg_tips" title="在神秘系数排名发生变化时进行提醒，只在首页生效">[?]</span>\n      </label><br>\n      <label>\n        <input name="homePageThreadFastGotoLinkEnabled" type="checkbox"> 在首页帖子旁显示跳转链接\n        <span class="pd_cfg_tips" title="在首页帖子链接旁显示快速跳转至页末的链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="showVipSurplusTimeEnabled" type="checkbox"> 显示VIP剩余时间\n        <span class="pd_cfg_tips" title="在首页显示VIP剩余时间">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>版块页面相关</legend>\n      <label>\n        <input name="showFastGotoThreadPageEnabled" type="checkbox" data-disabled="[name=maxFastGotoThreadPageNum]"> 显示帖子页数快捷链接\n        <span class="pd_cfg_tips" title="在版块页面中显示帖子页数快捷链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        页数链接最大数量 <input name="maxFastGotoThreadPageNum" type="number" min="1" max="10" style="width: 40px;" required>\n        <span class="pd_cfg_tips" title="在帖子页数快捷链接中显示页数链接的最大数量">[?]</span>\n      </label><br>\n      <label>\n        <input name="highlightNewPostEnabled" type="checkbox"> 高亮今日的新帖\n        <span class="pd_cfg_tips" title="在版块页面中高亮今日新发表帖子的发表时间">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>其它设置</legend>\n      <label class="pd_highlight">\n        存储类型\n        <select data-name="storageType">\n          <option value="Default">默认</option>\n          <option value="ByUid">按uid</option>\n          <option value="Global">全局</option>\n        </select>\n        <span class="pd_cfg_tips" title="助手设置和日志的存储方式，详情参见【常见问题1】">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        浏览器类型\n        <select name="browseType">\n          <option value="auto">自动检测</option>\n          <option value="desktop">桌面版</option>\n          <option value="mobile">移动版</option>\n        </select>\n        <span class="pd_cfg_tips" title="用于在KFOL助手上判断浏览器的类型，一般使用自动检测即可；\n如果当前浏览器与自动检测的类型不相符（移动版会在设置界面标题上显示“For Mobile”的字样），请手动设置为正确的类型">[?]</span>\n      </label><br>\n      <label>\n        消息显示时间 <input name="defShowMsgDuration" type="number" min="-1" style="width: 46px;" required> 秒\n        <span class="pd_cfg_tips" title="默认的消息显示时间（秒），设置为-1表示永久显示，例：15">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        日志保存天数 <input name="logSaveDays" type="number" min="1" max="365" style="width: 46px;" required>\n        <span class="pd_cfg_tips" title="默认值：'+_Config.Config.logSaveDays+'">[?]</span>\n      </label><br>\n      <label>\n        <input name="showSearchLinkEnabled" type="checkbox"> 显示搜索链接\n        <span class="pd_cfg_tips" title="在用户菜单上显示搜索对话框的链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="animationEffectOffEnabled" type="checkbox"> 禁用动画效果\n        <span class="pd_cfg_tips" title="禁用jQuery的动画效果（推荐在配置较差的机器上使用）">[?]</span>\n      </label><br>\n      <label>\n        <input name="addFastNavMenuEnabled" type="checkbox"> 添加快捷导航菜单\n        <span class="pd_cfg_tips" title="为顶部导航栏添加快捷导航菜单">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="modifySideBarEnabled" type="checkbox"> 将侧边栏修改为平铺样式\n        <span class="pd_cfg_tips" title="将侧边栏修改为和手机相同的平铺样式">[?]</span>\n      </label><br>\n      <label>\n        <input name="customCssEnabled" type="checkbox" data-disabled="[data-name=openCustomCssDialog]"> 添加自定义CSS\n        <span class="pd_cfg_tips" title="为页面添加自定义的CSS内容，请点击详细设置填入自定义的CSS内容">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomCssDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="customScriptEnabled" type="checkbox" data-disabled="[data-name=openCustomScriptDialog]"> 执行自定义脚本\n        <span class="pd_cfg_tips" title="执行自定义的javascript脚本，请点击详细设置填入自定义的脚本内容">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomScriptDialog" href="#">详细设置&raquo;</a>\n    </fieldset>\n    <fieldset>\n      <legend>关注和屏蔽</legend>\n      <label>\n        <input name="followUserEnabled" type="checkbox" data-disabled="[data-name=openFollowUserDialog]"> 关注用户\n        <span class="pd_cfg_tips" title="开启关注用户的功能，所关注的用户将被加注记号，请点击详细设置管理关注用户">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openFollowUserDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="blockUserEnabled" type="checkbox" data-disabled="[data-name=openBlockUserDialog]"> 屏蔽用户\n        <span class="pd_cfg_tips" title="开启屏蔽用户的功能，你将看不见所屏蔽用户的发言，请点击详细设置管理屏蔽用户">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openBlockUserDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="blockThreadEnabled" type="checkbox" data-disabled="[data-name=openBlockThreadDialog]"> 屏蔽帖子\n        <span class="pd_cfg_tips" title="开启屏蔽标题中包含指定关键字的帖子的功能，请点击详细设置管理屏蔽关键字">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openBlockThreadDialog" href="#">详细设置&raquo;</a><br>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label>\n          <input name="autoSaveCurrentDepositEnabled" type="checkbox"> 自动活期存款\n          <span class="pd_cfg_tips" title="在当前收入满足指定额度之后自动将指定数额存入活期存款中，只会在首页触发">[?]</span>\n        </label>\n      </legend>\n      <label>\n        在当前收入已满 <input name="saveCurrentDepositAfterKfb" type="number" min="1" style="width: 80px;"> KFB之后\n        <span class="pd_cfg_tips" title="在当前收入已满指定KFB额度之后自动进行活期存款，例：1000">[?]</span>\n      </label><br>\n      <label>\n        将 <input name="saveCurrentDepositKfb" type="number" min="1" style="width: 80px;"> KFB存入活期存款\n        <span class="pd_cfg_tips" title="将指定额度的KFB存入活期存款中，例：900；举例：设定已满1000存900，当前收入为2000，则自动存入金额为1800">[?]</span>\n      </label>\n    </fieldset>\n  </div>\n</div>\n\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a target="_blank" href="read.php?tid=508450">By 喵拉布丁</a>\n    <i style="color: #666; font-style: normal;">(V'+_Info2.default.version+')</i>\n    <a target="_blank" href="https://git.oschina.net/miaolapd/KF_Online_Assistant/wikis/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">[常见问题]</a>\n  </span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n  <button name="default" type="button">默认值</button>\n</div>',t=Dialog.create("pdConfigDialog","KFOL助手设置"+(_Info2.default.isMobile?" (For Mobile)":""),e);t.submit(function(e){if(e.preventDefault(),verifyMainConfig(t)){var n=Config.timingModeEnabled;(0,_Config.read)();var a=getMainConfigValue(t);a=(0,_Config.normalize)(a),$.extend(Config,a),(0,_Config.write)();var o=t.find('[data-name="storageType"]').val();if(o!==_Info2.default.storageType){if(!confirm("是否修改存储类型？"))return;return(0,_Config.changeStorageType)(o),alert("存储类型已修改"),void location.reload()}Dialog.close("pdConfigDialog"),n!==a.timingModeEnabled&&confirm("你已修改了定时模式的设置，需要刷新页面才能生效，是否立即刷新？")&&location.reload()}}).find('[name="default"]').click(function(){confirm("是否重置所有设置？")&&((0,_Config.clear)(),alert("设置已重置"),location.reload())}).end().find('[data-name="clearTmpData"]').click(function(e){e.preventDefault();var t=prompt("可清除与助手有关的Cookies和本地临时数据（不包括助手设置和日志）\n请填写清除类型，0：全部清除；1：清除Cookies；2：清除本地临时数据",0);null!==t&&(t=parseInt(t),!isNaN(t)&&t>=0&&(clearTmpData(t),alert("缓存已清除")))}),t.on("click",'a[data-name^="open"][href="#"]',function(e){e.preventDefault();var t=$(this);if(!t.hasClass("pd_disabled_link")){var n=t.data("name");"openRumCommandDialog"===n&&showRunCommandDialog(),"openImportOrExportSettingDialog"===n&&showImportOrExportSettingDialog(),"openCustomSmColorDialog"===n?showCustomSmColorDialog():"openUserMemoDialog"===n?showUserMemoDialog():"openCustomCssDialog"===n?showCustomCssDialog():"openCustomScriptDialog"===n?Script.showDialog():"openFollowUserDialog"===n?showFollowUserDialog():"openBlockUserDialog"===n?showBlockUserDialog():"openBlockThreadDialog"===n&&showBlockThreadDialog()}}).find('[name="promoteHaloCostType"]').change(function(){var e=parseInt($(this).val());t.find('[data-id="promoteHaloLimitUnit"]').text(e>=11?"贡献":"KFB")}).end().find('[data-name="customMySmColorSelect"]').change(function(){t.find('[name="customMySmColor"]').val($(this).val().toString().toLowerCase())}).end().find('[name="customMySmColor"]').change(function(){var e=$.trim($(this).val());/^#[0-9a-fA-F]{6}$/.test(e)&&t.find('[data-name="customMySmColorSelect"]').val(e.toLowerCase())}),setMainConfigValue(t),Dialog.show("pdConfigDialog"),Script.runFunc("ConfigDialog.show_after_")}},setMainConfigValue=function(e){e.find("input[name], select[name]").each(function(){var e=$(this),t=e.attr("name");t in Config&&(e.is('[type="checkbox"]')&&"boolean"==typeof Config[t]?e.prop("checked",Config[t]===!0):e.val(Config[t]))}),e.find('[name="promoteHaloCostType"]').trigger("change"),e.find('[name="threadContentFontSize"]').val(Config.threadContentFontSize>0?Config.threadContentFontSize:""),e.find('[data-name="customMySmColorSelect"]').val(Config.customMySmColor),e.find('[data-name="storageType"]').val(_Info2.default.storageType),"undefined"==typeof GM_getValue&&e.find('[data-name="storageType"] > option:gt(0)').prop("disabled",!0)},getMainConfigValue=function(e){var t={};return e.find("input[name], select[name]").each(function(){var e=$(this),n=e.attr("name");if(n in Config)if(e.is('[type="checkbox"]')&&"boolean"==typeof Config[n])t[n]=Boolean(e.prop("checked"));else if("number"==typeof Config[n]){var a=$.trim(e.val());/\d+\.\d+/.test(a)?t[n]=parseFloat(a):t[n]=parseInt(a),"threadContentFontSize"===n&&isNaN(t[n])&&(t[n]=0)}else t[n]=$.trim(e.val())}),t},verifyMainConfig=function(e){var t=e.find('[name="checkLootAfterTime"]'),n=$.trim(t.val());if(!/^(2[0-3]|[0-1][0-9]):[0-5][0-9]:[0-5][0-9]$/.test(n))return alert("在指定时间之后争夺格式不正确"),t.select().focus(),!1;var a=e.find('[name="customMySmColor"]'),o=$.trim(a.val());if(o&&!/^#[0-9a-fA-F]{6}$/.test(o))return alert("自定义本人的神秘颜色格式不正确，例：#009cff"),a.select().focus(),!1;var i=e.find('[name="saveCurrentDepositAfterKfb"]'),r=e.find('[name="saveCurrentDepositKfb"]'),l=parseInt(i.val()),d=parseInt(r.val());if(l||d){if(!l||l<=0)return alert("自动活期存款满足额度格式不正确"),i.select().focus(),!1;if(!d||d<=0||d>l)return alert("想要存款的金额格式不正确"),r.select().focus(),!1}return!0},clearTmpData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e||1===e)for(var t in _Const2.default)/CookieName$/.test(t)&&Util.deleteCookie(_Const2.default[t]);0!==e&&2!==e||(TmpLog.clear(),localStorage.removeItem(_Const2.default.multiQuoteStorageName),localStorage.removeItem(_Const2.default.tempPointsLogListStorageName))},showRunCommandDialog=function(){if(!($("#pdRunCommandDialog").length>0)){Dialog.close("pdConfigDialog");var e=Dialog.create("pdRunCommandDialog","运行命令",'\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">\n    运行命令快捷键：<b>Ctrl+Enter</b>；清除命令快捷键：<b>Ctrl+退格键</b><br>\n    按<b>F12键</b>可打开浏览器控制台查看消息（需切换至控制台或Console标签）\n  </div>\n  <textarea name="cmd" wrap="off" style="width: 750px; height: 300px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit">运行</button>\n  <button name="clear" type="button">清除</button>\n  <button data-action="close" type="button">关闭</button>\n</div>'),t=e.find('[name="cmd"]');e.submit(function(e){e.preventDefault();var n=t.val();n&&Script.runCmd(n,!0)}).end().find('[name="clear"]').click(function(){t.val("").focus()}),t.keydown(function(t){t.ctrlKey&&13===t.keyCode?e.submit():t.ctrlKey&&8===t.keyCode&&e.find('[name="clear"]').click()}),Dialog.show("pdRunCommandDialog"),t.focus()}},showImportOrExportSettingDialog=function(){var e="pdImOrExSettingDialog";if(!($("#"+e).length>0)){(0,_Config.read)();var t=Dialog.create(e,"导入或导出设置",'\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到别处即可\n  </div>\n  <textarea name="setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find('[name="setting"]');t.submit(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim(n.val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("设置有错误")}if(!t||"object"!==$.type(t))return void alert("设置有错误");t=(0,_Config.normalize)(t),_Info2.default.w.Config=$.extend(!0,{},_Config.Config,t),(0,_Config.write)(),alert("设置已导入"),location.reload()}}}),Dialog.show(e),n.val(JSON.stringify(Util.getDifferenceSetOfObject(_Config.Config,Config))).select().focus()}},showCustomSmColorDialog=function(){var e="pdCustomSmColorDialog";if(!($("#"+e).length>0)){var t=Dialog.create(e,"自定义各等级神秘颜色",'\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    <strong>\n      示例（<a target="_blank" href="http://www.35ui.cn/jsnote/peise.html">常用配色表</a> / \n      <a target="_blank" href="read.php?tid=488016">配色方案收集贴</a>）：\n    </strong><br>\n    <b>等级范围：</b>4-4 <b>颜色：</b><span style="color: #0000ff;">#0000ff</span><br>\n    <b>等级范围：</b>10-99 <b>颜色：</b><span style="color: #5ad465;">#5ad465</span><br>\n    <b>等级范围：</b>5000-MAX <b>颜色：</b><span style="color: #ff0000;">#ff0000</span>\n  </div>\n  <ul data-name="smColorList"></ul>\n  <div style="margin-top: 5px;" data-name="customSmColorAddBtns">\n    <a class="pd_btn_link" data-action="addOne" href="#">增加1个</a>\n    <a class="pd_btn_link" data-action="addFive" href="#">增加5个</a>\n    <a class="pd_btn_link" data-action="clear" href="#">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExCustomSmColorConfigDialog" href="#">导入/导出配色方案</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',"min-width: 327px;"),n=t.find('[data-name="smColorList"]');n.on("change",'[name="color"]',function(){var e=$(this),t=$.trim(e.val());/^#[0-9a-fA-F]{6}$/.test(t)&&e.next('[type="color"]').val(t.toLowerCase())}).on("change",'[type="color"]',function(){var e=$(this);e.prev('[type="text"]').val(e.val().toString().toLowerCase())}).on("click","a",function(e){e.preventDefault(),$(this).closest("li").remove()});var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.min,n=void 0===t?"":t,a=e.max,o=void 0===a?"":a,i=e.color,r=void 0===i?"":i;return'\n<li>\n  <label>等级范围 <input name="min" type="text" maxlength="5" style="width: 30px;" value="'+n+'"></label>\n  <label>- <input name="max" type="text" maxlength="5" style="width: 30px;" value="'+o+'"></label>\n  <label>\n    &nbsp;颜色 <input name="color" type="text" maxlength="7" style="width: 50px;" value="'+r+'">\n    <input style="margin-left: 0;" type="color" value="'+r+'">\n  </label>\n  <a href="#">删除</a>\n</li>'},o="",i=!0,r=!1,l=void 0;try{for(var d,s=Config.customSmColorConfigList[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){o+=a(d.value)}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}n.html(o),t.submit(function(t){t.preventDefault();var a=[],o=!0;n.find("li").each(function(){var e=$(this),t=e.find('[name="min"]'),n=$.trim(t.val()).toUpperCase();if(""!==n){if(!/^(-?\d+|MAX)$/i.test(n))return o=!1,t.select().focus(),alert("等级范围格式不正确"),!1;var i=e.find('[name="max"]'),r=$.trim(i.val()).toUpperCase();if(""!==r){if(!/^(-?\d+|MAX)$/i.test(r))return o=!1,i.select().focus(),alert("等级范围格式不正确"),!1;if(Util.compareSmLevel(r,n)<0)return o=!1,t.select().focus(),alert("等级范围格式不正确"),!1;var l=e.find('[name="color"]'),d=$.trim(l.val()).toLowerCase();if(""!==d)return/^#[0-9a-fA-F]{6}$/.test(d)?void a.push({min:n,max:r,color:d}):(o=!1,l.select().focus(),alert("颜色格式不正确"),!1)}}}),o&&(a.sort(function(e,t){return Util.compareSmLevel(e.min,t.min)>0?1:-1}),Config.customSmColorConfigList=a,(0,_Config.write)(),Dialog.close(e))}).find('[data-action="addOne"], [data-action="addFive"]').click(function(t){t.preventDefault();var o=1;$(this).is('[data-action="addFive"]')&&(o=5);for(var i=1;i<=o;i++)n.append(a());Dialog.resize(e)}).end().find('[data-action="clear"]').click(function(t){t.preventDefault(),confirm("是否清除所有颜色？")&&(n.empty(),Dialog.resize(e))}).end().find('[data-name="openImOrExCustomSmColorConfigDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("配色方案","customSmColorConfigList",function(e){return e.find(".pd_cfg_about").append('<a target="_blank" href="read.php?tid=488016">其他人分享的配色方案</a>')})}),Dialog.show(e)}},showCustomCssDialog=function(){var e="pdCustomCssDialog";if(!($("#"+e).length>0)){var t=Dialog.create(e,"自定义CSS",'\n<div class="pd_cfg_main">\n  <strong>自定义CSS内容：</strong><br>\n  <textarea name="customCssContent" wrap="off" style="width: 750px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a target="_blank" href="read.php?tid=500969">CSS规则收集贴</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find('[name="customCssContent"]');t.submit(function(t){t.preventDefault(),Config.customCssContent=$.trim(n.val()),(0,_Config.write)(),Dialog.close(e),alert("自定义CSS修改成功（需刷新页面后才可生效）")}),n.val(Config.customCssContent),Dialog.show(e),n.focus()}},showUserMemoDialog=function(){var e="pdUserMemoDialog";if(!($("#"+e).length>0)){var t=Dialog.create(e,"用户备注",'\n<div class="pd_cfg_main">\n  按照“用户名:备注”的格式（注意是英文冒号），每行一个<br>\n  <textarea name="userMemoList" wrap="off" style="width: 320px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find('[name="userMemoList"]');t.submit(function(t){t.preventDefault();var a=$.trim(n.val());Config.userMemoList={};var o=!0,i=!1,r=void 0;try{for(var l,d=a.split("\n")[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=l.value;if(s=$.trim(s)){if(!/.+?:.+/.test(s))return alert("用户备注格式不正确"),void n.focus();var c=s.split(":"),p=_slicedToArray(c,2),f=p[0],u=p[1],m=void 0===u?"":u;m&&(Config.userMemoList[f.trim()]=m.trim())}}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}(0,_Config.write)(),Dialog.close(e)});var a="",o=!0,i=!1,r=void 0;try{for(var l,d=Util.entries(Config.userMemoList)[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=_slicedToArray(l.value,2);a+=s[0]+":"+s[1]+"\n"}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}n.val(a),Dialog.show(e),n.focus()}},showFollowUserDialog=function(){var e="pdFollowUserDialog";if(!($("#"+e).length>0)){var t=Dialog.create(e,"关注用户",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label>\n      <input name="highlightFollowUserThreadInHpEnabled" type="checkbox"> 高亮所关注用户的首页帖子链接\n      <span class="pd_cfg_tips" title="高亮所关注用户在首页下的帖子链接">[?]</span>\n    </label><br>\n    <label>\n      <input name="highlightFollowUserThreadLinkEnabled" type="checkbox"> 高亮所关注用户的帖子链接\n      <span class="pd_cfg_tips" title="高亮所关注用户在版块页面下的帖子链接">[?]</span>\n    </label><br>\n  </div>\n  <ul id="pdFollowUserList" style="margin-top: 5px; min-width: 274px; line-height: 24px;"></ul>\n  <div style="margin-top: 5px;">\n    <div style="display: inline-block;">\n      <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n      <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n    </div>\n    <div style="float: right;">\n      <a class="pd_btn_link" data-name="deleteSelect" href="#">删除</a>\n    </div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input name="addFollowUser" style="width: 200px;" type="text">\n    <a class="pd_btn_link" data-name="add" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExFollowUserListDialog" href="#">导入/导出关注用户</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find("#pdFollowUserList"),a=function(e){$('\n<li>\n  <input type="checkbox">\n  <input name="username" type="text" style="width: 178px; margin-left: 5px;" maxlength="15" value="'+e+'">\n  <a class="pd_btn_link" data-name="delete" href="#">删除</a>\n</li>\n').appendTo(n)};t.submit(function(a){a.preventDefault(),Config.highlightFollowUserThreadInHPEnabled=t.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked"),Config.highlightFollowUserThreadLinkEnabled=t.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked"),Config.followUserList=[],n.find("li").each(function(){var e=$(this),t=$.trim(e.find('[name="username"]').val());""!==t&&Util.inFollowOrBlockUserList(t,Config.followUserList)===-1&&Config.followUserList.push({name:t})}),(0,_Config.write)(),Dialog.close(e)}),n.on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).parent().remove()}),t.find('[data-name="selectAll"]').click(function(){return Util.selectAll(n.find('[type="checkbox"]'))}).end().find('[data-name="selectInverse"]').click(function(){return Util.selectInverse(n.find('[type="checkbox"]'))}).end().find('[data-name="deleteSelect"]').click(function(t){t.preventDefault();var a=n.find('li:has([type="checkbox"]:checked)');a.length&&confirm("是否删除所选用户？")&&(a.remove(),Dialog.resize(e))}),t.find('[name="addFollowUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).end().find('[data-name="add"]').click(function(n){n.preventDefault();var o=!0,i=!1,r=void 0;try{for(var l,d=$.trim(t.find('[name="addFollowUser"]').val()).split(",")[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=l.value;s=$.trim(s),s&&(Util.inFollowOrBlockUserList(s,Config.followUserList)===-1&&a(s))}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}t.find('[name="addFollowUser"]').val(""),Dialog.resize(e)}).end().find('[data-name="openImOrExFollowUserListDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("关注用户","followUserList")}),t.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked",Config.highlightFollowUserThreadInHPEnabled),t.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked",Config.highlightFollowUserThreadLinkEnabled);var o=!0,i=!1,r=void 0;try{for(var l,d=Config.followUserList[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){a(l.value.name)}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}Dialog.show(e)}},showBlockUserDialog=function(){var e="pdBlockUserDialog";if(!($("#"+e).length>0)){
var t=Dialog.create(e,"屏蔽用户",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px; line-height: 24px;">\n    <label>\n      默认屏蔽类型\n      <select name="blockUserDefaultType">\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n    </label>\n    <label class="pd_cfg_ml">\n      <input name="blockUserAtTipsEnabled" type="checkbox"> 屏蔽@提醒 <span class="pd_cfg_tips" title="屏蔽被屏蔽用户的@提醒">[?]</span>\n    </label><br>\n    <label>版块屏蔽范围\n      <select name="blockUserForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label><br>\n    <label>版块ID列表\n      <input name="blockUserFidList" type="text" style="width: 220px;"> \n      <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span>\n    </label>\n  </div>\n  <ul id="pdBlockUserList" style="margin-top: 5px; min-width: 362px; line-height: 24px;"></ul>\n  <div style="margin-top: 5px;">\n    <div style="display: inline-block;">\n      <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n      <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n    </div>\n    <div style="float: right;">\n      <a class="pd_btn_link" data-name="modify" href="#">修改为</a>\n      <select>\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n      <a class="pd_btn_link" data-name="deleteSelect" href="#">删除</a>\n    </div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input name="addBlockUser" style="width: 200px;" type="text">\n    <a class="pd_btn_link" data-name="add" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExBlockUserListDialog" href="#">导入/导出屏蔽用户</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find("#pdBlockUserList"),a=function(e,t){$('\n<li>\n  <input type="checkbox">\n  <input name="username" type="text" style="width: 150px; margin-left: 5px;" maxlength="15" value="'+e+'">\n  <select name="blockType" style="margin-left: 5px;">\n    <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n  </select>\n  <a class="pd_btn_link" data-name="delete" href="#">删除</a>\n</li>').appendTo(n).find('[name="blockType"]').val(t)};t.submit(function(a){a.preventDefault(),Config.blockUserDefaultType=parseInt(t.find('[name="blockUserDefaultType"]').val()),Config.blockUserAtTipsEnabled=t.find('[name="blockUserAtTipsEnabled"]').prop("checked"),Config.blockUserForumType=parseInt(t.find('[name="blockUserForumType"]').val());var o=new Set,i=!0,r=!1,l=void 0;try{for(var d,s=$.trim(t.find('[name="blockUserFidList"]').val()).split(",")[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var c=d.value;c=parseInt(c),!isNaN(c)&&c>0&&o.add(c)}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}Config.blockUserFidList=[].concat(_toConsumableArray(o)),Config.blockUserList=[],n.find("li").each(function(){var e=$(this),t=$.trim(e.find('[name="username"]').val());if(""!==t&&Util.inFollowOrBlockUserList(t,Config.blockUserList)===-1){var n=parseInt(e.find('[name="blockType"]').val());Config.blockUserList.push({name:t,type:n})}}),(0,_Config.write)(),Dialog.close(e)}),n.on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).parent().remove()}),t.find('[data-name="selectAll"]').click(function(){return Util.selectAll(n.find('input[type="checkbox"]'))}).end().find('[data-name="selectInverse"]').click(function(){return Util.selectInverse(n.find('input[type="checkbox"]'))}).end().find('[data-name="modify"]').click(function(e){e.preventDefault();var t=$(this).next("select").val();n.find('li:has([type="checkbox"]:checked) > select').val(t)}).end().find('[data-name="deleteSelect"]').click(function(t){t.preventDefault();var a=n.find('li:has([type="checkbox"]:checked)');a.length&&confirm("是否删除所选用户？")&&(a.remove(),Dialog.resize(e))}),t.find('[name="addBlockUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).end().find('[data-name="add"]').click(function(n){n.preventDefault();var o=parseInt(t.find('[name="blockUserDefaultType"]').val()),i=!0,r=!1,l=void 0;try{for(var d,s=$.trim(t.find('[name="addBlockUser"]').val()).split(",")[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var c=d.value;c=$.trim(c),c&&(Util.inFollowOrBlockUserList(c,Config.blockUserList)===-1&&a(c,o))}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}t.find('[name="addBlockUser"]').val(""),Dialog.resize(e)}).end().find('[name="blockUserForumType"]').change(function(){t.find('[name="blockUserFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find('[data-name="openImOrExBlockUserListDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("屏蔽用户","blockUserList")}),t.find('[name="blockUserDefaultType"]').val(Config.blockUserDefaultType),t.find('[name="blockUserAtTipsEnabled"]').prop("checked",Config.blockUserAtTipsEnabled),t.find('[name="blockUserForumType"]').val(Config.blockUserForumType).triggerHandler("change"),t.find('[name="blockUserFidList"]').val(Config.blockUserFidList.join(","));var o=!0,i=!1,r=void 0;try{for(var l,d=Config.blockUserList[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=l.value;a(s.name,s.type)}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}Dialog.show(e)}},showBlockThreadDialog=function showBlockThreadDialog(){var dialogName="pdBlockThreadDialog";if(!($("#"+dialogName).length>0)){var html='\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    标题关键字可使用普通字符串或正则表达式，正则表达式请使用<code>/abc/</code>的格式，例：<code>/关键字A.*关键字B/i</code><br>\n    用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\n    <label>\n      默认版块屏蔽范围\n      <select name="blockThreadDefForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label>\n    <label style="margin-left: 5px;">默认版块ID列表 <input name="blockThreadDefFidList" type="text" style="width: 150px;"></label>\n  </div>\n  <table id="pdBlockThreadList" style="line-height: 22px; text-align: center;">\n    <tbody>\n      <tr>\n        <th style="width: 220px;">标题关键字(必填)</th>\n        <th style="width: 62px;">屏蔽用户</th>\n        <th style="width: 200px;">用户名 <span class="pd_cfg_tips" title="多个用户名请用英文逗号分隔">[?]</span></th>\n        <th style="width: 62px;">屏蔽范围</th>\n        <th style="width: 132px;">版块ID <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span></th>\n        <th style="width: 35px;"></th>\n      </tr>\n    </tbody>\n  </table>\n  <div data-name="blockThreadAddBtns" style="margin-top: 5px;">\n    <a class="pd_btn_link" data-name="addOne" href="#">增加1个</a>\n    <a class="pd_btn_link" data-name="addFive" href="#">增加5个</a>\n    <a class="pd_btn_link pd_highlight" data-name="clear" href="#">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExBlockThreadListDialog" href="#">导入/导出屏蔽帖子</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',$dialog=Dialog.create(dialogName,"屏蔽帖子",'\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    标题关键字可使用普通字符串或正则表达式，正则表达式请使用<code>/abc/</code>的格式，例：<code>/关键字A.*关键字B/i</code><br>\n    用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\n    <label>\n      默认版块屏蔽范围\n      <select name="blockThreadDefForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label>\n    <label style="margin-left: 5px;">默认版块ID列表 <input name="blockThreadDefFidList" type="text" style="width: 150px;"></label>\n  </div>\n  <table id="pdBlockThreadList" style="line-height: 22px; text-align: center;">\n    <tbody>\n      <tr>\n        <th style="width: 220px;">标题关键字(必填)</th>\n        <th style="width: 62px;">屏蔽用户</th>\n        <th style="width: 200px;">用户名 <span class="pd_cfg_tips" title="多个用户名请用英文逗号分隔">[?]</span></th>\n        <th style="width: 62px;">屏蔽范围</th>\n        <th style="width: 132px;">版块ID <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span></th>\n        <th style="width: 35px;"></th>\n      </tr>\n    </tbody>\n  </table>\n  <div data-name="blockThreadAddBtns" style="margin-top: 5px;">\n    <a class="pd_btn_link" data-name="addOne" href="#">增加1个</a>\n    <a class="pd_btn_link" data-name="addFive" href="#">增加5个</a>\n    <a class="pd_btn_link pd_highlight" data-name="clear" href="#">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExBlockThreadListDialog" href="#">导入/导出屏蔽帖子</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',"width: 768px;"),$blockThreadList=$dialog.find("#pdBlockThreadList"),addBlockThread=function(e,t,n,a,o){$('\n<tr>\n  <td><input name="keyWord" type="text" style="width: 208px;" value="'+e+'"></td>\n  <td><select name="userType"><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input name="userList" type="text" style="width: 188px;" value="'+n.join(",")+'" '+(0===t?"disabled":"")+'></td>\n  <td><select name="fidType"><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input name="fidList" type="text" style="width: 120px;" value="'+o.join(",")+'" '+(0===a?"disabled":"")+'></td>\n  <td><a href="#" data-name="delete">删除</a></td>\n</tr>\n').appendTo($blockThreadList).find('[name="userType"]').val(t).end().find('[name="fidType"]').val(a)},verify=function verify(){var flag=!0;return $blockThreadList.find("tr:gt(0)").each(function(){var $this=$(this),$txtKeyWord=$this.find('[name="keyWord"]'),keyWord=$txtKeyWord.val();if(""!==$.trim(keyWord)&&/^\/.+\/[gimuy]*$/.test(keyWord))try{eval(keyWord)}catch(e){return alert("正则表达式不正确"),$txtKeyWord.select().focus(),flag=!1,!1}}),flag};$dialog.submit(function(e){if(e.preventDefault(),verify()){Config.blockThreadDefForumType=parseInt($dialog.find('[name="blockThreadDefForumType"]').val());var t=new Set,n=!0,a=!1,o=void 0;try{for(var i,r=$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(",")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;l=parseInt(l),!isNaN(l)&&l>0&&t.add(l)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}Config.blockThreadDefFidList=[].concat(_toConsumableArray(t)),Config.blockThreadList=[],$blockThreadList.find("tr:gt(0)").each(function(){var e=$(this),t=e.find('[name="keyWord"]').val();if(""!==$.trim(t)){var n={keyWord:t},a=parseInt(e.find('[name="userType"]').val());if(a>0){var o=new Set,i=!0,r=!1,l=void 0;try{for(var d,s=$.trim(e.find('[name="userList"]').val()).split(",")[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var c=d.value;c=$.trim(c),c&&o.add(c)}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}o.size>0&&(n[2===a?"excludeUser":"includeUser"]=[].concat(_toConsumableArray(o)))}var p=parseInt(e.find('[name="fidType"]').val());if(p>0){var f=new Set,u=!0,m=!1,g=void 0;try{for(var h,v=$.trim(e.find('[name="fidList"]').val()).split(",")[Symbol.iterator]();!(u=(h=v.next()).done);u=!0){var b=h.value;b=parseInt(b),!isNaN(b)&&b>0&&f.add(b)}}catch(e){m=!0,g=e}finally{try{!u&&v.return&&v.return()}finally{if(m)throw g}}f.size>0&&(n[2===p?"excludeFid":"includeFid"]=[].concat(_toConsumableArray(f)))}Config.blockThreadList.push(n)}}),(0,_Config.write)(),Dialog.close(dialogName)}}),$blockThreadList.on("change","select",function(){var e=$(this);e.parent("td").next("td").find("input").prop("disabled",0===parseInt(e.val()))}).on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).closest("tr").remove()}),$dialog.find('[data-name="addOne"], [data-name="addFive"]').click(function(e){e.preventDefault();var t=1;$(this).is('[data-name="addFive"]')&&(t=5);for(var n=1;n<=t;n++)addBlockThread("",0,[],parseInt($dialog.find('[name="blockThreadDefForumType"]').val()),$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(","));Dialog.resize(dialogName)}).end().find('[data-name="clear"]').click(function(e){e.preventDefault(),confirm("是否清除所有屏蔽关键字？")&&($blockThreadList.find("tbody > tr:gt(0)").remove(),Dialog.resize(dialogName))}).end().find('[name="blockThreadDefForumType"]').change(function(){$dialog.find('[name="blockThreadDefFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find('[data-name="openImOrExBlockThreadListDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("屏蔽帖子","blockThreadList")}),$dialog.find('[name="blockThreadDefForumType"]').val(Config.blockThreadDefForumType).triggerHandler("change"),$dialog.find('[name="blockThreadDefFidList"]').val(Config.blockThreadDefFidList.join(","));var _iteratorNormalCompletion12=!0,_didIteratorError12=!1,_iteratorError12=void 0;try{for(var _iterator12=Config.blockThreadList[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=!0){var data=_step12.value,keyWord=data.keyWord,includeUser=data.includeUser,excludeUser=data.excludeUser,includeFid=data.includeFid,excludeFid=data.excludeFid,userType=0,userList=[];void 0!==includeUser?(userType=1,userList=includeUser):void 0!==excludeUser&&(userType=2,userList=excludeUser);var fidType=0,fidList=[];void 0!==includeFid?(fidType=1,fidList=includeFid):void 0!==excludeFid&&(fidType=2,fidList=excludeFid),addBlockThread(keyWord,userType,userList,fidType,fidList)}}catch(e){_didIteratorError12=!0,_iteratorError12=e}finally{try{!_iteratorNormalCompletion12&&_iterator12.return&&_iterator12.return()}finally{if(_didIteratorError12)throw _iteratorError12}}Dialog.show(dialogName)}}},{"./Config":4,"./Const":6,"./Dialog":7,"./Info":9,"./Public":18,"./Script":20,"./TmpLog":21,"./Util":22}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={debug:!1,forumTimezoneOffset:-8,getDailyBonusAfterTime:"00:35:00",enemyStatLatestLevelNum:10,lootAttackPerCheckLevel:10,getCustomPoints:null,actionFinishRetryInterval:30,errorRefreshInterval:1,showRefreshModeTipsInterval:1,getDailyBonusSpecialInterval:60,minPromoteHaloInterval:480,promoteHaloLimitNextActionInterval:480,promoteHaloActionInterval:1e3,tmpHaloInfoExpires:210,lootAttackingExpires:10,changePointsInfoExpires:30,checkLootInterval:30,hideMarkReadAtTipsExpires:3,smLevelUpAlertInterval:3,smRankChangeAlertInterval:22,vipSurplusTimeExpires:60,fixedDepositDueTime:90,defAjaxTimeout:3e4,defAjaxInterval:200,specialAjaxInterval:function(){return Config.slowActionEnabled?Math.floor(4e3*Math.random())+3e3:Math.floor(200*Math.random())+1e3},minActionInterval:1e3,lootAttackInterval:function(){return Config.slowAttackEnabled?Math.floor(3e3*Math.random())+4e3:Math.floor(200*Math.random())+1e3},bankActionInterval:5e3,minBuyThreadWarningSell:6,statFloorMaxPage:300,ratingErrorSizePercent:3,customFastNavMenuContent:"",storagePrefix:"pd_",multiQuoteStorageName:"pd_multiQuote",postContentStorageName:"pd_postContent",tempPointsLogListStorageName:"pd_tempPointsLogList",itemLogStorageName:"pd_itemLog",myObjectsInfoStorageName:"pd_myObjectsInfo",smLevelUpTmpLogName:"SmLevelUp",smRankChangeTmpLogName:"SmRankChange",fixedDepositDueTmpLogName:"FixedDepositDue",prevAutoChangeIdColorTmpLogName:"PrevAutoChangeIdColor",haloInfoTmpLogName:"HaloInfo",getDailyBonusCookieName:"getDailyBonus",promoteHaloCookieName:"promoteHalo",lootCheckingCookieName:"lootChecking",lootAttackingCookieName:"lootAttacking",changePointsInfoCookieName:"changePointsInfo",lootCompleteCookieName:"lootComplete",hideReadAtTipsCookieName:"hideReadAtTips",prevReadAtTipsCookieName:"prevReadAtTips",fixedDepositDueAlertCookieName:"fixedDepositDueAlert",vipSurplusTimeCookieName:"vipSurplusTime",autoChangeIdColorCookieName:"autoChangeIdColor"};n.default=a},{}],7:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.close=n.resize=n.show=n.create=void 0;var o=e("./Info"),i=function(e){return e&&e.__esModule?e:{default:e}}(o),r=e("./Util"),l=a(r),d=e("./Public"),s=a(d),c=(n.create=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o='\n<form>\n<div class="pd_cfg_box" id="'+e+'" style="'+a+'">\n  <h1>'+t+'<span data-action="close">&times;</span></h1>\n  '+n+"\n</div>\n</form>",r=$(o).appendTo("body");return r.on("click",".pd_cfg_tips",function(e){return i.default.isMobile&&s.showElementTitleTips(e,this.title),!1}).on("click","a.pd_disabled_link",function(){return!1}).on("click",'[data-action="close"]',function(){return p(e)}).keydown(function(t){if(27===t.keyCode)return p(e)}).find('legend [type="checkbox"]').click(function(){var e=$(this),t=e.prop("checked");l.isOpera()||l.isEdge()?e.closest("fieldset").find("input, select, textarea, button").not("legend input").prop("disabled",!t):e.closest("fieldset").prop("disabled",!t)}).end().find("input[data-disabled]").click(function(){var e=$(this),t=e.prop("checked");$(e.data("disabled")).each(function(){var e=$(this);e.is("a")?t?e.removeClass("pd_disabled_link"):e.addClass("pd_disabled_link"):e.prop("disabled",!t)})}).end().find("input[data-mutex]").click(function(){var e=$(this),t=e.prop("checked");$(e.data("mutex")).each(function(){var e=$(this);e.is("a")?t?e.addClass("pd_disabled_link"):e.removeClass("pd_disabled_link"):e.prop("disabled",t)})}),i.default.isMobile||$(window).on("resize."+e,function(){return c(e)}),r},n.show=function(e){var t=$("#"+e);t.length&&(t.find('legend [type="checkbox"]').each(function(){$(this).triggerHandler("click")}).end().find("input[data-disabled], input[data-mutex]").each(function(){$(this).triggerHandler("click")}),t.fadeIn("fast"),c(e),t.find("input:first, select:first, a:first, textarea:first, button:first").eq(0).focus())},n.resize=function(e){var t=$("#"+e),n=$(window).height();t.find(".pd_cfg_main").css("max-height",n-80);var a=t.outerWidth(),o=$(window).width(),i=o/2-a/2;i+a>o&&(i=o-a-20),i<0&&(i=0);var r=n/2-t.outerHeight()/2;r<0&&(r=0),t.css({top:r,left:i})}),p=n.close=function(e){return $("#"+e).fadeOut("fast",function(){$(this).parent("form").remove()}),i.default.isMobile||$(window).off("resize."+e),!1}},{"./Info":9,"./Public":18,"./Util":22}],8:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.addChangePointsInfoTips=n.addPromoteHaloInterval=n.handleIndexLink=n.addSearchTypeSelectBox=n.showVipSurplusTime=n.addThreadFastGotoLink=n.smRankChangeAlert=n.smLevelUpAlert=n.handleAtTips=void 0;var i=e("./Info"),r=o(i),l=e("./Util"),d=a(l),s=e("./Msg"),c=a(s),p=e("./Const"),f=o(p),u=e("./Log"),m=a(u),g=e("./TmpLog"),h=a(g),v=e("./Loot"),b=a(v);n.handleAtTips=function(){var e=Config.atTipsHandleType;if("default"!==e){var t=$('a.indbox5[href^="guanjianci.php?gjc="]'),n=function(){return t.removeClass("indbox5").addClass("indbox6")},a=function(){return t.parent().next("div.line").addBack().remove()},o=n;if("hide_box_1"!==e&&"hide_box_2"!==e||(o=a),["no_highlight","no_highlight_extra","hide_box_1","at_change_to_cao"].includes(e)){if(t.length>0){var i=d.getCookie(f.default.hideReadAtTipsCookieName),l=$.trim(t.text()),s=/\d+日\d+时\d+分/.exec(l);s&&(l=s[0]),i&&i===l?o():t.click(function(){var e=$(this);if(!e.data("disabled")){var t=d.getCookie(f.default.hideReadAtTipsCookieName);if(t)t!==l&&d.setCookie(f.default.prevReadAtTipsCookieName,t);else{var n=(new Date).getDate().toString();d.setCookie(f.default.prevReadAtTipsCookieName,n.padStart(2,"0")+"日00时00分")}d.setCookie(f.default.hideReadAtTipsCookieName,l,d.getDate("+"+f.default.hideMarkReadAtTipsExpires+"d")),e.data("disabled",!0),o()}}),"at_change_to_cao"===e&&t.text(t.text().replace("@","艹"))}else if(!t.length&&("no_highlight_extra"===e||"at_change_to_cao"===e)){var c='\n<div style="width: 300px;">\n  <a class="indbox6" href="guanjianci.php?gjc='+r.default.userName+'" target="_blank">最近无人'+("at_change_to_cao"===e?"艹":"@")+'你</a><br>\n  <div class="line"></div>\n  <div class="c"></div>\n</div>\n<div class="line"></div>';$('a[href="kf_givemekfb.php"][title="网站虚拟货币"]').parent().before(c)}}else"hide_box_2"===e&&t.length>0&&o()}},n.smLevelUpAlert=function(){var e=parseInt($("#pdSmLevel").data("sm-level"));if(e){var t=function(e){h.setValue(f.default.smLevelUpTmpLogName,{time:$.now(),smLevel:e})},n=h.getValue(f.default.smLevelUpTmpLogName);if(n&&"number"===$.type(n.time)&&"number"===$.type(n.smLevel))if(e>n.smLevel){var a=Math.floor(($.now()-n.time)/60/60/1e3);if(a>=f.default.smLevelUpAlertInterval){var o=new Date(n.time);t(e),m.push("神秘等级升级","自`"+d.getDateString(o)+"`以来，你的神秘等级共上升了`"+(e-n.smLevel)+"`级 (Lv.`"+n.smLevel+"`->Lv.`"+e+"`)"),c.show("自<em>"+d.getDateString(o)+"</em>以来，你的神秘等级共上升了<em>"+(e-n.smLevel)+"</em>级")}else a<0&&t(e)}else e<n.smLevel&&t(e);else t(e)}},n.smRankChangeAlert=function(){var e=$("#pdSmLevel").data("sm-rank");if(e&&!e.toString().endsWith("+")){e=parseInt(e);var t=function(e){return h.setValue(f.default.smRankChangeTmpLogName,{time:$.now(),smRank:e})},n=h.getValue(f.default.smRankChangeTmpLogName);if(n&&"number"===$.type(n.time)&&"number"===$.type(n.smRank)){if(e!==n.smRank){var a=Math.floor(($.now()-n.time)/60/60/1e3);if(a>=f.default.smRankChangeAlertInterval){var o=new Date(n.time),i=e<n.smRank;t(e),m.push("神秘系数排名变化","自`"+d.getDateString(o)+"`以来，你的神秘系数排名共`"+(i?"上升":"下降")+"`了`"+Math.abs(e-n.smRank)+"`名 (No.`"+n.smRank+"`->No.`"+e+"`)"),c.show("自<em>"+d.getDateString(o)+'</em>以来，你的神秘系数排名共<b style="color: '+(i?"#F00":"#393")+'">'+(i?"上升":"下降")+"</b>了<em>"+Math.abs(e-n.smRank)+"</em>名")}else a<0&&t(e)}}else t(e)}},n.addThreadFastGotoLink=function(){$(".index1").on("mouseenter",'li.b_tit4:has("a"), li.b_tit4_1:has("a")',function(){var e=$(this);e.css("position","relative").prepend('<a class="pd_thread_goto" href="'+e.find("a").attr("href")+'&page=e#a">&raquo;</a>')}).on("mouseleave",'li.b_tit4:has("a"), li.b_tit4_1:has("a")',function(){$(this).css("position","static").find(".pd_thread_goto").remove()})},n.showVipSurplusTime=function(){var e=function(e){$("#pdSmLevel").parent().after('<div class="line"></div><div style="width: 300px;"><a href="kf_vmember.php" class="indbox'+(e>0?5:6)+'">VIP会员 ('+(e>0?"剩余"+e+"小时":"参与论坛获得的额外权限")+')</a><div class="c"></div></div>')},t=parseInt(d.getCookie(f.default.vipSurplusTimeCookieName));isNaN(t)||t<0?(console.log("检查VIP剩余时间Start"),$.get("kf_vmember.php?t="+$.now(),function(t){var n=0,a=/我的VIP剩余时间\s*<b>(\d+)<\/b>\s*小时/i.exec(t);a&&(n=parseInt(a[1])),d.setCookie(f.default.vipSurplusTimeCookieName,n,d.getDate("+"+f.default.vipSurplusTimeExpires+"m")),e(n)})):e(t)},n.addSearchTypeSelectBox=function(){var e=$('form[action="search.php?"]');e.attr("name","pdSearchForm");var t=e.find('[type="text"][name="keyword"]');t.css("width","116px"),$('<div class="pd_search_type"><span>标题</span><i>&#8744;</i></div>').insertAfter(t)},n.handleIndexLink=function(){var e=$('a[href="kf_givemekfb.php"]'),t=/拥有(-?\d+)KFB/.exec(e.text());if(t){var n=parseInt(t[1]);e.html("拥有<b>"+n.toLocaleString()+"</b>KFB").attr("data-kfb",n)}var a=$('a.indbox5[href="kf_growup.php"]');if(a.attr("id","pdSmLevel"),t=/神秘(-?\d+)级 \(系数排名第\s*(\d+\+?)\s*位/.exec(a.text())){var o=parseInt(t[1]),i=t[2];a.html("神秘<b>"+o+'</b>级 (系数排名第<b style="color: #00f;">'+i+"</b>位)").attr("data-sm-level",o).attr("data-sm-rank",i)}$('a.indbox5[href="kf_fw_ig_index.php"]').attr("id","pdLoot")},n.addPromoteHaloInterval=function(){var e=parseInt(d.getCookie(f.default.promoteHaloCookieName));if(e){var t=e-$.now();if(t>0){var n=Math.ceil(t/60/1e3),a=Math.floor(n/60);n-=60*a,$("#pdLoot").append('<span id="pdHaloInterval"> (光环：'+(a>0?a+"时":"")+n+"分)</span>")}}},n.addChangePointsInfoTips=function e(){var t=d.getCookie(f.default.changePointsInfoCookieName);if(!t)return void b.getChangePointsCountDown().done(e).fail(function(){return setTimeout(e,f.default.defAjaxInterval)});var n="";if($.isNumeric(t)){var a=parseInt(t),o=a-$.now();if(o>0){var i=Math.ceil(o/60/1e3),r=Math.floor(i/60);i-=60*r,n=(r>0?r+"时":"")+i+"分"}}else n=parseInt(t)+"次";n&&$("#pdLoot").append('<span id="pdChangePointsTips"> (改点：'+n+")</span>")}},{"./Const":6,"./Info":9,"./Log":11,"./Loot":13,"./Msg":15,"./TmpLog":21,"./Util":22}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={uid:0,userName:"",isInHomePage:"/"===location.pathname||"/index.php"===location.pathname,isMobile:!1,isInMiaolaDomain:location.host.endsWith(".miaola.info"),version:"",w:"undefined"!=typeof unsafeWindow?unsafeWindow:window,storageType:"Default",$userMenu:$(".topmenuo1 > .topmenuo3:last-child > .topmenuo2")};n.default=a},{}],10:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.addBatchBuyItemsLink=n.getItemsUsedNumInfo=n.getLevelByName=n.getArmsLevelInfo=n.getArmInfo=n.getWeaponParameterSetting=n.bindArmLinkClickEvent=n.handleArmArea=n.getNextObjects=n.init=n.itemTypeList=n.armTypeList=n.armGroupList=n.boxTypeList=void 0;var r=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=e("./Info"),d=o(l),s=e("./Util"),c=a(s),p=e("./Msg"),f=a(p),u=e("./Dialog"),m=a(u),g=e("./Const"),h=o(g),v=e("./Config"),b=e("./Log"),y=a(b),_=e("./Script"),x=a(_),k=e("./Public"),C=a(k),w=e("./Loot"),I=a(w),L=void 0,S=void 0,T=void 0,D=void 0,A=n.boxTypeList=["普通盒子","幸运盒子","稀有盒子","传奇盒子","神秘盒子"],E=n.armGroupList=["长剑","短弓","法杖"],M=n.armTypeList=["普通的装备","幸运的装备","稀有的装备","传奇的装备","神秘的装备"],P=n.itemTypeList=["零时迷子的碎片","被遗弃的告白信","学校天台的钥匙","TMA最新作压缩包","LOLI的钱包","棒棒糖","蕾米莉亚同人漫画","十六夜同人漫画","档案室钥匙","傲娇LOLI娇蛮音CD","整形优惠卷","消逝之药"],F=(n.init=function(){(D=C.getSafeId())&&(L=$(".kf_fw_ig1:eq(0)"),S=$(".kf_fw_ig4:eq(0)"),T=$(".kf_fw_ig1:eq(1)"),B(),U(),j(S),q(S,D),H(),J(),localStorage.getItem(h.default.storagePrefix+"myObjectsInfo_"+d.default.uid)&&localStorage.removeItem(h.default.storagePrefix+"myObjectsInfo_"+d.default.uid))},n.getNextObjects=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;console.log("获取下一批物品Start"),$.ajax({type:"GET",url:"kf_fw_ig_mybp.php?t="+$.now(),timeout:h.default.defAjaxTimeout}).done(function(e){for(var a=1;a<=2;a++){var o=null;if(o=1===a?/<tr><td width="\d+%">装备.+?\r\n(<tr.+?<\/tr>)<tr><td colspan="4">/.exec(e):/<tr><td width="\d+%">使用.+?\r\n(<tr.+?<\/tr>)<tr><td colspan="4">/.exec(e)){var i=o[1].match(/<tr(.+?)<\/tr>/g),r=1===a?S:T,l="";for(var d in i){var s=/"wp_(\d+)"/.exec(i[d]);s&&(r.has('[id="wp_'+s[1]+'"]').length||(l+=i[d]))}l&&(2===t?r.find("> tbody > tr:last-child").before(l):r.find("> tbody > tr:nth-child(2)").after(l),1===a&&j(S))}}"function"==typeof n&&n()}).fail(function(){setTimeout(function(){return e(t,n)},h.default.defAjaxInterval)})}),B=function(){L=$(".kf_fw_ig1:first"),L.find('> tbody > tr:nth-child(3) > td > a[onclick^="dkhz"]').each(function(){var e=$(this),t=/dkhz\('(\d+)'\)/.exec(e.attr("onclick"));t&&e.after('<a class="pd_highlight" href="#" data-name="openBoxes" data-id="'+t[1]+'" style="margin-left: 10px;">批量打开</a>')}),L.on("click",'a[data-name="openBoxes"]',function(e){e.preventDefault();var t=$(this),n=parseInt(t.data("id")),a=L.find("> tbody > tr:nth-child(2) > td:nth-child("+n+")"),o=a.find("span:first").text().trim()+"盒子";if(A.includes(o)){var i=parseInt(a.find("span:last").text()),r=parseInt(prompt("你要打开多少个【"+o+"】？",i));!r||r<0||(S.find("> tbody > tr:nth-child(2)").after('<tr><td colspan="3" style="color: #777;">以上为新装备</td></tr>'),f.destroy(),O({id:n,boxType:o,num:r,safeId:D}))}})},U=function(){$('\n<div class="pd_item_btns" data-name="openBoxesBtns">\n  <button name="clearMsg" type="button" title="清除页面上所有的消息框">清除消息框</button>\n  <button name="openAllBoxes" type="button" style="color: #f00;" title="打开全部盒子">一键开盒</button>\n</div>\n').insertAfter(L).find('[name="clearMsg"]').click(f.destroy).end().find('[name="openAllBoxes"]').click(N),C.addSlowActionChecked($('.pd_item_btns[data-name="openBoxesBtns"]'))},N=function(){var e="pdOpenAllBoxesDialog";if(!($("#"+e).length>0)){f.destroy(),(0,v.read)();var t="",n=!0,a=!1,o=void 0;try{for(var i,r=A.slice(0,4)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){t+="<option>"+i.value+"</option>"}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}var l="",d=!0,s=!1,p=void 0;try{for(var u,g=E[Symbol.iterator]();!(d=(u=g.next()).done);d=!0){var h=u.value;l+="<li><b>"+h+"：</b>";var b=!0,y=!1,_=void 0;try{for(var k,C=M[Symbol.iterator]();!(b=(k=C.next()).done);b=!0){var w=k.value,I=w.split("的")[0];if("神秘"!==I){var T=I+"的"+h;l+='\n<label style="margin-right: 5px;">\n  <input type="checkbox" name="smeltArmsType" value="'+T+'" '+(Config.defSmeltArmTypeList.includes(T)?"checked":"")+"> "+I+"\n</label>"}}}catch(e){y=!0,_=e}finally{try{!b&&C.return&&C.return()}finally{if(y)throw _}}l+="</li>"}}catch(e){s=!0,p=e}finally{try{!d&&g.return&&g.return()}finally{if(s)throw p}}var F="",B=!0,U=!1,N=void 0;try{for(var j,q=P.slice(6)[Symbol.iterator]();!(B=(j=q.next()).done);B=!0){F+="<option>"+j.value+"</option>"}}catch(e){U=!0,N=e}finally{try{!B&&q.return&&q.return()}finally{if(U)throw N}}var R='\n<div class="pd_cfg_main">\n  <fieldset style="margin-top: 5px;">\n    <legend>请选择想批量打开的盒子种类（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</legend>\n    <select name="openBoxesTypes" size="4" style="width: 320px;" multiple>'+t+'</select>\n  </fieldset>\n  <div style="margin-top: 5px;"><b>请选择批量打开盒子后想要进行的操作（如无需操作可不用勾选）：</b></div>\n  <fieldset>\n    <legend>\n      <label><input name="smeltArmsAfterOpenBoxesEnabled" type="checkbox"> 熔炼装备</label>\n    </legend>\n    <div>请选择想批量熔炼的装备种类：</div>\n    <ul data-name="smeltArmTypeList">'+l+'</ul>\n    <div>\n      <a class="pd_btn_link" href="#" data-name="selectAll">全选</a>\n      <a class="pd_btn_link" href="#" data-name="selectInverse">反选</a>\n    </div>\n  </fieldset>\n  <fieldset>\n    <legend>\n      <label><input name="useItemsAfterOpenBoxesEnabled" type="checkbox"> 使用道具</label>\n    </legend>\n    <div>请选择想批量使用的道具种类（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</div>\n    <select name="useItemTypes" size="6" style="width: 320px;" multiple>'+F+'</select>\n  </fieldset>\n  <fieldset>\n    <legend>\n      <label><input name="sellItemsAfterOpenBoxesEnabled" type="checkbox"> 出售道具</label>\n    </legend>\n    <div>请选择想批量出售的道具种类（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</div>\n    <select name="sellItemTypes" size="6" style="width: 320px;" multiple>'+F+'</select>\n  </fieldset>\n</div>\n<div class="pd_cfg_btns">\n  <button name="open" type="button" style="color: #f00;">一键开盒</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',K=m.create(e,"一键开盒",R),H=K.find('ul[data-name="smeltArmTypeList"]');K.find('[name="open"]').click(function(){(0,v.read)()
;var t=K.find('select[name="openBoxesTypes"]').val();if(Array.isArray(t)||(t=[]),Config.defOpenBoxTypeList=t,K.find('legend [type="checkbox"]').each(function(){var e=$(this),t=e.attr("name");t in Config&&(Config[t]=Boolean(e.prop("checked")))}),Config.smeltArmsAfterOpenBoxesEnabled){var n=[];H.find('input[name="smeltArmsType"]:checked').each(function(){n.push($(this).val())}),n.length>0?Config.defSmeltArmTypeList=n:Config.smeltArmsAfterOpenBoxesEnabled=!1}if(Config.useItemsAfterOpenBoxesEnabled){var a=K.find('select[name="useItemTypes"]').val();Array.isArray(a)?Config.defUseItemTypeList=a:Config.useItemsAfterOpenBoxesEnabled=!1}if(Config.sellItemsAfterOpenBoxesEnabled){var o=K.find('select[name="sellItemTypes"]').val();Array.isArray(o)?Config.defSellItemTypeList=o:Config.sellItemsAfterOpenBoxesEnabled=!1}if((0,v.write)(),!Config.defOpenBoxTypeList.length)return void alert("未选择盒子种类");confirm("是否一键开盒（并执行所选操作）？")&&(m.close(e),S.find("> tbody > tr:nth-child(2)").after('<tr><td colspan="3" style="color: #777;">以上为新装备</td></tr>'),$(document).clearQueue("OpenAllBoxes"),L.find("> tbody > tr:nth-child(2) > td").each(function(e){var t=$(this),n=t.find("span:first").text().trim()+"盒子";if(Config.defOpenBoxTypeList.includes(n)){var a=parseInt(t.find("span:last").text());if(a&&!(a<0)){var o=parseInt(L.find("> tbody > tr:nth-child(3) > td:nth-child("+(e+1)+') > a[data-name="openBoxes"]').data("id"));o&&$(document).queue("OpenAllBoxes",function(){return O({id:o,boxType:n,num:a,safeId:D,nextActionEnabled:!0})})}}}),$(document).dequeue("OpenAllBoxes"))}).end().find('a[data-name="selectAll"]').click(function(){return c.selectAll(H.find('input[name="smeltArmsType"]'))}).end().find('a[data-name="selectInverse"]').click(function(){return c.selectInverse(H.find('input[name="smeltArmsType"]'))}),K.on("keydown",'select[name$="Types"]',function(e){e.ctrlKey&&65===e.keyCode&&(e.preventDefault(),$(this).children().prop("selected",!0))}).find('legend [type="checkbox"]').each(function(){var e=$(this),t=e.attr("name");t in Config&&e.prop("checked",Config[t]===!0)}),K.find('select[name$="Types"]').each(function(e){var t=$(this),n=Config.defOpenBoxTypeList;1===e?n=Config.defUseItemTypeList:2===e&&(n=Config.defSellItemTypeList),t.find("option").each(function(){var e=$(this);n.includes(e.val())&&e.prop("selected",!0)})}),m.show(e),x.runFunc("Item.showOpenAllBoxes_after_")}},O=function(e){var t=e.id,n=e.boxType,a=e.num,o=e.safeId,i=e.nextActionEnabled,l=void 0!==i&&i,d=0,s=0,p=0,u=0,m=0,g=!1,v={KFB:0,"经验值":0,"道具":0,"装备":0,item:{},arm:{}},b=function e(){$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=3&id="+t+"&safeid="+o,timeout:h.default.defAjaxTimeout}).done(function(t){p++;var n=c.removeHtmlTag(t);if(n.includes("获得")){d++;var a=/获得\[(\d+)]KFB/.exec(n);if(a&&(v.KFB+=parseInt(a[1])),a=/获得\[(\d+)]经验值/.exec(n),a&&(v["经验值"]+=parseInt(a[1])),a=/打开盒子获得了道具\[\s*(.+?)\s*]/.exec(n)){v["道具"]++;var o=a[1];o in v.item||(v.item[o]=0),v.item[o]++}if(a=/获得一件\[(.+?)]的?装备/.exec(n)){v["装备"]++;var i=a[1]+"装备";i in v.arm||(v.arm[i]=0),v.arm[i]++}a=/随机值(\d+)/.exec(n),a&&(m++,u+=parseInt(a[1]))}else n.includes("操作过快")?$(document).queue("OpenBoxes",e):n.includes("盒子不足")?($(document).clearQueue("OpenBoxes"),g=!0):s++;console.log("第"+p+"次："+n),$('.pd_result[data-name="boxResult"]:last').append("<li><b>第"+p+"次：</b>"+n+"</li>")}).fail(function(){s++}).always(function(){var e=$(document).queue("OpenBoxes").length,a=$(".pd_countdown:last");a.text(e);var i=a.closest(".pd_msg").data("stop");if(g=g||i,i&&($(document).clearQueue("OpenAllBoxes"),l=!1),g||!e){f.remove(_);var b=m>0?c.getFixedNumLocStr(u/m,2):0,k=!0,C=!1,w=void 0;try{for(var I,S=c.entries(v)[Symbol.iterator]();!(k=(I=S.next()).done);k=!0){var T=r(I.value,2),D=T[0],A=T[1];(!A||"object"===$.type(A)&&$.isEmptyObject(A))&&delete v[D]}}catch(e){C=!0,w=e}finally{try{!k&&S.return&&S.return()}finally{if(C)throw w}}$.isEmptyObject(v)||y.push("打开盒子","共有`"+d+"`个【`"+n+"`】打开成功 (平均随机值【`"+b+"`】)",{gain:v,pay:{"盒子":-d}});var E=L.find("> tbody > tr:nth-child(2) > td:nth-child("+t+") > span:last"),B=parseInt(E.text());B>0&&E.text(B-d);var U="",N="",O=!0,j=!1,q=void 0;try{for(var R,K=c.entries(v)[Symbol.iterator]();!(O=(R=K.next()).done);O=!0){var H=r(R.value,2),D=H[0],A=H[1],W="";if("object"===$.type(A)){U+=U?"<br>":"",N+=N?"<br>":"",U+=("item"===D?"道具":"装备")+"：";var z="item"===D?P:M,G=!0,Q=!1,J=void 0;try{for(var X,ee=c.getSortedObjectKeyList(z,A)[Symbol.iterator]();!(G=(X=ee.next()).done);G=!0){var te=X.value;W+="<i>"+te+"<em>+"+A[te].toLocaleString()+"</em></i> "}}catch(e){Q=!0,J=e}finally{try{!G&&ee.return&&ee.return()}finally{if(Q)throw J}}}else W+="<i>"+D+"<em>+"+A.toLocaleString()+"</em></i> ";U+=W,N+=W.trim()}}catch(e){j=!0,q=e}finally{try{!O&&K.return&&K.return()}finally{if(j)throw q}}if(N.length<200&&(N=N.replace(/(.*)<br>/,"$1")),$('.pd_result[data-name="boxResult"]:last').append('\n<li class="pd_stat">\n  <b>统计结果（平均随机值【<em>'+b+"</em>】）：</b><br>\n  "+(U?U:"无")+"\n</li>\n"),console.log("共有"+d+"个【"+n+"】打开成功（平均随机值【"+b+"】）"+(s>0?"，共有"+s+"个盒子打开失败":"")),f.show("<strong>共有<em>"+d+"</em>个【"+n+"】打开成功（平均随机值【<em>"+b+"</em>】）"+(s>0?"，共有<em>"+s+"</em>个盒子打开失败":"")+"</strong>"+(N.length>25?"<br>"+N:N),-1),x.runFunc("Item.openBoxes_after_",v),setTimeout(function(){return F(1)},h.default.defAjaxInterval),$(document).queue("OpenAllBoxes").length>0)setTimeout(function(){return $(document).dequeue("OpenAllBoxes")},"function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval);else if(l){var ne=null;Config.smeltArmsAfterOpenBoxesEnabled?ne=function(){return V(Config.defSmeltArmTypeList,o,l)}:Config.useItemsAfterOpenBoxesEnabled?ne=function(){return Y(Config.defUseItemTypeList,o,l)}:Config.sellItemsAfterOpenBoxesEnabled&&(ne=function(){return Z(Config.defSellItemTypeList,o,l)}),ne&&setTimeout(ne,h.default.minActionInterval)}}else p%10==0&&setTimeout(function(){return F(1)},h.default.defAjaxInterval),setTimeout(function(){return $(document).dequeue("OpenBoxes")},"function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval)})};L.parent().append('<ul class="pd_result" data-name="boxResult"><li><strong>【'+n+"】打开结果：</strong></li></ul>");var _=f.wait('<strong>正在打开盒子中&hellip;</strong><i>剩余：<em class="pd_countdown">'+a+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');$(document).clearQueue("OpenBoxes"),$.each(new Array(a),function(){$(document).queue("OpenBoxes",b)}),$(document).dequeue("OpenBoxes")},j=n.handleArmArea=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.find('a[onclick^="cdzb"]').removeAttr("onclick").attr("data-name","equip"),e.find('a[onclick^="rlzb"]').removeAttr("onclick").attr("data-name","smelt");var n=e.find('tr[id^="wp_"]');if(n.length>0){var a=n.attr("id"),o=n.find("td");o.removeAttr("colspan").removeAttr("style").css({"text-align":"left","padding-left":"5px"}),o.html(o.html().replace("（装备中）","")),n.removeAttr("id").prepend('<td id="'+a+'"><a data-name="equip" href="javascript:;">装备</a></td><td><a data-name="smelt" href="javascript:;">熔炼</a></td>').addClass("pd_arm_equipped")}e.find('tr:not([data-id]) > td[id^="wp_"]').each(function(){var e=$(this),t=/wp_(\d+)/.exec(e.attr("id"));if(t){var n=parseInt(t[1]),a=e.parent("tr");a.attr("data-id",n),Config.armsMemo[n]&&a.find("> td:nth-child(3)").attr("data-memo",Config.armsMemo[n].slice(0,12).replace(/"/g,""))}}),1===t&&e.find('a[data-name="equip"]').attr("data-name","add").text("加入")},q=n.bindArmLinkClickEvent=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.on("click",'a[data-name="equip"]',function(){var a=$(this),o=parseInt(a.closest("tr").data("id"));$.post("kf_fw_ig_mybpdt.php","do=4&id="+o+"&safeid="+t,function(t){if(/装备完毕/.test(t)){if(e.find(".pd_arm_equipped").removeClass("pd_arm_equipped"),a.closest("tr").addClass("pd_arm_equipped"),1===n){var i=f.wait("<strong>正在获取争夺首页信息&hellip;</strong>");I.updateLootInfo(function(){f.remove(i),$("#pdChangeArmDialog").parent().hide();var e=$('input[name="armId"]:first'),t=$('input[name="armMemo"]:first');e.val(o),t.val($("#pdArmArea > span:first").text().trim()),$.each([e,t],function(){this.get(0).defaultValue=""})})}}else alert(c.removeHtmlTag(t))})}).on("click",'a[data-name="smelt"]',function(){if(confirm("确定熔炼此装备吗？")){var e=$(this),n=parseInt(e.closest("tr").data("id"));$.post("kf_fw_ig_mybpdt.php","do=5&id="+n+"&safeid="+t,function(t){var a=c.removeHtmlTag(t);/装备消失/.test(a)?(e.closest("tr").html('<td colspan="3">'+a+"</td>"),n in Config.armsMemo&&((0,v.read)(),delete Config.armsMemo[n],(0,v.write)())):alert(a)})}}).on("click",'a[data-name="add"]',function(){var e=$(this).closest("tr"),t=parseInt(e.data("id")),n=G(e.find("> td:nth-child(3)").html());$("#pdAddArmDialog").parent().hide(),$("#pdAddArmMemo").val(n["名称"]),$("#pdAddArmId").val(t).focus()}).on("mouseenter","tr",function(){var e=$(this);if(e.has('> td[id^="wp_"]').length){e.find("> td:nth-child(3)").append('<a class="show_arm_info" data-name="showArmInfo" href="#" title="查看装备信息">查</a>')}}).on("mouseleave","tr",function(){var e=$(this);e.has('> td[id^="wp_"]').length&&e.find("> td:nth-child(3) .show_arm_info").remove()}).on("click",".show_arm_info",function(t){t.preventDefault();var n=$(this),a=$(this).parent("td"),o=n.closest("tr"),i=parseInt(o.data("id"));n.remove(),R(i,G(a.html()),e)})},R=function(e,t,n){if(!($("#pdArmInfoDialog").length>0)){f.destroy();var a='\n<div class="pd_cfg_main">\n  <div style="width: 550px; margin-top: 5px; padding-bottom: 5px; border-bottom: 1px solid #99f;">\n    <span style="color: '+t["颜色"]+'">'+t["名称"]+"</span> - "+t["描述"]+'\n  </div>\n  <div style="margin-top: 5px;">\n    <label>装备ID：<input name="armId" type="text" value="'+e+'" style="width: 100px;" readonly></label>\n    <a class="pd_btn_link" data-name="copy" data-target="[name=armId]" href="#">复制</a>\n  </div>\n  <div style="margin-top: 5px;">\n    <label>武器参数设置：</label>\n    <a class="pd_btn_link" data-name="copy" data-target="[name=armInfo]" href="#">复制</a><br>\n    <textarea name="armInfo" rows="6" style="width: 550px;" wrap="off" style="white-space: pre;" readonly></textarea>\n  </div>\n  <div style="margin-top: 5px;">\n    <label>\n      装备备注：<input name="armMemo" type="text" maxlength="20" style="width: 180px;">\n    </label>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <button name="saveMemo" type="button">保存备注</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',o=m.create("pdArmInfoDialog","装备信息",a,"z-index: 1001;");o.on("click",'a[data-name="copy"]',function(e){e.preventDefault();var t=o.find($(this).data("target"));c.copyText(t)||t.select().focus(),x.runFunc("Item.showArmInfoDialog_copy_")}).find('[name="saveMemo"]').click(function(t){t.preventDefault(),(0,v.read)();var a=$.trim(o.find('input[name="armMemo"]').val()),i=n.find('tr[data-id="'+e+'"] > td:nth-child(3)');a?(Config.armsMemo[e]=a,i.attr("data-memo",a.slice(0,12).replace(/"/g,""))):(delete Config.armsMemo[e],i.removeAttr("data-memo")),(0,v.write)(),m.close("pdArmInfoDialog")}),o.find('textarea[name="armInfo"]').val(K(t)),Config.armsMemo[e]&&o.find('input[name="armMemo"]').val(Config.armsMemo[e]),m.show("pdArmInfoDialog"),x.runFunc("Item.showArmInfoDialog_after_")}},K=n.getWeaponParameterSetting=function(e){var t={"组别":"","神秘属性数量":0,"所有的神秘属性":"","主属性数量":0,"所有的主属性":"","从属性数量":0,"所有的从属性":""},n=new Map([["长剑","Sword"],["短弓","Bow"],["法杖","Staff"]]);t["组别"]=n.get(e["组别"]);var a=new Map([["火神秘","FMT"],["雷神秘","LMT"],["风神秘","AMT"]]),o=!0,i=!1,l=void 0;try{for(var d,s=a[Symbol.iterator]();!(o=(d=s.next()).done);o=!0){var p=r(d.value,2),f=p[0],u=p[1];f in e&&(t["神秘属性数量"]++,t["所有的神秘属性"]+=u+" ")}}catch(e){i=!0,l=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw l}}var m=new Map([["增加攻击力","ATK"],["增加暴击伤害","CRT"],["增加技能伤害","SKL"],["穿透对方意志","BRC"],["生命夺取","LCH"],["增加速度","SPD"],["攻击","ATK"],["暴击","CRT"],["技能","SKL"],["穿透","BRC"],["吸血","LCH"],["速度","SPD"]]),g=!0,h=!1,v=void 0;try{for(var b,y=e["主属性"][Symbol.iterator]();!(g=(b=y.next()).done);g=!0){var u=b.value,_=u.split("(",1),x=r(_,1),k=x[0],C=void 0===k?"":k;C=C.trim(),C&&(t["主属性数量"]++,t["所有的主属性"]+=m.get(C)+" ")}}catch(e){h=!0,v=e}finally{try{!g&&y.return&&y.return()}finally{if(h)throw v}}var w=new Map([["系数(x3)","COF"],["力量","STR"],["敏捷","AGI"],["智力","INT"]]),I=!0,L=!1,S=void 0;try{for(var T,D=e["从属性"][Symbol.iterator]();!(I=(T=D.next()).done);I=!0){var A=T.value;if(A=$.trim(A)){var E=/(?:\[.])?(\S+?)\((\S+?)x([\d\.]+)%\)/.exec(A);E&&(t["从属性数量"]++,t["所有的从属性"]+=m.get(E[1])+" "+w.get(E[2])+" "+Math.floor(10*parseFloat(E[3]))+" ")}}}catch(e){L=!0,S=e}finally{try{!I&&D.return&&D.return()}finally{if(L)throw S}}var M="\n[组别]\n[神秘属性数量] [所有的神秘属性] \n[主属性数量] [所有的主属性]\n[从属性数量] [所有的从属性]\n".trim(),P=!0,F=!1,B=void 0;try{for(var U,N=c.entries(t)[Symbol.iterator]();!(P=(U=N.next()).done);P=!0){var O=r(U.value,2),f=O[0],j=O[1];M=M.replace("["+f+"]",$.trim(j))}}catch(e){F=!0,B=e}finally{try{!P&&N.return&&N.return()}finally{if(F)throw B}}return M},H=function(){$('\n<div class="pd_item_btns" data-name="handleArmBtns">\n  <button name="clearArmsMemo" type="button" title="清除所有装备的备注">清除备注</button>\n  <button name="showArmsFinalAddition" type="button" title="显示当前页面上所有装备的最终加成信息">显示最终加成</button>\n  <button name="smeltArms" type="button" style="color: #f00;" title="批量熔炼指定装备">批量熔炼</button>\n</div>\n').insertAfter(S).find('[name="smeltArms"]').click(function(){return z(D)}).end().find('[name="clearArmsMemo"]').click(function(){confirm("是否清除所有装备的备注？")&&((0,v.read)(),Config.armsMemo={},(0,v.write)())}).end().find('[name="showArmsFinalAddition"]').click(function(){if(confirm("是否显示当前页面上所有装备的最终加成信息？")){f.destroy();var e=0,t=[];S.find('td[id^="wp_"]').each(function(){var n=$(this),a=parseInt(n.parent("tr").data("id"));a&&t.push(a),n.parent("tr").hasClass("pd_arm_equipped")&&(e=a)}),(e||confirm("当前页面未发现有已装备的武器，显示最终加成信息后将用最后一件武器进行装备，是否继续？"))&&t.length>0&&W(t,e,D)}})},W=function(e,t,n){var a=0,o=function t(o){var l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=4&id="+o+"&safeid="+n,timeout:h.default.defAjaxTimeout}).done(function(n){var d=c.removeHtmlTag(n);if(console.log("装备ID["+o+"]："+d.replace("\n"," ")),!l){if(/装备完毕/.test(d)||a++,a>=e.length)return void r();/装备完毕/.test(d)?setTimeout(function(){return i(o)},h.default.defAjaxInterval):setTimeout(function(){return t(e[a])},h.default.minActionInterval)}}).fail(function(){return setTimeout(function(){return t(o)},h.default.minActionInterval)})},i=function t(n){$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:h.default.defAjaxTimeout}).done(function(t){if(l.find(".pd_countdown").text(e.length-(a+1)),l.data("stop"))return void r();var i=/>(最终加成：[^<>]+)</.exec(t);if(i){var d=i[1];console.log("装备ID["+n+"]："+d);var s=S.find('td[id="wp_'+n+'"]').parent("tr").find("td:nth-child(3)");s.find(".pd_final_addition_info").remove(),s.append('<span class="pd_final_addition_info"><br>'+d+"</span>")}if(++a>=e.length)return void r();setTimeout(function(){return o(e[a])},h.default.minActionInterval),x.runFunc("Item.showArmsFinalAddition_show_",n)}).fail(function(){return setTimeout(function(){return t(n)},h.default.defAjaxInterval)})},r=function(){f.remove(l),t&&setTimeout(function(){return o(t,!0)},h.default.minActionInterval),x.runFunc("Item.showArmsFinalAddition_complete_")},l=f.wait('<strong>正在获取装备最终加成信息&hellip;</strong><i>剩余：<em class="pd_countdown">'+e.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');o(e[0])},z=function(){var e="pdBatchSmeltArmsDialog";if(!($("#"+e).length>0)){f.destroy(),(0,v.read)();var t="",n=!0,a=!1,o=void 0;try{for(var i,r=E[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;t+="<li><b>"+l+"：</b>";var d=!0,s=!1,p=void 0;try{for(var u,g=M[Symbol.iterator]();!(d=(u=g.next()).done);d=!0){var h=u.value,b=h.split("的")[0];if("神秘"!==b){var y=b+"的"+l;t+='\n<label style="margin-right: 5px;">\n  <input type="checkbox" name="smeltArmsType" value="'+y+'" '+(Config.defSmeltArmTypeList.includes(y)?"checked":"")+"> "+b+"\n</label>"}}}catch(e){s=!0,p=e}finally{try{!d&&g.return&&g.return()}finally{if(s)throw p}}t+="</li>"}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}var _='\n<div class="pd_cfg_main">\n  <div>请选择想批量熔炼的装备种类：</div>\n  <ul data-name="smeltArmTypeList">'+t+'</ul>\n</div>\n<div class="pd_cfg_btns">\n  <button name="selectAll" type="button">全选</button>\n  <button name="selectInverse" type="button">反选</button>\n  <button name="smelt" type="button" style="color: #f00;">熔炼</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',k=m.create(e,"批量熔炼装备",_),C=k.find('ul[data-name="smeltArmTypeList"]');k.find('[name="smelt"]').click(function(){var t=[];C.find('input[name="smeltArmsType"]:checked').each(function(){t.push($(this).val())}),t.length&&((0,v.read)(),Config.defSmeltArmTypeList=t,(0,v.write)(),confirm("是否熔炼所选装备种类？")&&(m.close(e),V(t,D)))}).end().find('[name="selectAll"]').click(function(){return c.selectAll(C.find('input[name="smeltArmsType"]'))}).end().find('[name="selectInverse"]').click(function(){return c.selectInverse(C.find('input[name="smeltArmsType"]'))}),m.show(e),x.runFunc("Item.showBatchSmeltArmsDialog_after_")}},V=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=0,o=0,i={},l=!1,d=function(e,n,r,d){o++,$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=5&id="+e+"&safeid="+t,timeout:h.default.defAjaxTimeout}).done(function(t){if(t){var o=c.removeHtmlTag(t);console.log("【"+r+"】 "+o),$('.pd_result[data-name="armResult"]:last').append("<li>【"+r+"】 "+o+"</li>"),S.find('td[id="wp_'+e+'"]').parent("tr").fadeOut("normal",function(){$(this).remove()});var d=/获得对应装备经验\[\+(\d+)]/.exec(o);d&&(a++,e in Config.armsMemo&&(l=!0,delete Config.armsMemo[e]),n in i||(i[n]={num:0,exp:0}),i[n].num++,i[n].exp+=parseInt(d[1]),g.find(".pd_countdown").text(a),x.runFunc("Item.smeltArms_after_"))}}).fail(function(){$('.pd_result[data-name="armResult"]:last').append("<li>【"+r+'】 <span class="pd_notice">连接超时</span></li>')}).always(function(){g.data("stop")?m():o===d?setTimeout(p,h.default.minActionInterval):setTimeout(function(){return $(document).dequeue("SmeltArms")},h.default.minActionInterval)})},s=function(){var t=[];if(S.find('td[id^="wp_"]').each(function(){var n=($(this),$(this).parent("tr"));if(!n.hasClass("pd_arm_equipped")){var a=parseInt(n.data("id")),o=n.find("> td:nth-child(3) > span:first").text().trim(),i=o.split("的"),l=r(i,2),d=l[1];o&&d&&e.includes(o)&&t.push({armId:a,armGroup:d,armName:o})}}),!t.length)return void m();o=0,$(document).clearQueue("SmeltArms"),$.each(t,function(e,n){var a=n.armId,o=n.armGroup,i=n.armName;$(document).queue("SmeltArms",function(){return d(a,o,i,t.length)})}),$(document).dequeue("SmeltArms")},p=function(){F(2,function(){g.data("stop")?m():setTimeout(s,h.default.defAjaxInterval)})},u=function(){var e=null;Config.useItemsAfterOpenBoxesEnabled?e=function(){return Y(Config.defUseItemTypeList,t,n)}:Config.sellItemsAfterOpenBoxesEnabled&&(e=function(){return Z(Config.defSellItemTypeList,t,n)}),e&&setTimeout(e,h.default.minActionInterval)},m=function(){if($(document).clearQueue("SmeltArms"),f.remove(g),$.isEmptyObject(i))return console.log("没有装备被熔炼！"),void(n&&u());var e=0,t=0,o="",r=!0,d=!1,s=void 0;try{for(var p,m=c.getSortedObjectKeyList(E,i)[Symbol.iterator]();!(r=(p=m.next()).done);r=!0){var b=p.value;e++;var _=i[b],k=_.exp,C=_.num;t+=k,o+="【"+b+"】 <i>装备<ins>-"+C+"</ins></i> <i>武器经验<em>+"+k.toLocaleString()+"</em></i><br>",y.push("熔炼装备","共有`"+C+"`个【`"+b+"`】装备熔炼成功",{gain:{"武器经验":t},pay:{"装备":-C}})}}catch(e){d=!0,s=e}finally{try{!r&&m.return&&m.return()}finally{if(d)throw s}}$('.pd_result[data-name="armResult"]:last').append('\n<li class="pd_stat">\n  <b>统计结果（共有<em>'+e+"</em>个组别中的<em>"+a+"</em>个装备熔炼成功）：</b> <i>武器经验<em>+"+t.toLocaleString()+"</em></i><br>\n  "+o+"\n</li>"),console.log("共有"+e+"个组别中的"+a+"个装备熔炼成功，武器经验+"+t),f.show("<strong>共有<em>"+e+"</em>个组别中的<em>"+a+"</em>个装备熔炼成功</strong><i>武器经验<em>+"+t.toLocaleString()+"</em></i>",-1),l&&(0,v.write)(),setTimeout(function(){return F(2)},h.default.defAjaxInterval),n&&u(),x.runFunc("Item.smeltArms_complete_")};$.isEmptyObject(Config.armsMemo)||(0,v.read)(),S.parent().append('<ul class="pd_result" data-name="armResult"><li><strong>熔炼结果：</strong></li></ul>');var g=f.wait('<strong>正在熔炼装备中&hellip;</strong><i>已熔炼：<em class="pd_countdown">0</em></i><a class="pd_stop_action" href="#">停止操作</a>');s()},G=n.getArmInfo=function(e){var t={"名称":"","颜色":"#000","组别":"","描述":"","作用":"","主属性":[],"从属性":[],"最终加成":[]},n=/<span style="color:([^<>]+);">([^<>]+)<\/span>/.exec(e);if(!n)return t;t["颜色"]=n[1],t["名称"]=n[2];var a=n[2].split("的"),o=r(a,2),i=o[1];t["组别"]=void 0===i?"":i;var l=e.split("</span> - ",2),d=r(l,2),s=d[1];t["描述"]=void 0===s?"":s;var p=c.removeHtmlTag(t["描述"]),f=p.split("\n",1),u=r(f,1),m=u[0];t["作用"]=void 0===m?"":m,n=/主属性：(.+?)\n/.exec(p),n&&(t["主属性"]=n[1].split("。")),n=/从属性：(.+?)(\n|$)/.exec(p),n&&(t["从属性"]=n[1].split("。")),(n=/最终加成：(.+?)(\n|$)/.exec(p))&&(t["最终加成"]=n[1].split(" | "));var g=p.match(/(.神秘)：(.+?)。/g);for(var h in g){var v=/(.神秘)：(.+?)。/.exec(g[h]);g&&(t[v[1]]=v[2])}return t},Q=(n.getArmsLevelInfo=function(e){var t=new Map([["武器",0],["护甲",0],["项链",0]]),n=e.match(/value="(\S+?)等级\[\s*(\d+)\s*] 经验:\d+"/g);for(var a in n){var o=/value="(\S+?)等级\[\s*(\d+)\s*] 经验:\d+"/.exec(n[a]);t.set(o[1],parseInt(o[2]))}return t},n.getLevelByName=function(e){switch(e){case"零时迷子的碎片":case"被遗弃的告白信":case"学校天台的钥匙":case"TMA最新作压缩包":return 1;case"LOLI的钱包":case"棒棒糖":return 2;case"蕾米莉亚同人漫画":case"十六夜同人漫画":return 3;case"档案室钥匙":case"傲娇LOLI娇蛮音CD":return 4;case"整形优惠卷":case"消逝之药":return 5;default:return 0}}),J=(n.getItemsUsedNumInfo=function(e){var t=new Map([["蕾米莉亚同人漫画",0],["十六夜同人漫画",0],["档案室钥匙",0],["傲娇LOLI娇蛮音CD",0],["消逝之药",0],["整形优惠卷",0]]),n=e.match(/value="\[\s*(\d+)\s*](\S+?)"/g);for(var a in n){var o=/value="\[\s*(\d+)\s*](\S+?)"/.exec(n[a]);t.has(o[2])&&t.set(o[2],parseInt(o[1]))}return t},function(){$('\n<div class="pd_item_btns" data-name="handleItemsBtns">\n  <button name="useItems" type="button" style="color: #00f;" title="批量使用指定道具">批量使用</button>\n  <button name="sellItems" type="button" style="color: #f00;" title="批量出售指定道具">批量出售</button>\n</div>\n').insertAfter(T).find('[name="useItems"]').click(function(){return X(1,D)}).end().find('[name="sellItems"]').click(function(){return X(2,D)}),C.addSlowActionChecked($('.pd_item_btns[data-name="handleItemsBtns"]'))}),X=function(e){var t="pdBatchUseAndSellItemsDialog";if(!($("#"+t).length>0)){f.destroy();var n=1===e?"使用":"出售";(0,v.read)();var a="",o=!0,i=!1,r=void 0;try{for(var l,d=P.slice(6)[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){a+="<option>"+l.value+"</option>"}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}var s='\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">请选择想批量'+n+'的道具种类（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</div>\n  <select name="itemTypes" size="6" style="width: 320px;" multiple>'+a+'</select>\n</div>\n<div class="pd_cfg_btns">\n  <button name="sell" type="button">'+n+'</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',c=m.create(t,"批量"+n+"道具",s);c.find('[name="itemTypes"]').keydown(function(e){e.ctrlKey&&65===e.keyCode&&(e.preventDefault(),$(this).children().prop("selected",!0))}).end().find('[name="sell"]').click(function(){var a=c.find('[name="itemTypes"]').val();Array.isArray(a)&&((0,v.read)(),1===e?Config.defUseItemTypeList=a:Config.defSellItemTypeList=a,(0,v.write)(),confirm("是否"+n+"所选道具种类？")&&(m.close(t),1===e?Y(a,D):Z(a,D)))}),c.find('[name="itemTypes"] > option').each(function(){var t=$(this);(1===e?Config.defUseItemTypeList:Config.defSellItemTypeList).includes(t.val())&&t.prop("selected",!0)}),m.show(t),x.runFunc("Item.showBatchUseAndSellItemsDialog_after_",e)}},Y=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=0,o=0,l=0,d=0,s={},p=[].concat(i(e)),u=function(e,n,i){d++,$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=1&id="+e+"&safeid="+t,timeout:h.default.defAjaxTimeout}).done(function(t){if(t){var r=c.removeHtmlTag(t),f=!1;if(/(成功|失败)！/.test(r))a++,n in s||(s[n]={"道具":0,"有效道具":0,"无效道具":0}),s[n]["道具"]++,/成功！/.test(r)?(s[n]["有效道具"]++,o++):(s[n]["无效道具"]++,l++),_.find(".pd_countdown").text(a),f=!0;else if(/无法再使用/.test(r)){d=i;var u=p.indexOf(n);u>-1&&p.splice(u,1)}else f=!0;f&&T.find('[id="wp_'+e+'"]').fadeOut("normal",function(){$(this).remove()}),console.log("【Lv."+Q(n)+"："+n+"】 "+r),$('.pd_result[data-name="itemResult"]:last').append("<li>【Lv."+Q(n)+"："+n+"】 "+r+"</li>"),x.runFunc("Item.useItems_after_")}}).fail(function(){$('.pd_result[data-name="itemResult"]:last').append("<li>【Lv."+Q(n)+"："+n+'】 <span class="pd_notice">连接超时</span></li>')}).always(function(){_.data("stop")?b():d===i?setTimeout(g,"function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval):setTimeout(function(){return $(document).dequeue("UseItems")},"function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval)})},m=function(){var e=[];if(T.find('tr[id^="wp_"]').each(function(){var t=$(this),n=/wp_(\d+)/.exec(t.attr("id"));if(n){var a=parseInt(n[1]),o=t.find("> td:nth-child(3)").text().trim();p.includes(o)&&e.push({itemId:a,itemName:o})}}),!e.length)return void b();d=0,$(document).clearQueue("UseItems"),$.each(e,function(t,n){var a=n.itemId,o=n.itemName;$(document).queue("UseItems",function(){return u(a,o,e.length)})}),$(document).dequeue("UseItems")},g=function(){F(2,function(){_.data("stop")?b():setTimeout(m,h.default.defAjaxInterval)})},v=function(){var e=null;Config.sellItemsAfterOpenBoxesEnabled&&(e=function(){return Z(Config.defSellItemTypeList,t,n)}),e&&setTimeout(e,h.default.minActionInterval)},b=function(){if($(document).clearQueue("UseItems"),f.remove(_),$.isEmptyObject(s))return console.log("没有道具被使用！"),void(n&&v());var t=0,i="",d=!0,p=!1,u=void 0;try{for(var m,g=c.getSortedObjectKeyList(e,s)[Symbol.iterator]();!(d=(m=g.next()).done);d=!0){var b=m.value;t++;var k=Q(b),C=s[b],w=C["道具"];if(delete C["道具"],0===C["有效道具"]&&delete C["有效道具"],0===C["无效道具"]&&delete C["无效道具"],!$.isEmptyObject(C)){i+="【Lv."+k+"："+b+"】 <i>道具<ins>-"+w+"</ins></i> ";var I=!0,L=!1,S=void 0;try{for(var T,D=c.entries(C)[Symbol.iterator]();!(I=(T=D.next()).done);I=!0){var A=r(T.value,2);i+="<i>"+A[0]+"<em>+"+A[1]+"</em></i> "}}catch(e){L=!0,S=e}finally{try{!I&&D.return&&D.return()}finally{if(L)throw S}}i+="<br>",y.push("使用道具","共有`"+w+"`个【`Lv."+k+"："+b+"`】道具被使用",{gain:C,pay:{"道具":-w}})}}}catch(e){p=!0,u=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw u}}$('.pd_result[data-name="itemResult"]:last').append('\n<li class="pd_stat">\n  <b>统计结果（共有<em>'+t+"</em>个种类中的<em>"+a+"</em>个道具被使用，\n<i>有效道具<em>+"+o+"</em></i><i>无效道具<em>+"+l+"</em></i>）：</b><br>\n  "+i+"\n</li>"),console.log("共有"+t+"个种类中的"+a+"个道具被使用，有效道具+"+o+"，无效道具+"+l),f.show("<strong>共有<em>"+t+"</em>个种类中的<em>"+a+"</em>个道具被使用</strong><i>有效道具<em>+"+o+"</em></i><i>无效道具<em>+"+l+"</em></i>",-1),setTimeout(function(){return F(2)},h.default.defAjaxInterval),n&&v(),x.runFunc("Item.useItems_complete_")};T.parent().append('<ul class="pd_result" data-name="itemResult"><li><strong>使用结果：</strong></li></ul>');var _=f.wait('<strong>正在使用道具中&hellip;</strong><i>已使用：<em class="pd_countdown">0</em></i><a class="pd_stop_action" href="#">停止操作</a>');m()},Z=function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],0),a=0,o={},i=function(e,i,r){a++,$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=2&id="+e+"&safeid="+t,timeout:h.default.defAjaxTimeout}).done(function(t){if(t){var a=c.removeHtmlTag(t);console.log("【Lv."+Q(i)+"："+i+"】 "+a),$('.pd_result[data-name="itemResult"]:last').append("<li>【Lv."+Q(i)+"："+i+"】 "+a+"</li>"),T.find('[id="wp_'+e+'"]').fadeOut("normal",function(){$(this).remove()});var r=/出售该物品获得了\[\s*(\d+)\s*]KFB/.exec(a);r&&(n++,i in o||(o[i]={num:0,sell:0}),o[i].num++,o[i].sell+=parseInt(r[1]),s.find(".pd_countdown").text(n),x.runFunc("Item.sellItems_after_"))}}).fail(function(){$('.pd_result[data-name="itemResult"]:last').append("<li>【Lv."+Q(i)+"："+i+'】 <span class="pd_notice">连接超时</span></li>')}).always(function(){s.data("stop")?d():a===r?setTimeout(l,h.default.minActionInterval):setTimeout(function(){return $(document).dequeue("SellItems")},h.default.minActionInterval)})},r=function(){var t=[];if(T.find('tr[id^="wp_"]').each(function(){var n=$(this),a=/wp_(\d+)/.exec(n.attr("id"));if(a){var o=parseInt(a[1]),i=n.find("> td:nth-child(3)").text().trim();e.includes(i)&&t.push({itemId:o,itemName:i})}}),!t.length)return void d();a=0,$(document).clearQueue("SellItems"),$.each(t,function(e,n){var a=n.itemId,o=n.itemName;$(document).queue("SellItems",function(){return i(a,o,t.length)})}),$(document).dequeue("SellItems")},l=function(){F(2,function(){s.data("stop")?d():setTimeout(r,h.default.defAjaxInterval)})},d=function(){if($(document).clearQueue("SellItems"),f.remove(s),$.isEmptyObject(o))return void console.log("没有道具被出售！");var t=0,a=0,i="",r=!0,l=!1,d=void 0;try{for(var p,u=c.getSortedObjectKeyList(e,o)[Symbol.iterator]();!(r=(p=u.next()).done);r=!0){var m=p.value;t++;var g=Q(m),v=o[m],b=v.sell,_=v.num;a+=b,i+="【Lv."+g+"："+m+"】 <i>道具<ins>-"+_+"</ins></i> <i>KFB<em>+"+b.toLocaleString()+"</em></i><br>",y.push("出售道具","共有`"+_+"`个【`Lv."+g+"："+m+"`】道具出售成功",{gain:{KFB:b},pay:{"道具":-_}})}}catch(e){l=!0,d=e}finally{try{!r&&u.return&&u.return()}finally{if(l)throw d}}$('.pd_result[data-name="itemResult"]:last').append('\n<li class="pd_stat">\n  <b>统计结果（共有<em>'+t+"</em>个种类中的<em>"+n+"</em>个道具出售成功）：</b> <i>KFB<em>+"+a.toLocaleString()+"</em></i><br>\n  "+i+"\n</li>"),console.log("共有"+t+"个种类中的"+n+"个道具出售成功，KFB+"+a),f.show("<strong>共有<em>"+t+"</em>个种类中的<em>"+n+"</em>个道具出售成功</strong><i>KFB<em>+"+a.toLocaleString()+"</em></i>",-1),setTimeout(function(){return F(2)},h.default.defAjaxInterval),x.runFunc("Item.sellItems_complete_")};T.parent().append('<ul class="pd_result" data-name="itemResult"><li><strong>出售结果：</strong></li></ul>');var s=f.wait('<strong>正在出售道具中&hellip;</strong><i>已出售：<em class="pd_countdown">0</em></i><a class="pd_stop_action" href="#">停止操作</a>');r()},ee=(n.addBatchBuyItemsLink=function(){var e=$(".kf_fw_ig1").addClass("pd_items");e.find("> tbody > tr:first-child > td:nth-child(2)").css("width","430px").next("td").next("td").css("width","120px"),e.find('a[href^="kf_fw_ig_shop.php?do=buy&id="]').after('<a data-name="batchBuyItem" href="#">批量购买</a>'),e.on("click",'[data-name="batchBuyItem"]',function(e){e.preventDefault();var t=$(this),n=t.closest("tr"),a=n.find("td:first-child").text().trim(),o=parseInt(n.find("td:nth-child(3)").text()),i=t.prev("a").attr("href");if(a.includes("道具")&&o&&i){var r=parseInt(prompt("你要购买多少个【"+a+"】？（单价："+o.toLocaleString()+" KFB）",0));!r||r<0||(f.wait('<strong>正在购买道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+r+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),ee(r,a,o,i))}}).on("click",'a[href^="kf_fw_ig_shop.php?do=buy&id="]',function(){return confirm("是否购买该物品？")}),e.after('<div class="pd_item_btns"></div>'),C.addSlowActionChecked($(".pd_item_btns")),te()},function(e,t,n,a){var o=0,i=0,l=[],d={},s=!1,p=function e(){$.ajax({type:"GET",url:a+"&t="+$.now(),timeout:h.default.defAjaxTimeout,success:function(e){C.showFormatLog("购买道具",e);var t=c.getResponseMsg(e),a=t.msg;/购买成功，返回我的背包/.test(a)?(o++,i+=n):(s=!0,$(".pd_result:last").append("<li>"+a+'<span class="pd_notice">（购买中止）</span></li>')),setTimeout(u,h.default.defAjaxInterval)},error:function(){setTimeout(e,h.default.defAjaxInterval)}})},u=function n(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];$.ajax({type:"GET",url:"kf_fw_ig_mybp.php?t="+$.now(),timeout:h.default.defAjaxTimeout,success:function(n){var u=[];$('.kf_fw_ig1 a[href^="kf_fw_ig_mybp.php?do=1&id="]',n).each(function(){var e=$(this),t=e.attr("href");if(u.push(t),!a&&!l.includes(t)){var n=e.closest("tr").find("td:nth-child(3)").text().trim()
;P.includes(n)&&(n in d||(d[n]=0),d[n]++,console.log("获得了一个【Lv."+Q(n)+"："+n+"】道具"),$(".pd_result:last").append('<li>获得了一个【<b class="pd_highlight">Lv.'+Q(n)+"："+n+"</b>】道具</li>"))}}),l=u;var m=$(".pd_countdown:last");if(m.text(e-o),(s=s||m.closest(".pd_msg").data("stop"))||o===e){f.remove(m.closest(".pd_msg"));var g=!0,v=!1,b=void 0;try{for(var _,x=c.entries(d)[Symbol.iterator]();!(g=(_=x.next()).done);g=!0){var k=r(_.value,2),C=k[0];k[1]||delete d[C]}}catch(e){v=!0,b=e}finally{try{!g&&x.return&&x.return()}finally{if(v)throw b}}o>0&&!$.isEmptyObject(d)&&y.push("购买道具","共有`"+o+"`个【`"+t+"`】购买成功",{gain:{"道具":o,item:d},pay:{KFB:-i}});var w="",I=!0,L=!1,S=void 0;try{for(var T,D=c.getSortedObjectKeyList(P,d)[Symbol.iterator]();!(I=(T=D.next()).done);I=!0){var C=T.value;w+="<i>"+C+"<em>+"+d[C]+"</em></i> "}}catch(e){L=!0,S=e}finally{try{!I&&D.return&&D.return()}finally{if(L)throw S}}$(".pd_result:last").append('\n<li class="pd_stat">\n  <b>统计结果：</b><br>\n  共有<em>'+o+"</em>个道具购买成功，<i>KFB<ins>-"+i.toLocaleString()+"</ins></i> "+w+'<br>\n  <span style="color: #666;">(请到<a href="kf_fw_ig_mybp.php">角色/物品页面</a>查看)</span>\n</li>\n'),console.log("共有"+o+"个【"+t+"】购买成功，KFB-"+i),f.show("<strong>共有<em>"+o+"</em>个【"+t+"】购买成功</strong><i>KFB<ins>-"+i.toLocaleString()+"</ins></i>",-1),te()}else{var A="function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval;setTimeout(p,a?h.default.defAjaxInterval:A)}},error:function(){setTimeout(function(){return n(a)},h.default.defAjaxInterval)}})};$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【'+t+"】购买结果：</strong></li></ul>"),u(!0)}),te=function(){$.get("profile.php?action=show&uid="+d.default.uid+"&t="+$.now(),function(e){var t=/论坛货币：(\d+)\s*KFB<br/i.exec(e);if(t){var n=parseInt(t[1]);$(".kf_fw_ig_title1:last").find("span:last").remove().end().append('<span style="margin-left: 7px;">(当前持有 <b style="font-size: 14px;">'+n.toLocaleString()+"</b> KFB)</span>")}})}},{"./Config":4,"./Const":6,"./Dialog":7,"./Info":9,"./Log":11,"./Loot":13,"./Msg":15,"./Public":18,"./Script":20,"./Util":22}],11:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.getMergeLog=n.push=n.clear=n.write=n.read=void 0;var o=e("./Info"),i=a(o),r=e("./Util"),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r),d=e("./Const"),s=a(d),c=s.default.storagePrefix+"log",p=n.read=function(){var e={},t=l.readData(c+"_"+i.default.uid);if(!t)return e;try{t=JSON.parse(t)}catch(t){return e}return t&&"object"===$.type(t)?e=t:e},f=n.write=function(e){return l.writeData(c+"_"+i.default.uid,JSON.stringify(e))};n.clear=function(){return l.deleteData(c+"_"+i.default.uid)},n.push=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.gain,o=void 0===a?null:a,i=n.pay,r=void 0===i?null:i,d=p(),s=l.getDateString(l.getDate("-"+Config.logSaveDays+"d")),c=!0,u=!1,m=void 0;try{for(var g,h=l.getObjectKeyList(d,1)[Symbol.iterator]();!(c=(g=h.next()).done);c=!0){var v=g.value;if(!(v<=s))break;delete d[v]}}catch(e){u=!0,m=e}finally{try{!c&&h.return&&h.return()}finally{if(u)throw m}}var b=new Date,y=b.getTime(),_=l.getDateString(b),x={time:y,type:e,action:t};o&&(x.gain=o),r&&(x.pay=r),Array.isArray(d[_])||(d[_]=[]),d[_].push(x),f(d)},n.getMergeLog=function(e,t){for(var n in t)if(Array.isArray(e[n])){var a=!0,o=!1,i=void 0;try{for(var r,l=t[n][Symbol.iterator]();!(a=(r=l.next()).done);a=!0){(function(){var t=r.value;if("number"!=typeof t.time||"string"!=typeof t.type)return"continue";var a=e[n].findIndex(function(e){return t.time===e.time&&t.type===e.type});a>-1?e[n][a]=t:e[n].push(t)})()}}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}e[n].sort(function(e,t){return e.time>t.time?1:-1})}else e[n]=t[n];return e}},{"./Const":6,"./Info":9,"./Util":22}],12:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.show=void 0;var o=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=e("./Util"),r=a(i),l=e("./Dialog"),d=a(l),s=e("./Config"),c=e("./Log"),p=a(c),f=e("./Item"),u=a(f),m=e("./Script"),g=a(m),h=(n.show=function(){if(!($("#pdLogDialog").length>0)){(0,s.read)(),g.runFunc("LogDialog.show_before_");var e=d.create("pdLogDialog","KFOL助手日志",'\n<div class="pd_cfg_main">\n  <div class="pd_log_nav">\n    <a class="pd_disabled_link" data-name="start" href="#">&lt;&lt;</a>\n    <a class="pd_disabled_link" data-name="prev" href="#" style="padding: 0 7px;">&lt;</a>\n    <h2 class="pd_log_date pd_custom_tips">暂无日志</h2>\n    <a class="pd_disabled_link" data-name="next" href="#" style="padding: 0 7px;">&gt;</a>\n    <a class="pd_disabled_link" data-name="end" href="#">&gt;&gt;</a>\n  </div>\n  <fieldset>\n    <legend>日志内容</legend>\n    <div>\n      <strong>排序方式：</strong>\n      <label title="按时间顺序排序"><input type="radio" name="sortType" value="time" checked> 按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="sortType" value="type"> 按类别</label>\n    </div>\n    <div class="pd_stat pd_log_content">暂无日志</div>\n  </fieldset>\n  <fieldset>\n    <legend>统计结果</legend>\n    <div>\n      <strong>统计范围：</strong>\n      <label title="显示当天的统计结果"><input type="radio" name="statType" value="current" checked> 当天</label>\n      <label title="显示距该日N天内的统计结果"><input type="radio" name="statType" value="custom"></label>\n      <label title="显示距该日N天内的统计结果"><input name="statDays" type="text" style="width: 22px;" maxlength="3"> 天内</label>\n      <label title="显示全部统计结果"><input type="radio" name="statType" value="all"> 全部</label>\n    </div>\n    <div class="pd_stat" data-name="stat">暂无日志</div>\n  </fieldset>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExLogDialog" href="#">导入/导出日志</a></span>\n  <button data-action="close" type="button">关闭</button>\n  <button name="clear" type="button">清除日志</button>\n</div>',"width: 880px;"),t=e.find(".pd_log_nav"),n=p.read(),a=[],o=0;$.isEmptyObject(n)||(a=r.getObjectKeyList(n,1),o=a.length-1,t.find(".pd_log_date").attr("title","总共记录了"+a.length+"天的日志").text(a[o]),a.length>1&&(t.find('[data-name="start"]').attr("title",a[0]).removeClass("pd_disabled_link"),t.find('[data-name="prev"]').attr("title",a[o-1]).removeClass("pd_disabled_link"))),t.on("click","a[data-name]",function(i){i.preventDefault();var r=$(this);if(!r.hasClass("pd_disabled_link")){var l=r.data("name");if("start"===l)o=0;else if("prev"===l){if(!(o>0))return;o--}else if("next"===l){if(!(o<a.length-1))return;o++}else"end"===l&&(o=a.length-1);t.find(".pd_log_date").text(a[o]),h(n,a[o],e),b(n,a[o],e),o>0?(t.find('[data-name="start"]').attr("title",a[0]).removeClass("pd_disabled_link"),t.find('[data-name="prev"]').attr("title",a[o-1]).removeClass("pd_disabled_link")):t.find('[data-name="start"], [data-name="prev"]').removeAttr("title").addClass("pd_disabled_link"),o<a.length-1?(t.find('[data-name="next"]').attr("title",a[o+1]).removeClass("pd_disabled_link"),t.find('[data-name="end"]').attr("title",a[a.length-1]).removeClass("pd_disabled_link")):t.find('[data-name="next"], [data-name="end"]').removeAttr("title").addClass("pd_disabled_link")}}),e.find('[name="sortType"]').click(function(){var t=$(this).val();Config.logSortType!==t&&(Config.logSortType=t,(0,s.write)(),h(n,a[o],e))}).end().find('[name="statType"]').click(function(){var t=$(this).val();Config.logStatType!==t&&(Config.logStatType=t,(0,s.write)(),b(n,a[o],e))}).end().find('[name="statDays"]').keyup(function(){var t=parseInt($(this).val());t>0&&Config.logStatDays!==t&&(Config.logStatDays=t,(0,s.write)(),e.find('[name="statType"][value="custom"]:not(:checked)').click(),b(n,a[o],e))}).end().find('[name="sortType"][value="'+Config.logSortType+'"]').click().end().find('[name="statType"][value="'+Config.logStatType+'"]').click().end().find('[name="statDays"]').val(Config.logStatDays),e.find('[name="clear"]').click(function(e){e.preventDefault(),confirm("是否清除所有日志？")&&(p.clear(),alert("日志已清除"),location.reload())}).end().find('[data-name="openImOrExLogDialog"]').click(function(e){e.preventDefault(),_()}),h(n,a[o],e),b(n,a[o],e),$(window).height()<=750&&e.find(".pd_log_content").css("height","192px"),d.show("pdLogDialog"),g.runFunc("LogDialog.show_after_")}},function(e,t,n){Array.isArray(e[t])&&n.find(".pd_log_content").html(v(e,t,Config.logSortType)).parent().find("legend:first-child").text("日志内容 (共"+e[t].length+"项)")}),v=function(e,t,n){var a=e[t];if("type"===n){var o=["领取每日奖励","提升战力光环","争夺攻击","捐款","领取争夺奖励","批量攻击","试探攻击","抽取神秘盒子","抽取道具或卡片","打开盒子","使用道具","恢复道具","循环使用道具","将道具转换为能量","将卡片转换为VIP时间","购买道具","统计道具购买价格","出售道具","熔炼装备","神秘抽奖","统计神秘抽奖结果","神秘等级升级","神秘系数排名变化","批量转账","购买帖子","自动存款"];a.sort(function(e,t){return o.indexOf(e.type)>o.indexOf(t.type)?1:-1})}else a.sort(function(e,t){return e.time>t.time?1:-1});var i="",l="",d=!0,s=!1,c=void 0;try{for(var p,f=a[Symbol.iterator]();!(d=(p=f.next()).done);d=!0){var m=p.value,g=m.time,h=m.type,v=m.action,b=m.gain,y=m.pay;if(void 0!==g&&void 0!==h&&void 0!==v){var _=new Date(g);"type"===n?(l!==h&&(i+="<h3>【"+h+"】</h3>",l=h),i+="<p><b>"+r.getTimeString(_)+"：</b>"+v.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>')):i+="<p><b>"+r.getTimeString(_)+" ("+h+")：</b>"+v.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>');var x="";if("object"===$.type(b)&&!$.isEmptyObject(b)){x+="，";var k=!0,C=!1,w=void 0;try{for(var I,L=Object.keys(b)[Symbol.iterator]();!(k=(I=L.next()).done);k=!0){var S=I.value;if("item"===S){var T=!0,D=!1,A=void 0;try{for(var E,M=r.getSortedObjectKeyList(u.itemTypeList,b[S])[Symbol.iterator]();!(T=(E=M.next()).done);T=!0){var P=E.value;x+="<i>"+P+"<em>+"+b[S][P].toLocaleString()+"</em></i> "}}catch(e){D=!0,A=e}finally{try{!T&&M.return&&M.return()}finally{if(D)throw A}}}else if("arm"===S){var F=!0,B=!1,U=void 0;try{for(var N,O=r.getSortedObjectKeyList(u.armTypeList,b[S])[Symbol.iterator]();!(F=(N=O.next()).done);F=!0){var j=N.value;x+="<i>"+j+"<em>+"+b[S][j].toLocaleString()+"</em></i> "}}catch(e){B=!0,U=e}finally{try{!F&&O.return&&O.return()}finally{if(B)throw U}}}else if("box"===S){var q=!0,R=!1,K=void 0;try{for(var H,W=r.getSortedObjectKeyList(u.boxTypeList,b[S])[Symbol.iterator]();!(q=(H=W.next()).done);q=!0){var z=H.value;x+="<i>"+z+"<em>+"+b[S][z].toLocaleString()+"</em></i> "}}catch(e){R=!0,K=e}finally{try{!q&&W.return&&W.return()}finally{if(R)throw K}}}else x+="<i>"+S+"<em>+"+b[S].toLocaleString()+"</em></i> "}}catch(e){C=!0,w=e}finally{try{!k&&L.return&&L.return()}finally{if(C)throw w}}}if("object"===$.type(y)&&!$.isEmptyObject(y)){x||(x+="，");var V=!0,G=!1,Q=void 0;try{for(var J,X=Object.keys(y)[Symbol.iterator]();!(V=(J=X.next()).done);V=!0){var Y=J.value;if("item"===Y){var Z=!0,ee=!1,te=void 0;try{for(var ne,ae=Object.keys(y[Y])[Symbol.iterator]();!(Z=(ne=ae.next()).done);Z=!0){var oe=ne.value;x+="<i>"+oe+"<ins>"+y[Y][oe].toLocaleString()+"</ins></i> "}}catch(e){ee=!0,te=e}finally{try{!Z&&ae.return&&ae.return()}finally{if(ee)throw te}}}else x+="<i>"+Y+"<ins>"+y[Y].toLocaleString()+"</ins></i> "}}catch(e){G=!0,Q=e}finally{try{!V&&X.return&&X.return()}finally{if(G)throw Q}}}i+=x+"</p>"}}}catch(e){s=!0,c=e}finally{try{!d&&f.return&&f.return()}finally{if(s)throw c}}return i},b=function(e,t,n){Array.isArray(e[t])&&n.find('[data-name="stat"]').html(y(e,t,Config.logStatType))},y=function(e,t,n){var a={};if("custom"===n){var i=new Date(t);i.setDate(i.getDate()-Config.logStatDays+1),i=r.getDateString(i);var l=!0,d=!1,s=void 0;try{for(var c,p=r.getObjectKeyList(e,1)[Symbol.iterator]();!(l=(c=p.next()).done);l=!0){var f=c.value;f>=i&&f<=t&&(a[f]=e[f])}}catch(e){d=!0,s=e}finally{try{!l&&p.return&&p.return()}finally{if(d)throw s}}}else"all"===n?a=e:a[t]=e[t];var m={},g={},h={},v=0,b={total:0,min:0,max:0},y=0,_={},x=0,k={},C={KFB:0,"经验值":0,"道具":0,"装备":0,item:{},arm:{}},w=0,I=0,L=0,S=0,T={},D=0,A={},E=0,M={},P=["item","arm","box","夺取KFB","VIP小时","神秘","燃烧伤害","命中","闪避","暴击比例","暴击几率","防御","有效道具","无效道具","长剑经验","短弓经验","法杖经验"];for(var F in a){var B=!0,U=!1,N=void 0;try{for(var O,j=a[F][Symbol.iterator]();!(B=(O=j.next()).done);B=!0){var q=O.value,R=q.type,K=q.action,H=q.gain,W=q.pay,z=q.notStat;if(void 0!==R&&void 0===z){if("object"===$.type(H)){var V=!0,G=!1,Q=void 0;try{for(var J,X=Object.keys(H)[Symbol.iterator]();!(V=(J=X.next()).done);V=!0){var Y=J.value;P.includes(Y)||(void 0===m[Y]?m[Y]=H[Y]:m[Y]+=H[Y])}}catch(e){G=!0,Q=e}finally{try{!V&&X.return&&X.return()}finally{if(G)throw Q}}}if("object"===$.type(W)){var Z=!0,ee=!1,te=void 0;try{for(var ne,ae=Object.keys(W)[Symbol.iterator]();!(Z=(ne=ae.next()).done);Z=!0){var oe=ne.value;P.includes(oe)||(void 0===g[oe]?g[oe]=W[oe]:g[oe]+=W[oe])}}catch(e){ee=!0,te=e}finally{try{!Z&&ae.return&&ae.return()}finally{if(ee)throw te}}}if("争夺攻击"===R&&"object"===$.type(H)){var ie=/第`(\d+)`层/.exec(K);if(ie){v++;var re=parseInt(ie[1]);if(b.total+=re,b.max<re&&(b.max=re),(!b.min||b.min>re)&&(b.min=re),"object"===$.type(H.box)){var le=!0,de=!1,se=void 0;try{for(var ce,pe=r.entries(H.box)[Symbol.iterator]();!(le=(ce=pe.next()).done);le=!0){var fe=o(ce.value,2),ue=fe[0],me=fe[1];y+=me,ue in _||(_[ue]={total:0,min:-1,max:-1}),_[ue].total+=me,_[ue].max<me&&(_[ue].max=me),(_[ue].min<0||_[ue].min>me)&&(_[ue].min=me)}}catch(e){de=!0,se=e}finally{try{!le&&pe.return&&pe.return()}finally{if(de)throw se}}var ge=!0,he=!1,ve=void 0;try{for(var be,ye=u.boxTypeList[Symbol.iterator]();!(ge=(be=ye.next()).done);ge=!0){var ue=be.value;!(ue in H.box)&&ue in _&&(_[ue].min=0)}}catch(e){he=!0,ve=e}finally{try{!ge&&ye.return&&ye.return()}finally{if(he)throw ve}}}}}else if("打开盒子"===R&&"object"===$.type(H)&&"object"===$.type(W)){var _e=/【`(.+?)`】打开成功/.exec(K);if(!_e)continue;var xe=_e[1],ke=Math.abs(W["盒子"]);x+=ke,xe in k||(k[xe]=0),k[xe]+=Math.abs(W["盒子"]);var Ce=/平均随机值【`([\d\.]+)`】/.exec(K);Ce&&(I+=ke,w+=parseFloat(Ce[1])*ke);var we=!0,Ie=!1,$e=void 0;try{for(var Le,Se=r.entries(H)[Symbol.iterator]();!(we=(Le=Se.next()).done);we=!0){var Te=o(Le.value,2),De=Te[0],Ae=Te[1];if(De in C)if("object"===$.type(Ae)){var Ee=!0,Me=!1,Pe=void 0;try{for(var Fe,Be=r.entries(Ae)[Symbol.iterator]();!(Ee=(Fe=Be.next()).done);Ee=!0){var Ue=o(Fe.value,2),Ne=Ue[0],me=Ue[1];Ne in C[De]||(C[De][Ne]=0),C[De][Ne]+=me}}catch(e){Me=!0,Pe=e}finally{try{!Ee&&Be.return&&Be.return()}finally{if(Me)throw Pe}}}else C[De]+=Ae}}catch(e){Ie=!0,$e=e}finally{try{!we&&Se.return&&Se.return()}finally{if(Ie)throw $e}}}else if("购买道具"===R&&"object"===$.type(H)&&"object"===$.type(H.item)&&"object"===$.type(W)){L+=H["道具"],S+=Math.abs(W.KFB);var Oe=!0,je=!1,qe=void 0;try{for(var Re,Ke=r.entries(H.item)[Symbol.iterator]();!(Oe=(Re=Ke.next()).done);Oe=!0){var He=o(Re.value,2),We=He[0],me=He[1];We in T||(T[We]=0),T[We]+=me}}catch(e){je=!0,qe=e}finally{try{!Oe&&Ke.return&&Ke.return()}finally{if(je)throw qe}}}else if(("使用道具"===R||"循环使用道具"===R)&&"object"===$.type(H)){var ze=/【`Lv.(\d+)：(.+?)`】/.exec(K);if(ze){var Ve=parseInt(ze[1]);if(Ve<3)continue;var We=ze[2];H["有效道具"]>0&&(D+=H["有效道具"],void 0===A[We]&&(A[We]=0),A[We]+=H["有效道具"]),H["无效道具"]>0&&(E+=H["无效道具"],void 0===M[We]&&(M[We]=0),M[We]+=H["无效道具"])}}}}}catch(e){U=!0,N=e}finally{try{!B&&j.return&&j.return()}finally{if(U)throw N}}}var Ge="",Qe=["KFB","经验值","贡献","转账额度","盒子","道具","已使用道具","装备","武器经验","能量","卡片"];Ge+="<strong>收获：</strong>";var Je=!0,Xe=!1,Ye=void 0;try{for(var Ze,et=r.getSortedObjectKeyList(Qe,m)[Symbol.iterator]();!(Je=(Ze=et.next()).done);Je=!0){var tt=Ze.value;h[tt]=m[tt],Ge+="<i>"+tt+"<em>+"+m[tt].toLocaleString()+"</em></i> "}}catch(e){Xe=!0,Ye=e}finally{try{!Je&&et.return&&et.return()}finally{if(Xe)throw Ye}}Ge+="<br><strong>付出：</strong>";var nt=!0,at=!1,ot=void 0;try{for(var it,rt=r.getSortedObjectKeyList(Qe,g)[Symbol.iterator]();!(nt=(it=rt.next()).done);nt=!0){var lt=it.value;void 0===h[lt]?h[lt]=g[lt]:h[lt]+=g[lt],Ge+="<i>"+lt+"<ins>"+g[lt].toLocaleString()+"</ins></i> "}}catch(e){at=!0,ot=e}finally{try{!nt&&rt.return&&rt.return()}finally{if(at)throw ot}}Ge+="<br><strong>结余：</strong>";var dt=!0,st=!1,ct=void 0;try{for(var pt,ft=r.getSortedObjectKeyList(Qe,h)[Symbol.iterator]();!(dt=(pt=ft.next()).done);dt=!0){var ut=pt.value;Ge+="<i>"+ut+r.getStatFormatNumber(h[ut])+"</i> "}}catch(e){st=!0,ct=e}finally{try{!dt&&ft.return&&ft.return()}finally{if(st)throw ct}}if(Ge+='<div style="margin: 5px 0; border-bottom: 1px dashed #ccccff;"></div>',Ge+="\n<strong>争夺攻击统计：</strong><i>次数<em>+"+v+"</em></i> ",v>0){Ge+='<i>层数<span class="pd_stat_extra">(<em title="平均值">+'+(b.total/v).toFixed(2)+'</em>|<em title="最小值">+'+b.min+'</em>|<em title="最大值">+'+b.max+"</em>)</span></i> ",Ge+="<i>盒子<em>+"+y.toLocaleString()+"</em></i> ";var mt=!0,gt=!1,ht=void 0;try{for(var vt,bt=r.getSortedObjectKeyList(u.boxTypeList,_)[Symbol.iterator]();!(mt=(vt=bt.next()).done);mt=!0){var yt=vt.value;_[yt].total&&(Ge+="<i>"+yt+"<em>+"+_[yt].total.toLocaleString()+'</em><span class="pd_stat_extra">(<em title="平均值">+'+(_[yt].total/v).toFixed(2)+'</em>|<em title="最小值">+'+_[yt].min+'</em>|<em title="最大值">+'+_[yt].max+"</em>)</span></i> ")}}catch(e){gt=!0,ht=e}finally{try{!mt&&bt.return&&bt.return()}finally{if(gt)throw ht}}}var _t="",xt=!0,kt=!1,Ct=void 0;try{for(var wt,It=r.getSortedObjectKeyList(u.boxTypeList,k)[Symbol.iterator]();!(xt=(wt=It.next()).done);xt=!0){var $t=wt.value;_t&&(_t+="|"),_t+='<ins title="'+$t+'">-'+k[$t].toLocaleString()+"</ins>"}}catch(e){kt=!0,Ct=e}finally{try{!xt&&It.return&&It.return()}finally{if(kt)throw Ct}}if(Ge+="<br><strong>盒子收获统计：</strong><i>盒子<ins>-"+x+"</ins>"+(_t?'<span class="pd_stat_extra">('+_t+")</span>":"")+"</i> ",I>0&&(Ge+="<i>平均随机值<em>+"+r.getFixedNumLocStr(w/I,2)+"</em></i> "),x>0){var Lt=!0,St=!1,Tt=void 0;try{for(var Dt,At=r.entries(C)[Symbol.iterator]();!(Lt=(Dt=At.next()).done);Lt=!0){var Et=o(Dt.value,2),Mt=Et[0],Ae=Et[1];if(Ae&&("object"!==$.type(Ae)||!$.isEmptyObject(Ae)))if("object"===$.type(Ae)){var Pt="item"===Mt?u.itemTypeList:u.armTypeList,Ft=!0,Bt=!1,Ut=void 0;try{for(var Nt,Ot=r.getSortedObjectKeyList(Pt,Ae)[Symbol.iterator]();!(Ft=(Nt=Ot.next()).done);Ft=!0){var Ne=Nt.value;Ge+="<i>"+Ne+"<em>+"+Ae[Ne].toLocaleString()+"</em></i> "}}catch(e){Bt=!0,Ut=e}finally{try{!Ft&&Ot.return&&Ot.return()}finally{if(Bt)throw Ut}}}else Ge+="<i>"+Mt+'<span class="pd_stat_extra"><em>+'+Ae.toLocaleString()+'</em>(<em title="平均值">+'+r.getFixedNumLocStr(Ae/x,2).toLocaleString()+"</em>)</span></i> "}}catch(e){St=!0,Tt=e}finally{try{!Lt&&At.return&&At.return()}finally{if(St)throw Tt}}}Ge+="<br><strong>有效道具统计：</strong><i>有效道具<em>+"+D.toLocaleString()+"</em></i> ";var jt=!0,qt=!1,Rt=void 0;try{for(var Kt,Ht=r.getSortedObjectKeyList(u.itemTypeList,A)[Symbol.iterator]();!(jt=(Kt=Ht.next()).done);jt=!0){var Wt=Kt.value;Ge+="<i>"+Wt+"<em>+"+A[Wt].toLocaleString()+"</em></i> "}}catch(e){qt=!0,Rt=e}finally{try{!jt&&Ht.return&&Ht.return()}finally{if(qt)throw Rt}}Ge+="<br><strong>无效道具统计：</strong><i>无效道具<em>+"+E.toLocaleString()+"</em></i> ";var zt=!0,Vt=!1,Gt=void 0;try{for(var Qt,Jt=r.getSortedObjectKeyList(u.itemTypeList,M)[Symbol.iterator]();!(zt=(Qt=Jt.next()).done);zt=!0){var Xt=Qt.value;Ge+="<i>"+Xt+"<em>+"+M[Xt].toLocaleString()+"</em></i> "}}catch(e){Vt=!0,Gt=e}finally{try{!zt&&Jt.return&&Jt.return()}finally{if(Vt)throw Gt}}return Ge},_=function(){if(!($("#pdImOrExLogDialog").length>0)){var e=p.read(),t=d.create("pdImOrExLogDialog","导入或导出日志",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label style="color: #f00;"><input type="radio" name="logType" value="setting" checked> 导入/导出日志</label>\n    <label style="color: #00f;"><input type="radio" name="logType" value="text"> 导出日志文本</label>\n  </div>\n  <div data-name="logSetting">\n    <strong>导入日志：</strong>将日志内容粘贴到文本框中并点击合并或覆盖按钮即可<br>\n    <strong>导出日志：</strong>复制文本框里的内容并粘贴到别处即可<br>\n    <textarea name="setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n  </div>\n  <div data-name="logText" style="display: none;">\n    <strong>导出日志文本</strong>：复制文本框里的内容并粘贴到别处即可\n    <div>\n      <label title="按时间顺序排序"><input type="radio" name="sortType2" value="time" checked> 按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="sortType2" value="type"> 按类别</label>\n      <label title="在日志文本里显示每日以及全部数据的统计结果"><input type="checkbox" name="showStat" checked> 显示统计</label>\n    </div>\n    <textarea name="text" style="width: 600px; height: 400px;" readonly></textarea>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <button name="merge" type="button">合并日志</button>\n  <button name="overwrite" type="button" style="color: #f00;">覆盖日志</button>\n  <button data-action="close" type="button">关闭</button>\n</div>');t.find('[name="sortType2"], [name="showStat"]').click(function(){x(e,t),t.find('[name="text"]').select()}).end().find('[name="logType"]').click(function(){var e=$(this).val();t.find('[data-name="log'+("text"===e?"Setting":"Text")+'"]').hide(),t.find('[data-name="log'+("text"===e?"Text":"Setting")+'"]').show(),t.find('[data-name="log'+("text"===e?"Text":"Setting")+'"]').select()}).end().find('[name="merge"], [name="overwrite"]').click(function(n){n.preventDefault();var a=$(this).attr("name");if(confirm("是否将文本框中的日志"+("overwrite"===a?"覆盖":"合并")+"到本地日志？")){var o=$.trim(t.find('[name="setting"]').val());if(o){try{o=JSON.parse(o)}catch(e){return void alert("日志有错误")}if(!o||"object"!==$.type(o))return void alert("日志有错误");e="merge"===a?p.getMergeLog(e,o):o,p.write(e),alert("日志已导入"),location.reload()}}}),d.show("pdImOrExLogDialog"),t.find('[name="sortType2"][value="'+Config.logSortType+'"]').prop("checked",!0).triggerHandler("click"),t.find('[name="setting"]').val(JSON.stringify(e)).select().focus(),g.runFunc("LogDialog.showImportOrExportLogDialog_after_")}},x=function(e,t){var n=t.find('input[name="sortType2"]:checked').val(),a=t.find('[name="showStat"]').prop("checked"),o="",i="",r=!0,l=!1,d=void 0;try{for(var s,c=Object.keys(e)[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var p=s.value;Array.isArray(e[p])&&(i>p&&(i=p),o+="【"+p+"】(共"+e[p].length+"项)\n"+("type"===n?"":"\n")+v(e,p,n).replace(/<h3>/g,"\n").replace(/<\/h3>/g,"\n").replace(/<\/p>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"").replace(/`/g,""),a&&(o+="-".repeat(46)+"\n合计：\n"+y(e,p,"current").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")+"\n"),o+="=".repeat(46)+"\n")}}catch(e){l=!0,d=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw d}}o&&a&&(o+="\n总计：\n"+y(e,i,"all").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")),t.find('[name="text"]').val(o)}},{"./Config":4,"./Dialog":7,"./Item":10,"./Log":11,"./Script":20,"./Util":22}],13:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.getPromoteHaloCostByTypeId=n.promoteHalo=n.getPromoteHaloInfo=n.setHaloInfo=n.getHaloInfo=n.addUserLinkInHaloPage=n.addUserLinkInPkListPage=n.getChangePointsCountDown=n.autoSaveLootLog=n.checkLoot=n.getLevelInfoList=n.getLevelInfo=n.getLogList=n.getLog=n.getLootInfo=n.updateLootInfo=n.lootAttack=n.getRealProperty=n.getPointByProperty=n.getPropertyByPoint=n.getExtraPoint=n.getFieldNameByPointName=n.getPointNameByFieldName=n.getSkillAttack=n.getCurrentAssignedPoint=n.enhanceLootIndexPage=n.init=void 0;var r=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=e("./Info"),s=o(d),c=e("./Util"),p=a(c),f=e("./Msg"),u=a(f),m=e("./Dialog"),g=a(m),h=e("./Const"),v=o(h),b=e("./Config"),y=e("./Log"),_=a(y),x=e("./TmpLog"),k=a(x),C=e("./LootLog"),w=a(C),I=e("./Script"),L=a(I),S=e("./Public"),T=a(S),D=e("./Item"),A=a(D),E=void 0,M=void 0,P=void 0,F=void 0,B=void 0,U=void 0,N="",O=[],j=[],q={},R={},K={},H={},W=new Map,z=new Map,V=0,G=[],Q=n.init=function(){if(E=T.getSafeId()){M=$(".kf_fw_ig3:first"),P=$("#wdsx .kf_fw_ig1:first"),P.find("> tbody > tr:first-child > td").attr("id","pdArmArea"),F=P.find("#pdArmArea");var e=k.getValue(v.default.haloInfoTmpLogName);if(e&&"object"===$.type(e)){var t=$.now()-e.time;t>=0&&t<60*v.default.tmpHaloInfoExpires*1e3?(delete e.time,Ue(e),J()):Fe(!0)}else Fe(!0)}},J=n.enhanceLootIndexPage=function(){L.runFunc("Loot.enhanceLootIndexPage_before_");var e=M.html();q=ee(e),W=A.getItemsUsedNumInfo(e),z=A.getArmsLevelInfo(e),H=A.getArmInfo(F.html()),B=$("#pk_text_div"),U=$("#pk_text"),N=U.html(),O=we(N),j=$e(O),/你被击败了|本日无争夺记录|你已经复活/.test(N)?localStorage.removeItem(v.default.tempPointsLogListStorageName+"_"+s.default.uid):G=Ae(O),X(),Y(),se(),pe(),Config.alwaysOpenPointAreaEnabled&&$("#wdsx").show(),(N.includes("本日无争夺记录")||N.includes("你已经复活"))&&U.html(N.replace(/点击这里/g,"点击上方的攻击按钮").replace("战斗记录框内任意地方点击自动战斗下一层","请点击上方的攻击按钮开始争夺战斗")),ye(),ke(j),!Config.autoLootEnabled||/你被击败了/.test(N)||$.isNumeric(p.getCookie(v.default.changePointsInfoCookieName))||p.getCookie(v.default.lootAttackingCookieName)||$(document).ready(setTimeout(Me,500)),L.runFunc("Loot.enhanceLootIndexPage_after_")},X=function(){return M.find('input[value$="可分配属性"]').parent("td").css("position","relative").append('<span id="pdSurplusPoint" class="pd_property_diff" hidden>(<em></em>)</span>'),void $('<a data-name="copyParameterSetting" href="#" style="margin-left: -20px;" title="复制计算器的部分参数设置（包括神秘系数、光环和道具数量）">复</a>').insertAfter(M.find('input[value$="蕾米莉亚同人漫画"]')).click(function(e){e.preventDefault();var t=$(this),n=Math.floor((q["可分配属性点"]-50-(30===W.get("档案室钥匙")?30:0)-(10===W.get("消逝之药")?120:0))/5),a=n+" "+Math.floor(1e3*K["全属性"])+"\n",o=!0,i=!1,r=void 0;try{for(var l,d=W.values()[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){a+=l.value+" "}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}t.data("copy-text",a.trim()),p.copyText(t,"计算器的部分参数设置已复制")||alert("你的浏览器不支持复制")})},Y=function(){P.find('[type="text"]:not([readonly])').attr("type","number").attr("min",1).attr("max",9999).prop("required",!0).css("width","60px").addClass("pd_point").next("span").addClass("pd_extra_point").after('<span class="pd_sum_point" style="color: #f03; cursor: pointer;" title="点击：给该项加上或减去剩余属性点"></span>'),P.find("input[readonly]").attr("type","number").prop("disabled",!0).css("width","60px"),$('\n<tr>\n  <td width="40%">装备ID和备注 (无需更换装备时勿填)</td>\n  <td width="40%">\n    <input name="armId" type="text" value="" maxlength="15" title="装备ID" placeholder="装备ID" style="width: 70px;" readonly>\n    <input name="armMemo" type="text" value="" maxlength="15" title="装备备注" placeholder="装备备注" style="width: 100px;" readonly>\n    <a class="pd_btn_link" data-name="changeArm" href="#">更换装备</a>\n  </td>\n</tr>\n').insertAfter(F.parent()).find('[data-name="changeArm"]').click(function(e){e.preventDefault(),ve(0)});var e=P.find("> tbody > tr:last-child > td:last-child"),t=/当前修改配点可用\[(\d+)]次/.exec(e.text());t&&(V=parseInt(t[1]),e.wrapInner('<span id="pdChangeCount"></span>'));var n=/\(下次修改配点还需\[(\d+)]分钟\)/.exec(e.text());if(n){var a=p.getDate("+"+n[1]+"m");p.setCookie(v.default.changePointsInfoCookieName,a.getTime(),a)}else{parseInt(p.getCookie(v.default.changePointsInfoCookieName))!==V&&p.setCookie(v.default.changePointsInfoCookieName,V+"c",p.getDate("+"+v.default.changePointsInfoExpires+"m"))}R={"耐力":parseInt(P.find('[name="p"]').next("span").text()),"幸运":parseInt(P.find('[name="l"]').next("span").text())};var o=function(){var e=q["可分配属性点"]-te(P.find(".pd_point"));$("#pdSurplusPoint").prop("hidden",0===e).css("color",0!==e?e>0?"#f03":"#393":"#000").find("em").text((e>0?"+":"")+e)},i=function(e){var t=parseInt(e.val());(!t||t<0)&&(t=1);var n=ie(ae(e.attr("name")),t);e.next(".pd_extra_point").text("+"+n)},r=function(e){var t=parseInt(e.val());(!t||t<0)&&(t=1);var n=parseInt(e.next(".pd_extra_point").text());e.next(".pd_extra_point").next(".pd_sum_point").text("="+(t+n))};P.on("change",".pd_point",function(){var e=$(this);o(),i(e),r(e)}).on("click",".pd_sum_point",function(){var e=q["可分配属性点"]-te(P.find(".pd_point"));if(e){var t=$(this).prev("span").prev(".pd_point");if(t.length){var n=parseInt(t.val());(isNaN(n)||n<0)&&(n=0),n+=e,t.val(n<1?1:n).trigger("change")}}}).closest("form").submit(function(){return p.deleteCookie(v.default.changePointsInfoCookieName),Z(P)}).find(".pd_point").trigger("change")},Z=function(e){var t=q["可分配属性点"]-te(e.find(".pd_point"));return t<0?(alert("剩余属性点为负，请重新填写"),!1):!(t>0&&!confirm("可分配属性点尚未用完，是否继续？"))},ee=function(e){var t={"攻击力":0,"生命值":0,"最大生命值":0,"攻击速度":0,"暴击几率":0,"技能伤害":0,"技能释放概率":0,"防御":0,"可分配属性点":0},n=/"(\d+)攻击力"/.exec(e);return n&&(t["攻击力"]=parseInt(n[1])),n=/"(\d+)\/(\d+)生命值"/.exec(e),n&&(t["生命值"]=parseInt(n[1]),t["最大生命值"]=parseInt(n[2])),n=/"(\d+)攻击速度"/.exec(e),n&&(t["攻击速度"]=parseInt(n[1])),n=/"(\d+(?:\.\d+)?)%减伤"/.exec(e),n&&(t["防御"]=parseFloat(n[1])),n=/"(\d+)\s*可分配属性"/.exec(e),n&&(t["可分配属性点"]=parseInt(n[1])),t},te=n.getCurrentAssignedPoint=function(e){var t=0;return e.each(function(){var e=$(this),n=(e.attr("name"),parseInt(e.val()));n&&n>0&&(t+=n)}),t},ne=n.getSkillAttack=function(e,t,n){return 5*e+5*t+5*n},ae=n.getPointNameByFieldName=function(e){switch(e){case"s1":return"力量";case"s2":return"体质";case"d1":return"敏捷";case"d2":return"灵活";case"i1":return"智力";case"i2":return"意志";case"p":return"耐力";case"l":return"幸运";case"armId":return"装备ID";case"armMemo":return"装备备注";default:return""}},oe=n.getFieldNameByPointName=function(e){switch(e){case"力量":return"s1";case"体质":return"s2";case"敏捷":return"d1";case"灵活":return"d2";case"智力":return"i1";case"意志":return"i2";case"耐力":return"p";case"幸运":return"l";case"装备ID":return"armId";case"装备备注":return"armMemo";default:return""}},ie=n.getExtraPoint=function(e,t){var n=5*W.get("消逝之药"),a=K["全属性"];switch(e){case"力量":return Math.floor(t*a)+W.get("蕾米莉亚同人漫画")+n;case"体质":return Math.floor(t*a)+W.get("蕾米莉亚同人漫画")+n;case"敏捷":return Math.floor(t*a)+W.get("十六夜同人漫画")+n;case"灵活":return Math.floor(t*a)+W.get("十六夜同人漫画")+n;case"智力":return Math.floor(t*a)+n;case"意志":return Math.floor(t*a)+n;default:return 0}},re=n.getPropertyByPoint=function(e,t){var n=t+ie(e,t);switch(e){case"力量":return 5*n+K["攻击力"];case"体质":return 20*n+(50===W.get("蕾米莉亚同人漫画")?700:0)+K["生命值"];case"敏捷":return 2*n+(50===W.get("十六夜同人漫画")?100:0);case"灵活":return Math.round(n/(n+100)*100);case"智力":return Math.round(n/(n+90)*100);case"意志":return Math.round(n/(n+150)*100);default:return 0}},le=n.getPointByProperty=function(e,t){var n=5*W.get("消逝之药"),a=1+K["全属性"],o=0;switch(e){case"力量":o=Math.ceil((Math.ceil((t-K["攻击力"])/5)-W.get("蕾米莉亚同人漫画")-n)/a);break;case"体质":o=Math.ceil((Math.ceil((t-K["生命值"]-(50===W.get("蕾米莉亚同人漫画")?700:0))/20)-W.get("蕾米莉亚同人漫画")-n)/a);break;case"敏捷":o=Math.ceil((Math.ceil((t-(50===W.get("十六夜同人漫画")?100:0))/2)-W.get("十六夜同人漫画")-n)/a);break;case"灵活":o=Math.floor((Math.round(100*t/(100-t))-W.get("十六夜同人漫画")-n)/a);break;case"智力":o=Math.floor((Math.round(90*t/(100-t))-n)/a);break;case"意志":
o=Math.floor((Math.round(150*t/(100-t))-n)/a)}return(!isFinite(o)||o<1)&&(o=1),o},de=n.getRealProperty=function(e,t,n,a){var o={"普通":1,"强壮":1,"快速":1.5,"睿智":1,"坚强":1,BOSS:1.2},i="灵活"===e?100:90,r=Math.round(2*n*o[a]),l=Math.max(t-Math.round((r+t)/3),0);return Math.round(l/(l+i)*100)},se=function(){$('\n<tr>\n  <td colspan="2">\n    <select id="pdLevelPointListSelect" style="margin: 5px 0;">\n      <option>点数分配方案</option>\n      <option value="0">默认</option>\n    </select>\n    <a class="pd_btn_link" data-name="save" href="#" title="将当前点数设置保存为新的方案">保存</a>\n    <a class="pd_btn_link" data-name="edit" href="#" title="编辑各层点数分配方案">编辑</a>\n    <a class="pd_btn_link" data-name="fill" href="#" title="输入一串数字按顺序填充到各个点数字段中">填充</a>\n  </td>\n</tr>').prependTo(P.find("> tbody")).find("#pdLevelPointListSelect").change(function(){var e=parseInt($(this).val());if(e>0){var t=Config.levelPointList[parseInt(e)];if("object"!==(void 0===t?"undefined":l(t)))return;P.find('.pd_point, input[name="armId"], input[name="armMemo"]').each(function(){var e=$(this),n=ae(e.attr("name"));e.val(t[n])}).trigger("change")}else 0===e&&P.find('.pd_point, input[name="armId"], input[name="armMemo"]').each(function(){$(this).val(this.defaultValue)}).trigger("change")}).end().find('[data-name="save"]').click(function(e){if(e.preventDefault(),Z(P)){var t=$("#pdLevelPointListSelect"),n=parseInt(t.val());if((n=parseInt(prompt("请输入层数：",n?n:"")))&&!(n<0)&&((0,b.read)(),!(n in Config.levelPointList)||confirm("该层数已存在，是否覆盖？"))){var a={},o=!0,i=!1,r=void 0;try{for(var l,d=Array.from(P.find('.pd_point, input[name="armId"], input[name="armMemo"]'))[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=l.value,c=$(s),p=c.attr("name"),f=$.trim(c.val());if(c.is(".pd_point")){if(!(f=parseInt(f))||f<0)return}else{if(!f)continue;if("armId"===p&&(!(f=parseInt(f))||f<0))return}a[ae(p)]=f,!a["装备ID"]&&a["装备备注"]&&delete a["装备备注"]}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}Config.levelPointList[n]=a,(0,b.write)(),ce(Config.levelPointList),t.val(n)}}}).end().find('[data-name="edit"]').click(function(e){e.preventDefault(),he()}).end().find('[data-name="fill"]').click(function(e){e.preventDefault();var t=$.trim(prompt("请输入以任意字符分隔的一串数字，按顺序填充到各个点数字段中："));if(t){var n=t.match(/\d+/g);n&&P.find(".pd_point").each(function(e){if(!(e<n.length))return!1;$(this).val(parseInt(n[e])).trigger("change")})}}),ce(Config.levelPointList)},ce=function(e){var t="",n=!0,a=!1,o=void 0;try{for(var i,l=p.entries(e)[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var d=r(i.value,2),s=d[0],c=d[1];$.isNumeric(s)&&(t+='<option value="'+s+'">第'+s+"层 "+(c["装备ID"]?"(装)":"")+"</option>")}}catch(e){a=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}$("#pdLevelPointListSelect").find("option:gt(1)").remove().end().append(t)},pe=function(){B.off("click"),$('\n<div id="pdAttackBtns" class="pd_result" style="margin-top: 5px;">\n  <label>\n    <input class="pd_input" name="autoChangeLevelPointsEnabled" type="checkbox" '+(Config.autoChangeLevelPointsEnabled?"checked":"")+'>\n    自动修改点数分配方案\n    <span class="pd_cfg_tips" title="在攻击时可自动修改为相应层数的点数分配方案（仅限自动攻击相关按钮有效）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="customPointsScriptEnabled" type="checkbox" '+(Config.customPointsScriptEnabled?"checked":"")+" \n"+("function"!=typeof v.default.getCustomPoints?"disabled":"")+'> 使用自定义脚本\n    <span class="pd_cfg_tips" title="使用自定义点数分配脚本（仅限自动攻击相关按钮有效，需正确安装自定义脚本后此项才可勾选）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="unusedPointNumAlertEnabled" type="checkbox" '+(Config.unusedPointNumAlertEnabled?"checked":"")+'>\n    有剩余属性点时提醒\n    <span class="pd_cfg_tips" title="在攻击时如有剩余属性点则进行提醒（仅限自动攻击相关按钮有效）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="slowAttackEnabled" type="checkbox" '+(Config.slowAttackEnabled?"checked":"")+'> 慢速\n    <span class="pd_cfg_tips" title="延长每次攻击的时间间隔（在4~7秒之间）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="alwaysOpenPointAreaEnabled" type="checkbox" '+(Config.alwaysOpenPointAreaEnabled?"checked":"")+'> 总是打开属性界面\n    <span class="pd_cfg_tips" title="总是打开个人属性/装备界面">[?]</span>\n  </label><br>\n  <button name="autoAttack" type="button" title="自动攻击到指定层数">自动攻击</button>\n  <button name="onceAttack" type="button" title="自动攻击一层">一层</button>\n  <span style="color: #888;">|</span>\n  <button name="manualAttack" type="button" title="手动攻击一层，会自动提交当前页面上的点数设置">手动攻击</button>\n</div>\n').insertAfter("#wdsx").on("click",'button[name$="Attack"]',function(){if(/你被击败了/.test(N))return void alert("你已经被击败了");if(!($(".pd_mask").length>0)){var e=$(this),t=e.attr("name"),n="manualAttack"===t?"manual":"auto",a=0;if("auto"===n){var o="+1";if("autoAttack"===t){var i=e.data("prevTargetLevel");o=$.trim(prompt("攻击到第几层？（0表示攻击到被击败为止，+n表示攻击到当前层数+n层）",i?i:Config.attackTargetLevel))}if(!/\+?\d+/.test(o))return;if(o.startsWith("+")){a=De(O)+parseInt(o)}else a=parseInt(o);if(isNaN(a)||a<0)return;"autoAttack"===t&&e.data("prevTargetLevel",o)}u.destroy(),$("#pdLootLogHeader").find('[data-name="end"]').click();var r=(Config.autoChangeLevelPointsEnabled||Config.customPointsScriptEnabled&&"function"==typeof v.default.getCustomPoints)&&"auto"===n;(r||Z(P))&&fe({type:n,targetLevel:a,autoChangePointsEnabled:r,safeId:E})}}).on("click",".pd_cfg_tips",function(){return!1}).on("click",'input[type="checkbox"]',function(){var e=$(this),t=e.attr("name"),n=e.prop("checked");t in Config&&Config[t]!==n&&((0,b.read)(),Config[t]=e.prop("checked"),(0,b.write)())}).find('[name="customPointsScriptEnabled"]').click(function(){var e=$(this);e.prop("disabled")||$('[name="autoChangeLevelPointsEnabled"]').prop("disabled",e.prop("checked"))}).triggerHandler("click")},fe=n.lootAttack=function(e){var t=e.type,n=e.targetLevel,a=e.autoChangePointsEnabled,o=e.safeId,l=De(O);if(!(n>0&&n<=l)){var d=u.wait('<strong>正在攻击中，请稍等&hellip;</strong><i>当前层数：<em class="pd_countdown">'+l+'</em></i><a class="pd_stop_action pd_highlight" href="#">停止操作</a><a href="/" target="_blank">浏览其它页面</a>'),c=0,f=!1,m=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];q=ee(M.html());var t="",n="",a="",o=parseInt(P.find('input[name="armId"]').val()),i=$.trim(P.find('input[name="armMemo"]').val());o>0&&(t="装备ID："+o+(i?"，装备备注："+i:"")),P.find(".pd_point").each(function(){var e=$(this),t=ae(e.attr("name")),a=parseInt(e.val()),o=ie(t,a);n+=t+"："+a+"+"+o+"="+(a+o)+"，"}),n=n.replace(/，$/,"");var l=!0,d=!1,c=void 0;try{for(var f,u=p.entries(q)[Symbol.iterator]();!(l=(f=u.next()).done);l=!0){var m=r(f.value,2),g=m[0],h=m[1];if("可分配属性点"!==g&&"生命值"!==g){var b="";(g.endsWith("率")||"防御"===g)&&(b="%"),a+=g+"："+h+b+"，"}}}catch(e){d=!0,c=e}finally{try{!l&&u.return&&u.return()}finally{if(d)throw c}}a=a.replace(/，$/,""),G[De(O)+1]=(t?"装备信息（"+t+"）\n":"")+"点数方案（"+n+"）",localStorage.setItem(v.default.tempPointsLogListStorageName+"_"+s.default.uid,JSON.stringify({time:$.now(),pointsLogList:G})),e&&(t&&console.log("【更换武器】装备信息（"+t+"）"),console.log("【分配点数】点数方案（"+n+"）"))},g=function(e){if(e>0&&Config.customPointsScriptEnabled&&"function"==typeof v.default.getCustomPoints){var t=null;try{t=v.default.getCustomPoints($.extend(me(),{getExtraPoint:ie,getPointByProperty:le,getPropertyByPoint:re}))}catch(e){console.log(e)}if("object"===$.type(t)){var n=!0,a=!1,l=void 0;try{for(var d,c=p.entries(t)[Symbol.iterator]();!(n=(d=c.next()).done);n=!0){var f=r(d.value,2),g=f[0],h=f[1];P.find('input[name="'+oe(g)+'"]').val(h).trigger("change")}}catch(e){a=!0,l=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw l}}e=-1}else{if("number"!=typeof t)return t===!1?(m(),$.Deferred().resolve("ignore")):$.Deferred().resolve("error");e=parseInt(t),e=e>1?e:1}}var b=De(O)+1,y=e>0?Math.max.apply(Math,i(Object.keys(Config.levelPointList).filter(function(t){return t<=e}))):-1,_=$("#pdLevelPointListSelect");y>0?_.val(y).trigger("change"):_.get(0).selectedIndex=0;var x=!1,k=!1;if(P.find('.pd_point, input[name="armId"]').each(function(){var e=$(this),t=e.attr("name"),n=$.trim(e.val());n&&this.defaultValue!==n&&("armId"===t?x=!0:k=!0)}),x||k){var C;if(Config.unusedPointNumAlertEnabled&&!s.default.w.unusedPointNumAlert&&parseInt($("#pdSurplusPoint > em").text())>0){if(!confirm("可分配属性点尚未用完，是否继续攻击？"))return $.Deferred().resolve("error");s.default.w.unusedPointNumAlert=!0}var w=parseInt(P.find('input[name="armId"]').val()),I=[["ignore"],["ignore"]];return x&&(I[0]=$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",timeout:v.default.defAjaxTimeout,data:"do=4&id="+w+"&safeid="+o})),k&&(I[1]=$.ajax({type:"POST",url:"kf_fw_ig_enter.php",timeout:v.default.defAjaxTimeout,data:P.closest("form").serialize()})),(C=$).when.apply(C,I).then(function(e,t){var n=r(e,1),a=n[0],o=r(t,1),i=o[0];if("ignore"!==a){var l=p.removeHtmlTag(a);if(!/装备完毕/.test(a))return u.show("<strong>更换武器："+l+"</strong>",-1),L.runFunc("Loot.lootAttack_changePoints_error_",l),"error";P.find('input[name="armId"], input[name="armMemo"]').each(function(){this.defaultValue=$(this).val()})}if("ignore"!==i){var d=p.getResponseMsg(i),s=d.msg;if(!/已经重新配置加点！/.test(s)){var c=/你还需要等待(\d+)分钟/.exec(s);if(c){var f=p.getDate("+"+parseInt(c[1])+"m");p.setCookie(v.default.changePointsInfoCookieName,f.getTime(),f)}return u.show("<strong>第<em>"+b+"</em>层方案："+s+"</strong>",-1),L.runFunc("Loot.lootAttack_changePoints_error_",s),"error"}p.deleteCookie(v.default.changePointsInfoCookieName),P.find(".pd_point").each(function(){this.defaultValue=$(this).val()})}return m(!0),L.runFunc("Loot.lootAttack_changePoints_success_",[a,i]),"success"},function(){return"timeout"})}return 1===b&&m(),$.Deferred().resolve("ignore")},h=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.default.lootAttackInterval;g(t>=0?t+1:-1).done(function(e){"ignore"===e?setTimeout(b,"function"==typeof n?n():n):"success"===e&&setTimeout(function(){ue(function(){setTimeout(b,"function"==typeof n?n():n)})},v.default.defAjaxInterval)}).fail(function(a){"timeout"===a&&setTimeout(function(){return e(t,n)},v.default.minActionInterval)}).always(function(e){["success","ignore","timeout"].includes(e)||u.remove(d)})},b=function(){$.ajax({type:"POST",url:"kf_fw_ig_intel.php",data:{safeid:o},timeout:v.default.defAjaxTimeout}).done(function(e){if(c++,Config.autoLootEnabled&&p.setCookie(v.default.lootAttackingCookieName,1,p.getDate("+"+v.default.lootAttackingExpires+"m")),!/你\(\d+\)遭遇了/.test(e)||c%v.default.lootAttackPerCheckLevel==0)return void setTimeout(function(){return ue(y)},v.default.defAjaxInterval);N=e+N,y(!1),L.runFunc("Loot.lootAttack_attack_after_",e)}).fail(function(){console.log("【争夺攻击】超时重试..."),setTimeout(function(){return ue(y)},"function"==typeof v.default.lootAttackInterval?v.default.lootAttackInterval():v.default.lootAttackInterval)})},y=function e(){var o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];O=we(N),j=$e(O),Ce(O,j,G),ke(j);var i=De(O);console.log("【争夺攻击】当前层数："+i);var r=$(".pd_countdown:last");r.text(i),P.find(".pd_point").each(function(){});var l=j[i];M.find("#pdCurrentLife").text(l?l.life:0);var s=/你被击败了/.test(N);f=s||f||"auto"!==t||n&&i>=n||r.closest(".pd_msg").data("stop"),f?(Config.autoLootEnabled&&(p.deleteCookie(v.default.lootCheckingCookieName),p.deleteCookie(v.default.lootAttackingCookieName),p.setCookie(v.default.lootCompleteCookieName,1,Ee())),s?(o?(u.remove(d),ge(O,j,G)):setTimeout(function(){return ue(e)},v.default.defAjaxInterval),L.runFunc("Loot.lootAttack_complete_")):(o||setTimeout(function(){return ue},v.default.defAjaxInterval),u.remove(d),u.show("<strong>你成功击败了第<em>"+i+"</em>层的NPC</strong>",-1),L.runFunc("Loot.lootAttack_after_"))):a?setTimeout(function(){return h(i)},v.default.minActionInterval):setTimeout(b,"function"==typeof v.default.lootAttackInterval?v.default.lootAttackInterval():v.default.lootAttackInterval)};h(a?l:-1,0)}},ue=n.updateLootInfo=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;console.log("更新争夺信息Start"),$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:v.default.defAjaxTimeout}).done(function(e){var n=$("#wdsx",e).parent();if(!(N=n.find("#pk_text").html()))return void u.remove($(".pd_countdown").closest(".pd_msg"));n.find('.kf_fw_ig3:first input[type="text"]').each(function(e){var t=$.trim($(this).val());t&&M.find('input[type="text"]:eq('+e+")").val(t)});var a=/\(下次修改配点还需\[(\d+)]分钟\)/.exec(e);if(a){V=0;var o=p.getDate("+"+a[1]+"m");p.setCookie(v.default.changePointsInfoCookieName,o.getTime(),o)}var i=/当前修改配点可用\[(\d+)]次/.exec(e);i&&(V=parseInt(i[1]),p.setCookie(v.default.changePointsInfoCookieName,V+"c",p.getDate("+"+v.default.changePointsInfoExpires+"m"))),P.find("#pdChangeCount").text("(当前修改配点可用["+V+"]次)");var r=n.find(".kf_fw_ig1:first > tbody > tr:first-child > td").html();r.includes("（装备中）")&&P.find("#pdArmArea").html(r);var l=M.html();q=ee(l),W=A.getItemsUsedNumInfo(l),z=A.getArmsLevelInfo(l),H=A.getArmInfo(F.html()),"function"==typeof t&&t(),L.runFunc("Loot.updateLootInfo_after_",e)}).fail(function(){setTimeout(function(){return e(t)},v.default.defAjaxInterval)})},me=n.getLootInfo=function(){var e=De(O),t=j[e],n=0,a=0;t&&(n=t.life,a=t.initLife);var o=Te(j);return{currentLevel:e,currentLife:n,currentInitLife:a,levelPointList:Config.levelPointList,availablePoint:q["可分配属性点"],haloInfo:K,extraPointsList:R,propertyList:q,itemUsedNumList:W,armsLevelList:z,currentArmInfo:H,changePointsAvailableCount:V,log:N,logList:O,enemyList:o}},ge=function(e,t,n){p.setCookie(v.default.lootCompleteCookieName,2,Ee()),localStorage.removeItem(v.default.tempPointsLogListStorageName+"_"+s.default.uid);var a={},o=!0,i=!1,l=void 0;try{for(var d,c=p.entries(Se(t))[Symbol.iterator]();!(o=(d=c.next()).done);o=!0){var f=r(d.value,2),m=f[0],g=f[1];a[m]=g}}catch(e){i=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw l}}var h="",b=!0,y=!1,x=void 0;try{for(var k,C=p.entries(a)[Symbol.iterator]();!(b=(k=C.next()).done);b=!0){var I=r(k.value,2),m=I[0],g=I[1];h+=m+"`+"+g+"` "}}catch(e){y=!0,x=e}finally{try{!b&&C.return&&C.return()}finally{if(y)throw x}}var S={},D=!0,E=!1,M=void 0;try{for(var P,F=p.entries(Se(t.filter(function(t,n){return n>=e.length-v.default.enemyStatLatestLevelNum})))[Symbol.iterator]();!(D=(P=F.next()).done);D=!0){var B=r(P.value,2),m=B[0],g=B[1];S[m]=g}}catch(e){E=!0,M=e}finally{try{!D&&F.return&&F.return()}finally{if(E)throw M}}var U="",N=!0,O=!1,j=void 0;try{for(var q,R=p.entries(S)[Symbol.iterator]();!(N=(q=R.next()).done);N=!0){var K=r(q.value,2),m=K[0],g=K[1];U+=m+"`+"+g+"` "}}catch(e){O=!0,j=e}finally{try{!N&&R.return&&R.return()}finally{if(O)throw j}}var H=De(e),W=Le(t),z=W.boxNum,V=W.boxes;$.isEmptyObject(V)||(_.push("争夺攻击","你成功击败了第`"+(H-1)+"`层的NPC ("+h.trim()+")",{gain:{"盒子":z,box:V}}),w.record(e,n));var G="",Q=!0,J=!1,X=void 0;try{for(var Y,Z=p.getSortedObjectKeyList(A.boxTypeList,V)[Symbol.iterator]();!(Q=(Y=Z.next()).done);Q=!0){var ee=Y.value;G+="<i>"+ee+"<em>+"+V[ee].toLocaleString()+"</em></i>"}}catch(e){J=!0,X=e}finally{try{!Q&&Z.return&&Z.return()}finally{if(J)throw X}}u.show("<strong>你被第<em>"+H+"</em>层的NPC击败了</strong>"+(G.length>75?"<br>":"")+G,-1),Config.autoGetDailyBonusEnabled&&Config.getBonusAfterLootCompleteEnabled&&(p.deleteCookie(v.default.getDailyBonusCookieName),T.getDailyBonus()),L.runFunc("Loot.recordLootLog_after_")},he=function e(t){var n="pdLevelPointListConfigDialog";if(!($("#"+n).length>0)){(0,b.read)();var a=g.create(n,"各层点数分配方案",'\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0; line-height: 1.6em;">\n    请填写各层对应的点数分配方案，相邻层数如数值完全相同的话，则只保留最前面的一层<br>\n    （例：11-19层点数相同的话，则只保留第11层）<br>\n    装备ID和装备备注为可选项，只在需要更换装备时填写<br>\n    自定义点数分配方案脚本的参考范例请参见<a href="read.php?tid=500968&spid=13270735" target="_blank">此贴53楼</a>\n  </div>\n  <div style="overflow-y: auto; max-height: 400px;">\n    <table id="pdLevelPointList" style="text-align: center; white-space: nowrap;">\n      <tbody>\n        <tr>\n          <th></th><th>层数</th><th>力量</th><th>体质</th><th>敏捷</th><th>灵活</th><th>智力</th><th>意志</th><th>装备ID</th><th>装备备注</th><th></th>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n  <hr>\n  <div style="float: left; line-height: 27px;">\n    <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n    <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n    <a class="pd_btn_link pd_highlight" data-name="add" href="#">增加</a>\n    <a class="pd_btn_link" data-name="deleteSelect" href="#">删除</a>\n  </div>\n  <div data-id="modifyArea" style="float: right;">\n    <input name="s1" type="text" maxlength="5" title="力量" placeholder="力量" style="width: 35px;">\n    <input name="s2" type="text" maxlength="5" title="体质" placeholder="体质" style="width: 35px;">\n    <input name="d1" type="text" maxlength="5" title="敏捷" placeholder="敏捷" style="width: 35px;">\n    <input name="d2" type="text" maxlength="5" title="灵活" placeholder="灵活" style="width: 35px;">\n    <input name="i1" type="text" maxlength="5" title="智力" placeholder="智力" style="width: 35px;">\n    <input name="i2" type="text" maxlength="5" title="意志" placeholder="意志" style="width: 35px;">\n    <a class="pd_btn_link" data-name="clear" href="#" title="清空各修改字段">清空</a>\n    <button type="button" name="modify">修改</button>\n    <span class="pd_cfg_tips" title="可将所选择的层数的相应属性修改为指定的数值；数字前可设+/-号，表示增加/减少相应数量；例：100、+5或-2">[?]</span>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExLevelPointListConfigDialog" href="#">导入/导出分配方案</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',"min-width: 840px;"),o=a.find("#pdLevelPointList > tbody"),i=function(e,t){$('\n<tr>\n  <td style="width: 25px; text-align: left;"><input type="checkbox"></td>\n  <td style="text-align: left;">\n    <label style="margin-right: 8px;">\n      第 <input name="level" type="text" value="'+(e?e:"")+'" style="width: 30px;"> 层\n    </label>\n  </td>\n  <td><input class="pd_point" name="s1" type="number" value="'+t["力量"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="s2" type="number" value="'+t["体质"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="d1" type="number" value="'+t["敏捷"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="d2" type="number" value="'+t["灵活"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="i1" type="number" value="'+t["智力"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="i2" type="number" value="'+t["意志"]+'" min="1" style="width: 50px;" required></td>\n  <td><input name="armId" type="text" value="'+(t["装备ID"]?t["装备ID"]:"")+'" maxlength="15" style="width: 65px;"></td>\n  <td><input name="armMemo" type="text" value="'+(t["装备备注"]?t["装备备注"]:"")+'" maxlength="15" style="width: 80px;"></td>\n  <td style="text-align: left;">\n    <a class="pd_btn_link" data-name="fill" href="#">填充</a>\n    <a class="pd_btn_link" data-name="addArm" href="#">装备</a>\n    <a class="pd_btn_link pd_highlight" data-name="delete" href="#">删除</a>\n  </td>\n</tr>\n<tr>\n  <td></td>\n  <td class="pd_custom_tips" title="剩余属性点">剩余：<span data-id="surplusPoint">0</span></td>\n  <td title="攻击力" hidden> <!-- 临时禁用 -->\n    攻：<span data-id="pro_s1" style="cursor: pointer;">0</span> <a data-id="opt_s1" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="最大生命值" hidden>\n    命：<span data-id="pro_s2" style="cursor: pointer;">0</span> <a data-id="opt_s2" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="攻击速度" hidden>\n    速：<span data-id="pro_d1" style="cursor: pointer;">0</span> <a data-id="opt_d1" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="暴击几率" hidden>\n    暴：<span data-id="pro_d2" style="cursor: pointer;">0</span>% <a data-id="opt_d2" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="技能释放概率" hidden>\n    技：<span data-id="pro_i1" style="cursor: pointer;">0</span>% <a data-id="opt_i1" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="防御减伤" hidden>\n    防：<span data-id="pro_i2" style="cursor: pointer;">0</span>% <a data-id="opt_i2" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td class="pd_custom_tips" title="[飞身劈斩]伤害：攻击+体质值*5+智力值*5" hidden>技伤：<span data-id="skillAttack">0</span></td>\n  <td hidden></td>\n  <td hidden></td>\n</tr>\n').appendTo(o).find(".pd_point").trigger("change")};a.submit(function(e){e.preventDefault(),(0,b.read)();var t={},a={},i=!1,r=!1;if(o.find("tr:gt(0)").each(function(){var e=$(this);if(e.find(".pd_point").length){var n=q["可分配属性点"]-te(e.find(".pd_point"));if(n>0)r=!0;else if(n<0)return i=!0,!1;var o=parseInt(e.find('[name="level"]').val());if(o&&!(o<0)){var l={},d=!0,s=!1,c=void 0;try{for(var f,u=Array.from(e.find('.pd_point, [name="armId"], [name="armMemo"]'))[Symbol.iterator]();!(d=(f=u.next()).done);d=!0){var m=f.value,g=$(m),h=g.attr("name"),v=null;if(v=$.trim(g.val()),g.is(".pd_point")){if(!(v=parseInt(v))||v<0)return}else{if(!v)continue;if("armId"===h&&(!(v=parseInt(v))||v<0))return}l[ae(h)]=v}}catch(e){s=!0,c=e}finally{try{!d&&u.return&&u.return()}finally{if(s)throw c}}!l["装备ID"]&&l["装备备注"]&&delete l["装备备注"],p.deepEqual(a,l)||(t[o]=l,a=l)}}}),!r||confirm("部分层数的可分配属性点尚未用完，是否提交？")){if(i)return void alert("部分层数的剩余属性点为负，请重新填写");Config.levelPointList=t,(0,b.write)(),g.close(n),ce(Config.levelPointList)}}).find('[data-name="add"]').click(function(e){e.preventDefault(),i(0,{"力量":1,"体质":1,"敏捷":1,"灵活":1,"智力":1,"意志":1}),o.find('[name="level"]:last').focus(),g.resize(n)}).end().find('[data-name="deleteSelect"]').click(function(e){e.preventDefault();var t=o.find('[type="checkbox"]:checked');if(t.length&&confirm("是否删除所选层数？")){t.closest("tr").next("tr").addBack().remove(),g.resize(n)}}).end().find('[data-name="openImOrExLevelPointListConfigDialog"]').click(function(t){t.preventDefault(),T.showCommonImportOrExportConfigDialog("各层点数分配方案","levelPointList",null,function(){$("#pdLevelPointListConfigDialog").remove(),e(function(e){return e.submit()})})}).end().find('[data-name="selectAll"]').click(function(){return p.selectAll(o.find('[type="checkbox"]'))}).end().find('[data-name="selectInverse"]').click(function(){return p.selectInverse(o.find('[type="checkbox"]'))}),o.on("click",'[data-name="fill"]',function(e){e.preventDefault();var t=$(this).closest("tr"),n=$.trim(prompt("请输入以任意字符分隔的一串数字，按顺序填充到各个点数字段中："));if(n){var a=n.match(/\d+/g);a&&t.find(".pd_point").each(function(e){if(!(e<a.length))return!1;$(this).val(parseInt(a[e])).trigger("change")})}}).on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).closest("tr").next("tr").addBack().remove(),g.resize(n)}).on("click",'[data-name="addArm"]',function(e){e.preventDefault(),o.find("#pdAddArmId, #pdAddArmMemo").removeAttr("id"),$(this).closest("tr").find('[name="armId"]').attr("id","pdAddArmId").end().find('[name="armMemo"]').attr("id","pdAddArmMemo"),ve(1)}).on("change",".pd_point",function(){var e=$(this),t=e.attr("name"),n=parseInt(e.val());if(n&&!(n<0)){var a=e.closest("tr"),o=a.next("tr");o.find('[data-id="pro_'+t+'"]').text(re(ae(t),n));var i=parseInt(a.find('[name="s1"]').val()),r=parseInt(a.find('[name="s2"]').val()),l=parseInt(a.find('[name="i1"]').val());o.find('[data-id="skillAttack"]').text(ne(i+ie("力量",i),r+ie("体质",r),l+ie("智力",l)));var d=q["可分配属性点"]-te(a.find(".pd_point"));o.find('[data-id="surplusPoint"]').text(d).css("color",0!==d?"#f00":"#000")}}).on("click",'[data-id^="pro_"]',function(){var e=$(this),t=e.data("id").replace("pro_",""),n=parseInt(prompt("请输入数值：",e.text()));!n||n<0||e.closest("tr").prev("tr").find('[name="'+t+'"]').val(le(ae(t),n)).trigger("change")}).on("click",'[data-id^="opt_"]',function(e){e.preventDefault();var t=$(this),n=t.data("id").replace("opt_",""),a=t.closest("tr").prev("tr"),o=q["可分配属性点"]-te(a.find(".pd_point"));if(o){var i=a.find('[name="'+n+'"]');if(i.length){var r=parseInt(i.val());(isNaN(r)||r<0)&&(r=0),r+=o;var l=parseInt(i.attr("min"));i.val(r<l?l:r).trigger("change")}}}),a.find('[name="modify"]').click(function(){var e=o.find('[type="checkbox"]:checked');if(e.length){var t={};a.find('[data-id="modifyArea"] [type="text"]').each(function(){var e=$(this),n=e.attr("name"),a=$.trim(e.val());if(a){var o=/^(-|\+)?(\d+)$/.exec(a);o||(alert("格式不正确"),e.select().focus()),t[n]={},void 0!==o[1]?t[n].action="+"===o[1]?"add":"minus":t[n].action="equal",t[n].value=parseInt(o[2])}}),e.each(function(){$(this).closest("tr").find(".pd_point").each(function(){var e=$(this),n=e.attr("name");if(n in t)if("equal"!==t[n].action){var a=parseInt(e.val());(!a||a<0)&&(a=0),a+="add"===t[n].action?t[n].value:-t[n].value,e.val(a>1?a:1)}else e.val(t[n].value)}).trigger("change")}),alert("点数已修改")}}).end().find('[data-name="clear"]').click(function(e){e.preventDefault(),$(this).closest('[data-id="modifyArea"]').find('[type="text"]').val("")});var l=!0,d=!1,s=void 0;try{for(var c,f=p.entries(Config.levelPointList)[Symbol.iterator]();!(l=(c=f.next()).done);l=!0){var u=r(c.value,2),m=u[0],h=u[1];$.isNumeric(m)&&i(m,h)}}catch(e){d=!0,s=e}finally{try{!l&&f.return&&f.return()}finally{if(d)throw s}}g.show(n),"function"==typeof t&&t(a)}},ve=function(e){(0,b.read)();var t="pd"+(1===e?"Add":"Change")+"ArmDialog",n=$("#"+t);if(n.length>0)n.parent().fadeIn("fast"),g.resize(t);else{var a=u.wait("<strong>正在获取装备信息&hellip;</strong>");$.ajax({type:"GET",url:"kf_fw_ig_mybp.php?t="+$.now(),timeout:v.default.defAjaxTimeout}).done(function(t){u.remove(a);var n=/<tr><td width="\d+%">装备.+?\r\n(<tr.+?<\/tr>)<tr><td colspan="4">/.exec(t);n&&be(e,n[1])}).fail(function(){return u.remove(a)})}},be=function(e,t){var n="pd"+(1===e?"Add":"Change")+"ArmDialog";if(!($("#"+n).length>0)){var a='\n<div class="pd_cfg_main" style="padding: 0;">\n  <table class="kf_fw_ig4" data-name="armList" cellspacing="0" cellpadding="0" align="center" style="width: 800px;">\n    <tbody>\n      <tr hidden><td colspan="3" class="kf_fw_ig_title1">我的装备背包</td></tr>\n      <tr><td width="10%">装备</td><td width="10%">熔炼</td><td width="80%">名称</td></tr>\n      '+t+'\n      <tr><td colspan="3"><span style="color:#00f;">不显示超过10件以上的物品，如物品超过10件，请熔炼掉多余的即可全部显示。</span></td></tr>\n    </tbody>\n  </table>\n</div>',o=g.create(n,(1===e?"加入":"更换")+"装备",a,"min-width: 820px; z-index: 1001;"),i=o.find('.kf_fw_ig4[data-name="armList"]');o.off("click",'[data-action="close"]').on("click",'[data-action="close"]',function(){o.fadeOut("fast")}),A.handleArmArea(i,e),A.bindArmLinkClickEvent(i,E,1),g.show(n),L.runFunc("Item.show"+(1===e?"Add":"Change")+"ArmDialog_after_")}},ye=function(){$('\n<div id="pdLootLogHeader" style="padding: 0 5px 5px; line-height: 2em;">\n  <div class="pd_log_nav">\n    <a class="pd_disabled_link" data-name="start" href="#">&lt;&lt;</a>\n    <a class="pd_disabled_link" data-name="prev" href="#" style="padding: 0 7px;">&lt;</a>\n    <h2 class="pd_history_logs_key pd_custom_tips" title="共有0天的争夺记录">现在</h2>\n    <a class="pd_disabled_link" data-name="next" href="#" style="padding: 0 7px;">&gt;</a>\n    <a class="pd_disabled_link" data-name="end" href="#">&gt;&gt;</a>\n  </div>\n  <div style="text-align: right;">\n    <label>\n      <input class="pd_input" name="showLiteLootLogEnabled" type="checkbox" '+(Config.showLiteLootLogEnabled?"checked":"")+'> 显示精简记录\n    </label>\n    <label>\n      <input class="pd_input" name="showLevelEnemyStatEnabled" type="checkbox" '+(Config.showLevelEnemyStatEnabled?"checked":"")+'> 显示分层统计\n    </label>\n    <a class="pd_btn_link" data-name="openImOrExLootLogDialog" href="#">导入/导出争夺记录</a>\n    <a class="pd_btn_link pd_highlight" data-name="clearLootLog" href="#">清除记录</a>\n  </div>\n  <ul class="pd_stat" id="pdLogStat"></ul>\n</div>\n').insertBefore(B).find('[type="checkbox"]').click(function(){var e=$(this),t=e.attr("name"),n=e.prop("checked");t in Config&&Config[t]!==n&&((0,b.read)(),Config[t]=e.prop("checked"),(0,b.write)(),"showLiteLootLogEnabled"===t?Ce(O,j,G):"showLevelEnemyStatEnabled"===t&&ke(j))}).end().find('[data-name="openImOrExLootLogDialog"]').click(function(e){e.preventDefault(),_e()}).end().find('[data-name="clearLootLog"]').click(function(e){e.preventDefault(),confirm("是否清除所有争夺记录？")&&(w.clear(),alert("争夺记录已清除"),location.reload())}),xe()},_e=function(){var e="pdImOrExLootLogDialog";if(!($("#"+e).length>0)){var t=w.read(),n=g.create(e,"导入或导出争夺记录",'\n<div class="pd_cfg_main">\n  <strong>导入争夺记录：</strong>将争夺记录内容粘贴到文本框中并点击合并或覆盖按钮即可<br>\n  <strong>导出争夺记录：</strong>复制文本框里的内容并粘贴到别处即可<br>\n  <textarea name="lootLog" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button name="merge" type="button">合并记录</button>\n  <button name="overwrite" type="button" style="color: #f00;">覆盖记录</button>\n  <button data-action="close" type="button">关闭</button>\n</div>');n.find('[name="merge"], [name="overwrite"]').click(function(e){e.preventDefault();var a=$(this).attr("name");if(confirm("是否将文本框中的争夺记录"+("overwrite"===a?"覆盖":"合并")+"到本地争夺记录？")){var o=$.trim(n.find('[name="lootLog"]').val());if(o){try{o=JSON.parse(o)}catch(e){return void alert("争夺记录有错误")}if(!o||"object"!==$.type(o))return void alert("争夺记录有错误");t="merge"===a?w.getMergeLog(t,o):o,w.write(t),alert("争夺记录已导入"),location.reload()}}}),g.show(e),n.find('[name="lootLog"]').val(JSON.stringify(t)).select().focus()}},xe=function(){var e=$("#pdLootLogHeader").find(".pd_log_nav"),t=function(e){if(0===parseInt(e))return"现在";var t=new Date(parseInt(e));return p.getDateString(t)+" "+p.getTimeString(t,":",!1)},n=w.read(),a=[];if($.isEmptyObject(n))a.push(0);else{a=p.getObjectKeyList(n,1);var o=parseInt(a[a.length-1]);(!/你被击败了/.test(N)||o<=p.getDate("-1d").getTime()||n[o].log.join("").trim()!==O.join("").trim())&&a.push(0)}var i=a.length-1,r=0===a[i]?a.length-1:a.length;if(e.find(".pd_history_logs_key").attr("title","共有"+r+"天的争夺记录").text(t(a[i])),a.length>1&&(e.find('[data-name="start"]').attr("title",t(a[0])).removeClass("pd_disabled_link"),e.find('[data-name="prev"]').attr("title",t(a[i-1])).removeClass("pd_disabled_link")),e.on("click","a[data-name]",function(o){o.preventDefault();var r=$(this);if(!r.hasClass("pd_disabled_link")){var l=r.data("name");if("start"===l)i=0;else if("prev"===l){if(!(i>0))return;i--}else if("next"===l){if(!(i<a.length-1))return;i++}else"end"===l&&(i=a.length-1);e.find(".pd_history_logs_key").text(t(a[i]));var d=0===a[i]?O:n[a[i]].log,s=$e(d);Ce(d,s,0===a[i]?G:n[a[i]].points),ke(s),i>0?(e.find('[data-name="start"]').attr("title",t(a[0])).removeClass("pd_disabled_link"),e.find('[data-name="prev"]').attr("title",t(a[i-1])).removeClass("pd_disabled_link")):e.find('[data-name="start"], [data-name="prev"]').removeAttr("title").addClass("pd_disabled_link"),i<a.length-1?(e.find('[data-name="next"]').attr("title",t(a[i+1])).removeClass("pd_disabled_link"),e.find('[data-name="end"]').attr("title",t(a[a.length-1])).removeClass("pd_disabled_link")):e.find('[data-name="next"], [data-name="end"]').removeAttr("title").addClass("pd_disabled_link")}}),!N.includes("本日无争夺记录")&&!N.includes("你已经复活")){var l=0===a[i]?O:n[a[i]].log;Ce(l,$e(l),0===a[i]?G:n[a[i]].points),Config.autoSaveLootLogInSpecialCaseEnabled&&/你被击败了/.test(N)&&0===a[i]&&(p.deleteCookie(v.default.lootCompleteCookieName),Pe())}},ke=function(e){var t=Le(e),n=t.boxNum,a=t.boxes,o="",i=!0,l=!1,d=void 0;try{for(var s,c=p.getSortedObjectKeyList(A.boxTypeList,a)[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var f=s.value;o+="<i>"+f+"<em>+"+a[f].toLocaleString()+"</em></i> "}}catch(e){l=!0,d=e}finally{try{!i&&c.return&&c.return()}finally{if(l)throw d}}var u="",m=!0,g=!1,h=void 0;try{for(var b,y=p.entries(Se(e))[Symbol.iterator]();!(m=(b=y.next()).done);m=!0){var _=r(b.value,2),x=_[0],k=_[1];u+="<i>"+x+"<em>+"+k+"</em></i> "}}catch(e){g=!0,h=e}finally{try{!m&&y.return&&y.return()}finally{if(g)throw h}}var C="",w=!0,I=!1,L=void 0;try{for(var S,T=p.entries(Se(e.filter(function(t,n){return n>=e.length-v.default.enemyStatLatestLevelNum})))[Symbol.iterator]();!(w=(S=T.next()).done);w=!0){
var D=r(S.value,2),x=D[0],k=D[1];C+="<i>"+x+"<em>+"+k+"</em></i> "}}catch(e){I=!0,L=e}finally{try{!w&&T.return&&T.return()}finally{if(I)throw L}}var E=$("#pdLogStat");if(E.html("\n<li><b>收获统计：</b><i>盒子<em>+"+n+"</em></i> "+(o?o:"无")+"</li>\n<li><b>全部层数：</b>"+u+"<br><b>最近"+v.default.enemyStatLatestLevelNum+"层：</b>"+C+"</li>\n"),Config.showLevelEnemyStatEnabled){for(var M="",P=1;P<e.length;P+=10)!function(t){M+="&nbsp;&nbsp;<b>"+t+"-"+(t+9<e.length?t+9:e.length-1)+"：</b>";var n="",a=!0,o=!1,i=void 0;try{for(var l,d=p.entries(Se(e.filter(function(e,n){return n>=t&&n<t+10})))[Symbol.iterator]();!(a=(l=d.next()).done);a=!0){var s=r(l.value,2);n+="<i>"+s[0]+"<em>+"+s[1]+"</em></i> "}}catch(e){o=!0,i=e}finally{try{!a&&d.return&&d.return()}finally{if(o)throw i}}M+=(n?n:"无")+"<br>"}(P);E.append("<li><b>分层统计：</b>"+(M?"<br>"+M:"无")+"</li>")}},Ce=function(e,t,n){var a=[];$.each(e,function(e,t){if(t){var o=/\[([^\]]+)的]NPC/.exec(t);if(o){var i=o[1],r="";switch(i){case"普通":r="#09c";break;case"特别睿智":r="#c96";break;case"特别坚强":r="#cc587c";break;case"特别强壮":r="#f93";break;case"特别快速":r="#f3c";break;case"BOSS":r="#f00";break;default:r="#0075ea"}if(a[e]=t.replace(o[0],'<span style="background-color: '+r+';">['+i+"的]</span>NPC"),n[e]){var l=n[e];i=i.replace("特别","");var d=/灵活：\d+\+\d+=(\d+)/.exec(l);if(d){var s=de("灵活",parseInt(d[1]),e,i);l=l.replace(/(暴击几率：\d+%)/,'$1<span class="pd_custom_tips" title="实际暴击几率">('+s+"%)</span>")}if(d=/智力：\d+\+\d+=(\d+)/.exec(l)){var c=de("智力",parseInt(d[1]),e,i);l=l.replace(/(技能释放概率：\d+%)/,'$1<span class="pd_custom_tips" title="实际技能释放概率">('+c+"%)</span>")}a[e]=a[e].replace("</li>",('</li><li class="pk_log_g" style="color: #666;">'+l+"</li>").replace(/\n/g,"<br>"))}}}}),U.html(a.reverse().join("")),Config.showLiteLootLogEnabled?$("#pdLiteLootLogStyle").length||$("head").append('<style id="pdLiteLootLogStyle">.pk_log_g, .pk_log_i, .pk_log_u, .pk_log_v { display: none; }</style>'):$("#pdLiteLootLogStyle").remove(),L.runFunc("Loot.showEnhanceLog_after_")},we=(n.getLog=function(){return N},n.getLogList=function(e){var t=[],n=e.match(/<li class="pk_log_j">.+?(?=\s*<li class="pk_log_j">|\s*$)/g);for(var a in n){var o=/在\[\s*(\d+)\s*层]/.exec(p.removeHtmlTag(n[a]));o&&(t[parseInt(o[1])]=n[a])}return t}),Ie=n.getLevelInfo=function(e){var t={enemy:"",life:0,initLife:0,box:""};if(!e)return t;e=p.removeHtmlTag(e.replace(/<\/li>/g,"</li>\n"));var n=/你\((\d+)\)遭遇了\[([^\]]+)的]NPC/.exec(e);return n&&(t.initLife=parseInt(n[1]),t.enemy=n[2],t.enemy=t.enemy.replace("特别","").replace("(后续更新前此路不通)","")),n=/生命值\[(\d+)\s*\/\s*\d+]/.exec(e),n&&(t.life=parseInt(n[1])),n=/敌人掉落了一个\s*\[\s*(\S+?盒子)\s*]/.exec(e),n&&(t.box=n[1]),t},$e=n.getLevelInfoList=function(e){var t=[];return $.each(e,function(e,n){n&&(t[e]=Ie(n))}),t},Le=function(e){var t=0,n={};return $.each(e,function(e,a){a&&a.box&&(a.box in n||(n[a.box]=0),n[a.box]++,t++)}),{boxNum:t,boxes:n}},Se=function(e){var t={"普通":0,"强壮":0,"快速":0,"睿智":0,"坚强":0,BOSS:0,"大魔王":0};return $.each(Te(e),function(e,n){n&&n in t&&t[n]++}),t.BOSS||delete t.BOSS,t["大魔王"]||delete t["大魔王"],t},Te=function(e){var t=[];return $.each(e,function(e,n){n&&n.enemy&&(t[e]=n.enemy)}),t},De=function(e){return e.length-1>=1?e.length-1:0},Ae=function(e){var t=localStorage.getItem(v.default.tempPointsLogListStorageName+"_"+s.default.uid);if(!t)return[];try{t=JSON.parse(t)}catch(e){return[]}if(!t||"object"!==$.type(t)||"number"!==$.type(t.time)||!Array.isArray(t.pointsLogList))return[];var n=$.now()-t.time;return t.pointsLogList.length>e.length||n>=864e5||n<0?(localStorage.removeItem(v.default.tempPointsLogListStorageName+"_"+s.default.uid),[]):t.pointsLogList},Ee=function(){var e=new Date,t=p.getTimezoneDateByTime("02:30:00");return e>t&&(t=p.getTimezoneDateByTime("00:00:30"),t.setDate(t.getDate()+1)),e>t&&t.setDate(t.getDate()+1),t},Me=(n.checkLoot=function e(){if(!(new Date<p.getDateByTime(Config.checkLootAfterTime))){console.log("检查争夺情况Start");var t=u.wait("<strong>正在检查争夺情况中&hellip;</strong>");$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:v.default.defAjaxTimeout,success:function(e){if(u.remove(t),/你被击败了/.test(e))p.setCookie(v.default.lootCompleteCookieName,2,Ee());else{if(p.getCookie(v.default.lootCheckingCookieName))return;var n=$("#pk_text",e);if(!n.length)return void p.setCookie(v.default.lootCompleteCookieName,-1,p.getDate("+"+v.default.checkLootInterval+"m"));if(Config.attackTargetLevel>0){var a=n.html(),o=we(a),i=De(o);if(Config.attackTargetLevel<=i)return void p.setCookie(v.default.lootCompleteCookieName,1,Ee())}p.setCookie(v.default.lootCheckingCookieName,1,p.getDate("+1m")),u.destroy(),location.href="kf_fw_ig_index.php"}},error:function(){u.remove(t),setTimeout(e,v.default.defAjaxInterval)}})}},function(){if(!(/你被击败了/.test(N)||new Date<p.getDateByTime(Config.checkLootAfterTime))){var e=T.getSafeId(),t=De(O);if(!e||Config.attackTargetLevel>0&&Config.attackTargetLevel<=t)return void p.setCookie(v.default.lootCompleteCookieName,1,Ee());p.setCookie(v.default.lootAttackingCookieName,1,p.getDate("+"+v.default.lootAttackingExpires+"m")),p.deleteCookie(v.default.lootCompleteCookieName);var n=Config.autoChangeLevelPointsEnabled||Config.customPointsScriptEnabled&&"function"==typeof v.default.getCustomPoints;(!Config.unusedPointNumAlertEnabled||n||Z(P))&&fe({type:"auto",targetLevel:Config.attackTargetLevel,autoChangePointsEnabled:n,safeId:e})}}),Pe=n.autoSaveLootLog=function e(){console.log("检查争夺情况Start");var t=u.wait("<strong>正在检查争夺情况中&hellip;</strong>");$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:v.default.defAjaxTimeout,success:function(e){if(u.remove(t),!p.getCookie(v.default.lootCompleteCookieName)){var n=$("#pk_text",e),a=n.html();if(/你被击败了/.test(a)){p.setCookie(v.default.lootCompleteCookieName,2,Ee());var o=we(a),i=$e(o),r=w.read();if(!$.isEmptyObject(r)){var l=p.getObjectKeyList(r,1),d=parseInt(l[l.length-1]);if(d>p.getDate("-1d").getTime()&&r[d].log.join("").trim()===o.join("").trim())return}ge(o,i,[])}else p.setCookie(v.default.lootCompleteCookieName,-1,p.getDate("+"+v.default.checkLootInterval+"m"))}},error:function(){u.remove(t),setTimeout(e,v.default.defAjaxInterval)}})},Fe=(n.getChangePointsCountDown=function(){return console.log("获取改点倒计时Start"),$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:v.default.defAjaxTimeout}).then(function(e){var t=/\(下次修改配点还需\[(\d+)]分钟\)/.exec(e);if(t){var n=p.getDate("+"+t[1]+"m");return p.setCookie(v.default.changePointsInfoCookieName,n.getTime(),n),n.getTime()}if(t=/当前修改配点可用\[(\d+)]次/.exec(e)){var a=parseInt(t[1]);return p.setCookie(v.default.changePointsInfoCookieName,a+"c",p.getDate("+"+v.default.changePointsInfoExpires+"m")),a}return"error"},function(){return"timeout"})},n.addUserLinkInPkListPage=function(){$(".kf_fw_ig1 > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===s.default.userName&&e.find("a").addClass("pd_highlight")})},n.addUserLinkInHaloPage=function(){$(".kf_fw_ig1:eq(1) > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===s.default.userName&&e.find("a").addClass("pd_highlight")})},function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("获取战力光环信息Start");var n=u.wait("<strong>正在获取战力光环信息，请稍候&hellip;</strong>");Be().done(function(e){"object"===$.type(e)&&(Ue(e),t?J():P.find(".pd_point").trigger("change"))}).always(function(a){u.remove(n),"timeout"===a?setTimeout(function(){return e(t)},v.default.defAjaxInterval):"error"===a&&u.show("<strong>战力光环信息获取失败！</strong>")})}),Be=n.getHaloInfo=function(){return $.ajax({type:"GET",url:"kf_fw_ig_halo.php?t="+$.now(),timeout:v.default.defAjaxTimeout}).then(function(e){var t={"全属性":0,"攻击力":0,"生命值":0},n=/全属性\s*\+\s*(\d+(?:\.\d+)?)%/.exec(e);if(n){t["全属性"]=Math.round(10*parseFloat(n[1]))/1e3;var a=/福利加成\s*\+\s*(\d+)攻击力\s*&\s*\+\s*(\d+)生命值/.exec(e);return a&&(t["攻击力"]=parseInt(a[1]),t["生命值"]=parseInt(a[2])),k.setValue(v.default.haloInfoTmpLogName,$.extend(t,{time:$.now()})),t}return"error"},function(){return"timeout"})},Ue=n.setHaloInfo=function(e){if(K=e,!$("#pdHaloInfo").length){var t=M.find('input[type="text"]:eq(13)');if(!t.length||$.trim(t.val()))return;t.attr("id","pdHaloInfo"),$('<a data-name="reloadHaloInfo" href="#" style="margin-left: -20px;" title="如战力光环信息不正确时，请点此重新读取">读</a>').insertAfter(t).click(function(e){e.preventDefault(),confirm("是否重新读取战力光环信息？")&&(k.deleteValue(v.default.haloInfoTmpLogName),Fe())})}$("#pdHaloInfo").val("全属性+"+Math.round(1e3*K["全属性"])/10+"% (+"+K["攻击力"]+"|+"+K["生命值"]+")")},Ne=n.getPromoteHaloInfo=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];L.runFunc("Loot.getPromoteHaloInfo_before_"),console.log("获取战力光环页面信息Start");var n=u.wait("<strong>正在获取战力光环信息，请稍候&hellip;</strong>"),a=function(e){var n=p.getDate(e);return p.setCookie(v.default.promoteHaloCookieName,n.getTime(),n),t&&Q(),!1},o=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;$.ajax({type:"GET",url:"kf_fw_ig_halo.php?t="+$.now(),timeout:v.default.defAjaxTimeout}).done(function(e){u.remove(n);var i=/safeid=(\w+)"/.exec(e);if(!i)return a("+1h");var r=i[1],l=/下次随机还需\[(\d+)]分钟/.exec(e);if(l){var d=Config.promoteHaloAutoIntervalEnabled?v.default.minPromoteHaloInterval:60*Config.promoteHaloInterval;return d=d<v.default.minPromoteHaloInterval?v.default.minPromoteHaloInterval:d,a("+"+(d-(v.default.minPromoteHaloInterval-parseInt(l[1])))+"m")}var s=1,c=/当前光环随机可用\[(\d+)]次/.exec(e);Config.promoteHaloAutoIntervalEnabled&&c&&(s=parseInt(c[1]),o>-1&&(s=s>o?o:s)),Oe(s,Config.promoteHaloCostType,r,t)}).fail(function(){u.remove(n),setTimeout(e,v.default.defAjaxInterval)})};Config.promoteHaloLimit>0?function e(){$.ajax({type:"GET",url:"profile.php?action=show&uid="+s.default.uid+"&t="+$.now(),timeout:v.default.defAjaxTimeout}).done(function(e){u.remove(n);var t=Config.promoteHaloCostType>=11?/贡献数值：(\d+(?:\.\d+)?)/:/论坛货币：(-?\d+)\s*KFB/,i=t.exec(e);if(!i)return a("+"+v.default.promoteHaloLimitNextActionInterval+"m");var r=parseFloat(i[1]);if(!(r>Config.promoteHaloLimit))return a("+"+v.default.promoteHaloLimitNextActionInterval+"m");var l=je(Config.promoteHaloCostType),d=l.num,s=Math.floor((r-Config.promoteHaloLimit)/d);if(!(s>0))return a("+"+v.default.promoteHaloLimitNextActionInterval+"m");n=u.wait("<strong>正在获取战力光环信息，请稍候&hellip;</strong>"),o(s)}).fail(function(){return setTimeout(e,v.default.defAjaxInterval)})}():o()},Oe=n.promoteHalo=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];console.log("提升战力光环Start");var o=u.wait('<strong>正在提升战力光环&hellip;</strong><i>剩余：<em class="pd_countdown">'+e+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');k.deleteValue(v.default.haloInfoTmpLogName);var i=!1,r=0,l=p.getDate("+10m").getTime();!function d(){$.ajax({type:"GET",url:"kf_fw_ig_halo.php?do=buy&id="+t+"&safeid="+n+"&t="+$.now(),timeout:v.default.defAjaxTimeout}).done(function(e){T.showFormatLog("提升战力光环",e);var n=p.getResponseMsg(e),a=n.msg,o=/(新数值为|随机值为)\[(\d+(?:\.\d+)?)%]/.exec(a);if(o){var d="新数值为"===o[1];l=Config.promoteHaloAutoIntervalEnabled?0:p.getDate("+"+Config.promoteHaloInterval+"h").getTime();var s=parseFloat(o[2]),c=je(t);u.show("<strong>"+(d?"恭喜你提升了光环的效果！新数值为【<em>"+s+"%</em>】":"你本次随机值为【<em>"+s+"%</em>】，未超过光环效果")+"</strong><i>"+c.type+"<ins>"+(-c.num).toLocaleString()+"</ins></i>",-1);var f={};f[c.type]=-c.num,_.push("提升战力光环",d?"恭喜你提升了光环的效果！新数值为【`"+s+"%`】":"你本次随机值为【`"+s+"%`】，未超过光环效果",{pay:f}),r++}else if(/两次操作间隔过短/.test(a)?l=p.getDate("+10s").getTime():i=!0,o=/你的(贡献点数|KFB)不足/.exec(a),o&&(l=p.getDate("+"+Config.promoteHaloInterval+"h").getTime(),u.show("<strong>"+o[1]+'不足，无法提升战力光环</strong><a href="kf_fw_ig_halo.php" target="_blank">手动选择</a>',-1)),o=/你还需要等待(\d+)分钟/.exec(a)){var m=60*Config.promoteHaloInterval;m=m<v.default.minPromoteHaloInterval?v.default.minPromoteHaloInterval:m,l=p.getDate("+"+(60*Config.promoteHaloInterval-(v.default.minPromoteHaloInterval-parseInt(o[1])))+"m").getTime()}}).always(function(){o.find(".pd_countdown").text(e-r),i=i||o.data("stop"),i||r===e?(u.remove(o),l>0||i?p.setCookie(v.default.promoteHaloCookieName,l,new Date(l)):(p.deleteCookie(v.default.promoteHaloCookieName),Ne()),a&&Q(),L.runFunc("Loot.promoteHalo_after_")):setTimeout(d,v.default.promoteHaloActionInterval)})}()},je=n.getPromoteHaloCostByTypeId=function(e){switch(e){case 1:return{type:"KFB",num:100};case 2:return{type:"KFB",num:1e3};case 11:return{type:"贡献",num:.2};case 12:return{type:"贡献",num:2};default:return{type:"KFB",num:0}}}},{"./Config":4,"./Const":6,"./Dialog":7,"./Info":9,"./Item":10,"./Log":11,"./LootLog":14,"./Msg":15,"./Public":18,"./Script":20,"./TmpLog":21,"./Util":22}],14:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.getMergeLog=n.record=n.clear=n.write=n.read=void 0;var o=e("./Info"),i=a(o),r=e("./Const"),l=a(r),d=e("./Util"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(d),c=l.default.storagePrefix+"loot_log",p=n.read=function(){var e={},t=s.readData(c+"_"+i.default.uid);if(!t)return e;try{t=JSON.parse(t)}catch(t){return e}return t&&"object"===$.type(t)?e=t:e},f=n.write=function(e){return s.writeData(c+"_"+i.default.uid,JSON.stringify(e))};n.clear=function(){return s.deleteData(c+"_"+i.default.uid)},n.record=function(e,t){var n=p(),a=s.getDate("-"+Config.lootLogSaveDays+"d").getTime();$.each(s.getObjectKeyList(n,1),function(e,t){if(t=parseInt(t),!(isNaN(t)||t<=a))return!1;delete n[t]}),n[$.now()]={log:e,points:t},f(n)},n.getMergeLog=function(e,t){for(var n in t)!$.isNumeric(n)||parseInt(n)<=0||"object"===$.type(t[n])&&Array.isArray(t[n].log)&&Array.isArray(t[n].points)&&(e[n]=t[n]);return e}},{"./Const":6,"./Info":9,"./Util":22}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=n.show=function(e,t){var n={msg:"",duration:Config.defShowMsgDuration,clickable:!0,preventable:!1};"object"===$.type(e)?$.extend(n,e):(n.msg=e,n.duration=void 0===t?Config.defShowMsgDuration:t),$(".pd_msg").length>20&&i();var a=$(".pd_msg_container"),r=0===a.length;if(!r&&!$(".pd_mask").length){var l=$(".pd_msg:last");if(l.length>0){var d=l.offset().top,s=$(window).scrollTop();(d<s||d>=s+$(window).height()-l.outerHeight()-10)&&(i(),r=!0)}}n.preventable&&!$(".pd_mask").length&&$('<div class="pd_mask"></div>').appendTo("body"),r&&(a=$('<div class="pd_msg_container"></div>').appendTo("body"));var c=$('<div class="pd_msg">'+n.msg+"</div>").appendTo(a);c.on("click",".pd_stop_action",function(e){e.preventDefault(),$(this).html("正在停止&hellip;").closest(".pd_msg").data("stop",!0)}),n.clickable&&c.css("cursor","pointer").click(function(){$(this).stop(!0,!0).fadeOut("slow",function(){o($(this))})}).find("a").click(function(e){e.stopPropagation()});var p=$(window).width(),f=c.outerWidth(),u=c.outerHeight(),m=p/2-f/2;m+f>p&&(m=p-f-20),m<0&&(m=0),r?a.css("top",$(window).height()/2-u/2):a.stop(!1,!0).animate({top:"-="+u/1.75});var g=c.prev(".pd_msg");return c.css({top:g.length>0?parseInt(g.css("top"))+g.outerHeight()+5:0,left:m}).fadeIn("slow"),n.duration!==-1&&c.delay(1e3*n.duration).fadeOut("slow",function(){o($(this))}),c},o=(n.wait=function(e){return a({msg:e,duration:-1,clickable:!1,preventable:!(arguments.length>1&&void 0!==arguments[1])||arguments[1]})},n.remove=function(e){var t=e.parent();e.remove(),$(".pd_msg").length?$(".pd_countdown").length||$(".pd_mask").remove():(t.remove(),$(".pd_mask").remove())}),i=n.destroy=function(){$(".pd_msg_container").remove(),$(".pd_mask").remove()}},{}],16:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.handleProfilePage=n.addUserNameLinkInRankPage=n.refreshWaitCheckRatingPage=n.addLinksInGoodPostPage=n.showSelfRatingErrorSizeSubmitWarning=n.highlightRatingErrorSize=n.addAvatarChangeAlert=n.syncModifyPerPageFloorNum=n.addAutoChangeIdColorButton=n.addMsgSelectButton=n.modifyMyPostLink=n.addFollowAndBlockAndMemoUserLink=n.addFastDrawMoneyLink=n.highlightUnReadAtTipsMsg=n.addFastGotoThreadPageLink=n.highlightNewPost=void 0;var i=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e("./Info"),l=o(r),d=e("./Util"),s=a(d),c=e("./Msg"),p=a(c),f=e("./Const"),u=o(f),m=e("./Config"),g=e("./ConfigDialog"),h=e("./TmpLog"),v=a(h),b=e("./Public"),y=a(b),_=e("./Bank"),x=a(_);n.highlightNewPost=function(){$(".thread1 > tbody > tr > td:last-child").has("a.bl").each(function(){var e=$(this).html();/\|\s*\d{2}:\d{2}<br>\n.*\d{2}:\d{2}/.test(e)&&(e=e.replace(/(\d{2}:\d{2})<br>/,'<span class="pd_highlight">$1</span><br>'),$(this).html(e))})},n.addFastGotoThreadPageLink=function(){$('.threadtit1 > a[href^="read.php"]').each(function(){var e=$(this),t=e.closest("td").next().find("ul > li > a").contents().eq(0).text();if(t&&!(t<Config.perPageFloorNum)){for(var n=e.attr("href"),a=Math.floor(t/Config.perPageFloorNum)+1,o="",i=1;i<a;i++){if(i>Config.maxFastGotoThreadPageNum){i+1<=a&&(o+='..<a href="'+n+"&page="+a+'">'+a+"</a>");break}o+='<a href="'+n+"&page="+(i+1)+'">'+(i+1)+"</a>"}o='<span class="pd_thread_page">&hellip;'+o+"</span>",e.after(o).parent().css("white-space","normal")}})},n.highlightUnReadAtTipsMsg=function(){if($(".kf_share1:first").text().trim()==="含有关键词 “"+l.default.userName+"” 的内容"){var e=s.getCookie(u.default.prevReadAtTipsCookieName);if(e&&/^\d+日\d+时\d+分$/.test(e)){var t="";$(".kf_share1:eq(1) > tbody > tr:gt(0) > td:first-child").each(function(n){var a=$(this),o=a.text().trim();if(0===n&&(t=o),!(e<o&&t>=o))return!1;a.addClass("pd_highlight"),t=o}),$(".kf_share1").on("click","td > a",function(){s.deleteCookie(u.default.prevReadAtTipsCookieName)})}}},n.addFastDrawMoneyLink=function(){if($('td:contains("SYSTEM")').length&&$('td:contains("收到了他人转账的KFB")').length){var e=$(".thread2 > tbody > tr:eq(-2) > td:last"),t=e.html(),n=/给你转帐(\d+)KFB/i.exec(t);if(n){var a=parseInt(n[1]);e.html(t.replace(/会员\[(.+?)\]通过论坛银行/,'会员[<a target="_blank" href="profile.php?action=show&username=$1">$1</a>]通过论坛银行').replace(n[0],'给你转帐<span class="pd_stat"><em>'+a.toLocaleString()+"</em></span>KFB")),$('<br><a title="从活期存款中取出当前转账的金额" href="#">快速取款</a> | <a title="取出银行账户中的所有活期存款" href="#">取出所有存款</a>').appendTo(e).filter("a:eq(0)").click(function(e){e.preventDefault(),p.destroy(),x.drawCurrentDeposit(a)}).end().filter("a:eq(1)").click(function(e){e.preventDefault(),p.destroy(),p.wait("<strong>正在获取当前活期存款金额&hellip;</strong>"),$.get("hack.php?H_name=bank&t="+$.now(),function(e){p.destroy();var t=/活期存款：(\d+)KFB<br/.exec(e);if(!t)return void alert("获取当前活期存款金额失败");var n=parseInt(t[1]);if(n<=0)return void p.show("当前活期存款余额为零",-1);x.drawCurrentDeposit(n)})}),$('a[href^="message.php?action=write&remid="]').attr("href","#").addClass("pd_disabled_link").click(function(e){e.preventDefault(),alert("本短消息由系统发送，请勿直接回复；如需回复，请点击给你转账的用户链接，向其发送短消息")})}}},n.addFollowAndBlockAndMemoUserLink=function(){var e=/(.+?)\s*详细信息/.exec($('td:contains("详细信息")').text());if(e){var t=$.trim(e[1]);$('<span>[<a href="#">关注用户</a>] [<a href="#">屏蔽用户</a>]</span><br><span>[<a href="#">添加备注</a>]</span><br>').appendTo($('a[href^="message.php?action=write&touid="]').parent()).find("a").each(function(){var e=$(this);if(e.is('a:contains("备注")')){var n="",a=!0,o=!1,r=void 0;try{for(var l,d=s.entries(Config.userMemoList)[Symbol.iterator]();!(a=(l=d.next()).done);a=!0){var c=i(l.value,2),p=c[0],f=c[1];if(p===t){n=f;break}}}catch(e){o=!0,r=e}finally{try{!a&&d.return&&d.return()}finally{if(o)throw r}}if(""!==n){e.text("修改备注").data("memo",n);var u=$(".log1 > tbody > tr:last-child > td:last-child");u.html("备注："+n+"<br>"+u.html())}}else{var m="关注",g=Config.followUserList;e.text().indexOf("屏蔽")>-1&&(m="屏蔽",g=Config.blockUserList),s.inFollowOrBlockUserList(t,g)>-1&&e.addClass("pd_highlight").text("解除"+m)}}).click(function(e){e.preventDefault(),(0,m.read)();var n=$(this);if(n.is('a:contains("备注")')){var a=n.data("memo");a||(a="");var o=prompt("为此用户添加备注（要删除备注请留空）：",a);if(null===o)return;Config.userMemoEnabled||(Config.userMemoEnabled=!0),o=$.trim(o),o?(Config.userMemoList[t]=o,n.text("修改备注")):(delete Config.userMemoList[t],n.text("添加备注")),n.data("memo",o),(0,m.write)()}else{var i="关注",r=Config.followUserList;if(n.text().includes("屏蔽")?(i="屏蔽",r=Config.blockUserList,Config.blockUserEnabled||(Config.blockUserEnabled=!0)):Config.followUserEnabled||(Config.followUserEnabled=!0),n.text()==="解除"+i){var l=s.inFollowOrBlockUserList(t,r);l>-1&&(r.splice(l,1),(0,m.write)()),n.removeClass("pd_highlight").text(i+"用户"),alert("该用户已被解除"+i)}else{if(s.inFollowOrBlockUserList(t,r)===-1){if("屏蔽"===i){var d=Config.blockUserDefaultType;if(null===(d=prompt("请填写屏蔽类型，0：屏蔽主题和回帖；1：仅屏蔽主题；2：仅屏蔽回帖",d)))return;d=parseInt(d),(isNaN(d)||d<0||d>2)&&(d=Config.blockUserDefaultType),r.push({name:t,type:d})}else r.push({name:t});(0,m.write)()}n.addClass("pd_highlight").text("解除"+i),alert("该用户已被"+i)}}})}},n.modifyMyPostLink=function(){$('.t a[href^="read.php?tid="]').each(function(){var e=$(this);e.attr("href",e.attr("href").replace(/&uid=\d+#(\d+)/,"&spid=$1"))})},n.addMsgSelectButton=function(){var e=$('.thread1 > tbody > tr > td:last-child > [type="checkbox"]');$('<input value="自定义" type="button" style="margin-right: 3px;">').insertBefore('[type="button"][value="全选"]').click(function(t){t.preventDefault();var n=$.trim(prompt("请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）","收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除"));if(""!==n){e.prop("checked",!1);var a=n.split("|");$(".thread1 > tbody > tr > td:nth-child(2) > a").each(function(){var e=$(this),t=!0,n=!1,o=void 0;try{for(var i,r=a[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var l=i.value;e.text().toLowerCase().includes(l.toLowerCase())&&e.closest("tr").find('td:last-child > input[type="checkbox"]').prop("checked",!0)}}catch(e){n=!0,o=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw o}}})}}).parent().attr("colspan",4).prev("td").attr("colspan",3),$('<input value="反选" type="button" style="margin-left: 5px; margin-right: 1px;">').insertAfter('[type="button"][value="全选"]').click(function(){return s.selectInverse(e)})},n.addAutoChangeIdColorButton=function(){var e=$('table div > table > tbody > tr > td:contains("自定义ID颜色")');$('<span class="pd_highlight">低等级没人权？没有自己喜欢的颜色？快来试试助手的<a href="#">自定义本人神秘颜色</a>的功能吧！（虽然仅限自己可见 ╮(╯▽╰)╭）</span><br>').appendTo(e).find("a").click(function(e){e.preventDefault(),(0,g.show)()});var t=e.parent("tr").nextAll("tr").not("tr:last");if(!(t.find("a").length<=1)){var n=$('\n<form>\n<div data-name="autoChangeIdColorBtns" style="margin-top: 5px;">\n  <label><input name="autoChangeIdColorEnabled" class="pd_input" type="checkbox"> 自动更换ID颜色</label>\n</div>\n</form>\n').appendTo(e);n.find('[name="autoChangeIdColorEnabled"]').click(function(){var e=$(this),a=e.prop("checked");if(a!==Config.autoChangeIdColorEnabled&&((0,m.read)(),Config.autoChangeIdColorEnabled=a,(0,m.write)()),a){t.addClass("pd_id_color_select").find("td:not(:has(a))").css("cursor","not-allowed"),$('\n<label class="pd_cfg_ml">\n  更换顺序\n  <select name="autoChangeIdColorType" style="font-size: 12px;">\n    <option value="random">随机</option><option value="sequence">顺序</option>\n  </select>\n</label>&nbsp;\n<label>每隔 <input name="autoChangeIdColorInterval" class="pd_input" style="width: 25px;" type="text" maxlength="5"> 小时</label>\n<button name="save" type="button">保存</button>\n<button name="reset" type="button" style="margin-left: 3px;">重置</button><br>\n<a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n<a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n<label><input name="changeAllAvailableIdColorEnabled" class="pd_input" type="checkbox"> 选择当前所有可用的ID颜色</label>\n').insertAfter(e.parent()).filter('[name="save"]').click(function(){var e=n.find('[name="autoChangeIdColorInterval"]'),a=parseInt(e.val());if(isNaN(a)||a<=0)return alert("ID颜色更换时间间隔格式不正确"),void e.select().focus();var o=n.find('[name="changeAllAvailableIdColorEnabled"]').prop("checked"),i=[];if(t.find('[type="checkbox"]:checked').each(function(){i.push(parseInt($(this).val()))}),!o&&i.length<=1)return void alert("必须选择2种或以上的ID颜色");i.length<=1&&(i=[]);var r=Config.autoChangeIdColorInterval;(0,m.read)(),Config.autoChangeIdColorType=n.find('[name="autoChangeIdColorType"]').val().toLowerCase(),Config.autoChangeIdColorInterval=a,Config.changeAllAvailableIdColorEnabled=o,Config.customAutoChangeIdColorList=i,(0,m.write)(),r!==Config.autoChangeIdColorInterval&&s.deleteCookie(u.default.autoChangeIdColorCookieName),alert("设置保存成功")}).end().filter('[name="reset"]').click(function(){(0,m.read)(),Config.autoChangeIdColorEnabled=m.Config.autoChangeIdColorEnabled,Config.autoChangeIdColorType=m.Config.autoChangeIdColorType,Config.autoChangeIdColorInterval=m.Config.autoChangeIdColorInterval,Config.changeAllAvailableIdColorEnabled=m.Config.changeAllAvailableIdColorEnabled,Config.customAutoChangeIdColorList=m.Config.customAutoChangeIdColorList,(0,m.write)(),s.deleteCookie(u.default.autoChangeIdColorCookieName),v.deleteValue(u.default.prevAutoChangeIdColorTmpLogName),alert("设置已重置"),location.reload()}).end().filter('[data-name="selectAll"], [data-name="selectInverse"]').click(function(e){if(e.preventDefault(),t.find("input[disabled]").length>0)return alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),void n.find('[name="changeAllAvailableIdColorEnabled"]').focus();$(this).is('[data-name="selectAll"]')?s.selectAll(t.find('[type="checkbox"]')):s.selectInverse(t.find('[type="checkbox"]'))}),t.find("td:has(a)").each(function(){var e=$(this),t=/&color=(\d+)/i.exec(e.find("a").attr("href"));t&&e.append('<input type="checkbox" class="pd_input" value="'+t[1]+'">')}),n.find('[name="autoChangeIdColorType"]').val(Config.autoChangeIdColorType),n.find('[name="autoChangeIdColorInterval"]').val(Config.autoChangeIdColorInterval),n.find('[name="changeAllAvailableIdColorEnabled"]').click(function(){t.find("input").prop("disabled",$(this).prop("checked"))}).prop("checked",Config.changeAllAvailableIdColorEnabled).triggerHandler("click");var o=!0,i=!1,r=void 0;try{for(var l,d=Config.customAutoChangeIdColorList[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var c=l.value;t.find('input[value="'+c+'"]').prop("checked",!0)}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}}else e.parent().nextAll().remove(),t.removeClass("pd_id_color_select").find("input").remove()}),t.on("click","td",function(e){if(!$(e.target).is("a")){var t=$(this);t.find("input[disabled]").length>0?(alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),n.find('[name="changeAllAvailableIdColorEnabled"]').focus()):$(e.target).is("input")||t.find("input").click()}}),Config.autoChangeIdColorEnabled&&n.find('[name="autoChangeIdColorEnabled"]').prop("checked",!0).triggerHandler("click")}},n.syncModifyPerPageFloorNum=function(){var e=function(){var e=parseInt($('select[name="p_num"]').val());isNaN(e)||(e||(e=10),e!==Config.perPageFloorNum&&(Config.perPageFloorNum=e,(0,m.write)()))};$("form#creator").submit(function(){(0,m.read)(),e()}),e()},n.addAvatarChangeAlert=function(){$('input[name="uploadurl[2]"]').parent().append('<div class="pd_highlight">本反向代理服务器为了提高性能对图片设置了缓存，更换头像后可能需等待<b>最多30分钟</b>才能看到效果</div>')},n.highlightRatingErrorSize=function(){$('.adp1 a[href^="read.php?tid="]').each(function(){var e=$(this),t=e.text(),n=0,a=e.parent("td").next("td"),o=/认定\[(\d+)\]/i.exec(a.text());o&&(n=parseInt(o[1]));var i=y.checkRatingSize(t,n),r=i.type,l=i.titleSize;r===-1?a.css("color","#ff9933").attr("title","标题文件大小无法解析").addClass("pd_custom_tips"):1===r&&a.addClass("pd_highlight pd_custom_tips").attr("title","标题文件大小("+l.toLocaleString()+"M)与认定文件大小("+n.toLocaleString()+"M)不一致")})},n.showSelfRatingErrorSizeSubmitWarning=function(){$('form[name="mail1"]').submit(function(){var e=parseFloat($('[name="psize"]').val());if(!(isNaN(e)||e<=0)){2===parseInt($('[name="psizegb"]').val())&&(e*=1024);var t=$('.adp1 a[href^="read.php?tid="]').text(),n=y.checkRatingSize(t,e),a=n.type,o=n.titleSize;return 1===a?confirm("标题文件大小("+o.toLocaleString()+"M)与认定文件大小("+e.toLocaleString()+"M)不一致，是否继续？"):void 0}})},n.addLinksInGoodPostPage=function(){/\/kf_fw_1wkfb\.php\?ping=5/i.test(location.href)?$(".adp1:last > tbody > tr:gt(0) > td:last-child").each(function(){var e=$(this),t=parseInt(e.text());e.wrapInner('<a class="'+(t===l.default.uid?"pd_highlight":"")+'" href="profile.php?action=show&uid='+t+'" target="_blank"></a>')}):/\/kf_fw_1wkfb\.php\?ping=6/i.test(location.href)&&($(".adp1:last > tbody > tr:gt(1) > td:nth-child(3)").each(function(){var e=$(this),t=e.text().trim();"0"!==t&&e.wrapInner('<a class="'+(t===l.default.userName?"pd_highlight":"")+'" href="profile.php?action=show&username='+t+'" target="_blank"></a>')}),$(".adp1:last > tbody > tr:gt(1) > td:last-child").each(function(){var e=$(this),t=/\[(\d+)]板块/.exec(e.text());t&&e.wrapInner('<a href="thread.php?fid='+t[1]+'" target="_blank"></a>')}))},n.refreshWaitCheckRatingPage=function(){if(/剩余-\d+分钟/.test($(".adp1:eq(1) > tbody > tr:last-child > td:first-child").text())){!function e(){console.log("自动刷新Start"),$.ajax({type:"GET",url:"kf_fw_1wkfb.php?ping=2&t="+$.now(),timeout:1e4}).done(function(t){/剩余-\d+分钟/.test(t)&&setTimeout(e,u.default.defAjaxInterval)}).fail(function(){return setTimeout(e,u.default.defAjaxInterval)})}()}},n.addUserNameLinkInRankPage=function(){$(".kf_no11:eq(2) > tbody > tr:gt(0) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===l.default.userName&&e.find("a").addClass("pd_highlight")})},n.handleProfilePage=function(){var e=$(".log1 > tbody > tr:last-child > td:nth-child(2)");e.html(e.html().replace(/<b>在线<\/b>/,'<b style="color: #090;">在线</b>').replace(/<b>离线<\/b>/,'<b style="color: #999;">离线</b>').replace(/系统等级：(\S+)/,'系统等级：<span class="pd_highlight">$1</span>').replace(/发帖数量：(\d+)/,function(e,t){return'发帖数量：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/论坛货币：(-?\d+)/,function(e,t){return'论坛货币：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/在线时间：(\d+)/,function(e,t){return'在线时间：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/注册时间：((\d{4})-(\d{2})-(\d{2}))/,function(e,t,n,a,o){var i=new Date,r=t;return parseInt(a)===i.getMonth()+1&&parseInt(o)===i.getDate()&&parseInt(n)<=i.getFullYear()&&(r='<span class="pd_custom_tips pd_highlight" title="今天是该用户注册'+(i.getFullYear()-parseInt(n))+'周年纪念日">'+t+"</span>"),"注册时间："+r})).css("vertical-align","top")}},{"./Bank":2,"./Config":4,"./ConfigDialog":5,"./Const":6,"./Info":9,"./Msg":15,"./Public":18,"./TmpLog":21,"./Util":22}],17:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.addRedundantKeywordWarning=n.savePostContentWhenSubmit=n.preventCloseWindowWhenEditPost=n.importKfSmileEnhanceExtension=n.addAttachChangeAlert=n.modifyPostPreviewPage=n.addExtraOptionInPostPage=n.addExtraPostEditorButton=n.removeUnpairedBBCodeInQuoteContent=n.handleMultiQuote=void 0
;var r=e("./Info"),l=o(r),d=e("./Util"),s=a(d),c=e("./Msg"),p=a(c),f=e("./Const"),u=o(f),m=e("./Script"),g=a(m);n.handleMultiQuote=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;g.runFunc("Post.handleMultiQuote_before_",e),$("#pdClearMultiQuoteData").length||$('<a id="pdClearMultiQuoteData" style="margin-left: 7px;" title="清除在浏览器中保存的多重引用数据" href="#">清除引用数据</a>').insertAfter('input[name="diy_guanjianci"]').click(function(t){t.preventDefault(),localStorage.removeItem(u.default.multiQuoteStorageName),$('input[name="diy_guanjianci"]').val(""),$(2===e?"#textarea":'[name="atc_content"]').val(""),alert("多重引用数据已被清除")});var t=localStorage[u.default.multiQuoteStorageName];if(t){try{t=JSON.parse(t)}catch(e){return}if(t&&"object"===$.type(t)&&!$.isEmptyObject(t)){var n=parseInt(s.getUrlParam("tid")),a=parseInt(s.getUrlParam("fid"));if(n&&void 0!==t.tid&&t.tid===n&&Array.isArray(t.quoteList)&&(2!==e||a)){var o=[],r=!0,l=!1,d=void 0;try{for(var c,f=t.quoteList[Symbol.iterator]();!(r=(c=f.next()).done);r=!0){var m=c.value;if(Array.isArray(m)){var h=!0,v=!1,b=void 0;try{for(var y,_=m[Symbol.iterator]();!(h=(y=_.next()).done);h=!0){var x=y.value;o.push(x)}}catch(e){v=!0,b=e}finally{try{!h&&_.return&&_.return()}finally{if(v)throw b}}}}}catch(e){l=!0,d=e}finally{try{!r&&f.return&&f.return()}finally{if(l)throw d}}if(!o.length)return void localStorage.removeItem(u.default.multiQuoteStorageName);var k=new Set,C="",w=$('input[name="diy_guanjianci"]');2===e&&(p.wait('<strong>正在获取引用内容中&hellip;</strong><i>剩余：<em class="pd_countdown">'+o.length+"</em></i>"),$(document).clearQueue("MultiQuote")),$.each(o,function(t,i){void 0!==i.floor&&void 0!==i.pid&&(k.add(i.userName),2===e?$(document).queue("MultiQuote",function(){$.get("post.php?action=quote&fid="+a+"&tid="+n+"&pid="+i.pid+"&article="+i.floor+"&t="+$.now(),function(e){var n=/<textarea id="textarea".*?>((.|\n)+?)<\/textarea>/i.exec(e);n&&(C+=s.removeUnpairedBBCodeContent(s.htmlDecode(n[1]).replace(/\n{2,}/g,"\n"))+(t===o.length-1?"":"\n"));var a=$(".pd_countdown:last");a.text(parseInt(a.text())-1),t===o.length-1?(p.destroy(),$("#textarea").val(C).focus(),w.trigger("change")):setTimeout(function(){$(document).dequeue("MultiQuote")},100)})}):C+="[quote]回 "+i.floor+"楼("+i.userName+") 的帖子[/quote]\n")}),w.val([].concat(i(k)).join(",")),$('form[name="FORM"]').submit(function(){localStorage.removeItem(u.default.multiQuoteStorageName)}),2===e?$(document).dequeue("MultiQuote"):($('[name="atc_content"]').val(C).focus(),w.trigger("change")),g.runFunc("Post.handleMultiQuote_after_",e)}}}},n.removeUnpairedBBCodeInQuoteContent=function(){var e=$("#textarea"),t=e.val(),n=/\[quote\](.|\r|\n)+?\[\/quote\]/.exec(t);if(n){var a=s.removeUnpairedBBCodeContent(n[0]);n[0]!==a&&e.val(t.replace(n[0],a))}},n.addExtraPostEditorButton=function(){var e=$("#textarea").get(0);e&&$('\n<span id="wy_post" title="插入隐藏内容" data-type="hide" style="background-position: 0 -280px;">插入隐藏内容</span>\n<span id="wy_justifyleft" title="左对齐" data-type="left" style="background-position: 0 -360px;">左对齐</span>\n<span id="wy_justifycenter" title="居中" data-type="center" style="background-position: 0 -380px;">居中</span>\n<span id="wy_justifyright" title="右对齐" data-type="right" style="background-position: 0 -400px;">右对齐</span>\n<span id="wy_subscript" title="下标" data-type="sub" style="background-position: 0 -80px;">下标</span>\n<span id="wy_superscript" title="上标" data-type="sup" style="background-position: 0 -100px;">上标</span>\n<span class="pd_editor_btn" title="插入飞行文字" data-type="fly">F</span>\n<span class="pd_editor_btn" title="插入HTML5音频" data-type="audio">A</span>\n<span class="pd_editor_btn" title="插入HTML5视频" data-type="video">V</span>\n').appendTo("#editor-button .editor-button").click(function(){var t=$(this),n=t.data("type"),a="";switch(n){case"hide":a=prompt("请输入神秘等级：",5);break;case"audio":a=prompt("请输入HTML5音频实际地址：\n（可直接输入网易云音乐的单曲地址，将自动转换为外链地址）","http://");var o=/^https?:\/\/music\.163\.com\/(?:#\/)?song\?id=(\d+)/i.exec(a);o&&(a="http://music.miaola.info/163/"+o[1]+".mp3"),o=/^https?:\/\/www\.xiami\.com\/song\/(\w+)/i.exec(a),o&&(a="http://music.miaola.info/xiami/"+o[1]+".mp3");break;case"video":a=prompt("请输入HTML5视频实际地址：\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）","http://");var i=/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w\-]+)/i.exec(a);i&&(a="http://video.miaola.info/youtube/"+i[1]),i=/^https?:\/\/youtu\.be\/([\w\-]+)$/i.exec(a),i&&(a="http://video.miaola.info/youtube/"+i[1])}if(null!==a){var r="",l="";switch(n){case"hide":r=s.getSelText(e),l="[hide="+a+"]"+r+"[/hide]";break;case"left":r=s.getSelText(e),l="[align=left]"+r+"[/align]";break;case"center":r=s.getSelText(e),l="[align=center]"+r+"[/align]";break;case"right":r=s.getSelText(e),l="[align=right]"+r+"[/align]";break;case"fly":r=s.getSelText(e),l="[fly]"+r+"[/fly]";break;case"sub":r=s.getSelText(e),l="[sub]"+r+"[/sub]";break;case"sup":r=s.getSelText(e),l="[sup]"+r+"[/sup]";break;case"audio":l="[audio]"+a+"[/audio]";break;case"video":l="[video]"+a+"[/video]"}l&&(s.addCode(e,l,r),e.focus())}}).mouseenter(function(){$(this).addClass("buttonHover")}).mouseleave(function(){$(this).removeClass("buttonHover")})},n.addExtraOptionInPostPage=function(){$('\n<div class="pd_post_extra_option">\n  <label><input type="checkbox" name="autoAnalyzeUrl" checked> 自动分析url</label><br>\n  <label><input type="checkbox" name="windCodeAutoConvert" checked> Wind Code自动转换</label>\n</div>\n').appendTo($("#menu_show").closest("td")).on("click",'[type="checkbox"]',function(){var e=$(this),t=e.is('[name="autoAnalyzeUrl"]')?"atc_autourl":"atc_convert";$('form[name="FORM"]').find('[name="'+t+'"]').val(e.prop("checked")?1:0)}),$('<input type="button" value="预览帖子" style="margin-left: 7px;">').insertAfter('[type="submit"][name="Submit"]').click(function(e){e.preventDefault();var t=$('form[name="preview"]');t.find('input[name="atc_content"]').val($("#textarea").val()),t.submit()})},n.modifyPostPreviewPage=function(){$("table > tbody > tr.tr1 > th").css({"text-align":"left","font-weight":"normal",border:"1px solid #9191ff",padding:"10px"})},n.addAttachChangeAlert=function(){$(document).on("click",'.abtn[id^="md_"]',function(){$(document).data("attachUpdateAlert")||(alert("本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果"),$(document).data("attachUpdateAlert",!0))})},n.importKfSmileEnhanceExtension=function(){var e=document.createElement("script");e.type="text/javascript",e.charset="utf-8",e.src="https://kf.miaola.info/KfEmotion.min.user.js"+(void 0!==l.default.w.resTimestamp?"?ts="+l.default.w.resTimestamp:""),document.body.appendChild(e)},n.preventCloseWindowWhenEditPost=function(){window.addEventListener("beforeunload",function(e){var t=$("/post.php"===location.pathname?"#textarea":'input[name="atc_content"]'),n=t.val();if(n&&n!==t.get(0).defaultValue&&!/\[\/quote]\n*$/.test(n)&&!l.default.w.isSubmit){var a="你可能正在撰写发帖内容中，确定要关闭页面吗？";return e.returnValue=a,a}}),$('form[action="post.php?"]').submit(function(){l.default.w.isSubmit=!0})},n.savePostContentWhenSubmit=function(){var e=$("/post.php"===location.pathname?"#textarea":'input[name="atc_content"]');$('form[action="post.php?"]').submit(function(){var t=e.val();$.trim(t).length>0&&sessionStorage.setItem(u.default.postContentStorageName,t)});var t=sessionStorage.getItem(u.default.postContentStorageName);t&&$('\n<div style="padding: 0 10px; line-height: 2em; text-align: left; background-color: #fefee9; border: 1px solid #99f;">\n  <a class="pd_btn_link" data-name="restore" href="#">[恢复上次提交的内容]</a>\n  <a class="pd_btn_link" data-name="clear" href="#">[清除]</a>\n</div>\n').insertBefore(e).find('[data-name="restore"]').click(function(n){n.preventDefault(),e.val(t),$(this).parent().find('[data-name="clear"]').click()}).end().find('[data-name="clear"]').click(function(e){e.preventDefault(),sessionStorage.removeItem(u.default.postContentStorageName),$(this).parent().remove()})},n.addRedundantKeywordWarning=function(){$('input[name="diy_guanjianci"]').change(function(){var e=$(this);$.trim(e.val()).split(",").filter(function(e){return e}).length>5&&(alert("所填关键词已超过5个，多余的关键词将被忽略"),e.select().focus())})}},{"./Const":6,"./Info":9,"./Msg":15,"./Script":20,"./Util":22}],18:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addSlowActionChecked=exports.changeNewRateTipsColor=exports.showCommonImportOrExportConfigDialog=exports.checkRatingSize=exports.turnPageViaKeyboard=exports.repairBbsErrorCode=exports.addSearchDialogLink=exports.makeSearchByBelowTwoKeyWordAvailable=exports.bindSearchTypeSelectMenuClick=exports.bindElementTitleClick=exports.showElementTitleTips=exports.changeIdColor=exports.autoSaveCurrentDeposit=exports.addFastNavMenu=exports.modifySideBar=exports.blockThread=exports.blockUsers=exports.followUsers=exports.getDailyBonus=exports.startTimingMode=exports.getNextTimingIntervalInfo=exports.addPolyfill=exports.showFormatLog=exports.preventCloseWindowWhenActioning=exports.addConfigAndLogDialogLink=exports.appendCss=exports.checkBrowserType=exports.getSafeId=exports.getUidAndUserName=void 0;var _slicedToArray=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Msg=require("./Msg"),Msg=_interopRequireWildcard(_Msg),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Config=require("./Config"),_ConfigDialog=require("./ConfigDialog"),_Log=require("./Log"),Log=_interopRequireWildcard(_Log),_LogDialog=require("./LogDialog"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_Script=require("./Script"),Script=_interopRequireWildcard(_Script),_Read=require("./Read"),Read=_interopRequireWildcard(_Read),_Loot=require("./Loot"),Loot=_interopRequireWildcard(_Loot),getUidAndUserName=exports.getUidAndUserName=function(){var e=$('.topmenuo1 > .topmenuo3:last-child > a[href="javascript:;"]').eq(0),t=$('.topmenuo1 > .topmenuo3:last-child a[href^="profile.php?action=show&uid="]').eq(0);if(!e.length||!t.length)return!1;if(e.attr("id","pdUserName"),_Info2.default.userName=$.trim(e.contents().get(0).textContent),!_Info2.default.userName)return!1;var n=/&uid=(\d+)/.exec(t.attr("href"));return!!n&&(_Info2.default.uid=parseInt(n[1]),!0)},getSafeId=exports.getSafeId=function(){var e=$("input#safeid").val();if(!e){var t=/safeid=(\w+)/i.exec($('a[href*="safeid="]:first').attr("href"));t&&(e=t[1])}return e?e:""},checkBrowserType=exports.checkBrowserType=function(){"auto"===Config.browseType?_Info2.default.isMobile=/(Mobile|MIDP)/i.test(navigator.userAgent):_Info2.default.isMobile="mobile"===Config.browseType},appendCss=exports.appendCss=function(){$("head").append('\n<style>\n  /* 公共 */\n  .pd_highlight { color: #f00 !important; }\n  .pd_notice, .pd_msg .pd_notice { font-style: italic; color: #666; }\n  .pd_input, .pd_cfg_main input, .pd_cfg_main select {\n    vertical-align: middle; height: auto; margin-right: 0; line-height: 22px; font-size: 12px;\n  }\n  .pd_input[type="text"], .pd_input[type="number"], .pd_cfg_main input[type="text"], .pd_cfg_main input[type="number"] {\n    height: 22px; line-height: 22px;\n  }\n  .pd_input:focus, .pd_cfg_main input[type="text"]:focus, .pd_cfg_main input[type="number"]:focus, .pd_cfg_main textarea:focus,\n      .pd_textarea:focus { border-color: #7eb4ea; }\n  .pd_textarea, .pd_cfg_main textarea { border: 1px solid #ccc; font-size: 12px; }\n  .pd_btn_link { margin-left: 4px; margin-right: 4px; }\n  .pd_custom_tips { cursor: help; }\n  .pd_disabled_link { color: #999 !important; text-decoration: none !important; cursor: default; }\n  hr {\n    box-sizing: content-box; height: 0; margin-top: 7px; margin-bottom: 7px; border: 0;\n    border-top: 1px solid rgba(0, 0, 0, .2); overflow: visible;\n  }\n  .pd_overflow { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n  .pd_hide { width: 0 !important; height: 0 !important; font: 0/0 a; color: transparent; background-color: transparent; border: 0 !important; }\n  .pd_stat i { display: inline-block; font-style: normal; margin-right: 3px; }\n  .pd_stat_extra em, .pd_stat_extra ins { padding: 0 2px; cursor: help; }\n  .pd_panel { position: absolute; overflow-y: auto; background-color: #fff; border: 1px solid #9191ff; opacity: 0.9; }\n  .pd_title_tips {\n    position: absolute; max-width: 470px; font-size: 12px; line-height: 1.5em;\n    padding: 2px 5px; background-color: #fcfcfc; border: 1px solid #767676; z-index: 9999;\n  }\n  .pd_search_type {\n    float: left; height: 26px; line-height: 26px; width: 65px; text-align: center; border: 1px solid #ccc; border-left: none; cursor: pointer;\n  }\n  .pd_search_type i { font-style: normal; margin-left: 5px; font-family: sans-serif; }\n  .pd_search_type_list {\n    position: absolute; width: 63px; background-color: #fcfcfc; border: 1px solid #ccc; border-top: none; line-height: 26px;\n    text-indent: 13px; cursor: pointer; z-index: 1003;\n  }\n  .pd_search_type_list li:hover { color: #fff; background-color: #87c3cf; }\n  '+(_Info2.default.isMobile?".topmenu { position: static; }":"")+"\n  "+(_Info2.default.isMobile?".r_cmenu { position: static !important; }":"")+"\n  .topmenu { z-index: 1; }\n  \n  /* 消息框 */\n  .pd_mask { position: fixed; width: 100%; height: 100%; left: 0; top: 0; z-index: 1001; }\n  .pd_msg_container { position: "+(_Info2.default.isMobile?"absolute":"fixed")+'; width: 100%; z-index: 1002; }\n  .pd_msg {\n    border: 1px solid #6ca7c0; text-shadow: 0 0 3px rgba(0, 0, 0, 0.1); border-radius: 3px; padding: 10px 40px; text-align: center;\n    font-size: 14px; position: absolute; display: none; color: #333; line-height: 1.6em; background: #f8fcfe; background-repeat: no-repeat;\n    background-image: -webkit-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -moz-linear-gradient(top, #f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -ms-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n  }\n  .pd_msg strong { margin-right: 5px; }\n  .pd_msg i { font-style: normal; padding-left: 10px; }\n  .pd_msg em, .pd_stat em, .pd_msg ins, .pd_stat ins { font-weight: 700; font-style: normal; color:#ff6600; padding: 0 3px; }\n  .pd_msg ins, .pd_stat ins { text-decoration: none; color: #339933; }\n  .pd_msg a { font-weight: bold; margin-left: 15px; }\n  \n  /* 帖子页面 */\n  .readlou .pd_goto_link { color: #000; }\n  .readlou .pd_goto_link:hover { color: #51d; }\n  .pd_fast_goto_floor, .pd_multi_quote_chk { margin-right: 2px; }\n  .pd_user_memo { font-size: 12px; color: #999; line-height: 14px; }\n  .pd_user_memo_tips { font-size: 12px; color: #fff; margin-left: 3px; cursor: help; }\n  .pd_user_memo_tips:hover { color: #ddd; }\n  .readtext img[onclick] { max-width: 550px; }\n  .read_fds { text-align: left !important; font-weight: normal !important; font-style: normal !important; }\n  .pd_code_area { max-height: 550px; overflow-y: auto; font-size: 12px; font-family: Consolas, "Courier New"; }\n  \n  /* 我的物品页面 */\n  .pd_item_btns { text-align: right; margin-top: 5px;  }\n  .pd_item_btns button, .pd_item_btns input { margin-bottom: 2px; vertical-align: middle; }\n  .pd_result { border: 1px solid #99f; padding: 5px; margin-top: 10px; line-height: 2em; }\n  .pd_arm_equipped { background-color:#EEEEFF; -webkit-box-shadow: 0 0 7px #99f; box-shadow: 0 0 7px #99f; }\n  .pd_arm_equipped > td:nth-child(3)::before { content: "（装备中）"; font-weight: bold; }\n  .pd_arm_equipped a[data-name="equip"], .pd_arm_equipped a[data-name="smelt"] { color: #777; pointer-events: none; }\n  .kf_fw_ig4 > tbody > tr > td:nth-child(3) { position: relative; }\n  .kf_fw_ig4 > tbody > tr > td[data-memo]::after {\n    content: "(" attr(data-memo) ")"; position: absolute; bottom: 0; right: 5px; padding: 0 5px; color: #777; background: rgba(252, 252, 252, .9);\n  }\n  .kf_fw_ig4 > tbody > .pd_arm_equipped > td[data-memo]::after { background: rgba(238, 238, 255, .9); }\n  .show_arm_info { position: absolute; top: 0; right: 0; padding: 0 10px; background: rgba(252, 252, 252, .9); }\n  .pd_arm_equipped .show_arm_info { background: rgba(238, 238, 255, .9); }\n  \n  /* 发帖页面 */\n  #pdSmilePanel img { margin: 3px; cursor: pointer; }\n  .editor-button .pd_editor_btn { background: none; text-indent: 0; line-height: 18px; cursor: default; }\n  .pd_post_extra_option { text-align: left; margin-top: 5px; margin-left: 5px; }\n  .pd_post_extra_option input { vertical-align: middle; height: auto; margin-right: 0; }\n  \n  /* 其它页面 */\n  .pd_thread_page { margin-left: 5px; }\n  .pd_thread_page a { color: #444; padding: 0 3px; }\n  .pd_thread_page a:hover { color: #51d; }\n  .pd_card_chk { position: absolute; bottom: -8px; left: 1px; }\n  .b_tit4 .pd_thread_goto, .b_tit4_1 .pd_thread_goto { position: absolute; top: 0; right: 0; padding: 0 15px; }\n  .b_tit4 .pd_thread_goto:hover, .b_tit4_1 .pd_thread_goto:hover { padding-left: 15px; }\n  .pd_id_color_select > td { position: relative; cursor: pointer; }\n  .pd_id_color_select > td > input { position: absolute; top: 18px; left: 10px; }\n  .pd_property_diff { position: absolute; top: 0px; right: 28px; }\n  .pd_property_diff em { font-style: normal; }\n\n  /* 设置对话框 */\n  .pd_cfg_ml { margin-left: 10px; }\n  .pd_cfg_box {\n    position: '+(_Info2.default.isMobile?"absolute":"fixed")+'; border: 1px solid #9191ff; display: none; z-index: 1000;\n    -webkit-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); -moz-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);\n  }\n  .pd_cfg_box h1 {\n    text-align: center; font-size: 14px; background-color: #9191ff; color: #fff; line-height: 2em; margin: 0; padding-left: 20px;\n  }\n  .pd_cfg_box h1 span { float: right; cursor: pointer; padding: 0 10px; }\n  .pd_cfg_nav { text-align: right; margin-top: 5px; margin-bottom: -5px; }\n  .pd_cfg_main { background-color: #fcfcfc; padding: 0 10px; font-size: 12px; line-height: 24px; min-height: 50px; overflow: auto; }\n  .pd_cfg_main fieldset { border: 1px solid #ccccff; padding: 0 6px 6px; }\n  .pd_cfg_main legend { font-weight: bold; }\n  .pd_cfg_main input[type="color"] { height: 18px; width: 30px; padding: 0; }\n  .pd_cfg_main button { vertical-align: middle; }\n  .pd_cfg_tips { color: #51d; text-decoration: none; cursor: help; }\n  .pd_cfg_tips:hover { color: #ff0000; }\n  #pdConfigDialog .pd_cfg_main { overflow-x: hidden; white-space: nowrap; }\n  .pd_cfg_panel { display: inline-block; width: 400px; vertical-align: top; }\n  .pd_cfg_panel + .pd_cfg_panel { margin-left: 5px; }\n  .pd_cfg_btns { background-color: #fcfcfc; text-align: right; padding: 5px; }\n  .pd_cfg_btns button { min-width: 80px; }\n  .pd_cfg_about { float: left; line-height: 24px; margin-left: 5px; }\n  .pd_custom_script_header { margin: 7px 0; padding: 5px; background-color: #e8e8e8; border-radius: 5px; }\n  .pd_custom_script_content { display: none; width: 750px; height: 350px; white-space: pre; }\n\n  /* 日志对话框 */\n  .pd_log_nav { text-align: center; margin: -5px 0 -12px; font-size: 14px; line-height: 44px; }\n  .pd_log_nav a { display: inline-block; }\n  .pd_log_nav h2 { display: inline; font-size: 14px; margin-left: 7px; margin-right: 7px; }\n  .pd_log_content { height: 242px; overflow: auto; }\n  .pd_log_content h3 { display: inline-block; font-size: 12px; line-height: 22px; margin: 0; }\n  .pd_log_content h3:not(:first-child) { margin-top: 5px; }\n  .pd_log_content p { line-height: 22px; margin: 0; }\n</style>\n'),Config.customCssEnabled&&$("head").append("<style>"+Config.customCssContent+"</style>")},addConfigAndLogDialogLink=exports.addConfigAndLogDialogLink=function(){$('\n<li><a data-name="openConfigDialog" href="#">助手设置</a></li>\n<li><a data-name="openLogDialog" href="#">助手日志</a></li>\n').insertBefore(_Info2.default.$userMenu.find("> li:nth-last-child(1)")).find('[data-name="openConfigDialog"]').click(function(e){e.preventDefault(),(0,_ConfigDialog.show)()}).end().find('[data-name="openLogDialog"]').click(function(e){e.preventDefault(),(0,_LogDialog.show)()})},preventCloseWindowWhenActioning=exports.preventCloseWindowWhenActioning=function(e){if($(".pd_mask").length>0){var t="操作正在进行中，确定要关闭页面吗？";return e.returnValue=t,t}},showFormatLog=exports.showFormatLog=function(e,t){var n=Util.getResponseMsg(t),a=n.msg,o=n.url;console.log("【"+e+"】回应："+a+(o?"；跳转地址："+Util.getHostNameUrl()+o:""))},addPolyfill=exports.addPolyfill=function(){Array.prototype.includes||(Array.prototype.includes=function(e){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),n=parseInt(t.length)||0;if(0===n)return!1;var a=parseInt(arguments[1])||0,o=void 0;a>=0?o=a:(o=n+a)<0&&(o=0);for(var i=void 0;o<n;){if(i=t[o],e===i||e!==e&&i!==i)return!0;o++}return!1}),String.prototype.padStart||(String.prototype.padStart=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",n=Object(this),a=String(n),o=parseInt(e)||0,i=parseInt(a.length)||0;if(o<=i)return a;var r=void 0===t?" ":String(t);if(""===r)return a;for(var l=o-i;r.length<l;){var d=r.length,s=l-d;r+=d>s?r.slice(0,s):r}return r.slice(0,l)+a}),String.prototype.padEnd||(String.prototype.padEnd=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",n=Object(this),a=String(n),o=parseInt(e)||0,i=parseInt(a.length)||0;if(o<=i)return a;var r=void 0===t?" ":String(t);if(""===r)return a;for(var l=o-i;r.length<l;){var d=r.length,s=l-d;r+=d>s?r.slice(0,s):r}return a+r.slice(0,l)})},getNextTimingIntervalInfo=exports.getNextTimingIntervalInfo=function(){var e=-1;if(Config.autoPromoteHaloEnabled){var t=parseInt(Util.getCookie(_Const2.default.promoteHaloCookieName));e=t>0?Math.floor((t-$.now())/1e3):0}var n=-1;if(Config.autoLootEnabled||Config.autoSaveLootLogInSpecialCaseEnabled){var a=parseInt(Util.getCookie(_Const2.default.lootCompleteCookieName));if(a<0)n=60*_Const2.default.checkLootInterval;else{var o=Util.getDateByTime(Config.checkLootAfterTime),i=new Date;a>0&&i>o&&o.setDate(o.getDate()+1),n=Math.floor((o-i)/1e3),n<0&&(n=0)}if(Util.getCookie(_Const2.default.lootAttackingCookieName))n=60*_Const2.default.lootAttackingExpires;else{var r=Util.getCookie(_Const2.default.changePointsInfoCookieName);r=$.isNumeric(r)?parseInt(r):0,r>0&&(n=Math.floor((r-$.now())/1e3))}}var l=-1;if(Config.autoGetDailyBonusEnabled){var d=parseInt(Util.getCookie(_Const2.default.getDailyBonusCookieName));if(d>0){var s=Util.getTimezoneDateByTime(_Const2.default.getDailyBonusAfterTime);s.setDate(s.getDate()+1);var c=new Date;c>s&&s.setDate(s.getDate()+1),l=Math.floor((s-c)/1e3)}else l=d<0?60*_Const2.default.getDailyBonusSpecialInterval:0}var p=[{action:"提升战力光环",interval:e},{action:"检查争夺情况",interval:n},{action:"自动获取每日奖励",interval:l}],f="",u=-1,m=!0,g=!1,h=void 0;try{for(var v,b=p.filter(function(e){return e.interval>-1})[Symbol.iterator]();!(m=(v=b.next()).done);m=!0){var y=v.value,_=y.action,x=y.interval;(u<0||x<u)&&(f=_,u=x)}}catch(e){g=!0,h=e}finally{try{!m&&b.return&&b.return()}finally{if(g)throw h}}return{action:u>0?f:"",interval:u}},startTimingMode=exports.startTimingMode=function(){var e=getNextTimingIntervalInfo(),t=e.action,n=e.interval;if(n!==-1){var a=document.title,o=null,i=-1,r=0,l=function(e,t){var n=Util.getTimeDiffInfo(Util.getDate("+"+t+"s").getTime()),a=n.hours>0?n.hours+"时":"";return a+=1===e?(n.minutes>0?n.minutes+"分":"")+n.seconds+"秒":n.minutes+"分"},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o&&window.clearInterval(o);var i=e;if(console.log("【定时模式】倒计时"+(t?"("+t+")":"")+"："+l(1,i)),"never"!==Config.showTimingModeTipsType.toLowerCase()){var r=function(){document.title=a+" (定时: "+l(e<60?1:2,i)+")",i=e<60?i-1:i-60};n||"always"===Config.showTimingModeTipsType.toLowerCase()||e<60?r():i=e<60?i-1:i-60,o=setInterval(r,60*_Const2.default.showRefreshModeTipsInterval*1e3)}},s=function e(){var t=0,n="";$.ajax({type:"GET",url:"index.php?t="+$.now(),timeout:_Const2.default.defAjaxTimeout,success:function(e){/"kf_fw_ig_index.php"/.test(e)||(t=10,n="论坛维护或其它未知情况")},error:function(){t=_Const2.default.errorRefreshInterval,n="连接超时"},complete:function(){t>0?(console.log("定时操作失败（原因："+n+"），将在"+t+"分钟后重试..."),Msg.remove($(".pd_refresh_notice").parent()),Msg.show('<strong class="pd_refresh_notice">定时操作失败（原因：'+n+"），将在<em>"+t+"</em>分钟后重试&hellip;</strong>",-1),setTimeout(e,60*t*1e3),d(60*t,"",!0)):r>6?(r=0,t=15,setTimeout(c,60*t*1e3),d(60*t,"",!0)):(r++,c())}})},c=function e(){Msg.remove($(".pd_refresh_notice").parent());var t=!1;Config.autoPromoteHaloEnabled&&!Util.getCookie(_Const2.default.promoteHaloCookieName)&&(t=!0,Loot.getPromoteHaloInfo()),Util.getCookie(_Const2.default.lootCompleteCookieName)||(Config.autoLootEnabled&&!t?Util.getCookie(_Const2.default.lootAttackingCookieName)||$.isNumeric(Util.getCookie(_Const2.default.changePointsInfoCookieName))||Loot.checkLoot():Config.autoSaveLootLogInSpecialCaseEnabled&&Loot.autoSaveLootLog()),Config.autoGetDailyBonusEnabled&&!Util.getCookie(_Const2.default.getDailyBonusCookieName)&&getDailyBonus();var n=getNextTimingIntervalInfo(),a=n.action,l=n.interval;return l>0&&(r=0),0===l&&0===i?(i=-1,void s()):(i=l,l===-1?void(o&&clearInterval(o)):(0===l&&(l=_Const2.default.actionFinishRetryInterval),setTimeout(e,1e3*l),void d(l,a,!0)))};setTimeout(c,n<60?6e4:1e3*n),d(n<60?60:n,t)}},getDailyBonus=exports.getDailyBonus=function e(){Script.runFunc("Public.getDailyBonus_before_"),console.log("领取每日奖励Start");var t=Msg.wait("<strong>正在领取每日奖励，请稍候&hellip;</strong>"),n=function(){var e=Util.getTimezoneDateByTime(_Const2.default.getDailyBonusAfterTime);return e.setDate(e.getDate()+1),new Date>e&&e.setDate(e.getDate()+1),e};$.ajax({type:"GET",url:"kf_growup.php?t="+$.now(),timeout:_Const2.default.defAjaxTimeout}).done(function(e){var a=/<a href="(kf_growup\.php\?ok=3&safeid=\w+)" target="_self">你可以领取\s*(\d+)KFB\s*\+\s*(\d+)经验\s*\+\s*(\d+(?:\.\d+)?)贡献\s*\+\s*(\d+)转账额度/.exec(e);if(a){if(Config.getBonusAfterLootCompleteEnabled&&!/<div class="gro_divlv">\r\n争夺奖励/.test(e))return Util.setCookie(_Const2.default.getDailyBonusCookieName,-1,Util.getDate("+"+_Const2.default.getDailyBonusSpecialInterval+"m")),void Msg.remove(t);if(Config.getBonusAfterSpeakCompleteEnabled&&!/<div class="gro_divlv">\r\n发言奖励/.test(e))return Util.setCookie(_Const2.default.getDailyBonusCookieName,-1,Util.getDate("+"+_Const2.default.getDailyBonusSpecialInterval+"m")),void Msg.remove(t);var o=a[1],i={};parseInt(a[2])>0&&(i.KFB=parseInt(a[2])),parseInt(a[3])>0&&(i["经验值"]=parseInt(a[3])),parseFloat(a[4])>0&&(i["贡献"]=parseFloat(a[4])),parseInt(a[5])>0&&(i["转账额度"]=parseInt(a[5])),$.get(o+"&t="+$.now(),function(e){Util.setCookie(_Const2.default.getDailyBonusCookieName,1,n()),showFormatLog("领取每日奖励",e);var a=Util.getResponseMsg(e),o=a.msg;if(Msg.remove(t),/领取成功/.test(o)){var r="",l="",d=!0,s=!1,c=void 0;try{for(var p,f=Util.entries(i)[Symbol.iterator]();!(d=(p=f.next()).done);d=!0){var u=_slicedToArray(p.value,2),m=u[0],g=u[1];r+=m+"+"+g+" ",l+="<i>"+m+"<em>+"+g.toLocaleString()+"</em></i>"}}catch(e){s=!0,c=e}finally{try{!d&&f.return&&f.return()}finally{if(s)throw c}}console.log("领取每日奖励，"+r),Msg.show("<strong>领取每日奖励</strong>"+l,-1),$.isEmptyObject(i)||Log.push("领取每日奖励","领取每日奖励",{gain:i}),Config.promoteHaloLimit>0&&Util.deleteCookie(_Const2.default.promoteHaloCookieName)}Script.runFunc("Public.getDailyBonus_after_",o)}).fail(function(){return Msg.remove(t)})}else Msg.remove(t),Util.setCookie(_Const2.default.getDailyBonusCookieName,1,n())}).fail(function(){Msg.remove(t),setTimeout(e,_Const2.default.defAjaxInterval)})},followUsers=exports.followUsers=function(){Config.followUserList.length&&(_Info2.default.isInHomePage&&Config.highlightFollowUserThreadInHPEnabled?$(".b_tit4 > a, .b_tit4_1 > a").each(function(){var e=$(this),t=/》by：(.+)/.exec(e.attr("title"));t&&Util.inFollowOrBlockUserList(t[1],Config.followUserList)>-1&&e.addClass("pd_highlight")}):"/thread.php"===location.pathname?$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&(e.addClass("pd_highlight"),Config.highlightFollowUserThreadLinkEnabled&&e.parent("td").prev("td").prev("td").find('div > a[href^="read.php?tid="]').addClass("pd_highlight"))}):"/read.php"===location.pathname?$(".readidmsbottom > a, .readidmleft > a").each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.closest(".readtext").prev("div").prev(".readlou").find("div:nth-child(2) > span:first-child").find("a").addBack().addClass("pd_highlight")}):"/guanjianci.php"===location.pathname||"/kf_share.php"===location.pathname?$(".kf_share1 > tbody > tr > td:last-child").each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.addClass("pd_highlight")}):"/search.php"===location.pathname&&$('.thread1 a[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.addClass("pd_highlight")}))},blockUsers=exports.blockUsers=function(){if(Config.blockUserList.length){var e=0;if(_Info2.default.isInHomePage)$(".b_tit4 > a, .b_tit4_1 > a").each(function(){var t=$(this),n=/》by：(.+)/.exec(t.attr("title"));if(n){var a=Util.inFollowOrBlockUserList(n[1],Config.blockUserList);a>-1&&Config.blockUserList[a].type<2&&(e++,t.parent("li").remove())}});else if("/thread.php"===location.pathname){var t=parseInt($('input[name="f_fid"]:first').val());if(!t)return;if(1===Config.blockUserForumType&&!Config.blockUserFidList.includes(t))return;if(2===Config.blockUserForumType&&Config.blockUserFidList.includes(t))return;$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var t=$(this),n=Util.inFollowOrBlockUserList(t.text(),Config.blockUserList);n>-1&&Config.blockUserList[n].type<2&&(e++,t.closest("tr").remove())})}else if("/read.php"===location.pathname){if(Config.blockUserForumType>0){var n=parseInt($('input[name="fid"]:first').val());if(!n)return;if(1===Config.blockUserForumType&&!Config.blockUserFidList.includes(n))return;if(2===Config.blockUserForumType&&Config.blockUserFidList.includes(n))return}var a=Util.getCurrentThreadPage();$(".readidmsbottom > a, .readidmleft > a").each(function(t){var n=$(this),o=Util.inFollowOrBlockUserList(n.text(),Config.blockUserList);if(o>-1){var i=Config.blockUserList[o].type;if(0===t&&1===a&&i>1)return;if((0===t&&1!==a||t>0)&&1===i)return;e++;var r=n.closest(".readtext");r.prev("div").prev(".readlou").remove(),r.prev("div").remove(),r.next(".readlou").remove(),r.remove()}}),$('.readtext fieldset:has(legend:contains("Quote:"))').each(function(){var e=$(this),t=e.text(),n=!0,a=!1,o=void 0;try{for(var i,r=Config.blockUserList[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;if(1!==l.type)try{var d=new RegExp("^Quote:引用(第\\d+楼|楼主)"+l.name+"于","i"),s=new RegExp("^Quote:回\\s*\\d+楼\\("+l.name+"\\)\\s*的帖子","i");(d.test(t)||s.test(t))&&e.html('<legend>Quote:</legend><mark class="pd_custom_tips" title="被屏蔽用户：'+l.name+'">该用户已被屏蔽</mark>')}catch(e){}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}})
}else"/guanjianci.php"===location.pathname&&Config.blockUserAtTipsEnabled&&$(".kf_share1 > tbody > tr > td:last-child").each(function(){var t=$(this);Util.inFollowOrBlockUserList(t.text(),Config.blockUserList)>-1&&(e++,t.closest("tr").remove())});e>0&&console.log("【屏蔽用户】共有"+e+"个帖子或回复被屏蔽")}},blockThread=exports.blockThread=function blockThread(){if(Config.blockThreadList.length){var isBlock=function isBlock(title,userName){var fid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _iterator4=Config.blockThreadList[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var _step4$value=_step4.value,keyWord=_step4$value.keyWord,includeUser=_step4$value.includeUser,excludeUser=_step4$value.excludeUser,includeFid=_step4$value.includeFid,excludeFid=_step4$value.excludeFid,regex=null;if(/^\/.+\/[gimuy]*$/.test(keyWord))try{regex=eval(keyWord)}catch(e){console.log(e);continue}if(userName)if(includeUser){if(!includeUser.includes(userName))continue}else if(excludeUser&&excludeUser.includes(userName))continue;if(fid)if(includeFid){if(!includeFid.includes(fid))continue}else if(excludeFid&&excludeFid.includes(fid))continue;if(regex){if(regex.test(title))return!0}else if(title.toLowerCase().includes(keyWord.toLowerCase()))return!0}}catch(e){_didIteratorError4=!0,_iteratorError4=e}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}return!1},num=0;if(_Info2.default.isInHomePage)$(".b_tit4 a, .b_tit4_1 a").each(function(){var e=$(this),t=e.attr("title");if(t){var n=/^《(.+)》by：(.+)$/.exec(t);n&&isBlock(n[1],n[2])&&(num++,e.parent("li").remove())}});else if("/thread.php"===location.pathname){var fid=parseInt($('input[name="f_fid"]:first').val());if(!fid)return;$('.threadtit1 a[href^="read.php"]').each(function(){var e=$(this);isBlock(e.text(),e.closest("tr").find("td:last-child > a.bl").text(),fid)&&(num++,e.closest("tr").remove())})}else if("/read.php"===location.pathname){if(1!==Util.getCurrentThreadPage())return;var title=Read.getThreadTitle();if(!title)return;var $userName=$(".readidmsbottom > a, .readidmleft > a").eq(0);if("楼主"!==$userName.closest(".readtext").prev("div").prev(".readlou").find("div:nth-child(2) > span:first-child").text().trim())return;var userName=$userName.text();if(!userName)return;var _fid2=parseInt($('input[name="fid"]:first').val());if(!_fid2)return;if(isBlock(title,userName,_fid2)){num++;var $lou=$userName.closest(".readtext");$lou.prev("div").prev(".readlou").remove(),$lou.prev("div").remove(),$lou.next(".readlou").remove(),$lou.remove()}}num>0&&console.log("【屏蔽帖子】共有"+num+"个帖子被屏蔽")}},modifySideBar=exports.modifySideBar=function(){$("#r_menu").replaceWith('\n<div id="r_menu" style="width: 140px; color: #9999ff; font-size: 14px; line-height: 24px; text-align: center; border: 1px #ddddff solid; padding: 5px; overflow: hidden;">\n  <span style="color: #ff9999;">游戏</span><br>\n  <a href="thread.php?fid=102">游戏推荐</a> | <a href="thread.php?fid=106">新作动态</a><br>\n  <a href="thread.php?fid=52">游戏讨论</a> | <a href="thread.php?fid=24">疑难互助</a><br>\n  <a href="thread.php?fid=16">种子下载</a> | <a href="thread.php?fid=41">网盘下载</a><br>\n  <a href="thread.php?fid=67">图片共享</a> | <a href="thread.php?fid=57">同人漫本</a><br>\n  <span style="color: #ff9999;">动漫音乐</span><br>\n  <a href="thread.php?fid=84">动漫讨论</a> | <a href="thread.php?fid=92">动画共享</a><br>\n  <a href="thread.php?fid=127">漫画小说</a> | <a href="thread.php?fid=68">音乐共享</a><br>\n  <a href="thread.php?fid=163">LIVE共享</a>  | <a href="thread.php?fid=182">转载资源</a><br>\n  <span style="color: #ff9999;">综合</span><br>\n  <a href="thread.php?fid=94">原创美图</a> | <a href="thread.php?fid=87">宅物交流</a><br>\n  <a href="thread.php?fid=86">电子产品</a> | <a href="thread.php?fid=115">文字作品</a><br>\n  <a href="thread.php?fid=96">出处讨论</a>  | <a href="thread.php?fid=36">寻求资源</a><br>\n  <span style="color: #ff9999;">交流</span><br>\n  <a href="thread.php?fid=5">自由讨论</a> | <a href="thread.php?fid=56">个人日记</a><br>\n  <a href="thread.php?fid=98">日本语版</a>  | <a href="thread.php?fid=9">我的关注</a><br>\n  <a href="thread.php?fid=4">站务管理</a><br>\n  <span style="color: #ff9999;">专用</span><br>\n  <a href="thread.php?fid=93">管理组区</a> | <a href="thread.php?fid=59">原创组区</a><br>\n  <a href="/">论坛首页</a><br>\n</div>\n')},addFastNavMenu=exports.addFastNavMenu=function(){var e=$('.topmenuo1 > .topmenuo3:nth-last-child(2) > a:contains("本站主页")');if(e.length){var t=e.attr("href");e.text("快捷导航").attr("href","javascript:;").removeAttr("target").after('\n<ul class="topmenuo2">\n  <li><a href="'+t+'" target="_blank">本站主页</a></li>\n  <li><a href="guanjianci.php?gjc='+_Info2.default.userName+'">@提醒</a></li>\n  <li><a href="search.php?authorid='+_Info2.default.uid+'">我的主题</a></li>\n  <li><a href="personal.php?action=post">我的回复</a></li>\n  <li><a href="kf_fw_ig_mybp.php">我的物品</a></li>\n  <li><a href="kf_fw_ig_shop.php">物品商店</a></li>\n  <li><a href="kf_fw_ig_halo.php">战力光环</a></li>\n  <li><a href="hack.php?H_name=bank">银行</a></li>\n  <li><a href="profile.php?action=favor">收藏</a></li>\n  '+(_Info2.default.isInMiaolaDomain?'<li><a href="https://m.miaola.info/" target="_blank">移动版</a></li>':"")+"\n  "+_Const2.default.customFastNavMenuContent+"\n</ul>")}},autoSaveCurrentDeposit=exports.autoSaveCurrentDeposit=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Config.saveCurrentDepositAfterKfb>0&&Config.saveCurrentDepositKfb>0&&Config.saveCurrentDepositKfb<=Config.saveCurrentDepositAfterKfb){var t=$('a[href="kf_givemekfb.php"]'),n=function(e){if(!(e<Config.saveCurrentDepositAfterKfb)){var t=Math.floor((e-Config.saveCurrentDepositAfterKfb)/Config.saveCurrentDepositKfb);e-Config.saveCurrentDepositKfb*t>=Config.saveCurrentDepositAfterKfb&&t++;var n=Config.saveCurrentDepositKfb*t;n<=0||n>e||(console.log("自动活期存款Start"),$.post("hack.php?H_name=bank",{action:"save",btype:1,savemoney:n},function(e){showFormatLog("自动存款",e);var t=Util.getResponseMsg(e),a=t.msg;/完成存款/.test(a)&&(Log.push("自动存款","共有`"+n+"`KFB已自动存入活期存款"),console.log("共有"+n+"KFB已自动存入活期存款"),Msg.show("共有<em>"+n.toLocaleString()+"</em>KFB已自动存入活期存款"))}))}};if(e)console.log("获取当前持有KFB Start"),$.get("profile.php?action=show&uid="+_Info2.default.uid+"&t="+$.now(),function(e){var t=/论坛货币：(\d+)\s*KFB/.exec(e);t&&n(parseInt(t[1]))});else{var a=parseInt(t.data("kfb"));a&&n(a)}}},changeIdColor=exports.changeIdColor=function(){if(Config.changeAllAvailableIdColorEnabled||!(Config.customAutoChangeIdColorList.length<=1)){var e=function(){var e=Util.getDate("+"+Config.autoChangeIdColorInterval+"h");Util.setCookie(_Const2.default.autoChangeIdColorCookieName,e.getTime(),e)};console.log("自动更换ID颜色Start"),$.get("kf_growup.php?t="+$.now(),function(t){if(!Util.getCookie(_Const2.default.autoChangeIdColorCookieName)){var n=t.match(/href="kf_growup\.php\?ok=2&safeid=\w+&color=\d+"/g);if(n){var a="",o=/safeid=(\w+)&/i.exec(n[0]);if(o&&(a=o[1]),!a)return void e();var i=[];for(var r in n){var l=/color=(\d+)/i.exec(n[r]);l&&i.push(parseInt(l[1]))}var d=i;if(!Config.changeAllAvailableIdColorEnabled){d=[];var s=!0,c=!1,p=void 0;try{for(var f,u=Config.customAutoChangeIdColorList[Symbol.iterator]();!(s=(f=u.next()).done);s=!0){var m=f.value;i.includes(m)&&d.push(m)}}catch(e){c=!0,p=e}finally{try{!s&&u.return&&u.return()}finally{if(c)throw p}}}if(d.length<=1)return void e();var g=parseInt(TmpLog.getValue(_Const2.default.prevAutoChangeIdColorTmpLogName));(isNaN(g)||g<0)&&(g=0);var h=0;if("sequence"===Config.autoChangeIdColorType.toLowerCase()){var v=!0,b=!1,y=void 0;try{for(var _,x=d.entries()[Symbol.iterator]();!(v=(_=x.next()).done);v=!0){var k=_slicedToArray(_.value,2),C=(k[0],k[1]);if(C>g){h=C;break}}}catch(e){b=!0,y=e}finally{try{!v&&x.return&&x.return()}finally{if(b)throw y}}0===h&&(h=d[0])}else{var w=!0,I=!1,L=void 0;try{for(var S,T=d.entries()[Symbol.iterator]();!(w=(S=T.next()).done);w=!0){var D=_slicedToArray(S.value,2),A=D[0];if(D[1]===g){d.splice(A,1);break}}}catch(e){I=!0,L=e}finally{try{!w&&T.return&&T.return()}finally{if(I)throw L}}h=d[Math.floor(Math.random()*d.length)]}$.get("kf_growup.php?ok=2&safeid="+a+"&color="+h+"&t="+$.now(),function(t){e(),showFormatLog("自动更换ID颜色",t);var n=Util.getResponseMsg(t),a=n.msg;/等级颜色修改完毕/.test(a)&&(console.log("ID颜色更换为："+h),TmpLog.setValue(_Const2.default.prevAutoChangeIdColorTmpLogName,h))})}else e()}})}},showElementTitleTips=exports.showElementTitleTips=function(e,t){$(".pd_title_tips").remove(),t&&e.originalEvent&&$('<div class="pd_title_tips">'+t.replace(/\n/g,"<br>")+"</div>").appendTo("body").css("left",e.originalEvent.pageX-20).css("top",e.originalEvent.pageY+15)},bindElementTitleClick=exports.bindElementTitleClick=function(){var e=["A","IMG","INPUT","BUTTON","TEXTAREA","SELECT"];$(document).click(function(t){var n=t.target;!n.title&&!e.includes(n.nodeName)&&n.parentNode&&n.parentNode.title&&(n=n.parentNode),!n.title||e.includes(n.nodeName)||n.id&&n.id.startsWith("wy_")||$(n).is(".pd_editor_btn")?$(".pd_title_tips").remove():showElementTitleTips(t,n.title)})},bindSearchTypeSelectMenuClick=exports.bindSearchTypeSelectMenuClick=function(){$(document).on("click",".pd_search_type",function(){var e=$(this),t=$(".pd_search_type_list");if(t.length>0)return void t.remove();var n=e.data("type");t=$('<ul class="pd_search_type_list"><li>标题</li><li>作者</li><li>关键词</li><li>用户名</li></ul>').appendTo("body");var a=e.offset();t.css("top",a.top+e.height()+2).css("left",a.left+1),"dialog"===n&&t.css({width:"65px",left:a.left-1}),t.on("click","li",function(){var n=$(this),a=n.text().trim(),o=e.closest("form"),i=o.find('input[name="keyword"], input[name="pwuser"]');e.find("span").text(a),"关键词"!==a&&"用户名"!==a&&o.attr("action","search.php?"),"作者"===a?i.attr("name","pwuser"):i.attr("name","keyword");var r=o.find('[name="searchRange"][value="current"]');r.length>0&&r.prop("disabled","关键词"===a||"用户名"===a||!r.data("enabled")),t.remove(),i.focus()})}),$(document).on("submit",'form[name="pdSearchForm"]',function(){var e=$(this),t=$.trim(e.find(".pd_search_type > span").text());"关键词"===t?e.attr("action","guanjianci.php?gjc="+e.find('input[name="keyword"]').val()):"用户名"===t&&e.attr("action","profile.php?action=show&username="+e.find('input[name="keyword"]').val())})},makeSearchByBelowTwoKeyWordAvailable=exports.makeSearchByBelowTwoKeyWordAvailable=function(){$(document).on("submit",'form[action="search.php?"]',function(){var e=$(this),t=e.find('input[name="keyword"]'),n=e.find('input[name="method"]');if(t.length&&n.length){var a=$.trim(t.val());!a||Util.getStrByteLen(a)>2||(t.val(a+" "+Math.floor($.now()/1e3)),n.val("OR"),setTimeout(function(){t.val(a),n.val("AND")},200))}})},addSearchDialogLink=exports.addSearchDialogLink=function(){$('<li><a data-name="search" href="#">搜索</a></li>').insertBefore(_Info2.default.$userMenu.find('a[href="profile.php?action=modify"]').parent()).find('[data-name="search"]').click(function(e){e.preventDefault();if(!($("#pdSearchDialog").length>0)){var t=Dialog.create("pdSearchDialog","搜索",'\n<div class="pd_cfg_main">\n  <input name="step" value="2" type="hidden">\n  <input name="method" value="AND" type="hidden">\n  <input name="sch_area" value="0" type="hidden">\n  <input name="s_type" value="forum" type="hidden">\n  <input name="f_fid" value="all" type="hidden">\n  <input name="orderway" value="lastpost" type="hidden">\n  <input name="asc" value="DESC" type="hidden">\n  <div style="margin-top: 15px;">\n    <input class="pd_input" name="keyword" type="search" style="float: left; width: 175px; line-height: 26px;" placeholder="关键字">\n    <div class="pd_search_type" data-type="dialog"><span>标题</span><i>∨</i></div>\n    <button class="indloginm" name="submit" type="submit">搜索</button>\n  </div>\n  <div style="margin-bottom: 8px; line-height: 35px;">\n    <label><input name="searchRange" type="radio" value="all" checked> 全站 </label>\n    <label><input name="searchRange" type="radio" value="current" disabled> 本版</label>\n  </div>\n</div>');t.closest("form").attr({name:"pdSearchForm",action:"search.php?",method:"post",target:"_blank"}).off("submit");var n=parseInt($('input[name="f_fid"]:first, input[name="fid"]:first').val());n&&(t.find('[name="searchRange"]').click(function(){var e=$(this);t.find('input[name="f_fid"]').val("current"===e.val()?n:"all")}),t.find('[name="searchRange"][value="current"]').prop("disabled",!1).data("enabled",!0).click()),t.keydown(function(e){27===e.keyCode&&$(".pd_search_type_list").remove()}).find("h1 > span").click(function(){$(".pd_search_type_list").remove()}),Dialog.show("pdSearchDialog"),t.find('[name="keyword"]').focus()}})},repairBbsErrorCode=exports.repairBbsErrorCode=function(){_Info2.default.w.is_ie=!1,"/read.php"===location.pathname&&(_Info2.default.w.strlen=Util.getStrByteLen)},turnPageViaKeyboard=exports.turnPageViaKeyboard=function(){$(document).keydown(function(e){if((37===e.keyCode||39===e.keyCode)&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){var t=$(".pages:first");if(t.find('li > a[href="javascript:;"]').length){var n=Util.getCurrentThreadPage(),a="";if(37===e.keyCode){if(n<=1)return;a=t.find('li > a:contains("上一页")').attr("href")}else{var o=/&page=(\d+)/.exec(t.find("li:last-child > a").attr("href"));if(!o)return;if(n>=parseInt(o[1]))return;a=t.find('li > a:contains("下一页")').attr("href")}location.href=a}}})},checkRatingSize=exports.checkRatingSize=function(e,t){var n=0,a=e.match(/\D(\d+(?:\.\d+)?)\s?(M|G)/gi);if(a)for(var o=0;o<a.length;o++){var i=/(\d+(?:\.\d+)?)\s?(M|G)/i.exec(a[o]);if(i){var r=parseFloat(i[1]);"G"===i[2].toUpperCase()&&(r*=1024),n+=r}}return n&&t?n>t*(100+_Const2.default.ratingErrorSizePercent)/100+1||n<t*(100-_Const2.default.ratingErrorSizePercent)/100-1?{type:1,titleSize:n,ratingSize:t}:{type:0}:{type:-1}},showCommonImportOrExportConfigDialog=exports.showCommonImportOrExportConfigDialog=function(e,t,n,a){var o="pdCommonImOrExConfigDialog";if(!($("#"+o).length>0)){(0,_Config.read)();var i=Dialog.create(o,"导入或导出"+e,'\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到别处即可\n  </div>\n  <textarea name="commonConfig" style="width: 500px; height: 300px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>');i.submit(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var n=$.trim(i.find('[name="commonConfig"]').val());if(n){try{n=JSON.parse(n)}catch(e){return void alert("设置有错误")}if(!n||$.type(n)!==$.type(Config[t]))return void alert("设置有错误");Config[t]=n,(0,_Config.write)(),alert("设置已导入"),Dialog.close(o),"function"==typeof a?a():location.reload()}}}),Dialog.show(o),i.find('[name="commonConfig"]').val(JSON.stringify(Config[t])).select().focus(),"function"==typeof n&&n(i)}},changeNewRateTipsColor=exports.changeNewRateTipsColor=function(){_Info2.default.$userMenu.find('a[href="kf_fw_1wkfb.php?ping=3"]:contains("有新的评分")').length>0&&$("#pdUserName").find("span").attr("id","pdNewRateTips").css("color","#5cb85c")},addSlowActionChecked=exports.addSlowActionChecked=function(e){$('\n<label style="margin-right: 5px;">\n  <input name="slowActionEnabled" type="checkbox" '+(Config.slowActionEnabled?"checked":"")+'> 慢速操作\n  <span class="pd_cfg_tips" title="延长部分批量操作的时间间隔（在3~7秒之间），如使用道具、打开盒子等">[?]</span>\n</label>\n').prependTo(e).find('input[name="slowActionEnabled"]').click(function(){var e=$(this).prop("checked");$('input[name="slowActionEnabled"]').not(this).prop("checked",e),Config.slowActionEnabled!==e&&((0,_Config.read)(),Config.slowActionEnabled=e,(0,_Config.write)())})}},{"./Config":4,"./ConfigDialog":5,"./Const":6,"./Dialog":7,"./Info":9,"./Log":11,"./LogDialog":12,"./Loot":13,"./Msg":15,"./Read":19,"./Script":20,"./TmpLog":21,"./Util":22}],19:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.getThreadTitle=n.showAttachImageOutsideSellBox=n.parseMediaTag=n.addMoreSmileLink=n.addCopyCodeLink=n.addUserMemo=n.modifyKFOtherDomainLink=n.addMultiQuoteButton=n.getMultiQuoteData=n.handleBuyThreadBtn=n.buyThreads=n.showStatFloorDialog=n.addStatAndBuyThreadBtn=n.addCopyBuyersListOption=n.adjustThreadContentFontSize=n.adjustThreadContentWidth=n.modifySmColor=n.modifyMySmColor=n.modifyFloorSmColor=n.fastGotoFloor=n.addFastGotoFloorInput=n.addFloorGotoLink=void 0;var r=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=e("./Info"),d=o(l),s=e("./Util"),c=a(s),p=e("./Msg"),f=a(p),u=e("./Dialog"),m=a(u),g=e("./Const"),h=o(g),v=e("./Log"),b=a(v),y=e("./Script"),_=a(y),x=e("./Public"),k=a(x),C=e("./Post"),w=a(C),I=(n.addFloorGotoLink=function(){$(".readlou > div:nth-child(2) > span").each(function(){var e=$(this),t=e.text();if(/^\d+楼$/.test(t)){var n=e.closest(".readlou").prev().attr("name");if(n&&/^\d+$/.test(n)){var a=c.getHostNameUrl()+"read.php?tid="+c.getUrlParam("tid")+"&spid="+n;e.html('<a class="pd_goto_link" href="'+a+'" title="复制楼层链接">'+t+"</a>"),e.find("a").click(function(e){e.preventDefault();var t=$(this),n=t.attr("href");t.data("copy-text",n),c.copyText(t,"楼层链接已复制")||prompt("本楼的跳转链接（请按Ctrl+C复制）：",n)})}}})},n.addFastGotoFloorInput=function(){$('\n<form>\n<li class="pd_fast_goto_floor">\n  电梯直达 <input class="pd_input" style="width: 30px;" type="text" maxlength="8">\n  <span data-name="submit" style="cursor: pointer;">楼</span>\n</li>\n</form>\n').prependTo($(".readtext:first").prev("div").prev(".readlou").find("> div:first-child > ul")).submit(function(e){e.preventDefault();var t=parseInt($(this).find("input").val());!t||t<0||(location.href="read.php?tid="+c.getUrlParam("tid")+"&page="+(parseInt(t/Config.perPageFloorNum)+1)+"&floor="+t)}).find('[data-name="submit"]').click(function(){$(this).closest("form").submit()}).end().closest("div").next().css({"max-width":"385px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"})},n.fastGotoFloor=function(){var e=parseInt(c.getUrlParam("floor"));if(e&&!(e<0)){var t=$('.readlou > div:nth-child(2) > span:contains("'+e+'楼")');if(t.length){var n=t.closest(".readlou").prev().attr("name");n&&/^\d+$/.test(n)&&(location.hash="#"+n)}}},n.modifyFloorSmColor=function(e,t){e.is(".readidmsbottom > a")&&e.css("color",t),e.closest(".readtext").css("border-color",t).prev("div").css("border-color",t).prev(".readlou").css("border-color",t).next().next().next(".readlou").css("border-color",t)}),L=(n.modifyMySmColor=function(){var e=$('.readidmsbottom > a[href="profile.php?action=show&uid='+d.default.uid+'"]');e.length||(e=$('.readidmleft > a[href="profile.php?action=show&uid='+d.default.uid+'"]')),e.length>0&&I(e,Config.customMySmColor)},n.modifySmColor=function(){Config.customSmColorConfigList.length&&$('.readidmsbottom > a[href^="profile.php?action=show&uid="], .readidmleft > a').each(function(){var e=$(this),t="";if(e.is(".readidmleft > a")){if(t=e.parent().next(".readidmright").text().toUpperCase(),!/(-?\d+|MAX)/i.test(t))return}else{var n=/(-?\d+|MAX)级神秘/i.exec(e.parent().contents().last().text());if(!n)return;t=n[1].toUpperCase()}var a=!0,o=!1,i=void 0;try{for(var r,l=Config.customSmColorConfigList[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var d=r.value,s=d.min,p=d.max,f=d.color;if(c.compareSmLevel(t,s)>=0&&c.compareSmLevel(t,p)<=0){I(e,f);break}}}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}})},n.adjustThreadContentWidth=function(){$("head").append("\n<style>\n  .readtext > table > tbody > tr > td { padding-left: 192px; }\n  .readidms, .readidm { margin-left: -192px !important; }\n</style>\n")},n.adjustThreadContentFontSize=function(){Config.threadContentFontSize>0&&12!==Config.threadContentFontSize&&$("head").append("\n<style>\n  .readtext td { font-size: "+Config.threadContentFontSize+"px; line-height: 1.6em; }\n  .readtext td > div, .readtext td > .read_fds { font-size: 12px; }\n</style>\n")},n.addCopyBuyersListOption=function(){$('.readtext select[name="buyers"]').each(function(){$(this).find("option:first-child").after('<option value="copyList">复制名单</option>')}),$(document).on("change",'select[name="buyers"]',function(){var e=$(this);if("copyList"===e.val()){var t=e.find("option").map(function(e){var t=$(this).text();return 0===e||1===e||t.includes("-".repeat(11))?null:t}).get().join("\n");if(e.get(0).selectedIndex=0,!t)return void alert("暂时无人购买");var n="pdCopyBuyerListDialog";if(!($("#"+n).length>0)){var a='\n<div class="pd_cfg_main">\n  <textarea name="buyerList" style="width: 200px; height: 300px; margin: 5px 0;" readonly>'+t+"</textarea>\n</div>",o=m.create(n,"购买人名单",a);m.show(n),o.find('[name="buyerList"]').select().focus()}}})},n.addStatAndBuyThreadBtn=function(){$('<span style="margin: 0 5px;">|</span><a data-name="statAndBuyThread" title="统计回帖者名单以及批量购买帖子" href="#">统计和购买</a>').insertAfter('td > a[href^="kf_tidfavor.php?action=favor&tid="]').filter('[data-name="statAndBuyThread"]').click(function(e){if(e.preventDefault(),!($("#pdStatFloorDialog").length>0)){var t=parseInt(c.getUrlParam("tid"));if(t){var n=$.trim(prompt("统计到第几楼？（0表示统计所有楼层，可用m-n的方式来设定统计楼层的区间范围）",0));if(""!==n){if(!/^\d+(-\d+)?$/.test(n))return void alert("统计楼层格式不正确");var a=0,o=0,i=n.split("-");if(2===i.length?(a=parseInt(i[0]),o=parseInt(i[1])):o=parseInt(i[0]),o<a)return void alert("统计楼层格式不正确");var r=/(\d+)页/.exec($(".pages:eq(0) > li:last-child > a").text()),l=r?parseInt(r[1]):1;0===a&&(a=1),0===o&&(o=l*Config.perPageFloorNum-1);var d=Math.floor(a/Config.perPageFloorNum)+1,s=Math.floor(o/Config.perPageFloorNum)+1;if(s>l&&(s=l),s-d>h.default.statFloorMaxPage)return void alert("需访问的总页数不可超过"+h.default.statFloorMaxPage);f.destroy(),f.wait('<strong>正在统计楼层中&hellip;</strong><i>剩余页数：<em class="pd_countdown">'+(s-d+1)+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),L(t,d,s,a,o)}}}})},function(e,t,n,a,o){var i=!1,r=[];!function t(l){$.ajax({type:"GET",url:"read.php?tid="+e+"&page="+l+"&t="+$.now(),timeout:h.default.defAjaxTimeout,success:function(e){$(".readtext",e).each(function(){var e={},t=$(this),n=t.prev("div").prev(".readlou"),l=parseInt(n.find("> div:nth-child(2) > span:first-child").text());if(l&&!(l<a)){if(l>o)return i=!0,!1;e.pid=parseInt(n.prev("a").attr("name"));var d=t.find(".readidms, .readidm");if(e.userName=d.find('a[href^="profile.php?action=show&uid="]').text(),e.smLevel="",d.hasClass("readidms")){var s=/(\S+)级神秘/.exec(d.find(".readidmsbottom").text());s&&(e.smLevel=s[1])}else e.smLevel=d.find(".readidmright").text().trim();var c=t.find('[name="buyers"]:first');if(e.status=0,c.length>0){var p=c.next("input");if(e.status=p.length>0?1:2,1===e.status){var f=/此帖售价\s*(\d+)\s*KFB/.exec(c.parent("legend").text());f&&(e.sell=parseInt(f[1])),f=/location\.href="(.+)"/i.exec(p.attr("onclick")),f&&(e.buyUrl=f[1])}}r[l]=e}});var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1),i=i||t.closest(".pd_msg").data("stop")},error:function(){setTimeout(function(){return t(l)},h.default.defAjaxInterval)},complete:function(){i||l>=n?(f.destroy(),S(r)):setTimeout(function(){return t(l+1)},h.default.defAjaxInterval)}})}(t)}),S=n.showStatFloorDialog=function(e){var t="pdStatFloorDialog",n=m.create(t,"统计楼层",'\n<div class="pd_cfg_main">\n  <div id="pdStatFloorFilter" style="margin-top: 5px;">\n    <label><input name="removeRepeatedEnabled" type="checkbox"> 去除重复</label>\n    <label><input name="removeTopFloorEnabled" type="checkbox"> 去除楼主</label>\n  </div>\n  <div id="pdStatFloorSelectBtns">\n    <label style="margin-left: 3px;">售价区间：</label>\n    <input name="startSell" type="number" value="1" min="1" max="100" style="width: 40px;"> -\n    <input name="endSell" type="number" value="100" min="1" max="100" style="width: 40px;">\n    <label style="margin-left: 3px;">\n      每名用户限选 <input name="limitNum" type="number" min="0" style="width: 32px;"> 个\n    </label>\n    <a class="pd_btn_link" data-name="selectFilter" href="#">筛选</a><br>\n    <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n    <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n  </div>\n  <div class="pd_highlight" style="text-align: center;">\n    共显示<b id="pdStatFloorShowCount">0</b>条项目，共选择<b id="pdStatFloorSelectCount">0</b>条项目\n  </div>\n  <table style="line-height: 1.8em; text-align: center;">\n    <thead>\n      <tr>\n        <th style="width: 30px;"></th>\n        <th style="width: 65px;">楼层号</th>\n        <th style="width: 120px;">用户名</th>\n        <th style="width: 80px;">神秘等级</th>\n        <th style="width: 100px;">\n          售价(KFB) <span class="pd_cfg_tips" title="注：售价信息在统计后可能会发生变化，如有必要，建议尽快购买帖子">[?]</span>\n        </th>\n      </tr>\n    </thead>\n    <tbody id="pdStatFloorList"></tbody>\n  </table>\n  <textarea name="statFloorListContent" style="margin-top: 8px; width: 250px; height: 300px;" hidden></textarea>\n</div>\n\n<div class="pd_cfg_btns">\n  <button name="copyList" type="button" style="color: #00f;" title="复制所有或所选楼层的用户名单">复制名单</button>\n  <button name="buyThread" type="button" style="color: #f00;" title="批量购买所选楼层的帖子">购买帖子</button>\n  <button data-action="close" type="button">关闭</button>\n</div>'),a=n.find("#pdStatFloorFilter"),o=n.find("#pdStatFloorList"),l=n.find('[name="statFloorListContent"]'),d=c.getUrlParam("tid"),s=function(){var t=[].concat(i(e)),s=a.find('[name="removeRepeatedEnabled"]').prop("checked"),c=a.find('[name="removeTopFloorEnabled"]').prop("checked");if(s&&(t=t.map(function(e,t,n){return e&&n.findIndex(function(t){return t&&t.userName===e.userName})===t?e:null})),c){var p=$(".readtext:first");if("tpc"===p.prev("div").prev(".readlou").prev("a").attr("name")){var f=p.find(".readidmsbottom, .readidmleft").find('a[href^="profile.php?action=show&uid="]').text();t=t.map(function(e){return e&&e.userName!==f?e:null})}}var u="",m="",g=0,h=!0,v=!1,b=void 0;try{for(var y,_=t.entries()[Symbol.iterator]();!(h=(y=_.next()).done);h=!0){var x=r(y.value,2),k=x[0],C=x[1];C&&(u+='\n<tr>\n  <td>\n    <label>\n      <input data-status="'+C.status+'" data-sell="'+(C.sell?C.sell:0)+'" data-url="'+(C.buyUrl?C.buyUrl:"")+'"\n        type="checkbox" value="'+C.userName+'">\n    </label>\n  </td>\n  <td><a href="read.php?tid='+d+"&spid="+C.pid+'" target="_blank">'+k+'楼</a></td>\n  <td><a href="profile.php?action=show&username='+C.userName+'" target="_blank" style="color: #000;">'+C.userName+'</a></td>\n  <td style="color: #f39;">'+C.smLevel+'</td>\n  <td class="pd_stat">'+(1===C.status?"<em>"+C.sell+"</em>":'<span class="pd_notice">'+(C.status?"已买":"无")+"</span>")+"</td>\n</tr>",m+=C.userName+"\n",g++)}}catch(e){v=!0,b=e}finally{try{!h&&_.return&&_.return()}finally{if(v)throw b}}o.html(u),l.val(m).data("copy-text",m),n.find("#pdStatFloorShowCount").text(g),n.find("#pdStatFloorSelectCount").text(0)};n.find("#pdStatFloorSelectBtns").on("click","[data-name]",function(e){e.preventDefault();var t=$(this).data("name");if("selectAll"===t)c.selectAll(o.find('[type="checkbox"]'));else if("selectInverse"===t)c.selectInverse(o.find('[type="checkbox"]'));else if("selectFilter"===t){var a=parseInt(n.find('[name="startSell"]').val()),i=parseInt(n.find('[name="endSell"]').val()),r=parseInt(n.find('[name="limitNum"]').val());if((!r||r<0)&&(r=0),!a||a<1||!i||i<1)return;var l={};o.find('[type="checkbox"]').each(function(){var e=$(this),t=parseInt(e.data("status"));if(t){var n=parseInt(e.data("sell")),o=e.val();o in l||(l[o]=0),l[o]++;var d=1===t&&n>=a&&n<=i;d&&r>0&&l[o]>r&&(d=!1),e.prop("checked",d)}})}n.find("#pdStatFloorSelectCount").text(o.find('[type="checkbox"]:checked').length)}).end().find('[name="copyList"]').click(function(){var e=$(this);if("取消复制"===e.text())return e.text("复制名单"),l.prop("hidden",!0),o.closest("table").prop("hidden",!1),void m.resize(t);var n="all",a=o.find('[type="checkbox"]:checked');if(a.length>0){n="select";var i="";a.each(function(){i+=$(this).val()+"\n"}),l.val(i).data("copy-text",i)}c.copyText(l,("all"===n?"所有":"所选")+"用户名单已复制")||(e.text("取消复制"),o.closest("table").prop("hidden",!0),l.prop("hidden",!1).select().focus(),m.resize(t))}).end().find('[name="buyThread"]').click(function(){var e=[],t=0;o.find('[type="checkbox"]:checked').length||n.find('[data-name="selectAll"]').click(),o.find('[type="checkbox"]:checked').each(function(){var n=$(this),a=n.data("url"),o=parseInt(n.data("sell"));a&&o>0&&(e.push({url:a,sell:o}),t+=o)}),e.length&&confirm("你共选择了 "+e.length+" 个可购买项，总售价 "+t.toLocaleString()+" KFB，均价 "+c.getFixedNumLocStr(t/e.length,2)+" KFB，是否批量购买？")&&(f.destroy(),f.wait('<strong>正在购买帖子中&hellip;</strong><i>剩余：<em class="pd_countdown">'+e.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),T(e))}),1!==c.getCurrentThreadPage()&&a.find('[name="removeTopFloorEnabled"]').prop("disabled",!0).parent("label").attr("title","请在第1页进行统计"),a.on("click",'[type="checkbox"]',s),s(),m.show(t),_.runFunc("Read.showStatFloorDialog_after_")},T=n.buyThreads=function(e){var t=0,n=0,a=0;$(document).clearQueue("BuyThread"),$.each(e,function(o,i){var r=i.url,l=i.sell;$(document).queue("BuyThread",function(){$.ajax({type:"GET",url:r+"&t="+$.now(),timeout:h.default.defAjaxTimeout,success:function(e){k.showFormatLog("购买帖子",e);var o=c.getResponseMsg(e),i=o.msg;/操作完成/.test(i)?(t++,a+=l):n++},error:function(){n++},complete:function(){var i=$(".pd_countdown:last");i.text(parseInt(i.text())-1);var r=i.closest(".pd_msg").data("stop");r&&$(document).clearQueue("BuyThread"),r||o===e.length-1?(f.destroy(),t>0&&b.push("购买帖子","共有`"+t+"`个帖子购买成功",{pay:{KFB:-a}}),console.log("共有"+t+"个帖子购买成功，共有"+n+"个帖子购买失败，KFB-"+a),f.show("<strong>共有<em>"+t+"</em>个帖子购买成功"+(n>0?"，共有<em>"+n+"</em>个帖子购买失败":"")+"</strong><i>KFB<ins>-"+a+"</ins></i>",-1),_.runFunc("Read.buyThreads_after_",e)):setTimeout(function(){return $(document).dequeue("BuyThread")},h.default.defAjaxInterval)}})})}),$(document).dequeue("BuyThread")},D=(n.handleBuyThreadBtn=function(){$('.readtext input[type="button"][value="愿意购买,支付KFB"]').each(function(){var e=$(this),t=/此帖售价\s*(\d+)\s*KFB/.exec(e.closest("legend").contents().eq(0).text());if(t){var n=parseInt(t[1]);t=/location\.href="(.+?)"/i.exec(e.attr("onclick")),t&&e.data("sell",n).data("url",t[1]).removeAttr("onclick").click(function(e){e.preventDefault();var t=$(this),n=t.data("sell"),a=t.data("url");if(n&&a&&(!(n>=h.default.minBuyThreadWarningSell)||confirm("此贴售价 "+n+" KFB，是否购买？")))if(Config.buyThreadNoJumpEnabled){var o=f.wait("正在购买帖子&hellip;");$.get(a+"&t="+$.now(),function(e){k.showFormatLog("购买帖子",e);var t=c.getResponseMsg(e),n=t.msg;f.remove(o),/操作完成/.test(n)?location.reload():/您已经购买此帖/.test(n)?(alert("你已经购买过此帖"),location.reload()):alert("帖子购买失败")})}else location.href=a})}})},n.getMultiQuoteData=function(){var e=[];return $(".pd_multi_quote_chk input:checked").each(function(){var t=$(this).closest(".readlou"),n=/(\d+)楼/.exec(t.find(".pd_goto_link").text()),a=n?parseInt(n[1]):0,o=t.prev("a").attr("name"),i=t.next("div").next(".readtext").find(".readidmsbottom > a, .readidmleft > a").text();i&&e.push({floor:a,pid:o,userName:i})}),e});n.addMultiQuoteButton=function(){var e=$('a[href^="post.php?action=reply"].b_tit2').attr("href")
;e&&($('<li class="pd_multi_quote_chk"><label title="多重引用"><input type="checkbox"> 引</label></li>').prependTo($(".readlou > div:first-child > ul").has('a[title="引用回复这个帖子"]')).find("input").click(function(){var e=parseInt(c.getUrlParam("tid")),t=localStorage[h.default.multiQuoteStorageName];if(t)try{t=JSON.parse(t),!t||"object"!==$.type(t)||$.isEmptyObject(t)?t=null:void 0!==t.tid&&t.tid===e&&Array.isArray(t.quoteList)||(t=null)}catch(e){t=null}else t=null;var n=D();t||(localStorage.removeItem(h.default.multiQuoteStorageName),t={tid:e,quoteList:[]});var a=c.getCurrentThreadPage();n.length>0?t.quoteList[a]=n:delete t.quoteList[a],localStorage[h.default.multiQuoteStorageName]=JSON.stringify(t)}),$(".readlou:last").next("div").find("table > tbody > tr > td:last-child").css({"text-align":"right",width:"320px"}).append('<span class="b_tit2" style="margin-left: 5px;"><a style="display: inline-block;" href="#" title="多重回复">回复</a> <a style="display: inline-block;" href="'+e+'&multiquote=1" title="多重引用">引用</a></span>').find(".b_tit2 > a:eq(0)").click(function(e){e.preventDefault(),w.handleMultiQuote(1)}))},n.modifyKFOtherDomainLink=function(){$(".readtext a, .thread2 a").each(function(){var e=$(this),t=e.attr("href");if(!/m\.miaola\.info\//i.test(t)){var n=/^(https?:\/\/(?:[\w\.]+?\.)?(?:2dgal|ddgal|9gal|9baka|9moe|kfgal|2dkf|miaola|kfer)\.\w+?\/).+/i.exec(t);n&&e.attr("href",t.replace(n[1],c.getHostNameUrl()))}})},n.addUserMemo=function(){$.isEmptyObject(Config.userMemoList)||$('.readidmsbottom > a[href^="profile.php?action=show&uid="], .readidmleft > a').each(function(){var e=$(this),t=e.text().trim(),n=Object.keys(Config.userMemoList).find(function(e){return e===t});if(n){var a=Config.userMemoList[n];if(e.is(".readidmleft > a"))e.after('<span class="pd_user_memo_tips" title="备注：'+a+'">[?]</span>');else{var o=a;a.length>24&&(o=o.substring(0,24)+"&hellip;"),e.after('<br><span class="pd_user_memo" title="备注：'+a+'">('+o+")</span>")}}})},n.addCopyCodeLink=function(){$('.readtext fieldset > legend:contains("Copy code")').html('<a class="pd_copy_code" href="#">复制代码</a>').parent("fieldset").addClass("pd_code_area"),$(".pd_copy_code").length&&$("#alldiv").on("click","a.pd_copy_code",function(e){e.preventDefault();var t=$(this),n=t.closest("fieldset");if(!c.copyText(n,"代码已复制",t.parent())){var a=n.data("content");if(a)n.html('<legend><a class="pd_copy_code" href="#">复制代码</a></legend>'+a).removeData("content");else{var o=n.html();o=o.replace(/<legend>.+?<\/legend>/i,""),n.data("content",o),o=c.htmlDecode(o);var i=n.height();i-=17,i<50&&(i=50),i>540&&(i=540),n.html('\n<legend><a class="pd_copy_code" href="#">还原代码</a></legend>\n<textarea wrap="off" class="pd_textarea" style="width: 100%; height: '+i+'px; line-height: 1.4em; white-space: pre;">'+o+"</textarea>\n"),n.find("textarea").select().focus()}}})},n.addMoreSmileLink=function(){var e=function(e){var t=$('[name="atc_content"]').get(0);if(t){var n="[s:"+e+"]";c.addCode(t,n),d.default.isMobile?t.blur():t.focus()}},t=$('input[name="diy_guanjianci"]').parent();t.on("click",'a[href="javascript:;"]',function(t){t.preventDefault();var n=$(this).data("id");n&&e(n)}).find('a[onclick^="javascript:addsmile"]').each(function(){var e=$(this),t=/addsmile\((\d+)\)/i.exec(e.attr("onclick"));t&&e.data("id",t[1]).removeAttr("onclick").attr("href","javascript:;")}),$('<a class="pd_highlight" href="#">[更多]</a>').appendTo(t).click(function(n){n.preventDefault();var a=$(this),o=$("#pdSmilePanel");if(o.length>0)return a.text("[更多]"),void o.remove();a.text("[关闭]");for(var i=["48","35","34","33","32","31","30","29","28","27","26","36","37","47","46","45","44","43","42","41","40","39","38","25","24","11","10","09","08","01","02","03","04","05","06","12","13","23","22","21","20","19","18","17","16","15","14","07"],r=[57,44,43,42,41,40,39,38,37,36,35,45,46,56,55,54,53,52,51,50,49,48,47,34,33,20,19,18,17,10,11,12,13,14,15,21,22,32,31,30,29,28,27,26,25,24,23,16],l="",s=0;s<i.length;s++)l+='<img src="'+d.default.w.imgpath+"/post/smile/em/em"+i[s]+'.gif" alt="[表情]" data-id="'+r[s]+'">';l='<div class="pd_panel" id="pdSmilePanel" style="width: 308px; height: 185px;">'+l+"</div>";var c=t.offset();o=$(l).appendTo("body"),o.css("top",c.top+t.height()+4).css("left",c.left+t.width()-o.width()+9).on("click","img",function(){var t=$(this).data("id");t&&e(t)}),_.runFunc("Read.addMoreSmileLink_after_click_")})},n.parseMediaTag=function(){$(".readtext > table > tbody > tr > td").each(function(){var e=$(this),t=e.html();/\[(audio|video)\](http|ftp)[^<>]+\[\/(audio|video)\]/.test(t)&&e.html(t.replace(/\[audio\]((?:http|ftp)[^<>]+?)\[\/audio\](?!<\/fieldset>)/g,'<audio src="$1" controls preload="none" style="margin: 3px 0;">[你的浏览器不支持audio标签]</audio>').replace(/\[video\]((?:http|ftp)[^<>]+?)\[\/video\](?!<\/fieldset>)/g,'<video src="$1" controls preload="none" style="max-width: '+(Config.adjustThreadContentWidthEnabled?627:820)+'px; margin:3px 0;">[你的浏览器不支持video标签]</video>'))})},n.showAttachImageOutsideSellBox=function(){if(1===c.getCurrentThreadPage()){var e=$(".readtext:first > table > tbody > tr > td");if(e.find('select[name="buyers"]').length){var t=e.html();if(/\[attachment=\d+\]/.test(t)){var n=e.closest(".readtext").prev("div").prev(".readlou").prev("a").attr("name"),a=c.getUrlParam("tid");e.html(t.replace(/\[attachment=(\d+)\]/g,'<img src="job.php?action=download&pid='+n+"&tid="+a+'&aid=$1" alt="[附件图片]" style="max-width:550px" onclick="if(this.width>=550) window.open(\'job.php?action=download&pid='+n+"&tid="+a+"&aid=$1');\">"))}}}},n.getThreadTitle=function(){return $('form[name="delatc"] > div:first > table > tbody > tr > td > span').text().trim()}},{"./Const":6,"./Dialog":7,"./Info":9,"./Log":11,"./Msg":15,"./Post":17,"./Public":18,"./Script":20,"./Util":22}],20:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleInstallScriptLink=exports.showDialog=exports.runFunc=exports.addFunc=exports.runCmd=exports.runCustomScript=void 0;var _Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Config=require("./Config"),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Msg=require("./Msg"),Msg=_interopRequireWildcard(_Msg),_Log=require("./Log"),Log=_interopRequireWildcard(_Log),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_LootLog=require("./LootLog"),LootLog=_interopRequireWildcard(_LootLog),_Public=require("./Public"),Public=_interopRequireWildcard(_Public),_Index=require("./Index"),Index=_interopRequireWildcard(_Index),_Read=require("./Read"),Read=_interopRequireWildcard(_Read),_Post=require("./Post"),Post=_interopRequireWildcard(_Post),_Other=require("./Other"),Other=_interopRequireWildcard(_Other),_Bank=require("./Bank"),Bank=_interopRequireWildcard(_Bank),_Card=require("./Card"),Card=_interopRequireWildcard(_Card),_Item=require("./Item"),Item=_interopRequireWildcard(_Item),_Loot=require("./Loot"),Loot=_interopRequireWildcard(_Loot),_ConfigDialog=require("./ConfigDialog"),ConfigDialog=_interopRequireWildcard(_ConfigDialog),defScriptName="未命名脚本",metaRegex=/\/\/\s*==UserScript==((?:.|\n)+?)\/\/\s*==\/UserScript==/i,funcList=new Map,runCustomScript=exports.runCustomScript=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"end",t=!0,n=!1,a=void 0;try{for(var o,i=Config.customScriptList[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value,l=r.enabled,d=r.trigger,s=r.content;l&&d===e&&s&&runCmd(s)}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}},runCmd=exports.runCmd=function runCmd(cmd){var isOutput=arguments.length>1&&void 0!==arguments[1]&&arguments[1],result=!0,response="";try{response=eval(cmd),isOutput&&console.log(response)}catch(e){result=!1,response=e,console.log(e)}return{result:result,response:String(response)}},addFunc=exports.addFunc=function(e,t){funcList.has(e)||funcList.set(e,[]),funcList.get(e).push(t)},runFunc=exports.runFunc=function(e,t){if(funcList.has(e)){var n=!0,a=!1,o=void 0;try{for(var i,r=funcList.get(e)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;if("function"==typeof l)try{l(t)}catch(e){console.log(e)}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}}},getScriptMeta=function(e){var t={name:"未命名脚本",version:"",trigger:"end",homepage:"",author:""},n=metaRegex.exec(e);if(!n)return t;var a=n[1];return n=/@name[ \t]+(.*)/i.exec(a),n&&(t.name=n[1]),n=/@version[ \t]+(.*)/i.exec(a),n&&(t.version=n[1]),n=/@trigger[ \t]+(.*)/i.exec(a),n&&(t.trigger="start"===n[1].toLowerCase()?"start":"end"),n=/@homepage[ \t]+(.*)/i.exec(a),n&&(t.homepage=n[1]),n=/@author[ \t]+(.*)/i.exec(a),n&&(t.author=n[1]),t},showDialog=exports.showDialog=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t="pdCustomScriptDialog";if(!($("#"+t).length>0)){(0,_Config.read)();var n=Dialog.create(t,"自定义脚本",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <a class="pd_highlight pd_btn_link" data-name="addNewScript" href="#">添加新脚本</a>\n    <a class="pd_btn_link" data-name="insertSample" href="#">插入范例</a>\n  </div>\n  <div data-name="customScriptList"></div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a class="pd_btn_link pd_highlight" href="read.php?tid=500968" target="_blank">自定义脚本收集贴</a>\n    <a class="pd_btn_link" data-name="openImOrExCustomScriptDialog" href="#">导入/导出所有脚本</a>\n  </span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n  <button class="pd_highlight" name="clear" type="button">清空</button>\n</div>',"min-width: 776px;"),a=n.find('[data-name="customScriptList"]');n.submit(function(e){e.preventDefault(),Config.customScriptList=[],a.find(".pd_custom_script_content").each(function(){var e=$(this),t=e.val();if($.trim(t)){var n=e.prev().find('[type="checkbox"]').prop("checked");Config.customScriptList.push($.extend(getScriptMeta(t),{enabled:n,content:t}))}}),(0,_Config.write)(),Dialog.close(t),alert("自定义脚本修改成功（需刷新页面后才可生效）")}).end().find('[name="clear"]').click(function(e){e.preventDefault(),confirm("是否清空所有脚本？")&&(a.html(""),Dialog.resize(t))});var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.enabled,n=void 0===t||t,o=e.name,i=void 0===o?"未命名脚本":o,r=e.version,l=void 0===r?"":r,d=e.homepage,s=void 0===d?"":d,c=e.trigger,p=void 0===c?"end":c,f=e.content,u=void 0===f?"":f;a.append('\n<div class="pd_custom_script_header">\n  <input type="checkbox" '+(n?"checked":"")+' title="是否启用此脚本">\n  <a class="pd_custom_script_name" href="#" style="margin-left: 5px;">['+i+']</a>\n  <span data-name="version" style="margin-left: 5px; color: #666;" '+(l?"":"hidden")+">"+l+'</span>\n  <span data-name="trigger" style="margin-left: 5px; color: '+("start"===p?"#f00":"#00f")+';" title="脚本执行时机">\n    ['+("start"===p?"开始时":"结束时")+']\n  </span>\n  <a data-name="homepage" href="'+s+'" target="_blank" style="margin-left: 5px;" '+(s?"":"hidden")+'>[主页]</a>\n  <a data-name="delete" href="#" style="margin-left: 5px; color: #666;">[删除]</a>\n</div>\n<textarea class="pd_custom_script_content" wrap="off">'+u+"</textarea>\n")},i=!0,r=!1,l=void 0;try{for(var d,s=Config.customScriptList[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){o(d.value)}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}n.find('[data-name="addNewScript"]').click(function(e){e.preventDefault(),a.find(".pd_custom_script_content").hide(),o(),a.find(".pd_custom_script_content:last").show().focus(),Dialog.resize(t)}).end().find('[data-name="insertSample"]').click(function(e){e.preventDefault();var t=a.find(".pd_custom_script_content:visible");t.val(("\n// ==UserScript==\n// @name        未命名脚本\n// @version     1.0\n// @author      "+_Info2.default.userName+"\n// @trigger     end\n// @homepage    read.php?tid=500968&spid=12318348\n// @description 这是一个未命名脚本\n// ==/UserScript==\n").trim()+"\n"+t.val()).focus()}).end().find('[data-name="openImOrExCustomScriptDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("自定义脚本","customScriptList")}),a.on("click",".pd_custom_script_name",function(e){e.preventDefault(),n.find(".pd_custom_script_content").hide(),$(this).parent().next().show().focus(),Dialog.resize(t)}).on("click",'[data-name="delete"]',function(e){if(e.preventDefault(),confirm("是否删除此脚本？")){var n=$(this).closest(".pd_custom_script_header");n.next().remove(),n.remove(),Dialog.resize(t)}}).on("change",".pd_custom_script_content",function(){var e=$(this),t=getScriptMeta(e.val()),n=t.name,a=t.version,o=t.homepage,i=t.trigger,r=e.prev();r.find(".pd_custom_script_name").text("["+(n?n:"未命名脚本")+"]"),r.find('[data-name="version"]').text(a).prop("hidden",!a),r.find('[data-name="homepage"]').attr("href",o?o:"").prop("hidden",!o),r.find('[data-name="trigger"]').html("["+("start"===i?"开始时":"结束时")+"]").css("color","start"===i?"#f00":"#00f")}),Dialog.show(t),"number"==typeof e&&a.find(".pd_custom_script_name").eq(e).click()}},handleInstallScriptLink=exports.handleInstallScriptLink=function(){$(document).on("click",'a[href$="#install-script"]',function(e){e.preventDefault();var t=$(this),n=t.nextAll(".pd_code_area").eq(0);if(n.length){var a=Util.htmlDecode(n.html().replace(/<legend>.+?<\/legend>/i,"")).trim();if(metaRegex.test(a)){(0,_Config.read)();var o=getScriptMeta(a),i=Config.customScriptList.findIndex(function(e){return e.name===o.name&&e.author===o.author}),r=i>-1?1:0;if(confirm("是否"+(1===r?"更新":"安装")+"此脚本？")){Config.customScriptEnabled=!0;var l=$.extend(o,{enabled:!0,content:a});1===r?Config.customScriptList[i]=l:Config.customScriptList.push(l),(0,_Config.write)(),Dialog.close("pdCustomScriptDialog"),showDialog(i)}}}})}},{"./Bank":2,"./Card":3,"./Config":4,"./ConfigDialog":5,"./Const":6,"./Dialog":7,"./Index":8,"./Info":9,"./Item":10,"./Log":11,"./Loot":13,"./LootLog":14,"./Msg":15,"./Other":16,"./Post":17,"./Public":18,"./Read":19,"./TmpLog":21,"./Util":22}],21:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.deleteValue=n.setValue=n.getValue=n.clear=n.write=n.read=void 0;var o=e("./Info"),i=a(o),r=e("./Const"),l=a(r),d=e("./Util"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(d),c=l.default.storagePrefix+"tmp_log",p=n.read=function(){var e={},t=s.readData(c+"_"+i.default.uid);if(!t)return e;try{t=JSON.parse(t)}catch(t){return e}if(!t||"object"!==$.type(t))return e;var n=[];for(var a in l.default)a.endsWith("TmpLogName")&&n.push(l.default[a]);var o=!0,r=!1,d=void 0;try{for(var p,f=Object.keys(t)[Symbol.iterator]();!(o=(p=f.next()).done);o=!0){var u=p.value;n.includes(u)||delete t[u]}}catch(e){r=!0,d=e}finally{try{!o&&f.return&&f.return()}finally{if(r)throw d}}return e=t},f=n.write=function(e){return s.writeData(c+"_"+i.default.uid,JSON.stringify(e))};n.clear=function(){return s.deleteData(c+"_"+i.default.uid)},n.getValue=function(e){var t=p();return e in t?t[e]:null},n.setValue=function(e,t){var n=p();n[e]=t,f(n)},n.deleteValue=function(e){var t=p();e in t&&(delete t[e],f(t))}},{"./Const":6,"./Info":9,"./Util":22}],22:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.deleteData=n.writeData=n.readData=n.selectInverse=n.selectAll=n.inFollowOrBlockUserList=n.entries=n.getResponseMsg=n.copyText=n.getSelText=n.addCode=n.getStrByteLen=n.removeUnpairedBBCodeContent=n.getFixedNumLocStr=n.getCurrentThreadPage=n.compareSmLevel=n.isEdge=n.isIE=n.isOpera=n.getStatFormatNumber=n.getSortedObjectKeyList=n.getObjectKeyList=n.removeHtmlTag=n.htmlDecode=n.htmlEncode=n.getGBKEncodeString=n.getUrlParam=n.deepEqual=n.getDifferenceSetOfObject=n.getHostNameUrl=n.isBetweenInTimeRange=n.getTimeDiffInfo=n.getTimeString=n.getDateString=n.getDate=n.getMidnightHourDate=n.getTimezoneDateByTime=n.getDateByTime=n.deleteCookie=n.getCookie=n.setCookie=void 0;var o=function(){function e(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=e("./Info"),r=a(i),l=e("./Const"),d=a(l),s=(n.setCookie=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.default.uid+"_"+d.default.storagePrefix;document.cookie=""+a+e+"="+encodeURI(t)+(n?";expires="+n.toUTCString():"")+";path=/;"},n.getCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.uid+"_"+d.default.storagePrefix,n=new RegExp("(^| )"+t+e+"=([^;]*)(;|$)"),a=document.cookie.match(n);return a?decodeURI(a[2]):null},n.deleteCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.uid+"_"+d.default.storagePrefix;document.cookie=""+t+e+"=;expires="+c("-1d").toUTCString()+";path=/;"},n.getDateByTime=function(e){var t=new Date,n=e.split(":"),a=o(n,3),i=a[0],r=a[1],l=a[2];return void 0!==i&&t.setHours(parseInt(i)),void 0!==r&&t.setMinutes(parseInt(r)),void 0!==l&&t.setSeconds(parseInt(l)),t.setMilliseconds(0),t}),c=(n.getTimezoneDateByTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.default.forumTimezoneOffset,n=new Date,a=e.split(":"),i=o(a,3),r=i[0],l=i[1],s=i[2];void 0!==r&&n.setUTCHours(parseInt(r)+t),void 0!==l&&n.setUTCMinutes(parseInt(l)),void 0!==s&&n.setUTCSeconds(parseInt(s)),n.setUTCMilliseconds(0);var c=new Date;return(c.getDate()>n.getDate()||c.getMonth()>n.getMonth()||c.getFullYear()>n.getFullYear())&&n.setDate(n.getDate()+1),n},n.getMidnightHourDate=function(e){var t=s("00:00:00");return t.setDate(t.getDate()+e),t},n.getDate=function(e){var t=new Date,n=/^(-|\+)?(\d+)([a-zA-Z]{1,2})$/.exec(e);if(!n)return null;var a=void 0===n[1]?0:"+"===n[1]?1:-1,o=a===-1?-parseInt(n[2]):parseInt(n[2]);switch(n[3]){case"Y":t.setFullYear(o);break;case"y":t.setFullYear(0===a?o:t.getFullYear()+o);break;case"M":t.setMonth(0===a?o:t.getMonth()+o);break;case"d":t.setDate(0===a?o:t.getDate()+o);break;case"h":t.setHours(0===a?o:t.getHours()+o);break;case"m":t.setMinutes(0===a?o:t.getMinutes()+o);break;case"s":t.setSeconds(0===a?o:t.getSeconds()+o);break;case"ms":t.setMilliseconds(0===a?o:t.getMilliseconds()+o);break;default:return null}return t}),p=(n.getDateString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";e=e?e:new Date;var n=(e.getMonth()+1).toString(),a=e.getDate().toString();return e.getFullYear()+t+n.padStart(2,"0")+t+a.padStart(2,"0")},n.getTimeString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.getHours().toString(),o=e.getMinutes().toString(),i=e.getSeconds().toString();return a.padStart(2,"0")+t+o.padStart(2,"0")+(n?t:"")+(n?i.padStart(2,"0"):"")},n.getTimeDiffInfo=function(e){var t=e-$.now();if(t>0){t=Math.floor(t/1e3);var n=Math.floor(t/60/60);if(n>=0){var a=Math.floor((t-60*n*60)/60);a<0&&(a=0);var o=Math.floor(t-60*n*60-60*a);return o<0&&(o=0),{hours:n,minutes:a,seconds:o}}}return{hours:0,minutes:0,seconds:0}},n.isBetweenInTimeRange=function(e,t){var n=t.split("-"),a=o(n,2),i=a[0],r=a[1];if(void 0===r)return null;var l=s(i),d=s(r);return d<l&&(e>d?d.setDate(d.getDate()+1):l.setDate(l.getDate()-1)),e>=l&&e<=d},n.getHostNameUrl=function(){return location.protocol+"//"+location.host+"/"},n.getDifferenceSetOfObject=function(e,t){var n={};return"object"!==$.type(e)||"object"!==$.type(t)?n:($.each(t,function(t,a){t in e&&(p(e[t],a)||(n[t]=a))}),n)},n.deepEqual=function e(t,n){if(t===n)return!0;if($.type(t)!==$.type(n))return!1;if("number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n))return!0;if($.isArray(t)&&$.isArray(n)||"object"===$.type(t)&&"object"===$.type(n)){if(t.length!==n.length)return!1;for(var a in $.extend($.isArray(t)?[]:{},t,n)){if(void 0===t[a]||void 0===n[a])return!1;if(!e(t[a],n[a]))return!1}return!0}return!1}),f=(n.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=location.search.substring(1).match(t);return n?decodeURI(n[2]):null},n.getGBKEncodeString=function(e){var t=document.createElement("img");t.src="nothing?sp="+e,document.body.appendChild(t);var n=t.src.split("nothing?sp=").pop();return document.body.removeChild(t),n},n.htmlEncode=function(e){return e.length?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"<br>"):""},n.htmlDecode=function(e){return e.length?e.replace(/<br\s*\/?>/gi,"\n").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&nbsp;/gi," ").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&"):""},n.removeHtmlTag=function(e){return e?e.replace(/<br\s*\/?>/g,"\n").replace(/<[^>]+>/g,""):""},n.getObjectKeyList=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];if("object"!==$.type(e))return n;for(var a in e)n.push(a);return 0!==t&&n.sort(function(e,n){return t>0?e>n?1:-1:e<n?1:-1}),n});n.getSortedObjectKeyList=function(e,t){var n=f(t);return n.sort(function(t,n){return e.indexOf(t)>e.indexOf(n)?1:-1}),n},n.getStatFormatNumber=function(e){return e>=0?"<em>+"+e.toLocaleString()+"</em>":"<ins>"+e.toLocaleString()+"</ins>"},n.isOpera=function(){return void 0!==r.default.w.opera},n.isIE=function(){return void 0!==navigator.msMaxTouchPoints},n.isEdge=function(){return navigator.appVersion&&navigator.appVersion.includes("Edge")},n.compareSmLevel=function(e,t){var n="MAX"===e.toUpperCase()?Number.MAX_VALUE:parseInt(e),a="MAX"===t.toUpperCase()?Number.MAX_VALUE:parseInt(t);return n>a?1:n<a?-1:0},n.getCurrentThreadPage=function(){var e=/- (\d+) -/.exec($('.pages:first > li > a[href="javascript:;"]').text());return e?parseInt(e[1]):1},n.getFixedNumLocStr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.toFixed(t).split("."),a=o(n,2),i=a[0],r=a[1],l=parseInt(i).toLocaleString(),d="";return void 0!==r&&(d="."+r),l+d},n.removeUnpairedBBCodeContent=function(e){for(var t=[/\[color=.+?\]/g,/\[backcolor=.+?\]/g,/\[size=.+?\]/g,/\[font=.+?\]/g,/\[align=.+?\]/g,/\[b\]/g,/\[i\]/g,/\[u\]/g,/\[strike\]/g,/\[sup\]/g,/\[sub\]/g],n=[/\[\/color\]/g,/\[\/backcolor\]/g,/\[\/size\]/g,/\[\/font\]/g,/\[\/align\]/g,/\[\/b\]/g,/\[\/i\]/g,/\[\/u\]/g,/\[\/strike\]/g,/\[\/sup\]/g,/\[\/sub\]/g],a=0;a<t.length;a++){var o=e.match(t[a]),i=e.match(n[a]);(o?o.length:0)!==(i?i.length:0)&&(e=e.replace(t[a],"").replace(n[a],""))}return e},n.getStrByteLen=function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n)<0||e.charCodeAt(n)>255?2:1;return t},n.addCode=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=n?t.indexOf(n):t.indexOf("]")+1;if(void 0!==e.selectionStart){var o=e.selectionStart;e.value=e.value.substring(0,o)+t+e.value.substring(e.selectionEnd),e.selectionStart=o+a,e.selectionEnd=o+a+n.length}else e.value+=t},n.getSelText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},n.copyText=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!("execCommand"in document&&t.length))return!1;var e=t.data("copy-text");e&&(t=$('<span class="pd_hide">'+e.replace(/\n/g,"<br>")+"</span>").insertAfter(t)),a&&a.prop("hidden",!0);var o=null;if(t.is("input, textarea"))t.select(),o=document.execCommand("copy");else{var i=window.getSelection();i.selectAllChildren(t.get(0)),o=document.execCommand("copy"),i.removeAllRanges()}return e&&t.remove(),a&&a.removeProp("hidden"),o&&alert(n?n:"已复制"),o},n.getResponseMsg=function(e){var t=0,n="",a="",o=/<span style=".+?">(.+?)<\/span><br\s*\/?><a href="(.+?)">/i.exec(e);if(o)t=1,n=o[1],a=o[2];else{var i=/操作提示<br\s*\/?>\r\n(.+?)<br\s*\/?>\r\n<a href="javascript:history\.go\(-1\);">返回上一步操作<\/a>/i.exec(e);i&&(t=-1,n=i[1])}return{type:t,msg:n?n:"未能获得预期的回应",url:a}},n.entries=regeneratorRuntime.mark(function e(t){var n,a,o,i,r,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,a=!1,o=void 0,e.prev=3,i=Object.keys(t)[Symbol.iterator]();case 5:if(n=(r=i.next()).done){e.next=12;break}return l=r.value,e.next=9,[l,t[l]];case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),a=!0,o=e.t0;case 18:e.prev=18,e.prev=19,!n&&i.return&&i.return();case 21:if(e.prev=21,!a){e.next=24;break}throw o;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}),n.inFollowOrBlockUserList=function(e,t){return t.findIndex(function(t){return t.name&&t.name===e})},n.selectAll=function(e){return e.prop("checked",!0),!1},n.selectInverse=function(e){return e.each(function(){var e=$(this);e.prop("checked",!e.prop("checked"))}),!1},n.readData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.storageType;return"ByUid"===t||"Global"===t?GM_getValue(e):localStorage.getItem(e)},n.writeData=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.default.storageType;"ByUid"===n||"Global"===n?GM_setValue(e,t):localStorage.setItem(e,t)},n.deleteData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.storageType;"ByUid"===t||"Global"===t?GM_deleteValue(e):localStorage.removeItem(e)}},{"./Const":6,"./Info":9}]},{},[1]);