!function e(t,n,a){function i(r,l){if(!n[r]){if(!t[r]){var s="function"==typeof require&&require;if(!l&&s)return s(r,!0);if(o)return o(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var c=n[r]={exports:{}};t[r][0].call(c.exports,function(e){var n=t[r][1][e];return i(n?n:e)},c,c.exports,e,t,n,a)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<a.length;r++)i(a[r]);return i}({1:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}var o=e("./module/Info"),r=i(o),l=e("./module/Config"),s=e("./module/Util"),d=a(s),c=e("./module/Const"),p=i(c),u=e("./module/Msg"),f=(a(u),e("./module/Dialog")),m=(a(f),e("./module/Log")),g=(a(m),e("./module/TmpLog")),h=a(g),v=e("./module/LootLog"),b=(a(v),e("./module/Script")),y=a(b),_=e("./module/Public"),x=a(_),k=e("./module/Index"),C=a(k),w=e("./module/Read"),I=a(w),L=e("./module/Post"),S=a(L),T=e("./module/Other"),D=a(T),A=e("./module/Bank"),E=a(A),P=e("./module/Card"),N=a(P),M=e("./module/Item"),U=a(M),F=e("./module/Box"),B=a(F),j=e("./module/Loot"),O=a(j),q=e("./module/ConfigDialog"),R=(a(q),function(){try{r.default.w.Info=e("./module/Info").default,r.default.w.Util=e("./module/Util"),r.default.w.Const=e("./module/Const").default,r.default.w.Msg=e("./module/Msg"),r.default.w.Dialog=e("./module/Dialog"),r.default.w.Log=e("./module/Log"),r.default.w.TmpLog=e("./module/TmpLog"),r.default.w.LootLog=e("./module/LootLog"),r.default.w.Public=e("./module/Public"),r.default.w.Index=e("./module/Index"),r.default.w.Read=e("./module/Read"),r.default.w.Post=e("./module/Post"),r.default.w.Other=e("./module/Other"),r.default.w.Bank=e("./module/Bank"),r.default.w.Card=e("./module/Card"),r.default.w.Item=e("./module/Item"),r.default.w.Loot=e("./module/Loot"),r.default.w.Script=e("./module/Script");var t=e("./module/Config");r.default.w.readConfig=t.read,r.default.w.writeConfig=t.write}catch(e){console.log(e)}}),K=function(){var e=new Date;if(r.default.version="10.5.1",x.getUidAndUserName()){x.addPolyfill(),R(),(0,l.init)(),x.checkBrowserType(),x.appendCss(),x.addConfigAndLogDialogLink(),Config.animationEffectOffEnabled&&($.fx.off=!0),Config.customScriptEnabled&&y.runCustomScript("start"),x.repairBbsErrorCode(),window.addEventListener("beforeunload",x.preventCloseWindowWhenActioning),Config.showSearchLinkEnabled&&x.addSearchDialogLink(),x.bindSearchTypeSelectMenuClick(),x.makeSearchByBelowTwoKeyWordAvailable(),Config.addFastNavMenuEnabled&&x.addFastNavMenu(),Config.modifySideBarEnabled&&x.modifySideBar(),r.default.$userMenu.find('a[href^="login.php?action=quit"]').click(function(){return confirm("是否退出账号？")}),x.changeNewRateTipsColor(),r.default.isInHomePage?(C.handleIndexLink(),C.handleAtTips(),C.addSearchTypeSelectBox(),Config.smLevelUpAlertEnabled&&C.smLevelUpAlert(),Config.smRankChangeAlertEnabled&&C.smRankChangeAlert(),Config.showVipSurplusTimeEnabled&&C.showVipSurplusTime(),Config.homePageThreadFastGotoLinkEnabled&&C.addThreadFastGotoLink(),Config.fixedDepositDueAlertEnabled&&!d.getCookie(p.default.fixedDepositDueAlertCookieName)&&E.fixedDepositDueAlert(),2===parseInt(d.getCookie(p.default.lootCompleteCookieName))&&$("#pdLoot.indbox5").removeClass("indbox5").addClass("indbox6"),C.addPromoteHaloInterval(),Config.showChangePointsInfoEnabled&&C.addChangePointsInfoTips()):"/read.php"===location.pathname?(Config.turnPageViaKeyboardEnabled&&x.turnPageViaKeyboard(),I.fastGotoFloor(),Config.adjustThreadContentWidthEnabled&&I.adjustThreadContentWidth(),I.adjustThreadContentFontSize(),I.showAttachImageOutsideSellBox(),Config.parseMediaTagEnabled&&I.parseMediaTag(),Config.modifyKfOtherDomainEnabled&&I.modifyKFOtherDomainLink(),Config.customSmColorEnabled&&I.modifySmColor(),Config.customMySmColor&&I.modifyMySmColor(),Config.multiQuoteEnabled&&I.addMultiQuoteButton(),I.addFastGotoFloorInput(),I.addFloorGotoLink(),I.addStatAndBuyThreadBtn(),I.handleBuyThreadBtn(),I.addCopyBuyersListOption(),Config.userMemoEnabled&&I.addUserMemo(),I.addCopyCodeLink(),I.addMoreSmileLink(),S.addRedundantKeywordWarning(),$('a[href$="#install-script"]').length>0&&y.handleInstallScriptLink(),Config.preventCloseWindowWhenEditPostEnabled&&S.preventCloseWindowWhenEditPost(),Config.autoSavePostContentWhenSubmitEnabled&&S.savePostContentWhenSubmit()):"/thread.php"===location.pathname?(Config.highlightNewPostEnabled&&D.highlightNewPost(),Config.showFastGotoThreadPageEnabled&&D.addFastGotoThreadPageLink()):"/post.php"===location.pathname?(S.addRedundantKeywordWarning(),/\bmultiquote=1/i.test(location.href)?Config.multiQuoteEnabled&&S.handleMultiQuote(2):/\baction=quote/i.test(location.href)&&S.removeUnpairedBBCodeInQuoteContent(),S.addExtraPostEditorButton(),S.addExtraOptionInPostPage(),Config.preventCloseWindowWhenEditPostEnabled&&S.preventCloseWindowWhenEditPost(),Config.autoSavePostContentWhenSubmitEnabled&&S.savePostContentWhenSubmit(),r.default.isInMiaolaDomain&&S.addAttachChangeAlert()):/\/kf_fw_ig_my\.php$/.test(location.href)?(U.enhanceMyItemsPage(),U.addBatchUseAndConvertOldItemTypesButton()):"/kf_fw_ig_mybp.php"===location.pathname?(B.init(),U.addBatchUseAndSellItemsButton()):"/kf_fw_ig_shop.php"===location.pathname||("/kf_fw_ig_pklist.php"===location.pathname?O.addUserLinkInPkListPage():"/kf_fw_ig_halo.php"===location.pathname?($(".kf_fw_ig1:first").on("click",'a[href^="kf_fw_ig_halo.php?do=buy&id="]',function(){if(!confirm("是否提升战力光环？"))return!1;h.deleteValue(p.default.haloInfoTmpLogName)}),O.addUserLinkInHaloPage()):/\/hack\.php\?H_name=bank$/i.test(location.href)?E.handleBankPage():/\/kf_fw_card_my\.php$/.test(location.href)?N.addStartBatchModeButton():/\/message\.php\?action=read&mid=\d+/i.test(location.href)?(D.addFastDrawMoneyLink(),Config.modifyKfOtherDomainEnabled&&I.modifyKFOtherDomainLink()):/\/message\.php($|\?action=receivebox)/i.test(location.href)?D.addMsgSelectButton():/\/profile\.php\?action=show/i.test(location.href)?(D.handleProfilePage(),D.addFollowAndBlockAndMemoUserLink()):/\/personal\.php\?action=post/i.test(location.href)?10===Config.perPageFloorNum&&D.modifyMyPostLink():"/kf_growup.php"===location.pathname?D.addAutoChangeIdColorButton():"/guanjianci.php"===location.pathname?D.highlightUnReadAtTipsMsg():/\/profile\.php\?action=modify$/i.test(location.href)?(D.syncModifyPerPageFloorNum(),r.default.isInMiaolaDomain&&D.addAvatarChangeAlert()):/\/job\.php\?action=preview$/i.test(location.href)?S.modifyPostPreviewPage():"/search.php"===location.pathname?Config.turnPageViaKeyboardEnabled&&x.turnPageViaKeyboard():"/kf_fw_1wkfb.php"===location.pathname?(/\/kf_fw_1wkfb\.php\?ping=(2|4)/i.test(location.href)?(D.highlightRatingErrorSize(),/\/kf_fw_1wkfb\.php\?ping=2/i.test(location.href)&&D.refreshWaitCheckRatingPage()):/\/kf_fw_1wkfb\.php\?do=1/i.test(location.href)&&D.showSelfRatingErrorSizeSubmitWarning(),D.addLinksInGoodPostPage()):"/kf_no1.php"===location.pathname&&D.addUserNameLinkInRankPage()),Config.blockUserEnabled&&x.blockUsers(),Config.blockThreadEnabled&&x.blockThread(),Config.followUserEnabled&&x.followUsers(),r.default.isMobile&&x.bindElementTitleClick(),r.default.isInMiaolaDomain&&Config.kfSmileEnhanceExtensionEnabled&&["/read.php","/post.php","/message.php"].includes(location.pathname)&&S.importKfSmileEnhanceExtension();var t=!1;Config.autoPromoteHaloEnabled&&!d.getCookie(p.default.promoteHaloCookieName)&&(t=!0,O.getPromoteHaloInfo("/kf_fw_ig_index.php"===location.pathname)),"/kf_fw_ig_index.php"!==location.pathname||t||O.init();var n=!1;"/kf_fw_ig_index.php"===location.pathname||d.getCookie(p.default.lootCompleteCookieName)||(Config.autoLootEnabled?d.getCookie(p.default.lootAttackingCookieName)||$.isNumeric(d.getCookie(p.default.changePointsInfoCookieName))||t||(n=!0,O.checkLoot()):Config.autoSaveLootLogInSpecialCaseEnabled&&(n=!0,O.autoSaveLootLog())),Config.getBonusAfterLootCompleteEnabled||(n=!1),!Config.autoGetDailyBonusEnabled||d.getCookie(p.default.getDailyBonusCookieName)||n||x.getDailyBonus(),Config.autoSaveCurrentDepositEnabled&&r.default.isInHomePage&&x.autoSaveCurrentDeposit(),Config.autoChangeIdColorEnabled&&!d.getCookie(p.default.autoChangeIdColorCookieName)&&x.changeIdColor(),Config.timingModeEnabled&&(r.default.isInHomePage||"/kf_fw_ig_index.php"===location.pathname)&&x.startTimingMode(),Config.customScriptEnabled&&y.runCustomScript("end");var a=new Date;console.log("【KF Online助手】初始化耗时："+(a-e)+"ms")}};"undefined"!=typeof jQuery&&$(document).ready(K)},{"./module/Bank":2,"./module/Box":3,"./module/Card":4,"./module/Config":5,"./module/ConfigDialog":6,"./module/Const":7,"./module/Dialog":8,"./module/Index":9,"./module/Info":10,"./module/Item":11,"./module/Log":12,"./module/Loot":14,"./module/LootLog":15,"./module/Msg":16,"./module/Other":17,"./module/Post":18,"./module/Public":19,"./module/Read":20,"./module/Script":21,"./module/TmpLog":22,"./module/Util":23}],2:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.fixedDepositDueAlert=n.drawCurrentDeposit=n.handleBankPage=void 0;var i=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("./Util"),r=a(o),l=e("./Msg"),s=a(l),d=e("./Const"),c=function(e){return e&&e.__esModule?e:{default:e}}(d),p=e("./Log"),u=a(p),f=e("./TmpLog"),m=a(f),g=e("./Public"),h=a(g),v=(n.handleBankPage=function(){var e=$('.bank1 > tbody > tr:nth-child(2) > td:contains("当前所持：")');if(e.length){var t=e.html();e.html(t.replace(/当前所持：(-?\d+)KFB/,function(e,t){return'当前所持：<b id="pdCash" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b> KFB"}).replace(/活期存款：(-?\d+)KFB/,function(e,t){return'活期存款：<b id="pdCurrentDeposit" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b> KFB"}).replace(/定期存款：(-?\d+)KFB/,function(e,t){return'定期存款：<b id="pdFixedDeposit" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b> KFB"}).replace(/可获利息：(-?\d+)/,function(e,t){return'可获利息：<b id="pdInterest" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b> KFB "}).replace(/定期利息：([\d\.]+)%/,'定期利息：<b id="pdInterestRate" data-num="$1">$1</b>%').replace(/(，才可以获得利息）)/,'$1 <span id="pdExpireTime" style="color: #393;"></span>').replace(/(，取出定期将获得该数额的KFB利息\))/,'$1 <span id="pdExpectedInterest" style="color: #393;"></span>')),e.find("[data-num]").css("color","#f60");var n=$("#pdInterest"),a=parseInt(n.data("num"));a>0&&n.css("color","#393");var i=parseInt($("#pdFixedDeposit").data("num"));if(i>0&&0===a){var o=parseInt(m.getValue(c.default.fixedDepositDueTmpLogName));!isNaN(o)&&o>(new Date).getTime()&&$("#pdExpireTime").text("(到期时间："+r.getDateString(new Date(o))+" "+r.getTimeString(new Date(o),":",!1)+")");var l=parseFloat($("#pdInterestRate").data("num"))/100,s=Math.round(i*l*c.default.fixedDepositDueTime);$("#pdExpectedInterest").text("(预期利息："+s.toLocaleString()+" KFB)")}$('form[name="form1"], form[name="form2"]').submit(function(){var e=$(this),t=0;t=e.is('[name="form2"]')?parseInt(e.find('input[name="drawmoney"]').val()):parseInt(e.find('input[name="savemoney"]').val()),2===parseInt(e.find('input[name="btype"]:checked').val())&&t>0&&m.setValue(c.default.fixedDepositDueTmpLogName,r.getDate("+"+c.default.fixedDepositDueTime+"d").getTime())}),$('form[name="form3"]').submit(function(){var e=parseInt($("#pdCurrentDeposit").data("num")),t=parseInt($("#pdFixedDeposit").data("num")),n=parseInt($('[name="to_money"]').val());if(!isNaN(n)&&t>0&&n>e&&!confirm("你的活期存款不足，转账金额将从定期存款里扣除，是否继续？"))return $(this).find('[type="submit"]').prop("disabled",!1),!1});var d=$('a[href="hack.php?H_name=bank&action=log"]').parent();d.html(d.html().replace(/\(手续费(\d+)%\)/,'(手续费<span id="pdFee" data-num="$1">$1</span>%)'));var p=$('form[name="form3"] > span:first');p.html(p.html().replace(/可转账额度：(\d+)/,function(e,t){return'可转账额度：<b id="pdTransferLimit" data-num="'+t+'">'+parseInt(t).toLocaleString()+"</b>"})),_(),$(document).on("change",'[name="savemoney"], [name="drawmoney"], [name="to_money"], [name="to_money"], [name="transfer_money"]',function(){var e=$(this),t=$.trim(e.val());t&&e.val(t.replace(/,/g,""))})}},function(e,t,n){var a=s.wait("<strong>正在存款中&hellip;</strong>");$.post("hack.php?H_name=bank",{action:"save",btype:1,savemoney:e},function(i){h.showFormatLog("存款",i);var o=r.getResponseMsg(i),l=o.msg;/完成存款/.test(l)?(s.remove(a),console.log("共有"+e+"KFB存入活期存款"),$("#pdCash").text((t-e).toLocaleString()).data("num",t-e),$("#pdCurrentDeposit").text((n+e).toLocaleString()).data("num",n+e),setTimeout(function(){$(document).dequeue("Bank")},c.default.bankActionInterval)):($(document).clearQueue("Bank"),alert("存款失败"))})}),b=(n.drawCurrentDeposit=function(e){var t=s.wait("<strong>正在取款中&hellip;</strong>");$.post("hack.php?H_name=bank",{action:"draw",btype:1,drawmoney:e},function(n){h.showFormatLog("取款",n);var a=r.getResponseMsg(n),i=a.msg;s.remove(t),/完成取款/.test(i)?(console.log("从活期存款中取出了"+e+"KFB"),s.show("<strong>从活期存款中取出了<em>"+e.toLocaleString()+"</em>KFB</strong>",-1)):s.show(i,-1)})},function(e,t,n,a,o){var l=0,d=0,p=0;$.each(e,function(n,f){var m=i(f,2),g=m[0],v=m[1];$(document).queue("Bank",function(){$.ajax({type:"POST",url:"hack.php?H_name=bank",timeout:c.default.defAjaxTimeout,data:"&action=virement&pwuser="+r.getGBKEncodeString(g)+"&to_money="+v+"&memo="+r.getGBKEncodeString(t),success:function(e){h.showFormatLog("批量转账",e);var t=r.getResponseMsg(e),n=t.msg,a=g+" <em>+"+v.toLocaleString()+"</em>";/完成转帐!/.test(n)?(l++,p+=v):(d++,/用户<b>.+?<\/b>不存在/.test(n)&&(n="用户不存在"),a+=' <span class="pd_notice">(错误：'+n+")</span>"),$(".pd_result:last").append("<li>"+a+"</li>")},error:function(){d++,$(".pd_result:last").append("\n<li>\n  "+g+":"+v.toLocaleString()+'\n  <span class="pd_notice">(错误：连接超时，转账可能失败，请到<a target="_blank" href="hack.php?H_name=bank&action=log">银行日志</a>里进行确认)</span>\n</li>\n')},complete:function(){var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1);var i=t.closest(".pd_msg").data("stop");i&&$(document).clearQueue("Bank"),i||n===e.length-1?(s.destroy(),l>0&&u.push("批量转账","共有`"+l+"`名用户转账成功",{pay:{KFB:-p}}),$("#pdCurrentDeposit").text((a-p).toLocaleString()).data("num",a-p),$("#pdTransferLimit").text((o-p).toLocaleString()).data("num",o-p),console.log("共有"+l+"名用户转账成功，共有"+d+"名用户转账失败，KFB-"+p),$(".pd_result:last").append("<li><b>共有<em>"+l+"</em>名用户转账成功"+(d>0?"，共有<em>"+d+"</em>名用户转账失败":"")+"：</b>KFB <ins>-"+p.toLocaleString()+"</ins></li>"),s.show("<strong>共有<em>"+l+"</em>名用户转账成功"+(d>0?"，共有<em>"+d+"</em>名用户转账失败":"")+"</strong><i>KFB<ins>-"+p.toLocaleString()+"</ins></i>",-1)):setTimeout(function(){return $(document).dequeue("Bank")},c.default.bankActionInterval)}})})}),n||$(document).dequeue("Bank")}),y=function(e){var t=e.find('[name="users"]'),n=t.val();if(!/^\s*\S+\s*$/m.test(n)||/^\s*:/m.test(n)||/:/.test(n)&&/:(\D|$)/m.test(n))return alert("用户列表格式不正确"),t.select().focus(),!1;if(/^\s*\S+?:0*[0-1]?\d\s*$/m.test(n))return alert("转帐金额不能小于20KFB"),t.select().focus(),!1;var a=e.find('[name="transfer_money"]'),i=parseInt(a.val());if(/^\s*[^:]+\s*$/m.test(n)){if(!$.isNumeric(i))return alert("通用转账金额格式不正确"),a.select().focus(),!1;if(i<20)return alert("转帐金额不能小于20KFB"),a.select().focus(),!1}return!0},_=function(){var e=$('\n<tr id="pdBankTransferArea">\n  <td style="vertical-align: top;">\n    使用说明：<br>每行一名用户，<br>如需单独设定金额，<br>可写为“用户名:金额”<br>（注意是<b>英文冒号</b>）<br>例子：<br>\n    <pre style="border: 1px solid #9999ff; padding: 5px;">张三\n李四:200\n王五:500\n信仰风</pre>\n  </td>\n  <td>\n  <form>\n    <div style="display: inline-block;">\n      <label>用户列表：<br>\n        <textarea class="pd_textarea" name="users" style="width: 270px; height: 250px;"></textarea>\n      </label>\n    </div>\n    <div style="display: inline-block; margin-left: 10px;">\n      <label>通用转帐金额（如所有用户都已设定单独金额则可留空）：<br>\n        <input class="pd_input" name="transfer_money" type="text" style="width: 217px;">\n      </label><br>\n      <label style="margin-top: 5px;">转帐附言（可留空）：<br>\n        <textarea class="pd_textarea" name="msg" style="width: 225px; height: 206px;"></textarea>\n      </label>\n    </div>\n    <div>\n      <button type="submit">批量转账</button>\n      <button type="reset">重置</button>\n      <button name="random" type="button" title="为用户列表上的每个用户设定指定范围内的随机金额">随机金额</button>\n      （活期存款不足时，将自动进行存款；批量转账金额不会从定期存款中扣除）\n    </div>\n  </form>\n  </td>\n</tr>\n').appendTo(".bank1 > tbody");e.find("form").submit(function(t){if(t.preventDefault(),s.destroy(),y(e)){var n=parseInt(e.find('[name="transfer_money"]').val());n||(n=0);var a=e.find('[name="msg"]').val(),o=[],r=!0,l=!1,d=void 0;try{for(var c,p=e.find('[name="users"]').val().split("\n")[Symbol.iterator]();!(r=(c=p.next()).done);r=!0){var u=c.value;if(u=$.trim(u))if(u.includes(":")){var f=u.split(":"),m=i(f,2),g=m[0],h=m[1];if(void 0===h)continue;o.push([$.trim(g),parseInt(h)])}else o.push([u,n])}}catch(e){l=!0,d=e}finally{try{!r&&p.return&&p.return()}finally{if(l)throw d}}if(o.length){var _=parseInt($("#pdFee").data("num"));isNaN(_)&&(_=0);var x=0,k=!0,C=!1,w=void 0;try{for(var I,L=o[Symbol.iterator]();!(k=(I=L.next()).done);k=!0){x+=i(I.value,2)[1]}}catch(e){C=!0,w=e}finally{try{!k&&L.return&&L.return()}finally{if(C)throw w}}if(x=Math.floor(x*(1+_)),confirm("共计 "+o.length+" 名用户，总额 "+x.toLocaleString()+" KFB，是否转账？")){var S=s.wait("<strong>正在获取银行账户信息中&hellip;</strong>");$.get("hack.php?H_name=bank&t="+(new Date).getTime(),function(t){s.remove(S);var n=0,i=0,r=0,l=/当前所持：(-?\d+)KFB/.exec(t);if(l&&(n=parseInt(l[1]),(l=/活期存款：(-?\d+)KFB/.exec(t))&&(i=parseInt(l[1]),l=/可转账额度：(\d+)/.exec(t)))){if(r=parseInt(l[1]),x>n+i)return void alert("资金不足");if(x>r)return void alert("转账额度不足");$(document).clearQueue("Bank");var d=!1,c=x-i;c>0&&(d=!0,$(document).queue("Bank",function(){v(c,n,i),n-=c,i+=c}),$(document).dequeue("Bank")),s.wait('<strong>正在批量转账中，请耐心等待&hellip;</strong><i>剩余：<em class="pd_countdown">'+o.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),e.find("> td:last-child").append('<ul class="pd_result pd_stat"><li><strong>转账结果：</strong></li></ul>'),b(o,a,d,i,r)}})}}}}).find('[name="random"]').click(function(){var t=[],n=!0,a=!1,i=void 0;try{for(var o,r=e.find('[name="users"]').val().split("\n")[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;l=$.trim(l),l&&t.push($.trim(l.split(":")[0]))}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}if(t.length){var s=prompt("设定随机金额的范围（注：最低转账金额为20KFB）","20-100");if(null!==s){if(s=$.trim(s),!/^\d+-\d+$/.test(s))return void alert("随机金额范围格式不正确");var d=s.split("-"),c=parseInt(d[0]),p=parseInt(d[1]);if(p<c)return void alert("最大值不能低于最小值");var u="",f=!0,m=!1,g=void 0;try{for(var h,v=t[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){u+=h.value+":"+Math.floor(Math.random()*(p-c+1)+c)+"\n"}}catch(e){m=!0,g=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw g}}e.find('[name="users"]').val(u)}}})};n.fixedDepositDueAlert=function(){console.log("定期存款到期提醒Start"),$.get("hack.php?H_name=bank&t="+(new Date).getTime(),function(e){r.setCookie(c.default.fixedDepositDueAlertCookieName,1,r.getMidnightHourDate(1));var t=/可获利息：(\d+)/.exec(e);if(t){var n=parseInt(t[1]);n>0&&(r.setCookie(c.default.fixedDepositDueAlertCookieName,1,r.getMidnightHourDate(7)),confirm("您的定期存款已到期，共产生利息 "+n.toLocaleString()+" KFB，是否前往银行取款？")&&(location.href="hack.php?H_name=bank"))}})}},{"./Const":7,"./Log":12,"./Msg":16,"./Public":19,"./TmpLog":22,"./Util":23}],3:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.init=n.boxTypeList=void 0;var i=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("./Util"),r=a(o),l=e("./Msg"),s=a(l),d=e("./Const"),c=function(e){return e&&e.__esModule?e:{default:e}}(d),p=e("./Log"),u=a(p),f=e("./Script"),m=a(f),g=e("./Item"),h=a(g),v=e("./Public"),b=a(v),y=n.boxTypeList=["普通盒子","幸运盒子","稀有盒子","传奇盒子","神秘盒子"],_=void 0,x=void 0,k=(n.init=function(){(x=b.getSafeId())&&(_=$(".kf_fw_ig1:first"),k(),C())},function(){_=$(".kf_fw_ig1:first"),_.find('> tbody > tr:nth-child(3) > td > a[onclick^="dkhz"]').each(function(){var e=$(this),t=/dkhz\('(\d+)'\)/.exec(e.attr("onclick"));t&&e.after('<a class="pd_highlight" href="#" data-name="openBoxes" data-id="'+t[1]+'" style="margin-left: 10px;">批量打开</a>')}),_.on("click",'a[data-name="openBoxes"]',function(e){e.preventDefault();var t=$(this),n=parseInt(t.data("id")),a=_.find("> tbody > tr:nth-child(2) > td:nth-child("+n+")"),i=a.find("span:first").text().trim()+"盒子";if(y.includes(i)){var o=parseInt(a.find("span:last").text()),r=parseInt(prompt("你要打开多少个【"+i+"】？",o));!r||r<0||w({id:n,boxType:i,num:r,safeId:x})}})}),C=function(){$('\n<div class="pd_item_btns">\n  <button name="openAllBoxes" type="button" style="color: #f00;" title="打开全部盒子">一键开盒</button>\n</div>\n').insertAfter(_).find('[name="openAllBoxes"]').click(function(){confirm("是否打开全部盒子？")&&(s.destroy(),$(document).clearQueue("OpenAllBoxes"),_.find("> tbody > tr:nth-child(2) > td").each(function(e){var t=$(this);$(document).queue("OpenAllBoxes",function(){var n=t.find("span:first").text().trim()+"盒子";if(y.includes(n)){var a=parseInt(t.find("span:last").text());if(a&&!(a<0)){var i=parseInt(_.find("> tbody > tr:nth-child(3) > td:nth-child("+(e+1)+') > a[data-name="openBoxes"]').data("id"));i&&w({id:i,boxType:n,num:a,safeId:x})}}})}),$(document).dequeue("OpenAllBoxes"))}),b.addSimulateManualActionChecked($(".pd_item_btns:first"))},w=function(e){var t=e.id,n=e.boxType,a=e.num,o=e.safeId,l=0,d=0,p=0,f=!1,g={KFB:0,"经验值":0,"道具":0,"装备":0,item:{},arm:{}};_.parent().append('<ul class="pd_result" data-name="boxResult"><li><strong>【'+n+"】打开结果：</strong></li></ul>");var v=s.wait('<strong>正在打开盒子中&hellip;</strong><i>剩余：<em class="pd_countdown">'+a+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),y=function e(){$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=3&id="+t+"&safeid="+o,timeout:c.default.defAjaxTimeout}).done(function(t){p++;var n=r.removeHtmlTag(t);if(n.includes("获得")){l++;var a=/获得\[(\d+)]KFB/.exec(n);if(a&&(g.KFB+=parseInt(a[1])),a=/获得\[(\d+)]经验值/.exec(n),a&&(g["经验值"]+=parseInt(a[1])),a=/打开盒子获得了道具\[\s*(.+?)\s*]/.exec(n)){g["道具"]++;var i=a[1];i in g.item||(g.item[i]=0),g.item[i]++}if(a=/获得一件\[(.+?)]的?装备/.exec(n)){g["装备"]++;var o=a[1]+"装备";o in g.arm||(g.arm[o]=0),g.arm[o]++}}else n.includes("操作过快")?$(document).queue("OpenBoxes",e):n.includes("盒子不足")?($(document).clearQueue("OpenBoxes"),f=!0):d++;console.log("第"+p+"次："+n),$('.pd_result[data-name="boxResult"]:last').append("<li><b>第"+p+"次：</b>"+n+"</li>")}).fail(function(){d++}).always(function(){var e=$(document).queue("OpenBoxes").length,a=$(".pd_countdown:last");a.text(e);var o=a.closest(".pd_msg").data("stop");if(f=f||o,o&&$(document).clearQueue("OpenAllBoxes"),f||!e){s.remove(v);var y=!0,x=!1,k=void 0;try{for(var C,w=r.entries(g)[Symbol.iterator]();!(y=(C=w.next()).done);y=!0){var I=i(C.value,2),L=I[0],S=I[1];(!S||"object"===$.type(S)&&$.isEmptyObject(S))&&delete g[L]}}catch(e){x=!0,k=e}finally{try{!y&&w.return&&w.return()}finally{if(x)throw k}}$.isEmptyObject(g)||u.push("打开盒子","共有`"+l+"`个【`"+n+"`】打开成功",{gain:g,pay:{"盒子":-l}});var T=_.find("> tbody > tr:nth-child(2) > td:nth-child("+t+") > span:last"),D=parseInt(T.text());D>0&&T.text(D-l);var A="",E=!0,P=!1,N=void 0;try{for(var M,U=r.entries(g)[Symbol.iterator]();!(E=(M=U.next()).done);E=!0){var F=i(M.value,2),L=F[0],S=F[1];if("object"===$.type(S)){var B="item"===L?h.itemTypeList:h.armTypeList;A&&(A+="<br>"+("item"===L?"道具":"装备")+"：");var j=!0,O=!1,q=void 0;try{for(var R,K=r.getSortedObjectKeyList(B,S)[Symbol.iterator]();!(j=(R=K.next()).done);j=!0){var H=R.value;A+="<i>"+H+"<em>+"+S[H].toLocaleString()+"</em></i> "}}catch(e){O=!0,q=e}finally{try{!j&&K.return&&K.return()}finally{if(O)throw q}}}else A+="<i>"+L+"<em>+"+S.toLocaleString()+"</em></i> "}}catch(e){P=!0,N=e}finally{try{!E&&U.return&&U.return()}finally{if(P)throw N}}$('.pd_result[data-name="boxResult"]:last').append('<li class="pd_stat"><b>统计结果：</b><br>'+(A?A:"无")+"</li>"),console.log("共有"+l+"个【"+n+"】打开成功"+(d>0?"，共有"+d+"个盒子打开失败":"")),s.show("<strong>共有<em>"+l+"</em>个【"+n+"】打开成功"+(d>0?"，共有<em>"+d+"</em>个盒子打开失败":"")+"</strong>",-1),m.runFunc("Box.openBoxes_after_",g),setTimeout(b.getNextObjects,c.default.defAjaxInterval),setTimeout(function(){return $(document).dequeue("OpenAllBoxes")},"function"==typeof c.default.specialAjaxInterval?c.default.specialAjaxInterval():c.default.specialAjaxInterval)}else p%10==0&&setTimeout(b.getNextObjects,c.default.defAjaxInterval),setTimeout(function(){return $(document).dequeue("OpenBoxes")},"function"==typeof c.default.specialAjaxInterval?c.default.specialAjaxInterval():c.default.specialAjaxInterval)})};$(document).clearQueue("OpenBoxes"),$.each(new Array(a),function(){$(document).queue("OpenBoxes",y)}),$(document).dequeue("OpenBoxes")}},{"./Const":7,"./Item":11,"./Log":12,"./Msg":16,"./Public":19,"./Script":21,"./Util":23}],4:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.addStartBatchModeButton=void 0;var i=e("./Util"),o=a(i),r=e("./Const"),l=function(e){return e&&e.__esModule?e:{default:e}}(r),s=e("./Msg"),d=a(s),c=e("./Log"),p=a(c),u=e("./Public"),f=a(u),m=function(e,t){var n=0,a=0,i=0,r=0;$(document).clearQueue("ConvertCardsToVipTime"),$.each(e,function(s,c){$(document).queue("ConvertCardsToVipTime",function(){$.ajax({type:"GET",url:"kf_fw_card_doit.php?do=recard&id="+c+"&safeid="+t+"&t="+(new Date).getTime(),timeout:l.default.defAjaxTimeout,success:function(e){f.showFormatLog("将卡片转换为VIP时间",e);var t=o.getResponseMsg(e),l=t.msg,s=/增加(\d+)小时VIP时间(?:.*?获得(\d+)点恢复能量)?/.exec(l);s?(n++,i+=parseInt(s[1]),void 0!==s[2]&&(r+=parseInt(s[2]))):a++},error:function(){a++},complete:function(){var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1);var o=t.closest(".pd_msg").data("stop");o&&$(document).clearQueue("ConvertCardsToVipTime"),o||s===e.length-1?(n>0&&p.push("将卡片转换为VIP时间","共有`"+n+"`张卡片成功为VIP时间",{gain:{"VIP小时":i,"能量":r},pay:{"卡片":-n}}),d.destroy(),console.log("共有"+n+"张卡片转换成功，共有"+a+"张卡片转换失败，VIP小时+"+i+"，能量+"+r),d.show("<strong>共有<em>"+n+"</em>张卡片转换成功"+(a>0?"，共有<em>"+a+"</em>张卡片转换失败":"")+"</strong><i>VIP小时<em>+"+i+"</em></i><i>能量<em>+"+r+"</em></i>",-1),$(".kf_fw_ig2 .pd_card_chk:checked").closest("td").fadeOut("normal",function(){var e=$(this).parent();$(this).remove(),e.children().length||e.remove()})):setTimeout(function(){$(document).dequeue("ConvertCardsToVipTime")},l.default.defAjaxInterval)}})})}),$(document).dequeue("ConvertCardsToVipTime")};n.addStartBatchModeButton=function(){var e=f.getSafeId();e&&$('.kf_fw_ig2 a[href^="kf_fw_card_my.php?id="]').length&&$('<div class="pd_item_btns"><button>开启批量模式</button></div>').insertAfter(".kf_fw_ig2").find("button").click(function(){var t=$(this),n=$(".kf_fw_ig2 > tbody > tr:gt(2)");if("开启批量模式"===t.text()){t.text("关闭批量模式"),n.on("click","a",function(e){e.preventDefault(),$(this).next(".pd_card_chk").click()}).find("td").has("a").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&$(this).css("position","relative").append('<input class="pd_card_chk" type="checkbox" value="'+e[1]+'">')});var a=[];$(".kf_fw_ig2 > tbody > tr:nth-child(2) > td").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&a.push(parseInt(e[1]))});var i=function(){var e=!0,t=!1,i=void 0;try{for(var o,r=a[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var l=o.value;n.find("td").has('a[href="kf_fw_card_my.php?id='+l+'"]').find('[type="checkbox"]').prop("checked",!1)}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}},r=$('\n<label><input name="uncheckPlayedCard" type="checkbox" checked> 不选已出战的卡片</label>\n<button name="selectOnlyOne" type="button">每类只保留一张</button>\n<button name="selectAll" type="button">全选</button>\n<button name="selectInverse" type="button">反选</button><br>\n<button name="convertCardsToVipTime" type="button">转换为VIP时间</button>\n').insertBefore(t);r.filter('[name="selectOnlyOne"]').click(function(){o.selectAll(n.find('[type="checkbox"]')),r.find('[name="uncheckPlayedCard"]').prop("checked")&&i();var e=new Set;n.find("a > img").each(function(){e.add($(this).attr("src"))});var t=!0,a=!1,l=void 0;try{for(var s,d=e[Symbol.iterator]();!(t=(s=d.next()).done);t=!0){var c=s.value,p=n.find("td").has('img[src="'+c+'"]'),u=p.length,f=p.has('[type="checkbox"]:checked').length;u>1?u===f&&p.eq(0).find('[type="checkbox"]:checked').prop("checked",!1):p.find('[type="checkbox"]:checked').prop("checked",!1)}}catch(e){a=!0,l=e}finally{try{!t&&d.return&&d.return()}finally{if(a)throw l}}}).end().filter('[name="selectAll"]').click(function(){o.selectAll(n.find('[type="checkbox"]')),r.find('[name="uncheckPlayedCard"]').prop("checked")&&i()}).end().filter('[name="selectInverse"]').click(function(){o.selectInverse(n.find('[type="checkbox"]')),r.find('[name="uncheckPlayedCard"]').prop("checked")&&i()}).end().filter('[name="convertCardsToVipTime"]').click(function(){d.destroy();var t=[];n.find('[type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length&&confirm("共选择了"+t.length+"张卡片，是否将卡片批量转换为VIP时间？")&&(d.wait('<strong>正在批量转换中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),m(t,e))})}else t.text("开启批量模式"),n.off("click").find(".pd_card_chk").remove(),t.prevAll().remove()})}},{"./Const":7,"./Log":12,"./Msg":16,"./Public":19,"./Util":23}],5:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.normalize=n.changeStorageType=n.clear=n.write=n.read=n.init=n.Config=void 0;var o=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e("./Info"),l=i(r),s=e("./Util"),d=a(s),c=e("./Const"),p=i(c),u=e("./Log"),f=a(u),m=e("./TmpLog"),g=a(m),h=e("./LootLog"),v=a(h),b=p.default.storagePrefix+"config",y=n.Config={timingModeEnabled:!1,showTimingModeTipsType:"auto",autoGetDailyBonusEnabled:!1,getBonusAfterLootCompleteEnabled:!1,getBonusAfterSpeakCompleteEnabled:!1,autoPromoteHaloEnabled:!1,promoteHaloCostType:1,promoteHaloInterval:8,promoteHaloAutoIntervalEnabled:!0,promoteHaloLimit:0,autoLootEnabled:!1,attackTargetLevel:0,autoSaveLootLogInSpecialCaseEnabled:!1,checkLootAfterTime:"00:05:00",lootLogSaveDays:7,showChangePointsInfoEnabled:!1,levelPointList:{},autoChangeLevelPointsEnabled:!1,customPointsScriptEnabled:!1,
unusedPointNumAlertEnabled:!0,slowAttackEnabled:!1,showLevelEnemyStatEnabled:!1,showLiteLootLogEnabled:!1,atTipsHandleType:"no_highlight",smLevelUpAlertEnabled:!1,fixedDepositDueAlertEnabled:!1,smRankChangeAlertEnabled:!1,homePageThreadFastGotoLinkEnabled:!0,showVipSurplusTimeEnabled:!1,showFastGotoThreadPageEnabled:!1,maxFastGotoThreadPageNum:5,perPageFloorNum:10,highlightNewPostEnabled:!0,adjustThreadContentWidthEnabled:!1,threadContentFontSize:0,customMySmColor:"",customSmColorEnabled:!1,customSmColorConfigList:[],modifyKfOtherDomainEnabled:!0,multiQuoteEnabled:!0,userMemoEnabled:!1,userMemoList:{},parseMediaTagEnabled:!0,turnPageViaKeyboardEnabled:!1,buyThreadNoJumpEnabled:!0,preventCloseWindowWhenEditPostEnabled:!0,autoSavePostContentWhenSubmitEnabled:!1,kfSmileEnhanceExtensionEnabled:!1,defShowMsgDuration:-1,animationEffectOffEnabled:!1,showSearchLinkEnabled:!0,addFastNavMenuEnabled:!0,modifySideBarEnabled:!1,customCssEnabled:!1,customCssContent:"",customScriptEnabled:!1,customScriptList:[],browseType:"auto",followUserEnabled:!1,followUserList:[],highlightFollowUserThreadInHPEnabled:!0,highlightFollowUserThreadLinkEnabled:!0,blockUserEnabled:!1,blockUserDefaultType:0,blockUserAtTipsEnabled:!0,blockUserForumType:0,blockUserFidList:[],blockUserList:[],blockThreadEnabled:!1,blockThreadDefForumType:0,blockThreadDefFidList:[],blockThreadList:[],autoSaveCurrentDepositEnabled:!1,saveCurrentDepositAfterKfb:0,saveCurrentDepositKfb:0,logSaveDays:30,logSortType:"time",logStatType:"current",logStatDays:7,autoChangeIdColorEnabled:!1,autoChangeIdColorType:"random",autoChangeIdColorInterval:24,changeAllAvailableIdColorEnabled:!0,customAutoChangeIdColorList:[],simulateManualActionEnabled:!1,defUseItemTypeList:[],defSellItemTypeList:[]},_=(n.init=function(){l.default.w.Config=$.extend(!0,{},y),"undefined"!=typeof GM_getValue&&(l.default.storageType=GM_getValue("StorageType"),"ByUid"!==l.default.storageType&&"Global"!==l.default.storageType&&(l.default.storageType="Default")),_()},n.read=function(){var e=d.readData("ByUid"===l.default.storageType?b+"_"+l.default.uid:b);if(e){try{e=JSON.parse(e)}catch(e){return}e&&"object"===$.type(e)&&!$.isEmptyObject(e)&&(e=k(e),l.default.w.Config=$.extend(!0,{},y,e))}}),x=n.write=function(){var e=d.getDifferenceSetOfObject(y,l.default.w.Config);d.writeData("ByUid"===l.default.storageType?b+"_"+l.default.uid:b,JSON.stringify(e))},k=(n.clear=function(){return d.deleteData("ByUid"===l.default.storageType?b+"_"+l.default.uid:b)},n.changeStorageType=function(e){var t=f.read(),n=g.read(),a=v.read();l.default.storageType=e,"undefined"!=typeof GM_setValue&&GM_setValue("StorageType",l.default.storageType),d.deepEqual(y,l.default.w.Config)&&$.isEmptyObject(t)||confirm("是否将助手设置和日志转移到对应存储类型中？（对应存储类型中的数据将被覆盖）")&&(x(),f.write(t),g.write(n),v.write(a))},n.normalize=function(e){var t={};if("object"!==$.type(e))return t;var n=!0,a=!1,i=void 0;try{for(var r,l=d.entries(e)[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var s=o(r.value,2),c=s[0],p=s[1];c in y&&$.type(p)===$.type(y[c])&&(t[c]=p)}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}return void 0!==t.lootLogSaveDays&&t.lootLogSaveDays>20&&(t.lootLogSaveDays=20),t})},{"./Const":7,"./Info":10,"./Log":12,"./LootLog":15,"./TmpLog":22,"./Util":23}],6:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.show=void 0;var _slicedToArray=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Config=require("./Config"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_Public=require("./Public"),Public=_interopRequireWildcard(_Public),_Script=require("./Script"),Script=_interopRequireWildcard(_Script),show=exports.show=function(){if(!($("#pdConfigDialog").length>0)){(0,_Config.read)(),Script.runFunc("ConfigDialog.show_before_");var e='\n<div class="pd_cfg_main">\n  <div class="pd_cfg_nav">\n    <a class="pd_btn_link" data-name="clearTmpData" title="清除与助手有关的Cookies和本地存储数据（不包括助手设置和日志）" href="#">清除临时数据</a>\n    <a class="pd_btn_link" data-name="openRumCommandDialog" href="#">运行命令</a>\n    <a class="pd_btn_link" data-name="openImportOrExportSettingDialog" href="#">导入/导出设置</a>\n  </div>\n\n  <div class="pd_cfg_panel" style="margin-bottom: 5px;">\n    <fieldset>\n      <legend>\n        <label>\n          <input name="timingModeEnabled" type="checkbox"> 定时模式\n          <span class="pd_cfg_tips" title="可按时进行自动操作（包括自动领取每日奖励、自动提升战力光环、自动争夺，需开启相关功能）\n只在论坛首页和争夺首页生效（不开启此模式的话只能在刷新页面后才会进行操作）">[?]</span>\n        </label>\n      </legend>\n      <label>\n        标题提示方案\n        <select name="showTimingModeTipsType">\n          <option value="auto">停留一分钟后显示</option>\n          <option value="always">总是显示</option>\n          <option value="never">不显示</option>\n        </select>\n        <span class="pd_cfg_tips" title="在首页的网页标题上显示定时模式提示的方案">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label><input name="autoGetDailyBonusEnabled" type="checkbox"> 自动领取每日奖励</label>\n      </legend>\n      <label>\n        <input name="getBonusAfterLootCompleteEnabled" type="checkbox"> 完成争夺后才领取\n        <span class="pd_cfg_tips" title="在完成争夺奖励后才领取每日奖励">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="getBonusAfterSpeakCompleteEnabled" type="checkbox"> 完成发言后才领取\n        <span class="pd_cfg_tips" title="在完成发言奖励后才领取每日奖励">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label><input name="autoPromoteHaloEnabled" type="checkbox"> 自动提升战力光环</label>\n      </legend>\n      <label>\n        花费\n        <select name="promoteHaloCostType" required>\n          <option value="1">100KFB</option>\n          <option value="2">1000KFB</option>\n          <option value="11">0.2贡献</option>\n          <option value="12">2贡献</option>\n        </select>\n        <span class="pd_cfg_tips" title="提升战力光环的花费类型">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n         高于 <input name="promoteHaloLimit" type="number" min="0" step="0.1" style="width: 55px;" required>\n         <span data-id="promoteHaloLimitUnit">KFB</span>时\n         <span class="pd_cfg_tips" title="在操作后所剩余的KFB或贡献高于指定值时才自动提升战力光环，设为0表示不限制">[?]</span>\n      </label><br>\n      <label>\n        每隔 <input name="promoteHaloInterval" type="number" min="8" style="width: 40px;" required> 小时\n        <span class="pd_cfg_tips" title="自动提升战力光环的间隔时间，最低值：8小时">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="promoteHaloAutoIntervalEnabled" type="checkbox" data-mutex="[name=promoteHaloInterval]"> 自动判断\n        <span class="pd_cfg_tips" title="自动判断提升战力光环的间隔时间（在有剩余次数时尽可能使用）">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>争夺相关</legend>\n      <label>\n        <input name="autoLootEnabled" type="checkbox" data-mutex="[name=autoSaveLootLogInSpecialCaseEnabled]"> 自动争夺\n        <span class="pd_cfg_tips" title="当发现可以进行争夺时，会跳转到争夺首页进行自动攻击（点数分配等相关功能请在争夺首页上设置）">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        攻击到第 <input name="attackTargetLevel" type="number" min="0" style="width: 40px;" required> 层\n        <span class="pd_cfg_tips" title="自动争夺的目标攻击层数（设为0表示攻击到被击败为止）">[?]</span>\n      </label><br>\n      <label>\n        <input name="autoSaveLootLogInSpecialCaseEnabled" type="checkbox"> 在不使用助手争夺的情况下自动保存争夺记录\n        <span class="pd_cfg_tips" title="在不使用助手争夺的情况下自动检查并保存争夺记录（使用助手进行争夺的用户请勿勾选此选项）">[?]</span>\n      </label><br>\n      <label>\n        在 <input name="checkLootAfterTime" type="text" maxlength="8" style="width: 55px;" required> 之后争夺\n        <span class="pd_cfg_tips" title="在当天的指定时间之后检查争夺情况（本地时间），例：00:05:00">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        争夺记录保存天数 <input name="lootLogSaveDays" type="number" min="1" max="20" style="width: 40px;" required>\n        <span class="pd_cfg_tips" title="默认值：'+_Config.Config.lootLogSaveDays+'，最大值：20">[?]</span>\n      </label><br>\n      <label>\n        <input name="showChangePointsInfoEnabled" type="checkbox"> 在首页显示改点剩余次数\n        <span class="pd_cfg_tips" title="在首页显示改点剩余次数，冷却时则显示倒计时">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>帖子页面相关</legend>\n      <label>\n        帖子每页楼层数量\n        <select name="perPageFloorNum">\n          <option value="10">10</option>\n          <option value="20">20</option>\n          <option value="30">30</option>\n        </select>\n        <span class="pd_cfg_tips" title="用于电梯直达和帖子页数快捷链接等功能，如果修改了论坛设置里的“文章列表每页个数”，请在此修改成相同的数目">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        帖子内容字体大小 <input name="threadContentFontSize" type="number" min="7" max="72" style="width: 40px;"> px\n        <span class="pd_cfg_tips" title="帖子内容字体大小，留空表示使用默认大小，推荐值：14">[?]</span>\n      </label><br>\n      <label>\n        <input name="adjustThreadContentWidthEnabled" type="checkbox"> 调整帖子内容宽度\n        <span class="pd_cfg_tips" title="调整帖子内容宽度，使其保持一致">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="turnPageViaKeyboardEnabled" type="checkbox"> 通过左右键翻页\n        <span class="pd_cfg_tips" title="在帖子和搜索页面通过左右键进行翻页">[?]</span>\n      </label><br>\n      <label>\n        <input name="autoChangeIdColorEnabled" type="checkbox" data-disabled="[data-name=openAutoChangeSmColorPage]"> 自动更换ID颜色\n        <span class="pd_cfg_tips" title="可自动更换ID颜色，请点击详细设置前往相应页面进行自定义设置">[?]</span>\n      </label>\n      <a data-name="openAutoChangeSmColorPage" class="pd_cfg_ml" target="_blank" href="kf_growup.php">详细设置&raquo;</a><br>\n      <label>\n        自定义本人的神秘颜色 <input name="customMySmColor" maxlength="7" style="width: 50px;" type="text">\n        <input style="margin-left: 0;" type="color" data-name="customMySmColorSelect">\n        <span class="pd_cfg_tips" title="自定义本人的神秘颜色（包括帖子页面的ID显示颜色和楼层边框颜色，仅自己可见），例：#009cff，如无需求可留空">[?]</span>\n      </label><br>\n      <label>\n        <input name="customSmColorEnabled" type="checkbox" data-disabled="[data-name=openCustomSmColorDialog]"> 自定义各等级神秘颜色\n        <span class="pd_cfg_tips" title="自定义各等级神秘颜色（包括帖子页面的ID显示颜色和楼层边框颜色，仅自己可见），请点击详细设置自定义各等级颜色">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomSmColorDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="userMemoEnabled" type="checkbox" data-disabled="[data-name=openUserMemoDialog]"> 显示用户备注\n        <span class="pd_cfg_tips" title="在楼层内的用户名旁显示该用户的自定义备注，请点击详细设置自定义用户备注">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openUserMemoDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="modifyKfOtherDomainEnabled" type="checkbox"> 将绯月其它域名的链接修改为当前域名\n        <span class="pd_cfg_tips" title="将帖子和短消息中的绯月其它域名的链接修改为当前域名">[?]</span>\n      </label><br>\n      <label>\n        <input name="multiQuoteEnabled" type="checkbox"> 开启多重引用功能\n        <span class="pd_cfg_tips" title="在帖子页面开启多重回复和多重引用功能">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="parseMediaTagEnabled" type="checkbox"> 解析多媒体标签\n        <span class="pd_cfg_tips" title="在帖子页面解析HTML5多媒体标签，详见【常见问题12】">[?]</span>\n      </label><br>\n      <label>\n        <input name="buyThreadNoJumpEnabled" type="checkbox"> 购买帖子时不跳转\n        <span class="pd_cfg_tips" title="使用Ajax的方式购买帖子，购买时页面不会跳转">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="kfSmileEnhanceExtensionEnabled" type="checkbox" '+(_Info2.default.isInMiaolaDomain?"":"disabled")+'> 开启绯月表情增强插件\n        <span class="pd_cfg_tips" title="在发帖框上显示绯月表情增强插件（仅在miaola.info域名下生效），该插件由eddie32开发">[?]</span>\n      </label><br>\n      <label>\n        <input name="preventCloseWindowWhenEditPostEnabled" type="checkbox"> 写帖子时阻止关闭页面\n        <span class="pd_cfg_tips" title="在撰写发帖内容时，如不小心关闭了页面会进行提示">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="autoSavePostContentWhenSubmitEnabled" type="checkbox"> 提交时保存发帖内容\n        <span class="pd_cfg_tips" title="在提交时自动保存发帖内容，以便在出现意外情况时能够恢复发帖内容（需在不关闭当前标签页的情况下才能起效）">[?]</span>\n      </label>\n    </fieldset>\n  </div>\n\n  <div class="pd_cfg_panel">\n    <fieldset>\n      <legend>首页相关</legend>\n      <label>\n        @提醒\n        <select name="atTipsHandleType" style="width: 140px;">\n          <option value="no_highlight">取消已读提醒高亮</option>\n          <option value="no_highlight_extra">取消已读提醒高亮，并在无提醒时补上消息框</option>\n          <option value="hide_box_1">不显示已读提醒的消息框</option>\n          <option value="hide_box_2">永不显示消息框</option>\n          <option value="default">保持默认</option>\n          <option value="at_change_to_cao">将@改为艹(其他和方式2相同)</option>\n        </select>\n        <span class="pd_cfg_tips" title="对首页上的有人@你的消息框进行处理的方案">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="smLevelUpAlertEnabled" type="checkbox"> 神秘等级升级提醒\n        <span class="pd_cfg_tips" title="在神秘等级升级后进行提醒，只在首页生效">[?]</span>\n      </label><br>\n      <label>\n        <input name="fixedDepositDueAlertEnabled" type="checkbox"> 定期存款到期提醒\n        <span class="pd_cfg_tips" title="在定时存款到期时进行提醒，只在首页生效">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="smRankChangeAlertEnabled" type="checkbox"> 系数排名变化提醒\n        <span class="pd_cfg_tips" title="在神秘系数排名发生变化时进行提醒，只在首页生效">[?]</span>\n      </label><br>\n      <label>\n        <input name="homePageThreadFastGotoLinkEnabled" type="checkbox"> 在首页帖子旁显示跳转链接\n        <span class="pd_cfg_tips" title="在首页帖子链接旁显示快速跳转至页末的链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="showVipSurplusTimeEnabled" type="checkbox"> 显示VIP剩余时间\n        <span class="pd_cfg_tips" title="在首页显示VIP剩余时间">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>版块页面相关</legend>\n      <label>\n        <input name="showFastGotoThreadPageEnabled" type="checkbox" data-disabled="[name=maxFastGotoThreadPageNum]"> 显示帖子页数快捷链接\n        <span class="pd_cfg_tips" title="在版块页面中显示帖子页数快捷链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        页数链接最大数量 <input name="maxFastGotoThreadPageNum" type="number" min="1" max="10" style="width: 40px;" required>\n        <span class="pd_cfg_tips" title="在帖子页数快捷链接中显示页数链接的最大数量">[?]</span>\n      </label><br>\n      <label>\n        <input name="highlightNewPostEnabled" type="checkbox"> 高亮今日的新帖\n        <span class="pd_cfg_tips" title="在版块页面中高亮今日新发表帖子的发表时间">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>其它设置</legend>\n      <label class="pd_highlight">\n        存储类型\n        <select data-name="storageType">\n          <option value="Default">默认</option>\n          <option value="ByUid">按uid</option>\n          <option value="Global">全局</option>\n        </select>\n        <span class="pd_cfg_tips" title="助手设置和日志的存储方式，详情参见【常见问题1】">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        浏览器类型\n        <select name="browseType">\n          <option value="auto">自动检测</option>\n          <option value="desktop">桌面版</option>\n          <option value="mobile">移动版</option>\n        </select>\n        <span class="pd_cfg_tips" title="用于在KFOL助手上判断浏览器的类型，一般使用自动检测即可；\n如果当前浏览器与自动检测的类型不相符（移动版会在设置界面标题上显示“For Mobile”的字样），请手动设置为正确的类型">[?]</span>\n      </label><br>\n      <label>\n        消息显示时间 <input name="defShowMsgDuration" type="number" min="-1" style="width: 46px;" required> 秒\n        <span class="pd_cfg_tips" title="默认的消息显示时间（秒），设置为-1表示永久显示，例：15">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        日志保存天数 <input name="logSaveDays" type="number" min="1" max="365" style="width: 46px;" required>\n        <span class="pd_cfg_tips" title="默认值：'+_Config.Config.logSaveDays+'">[?]</span>\n      </label><br>\n      <label>\n        <input name="showSearchLinkEnabled" type="checkbox"> 显示搜索链接\n        <span class="pd_cfg_tips" title="在用户菜单上显示搜索对话框的链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="animationEffectOffEnabled" type="checkbox"> 禁用动画效果\n        <span class="pd_cfg_tips" title="禁用jQuery的动画效果（推荐在配置较差的机器上使用）">[?]</span>\n      </label><br>\n      <label>\n        <input name="addFastNavMenuEnabled" type="checkbox"> 添加快捷导航菜单\n        <span class="pd_cfg_tips" title="为顶部导航栏添加快捷导航菜单">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="modifySideBarEnabled" type="checkbox"> 将侧边栏修改为平铺样式\n        <span class="pd_cfg_tips" title="将侧边栏修改为和手机相同的平铺样式">[?]</span>\n      </label><br>\n      <label>\n        <input name="customCssEnabled" type="checkbox" data-disabled="[data-name=openCustomCssDialog]"> 添加自定义CSS\n        <span class="pd_cfg_tips" title="为页面添加自定义的CSS内容，请点击详细设置填入自定义的CSS内容">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomCssDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="customScriptEnabled" type="checkbox" data-disabled="[data-name=openCustomScriptDialog]"> 执行自定义脚本\n        <span class="pd_cfg_tips" title="执行自定义的javascript脚本，请点击详细设置填入自定义的脚本内容">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomScriptDialog" href="#">详细设置&raquo;</a>\n    </fieldset>\n    <fieldset>\n      <legend>关注和屏蔽</legend>\n      <label>\n        <input name="followUserEnabled" type="checkbox" data-disabled="[data-name=openFollowUserDialog]"> 关注用户\n        <span class="pd_cfg_tips" title="开启关注用户的功能，所关注的用户将被加注记号，请点击详细设置管理关注用户">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openFollowUserDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="blockUserEnabled" type="checkbox" data-disabled="[data-name=openBlockUserDialog]"> 屏蔽用户\n        <span class="pd_cfg_tips" title="开启屏蔽用户的功能，你将看不见所屏蔽用户的发言，请点击详细设置管理屏蔽用户">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openBlockUserDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="blockThreadEnabled" type="checkbox" data-disabled="[data-name=openBlockThreadDialog]"> 屏蔽帖子\n        <span class="pd_cfg_tips" title="开启屏蔽标题中包含指定关键字的帖子的功能，请点击详细设置管理屏蔽关键字">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openBlockThreadDialog" href="#">详细设置&raquo;</a><br>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label>\n          <input name="autoSaveCurrentDepositEnabled" type="checkbox"> 自动活期存款\n          <span class="pd_cfg_tips" title="在当前收入满足指定额度之后自动将指定数额存入活期存款中，只会在首页触发">[?]</span>\n        </label>\n      </legend>\n      <label>\n        在当前收入已满 <input name="saveCurrentDepositAfterKfb" type="number" min="1" style="width: 80px;"> KFB之后\n        <span class="pd_cfg_tips" title="在当前收入已满指定KFB额度之后自动进行活期存款，例：1000">[?]</span>\n      </label><br>\n      <label>\n        将 <input name="saveCurrentDepositKfb" type="number" min="1" style="width: 80px;"> KFB存入活期存款\n        <span class="pd_cfg_tips" title="将指定额度的KFB存入活期存款中，例：900；举例：设定已满1000存900，当前收入为2000，则自动存入金额为1800">[?]</span>\n      </label>\n    </fieldset>\n  </div>\n</div>\n\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a target="_blank" href="read.php?tid=508450">By 喵拉布丁</a>\n    <i style="color: #666; font-style: normal;">(V'+_Info2.default.version+')</i>\n    <a target="_blank" href="https://git.oschina.net/miaolapd/KF_Online_Assistant/wikis/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">[常见问题]</a>\n  </span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n  <button name="default" type="button">默认值</button>\n</div>',t=Dialog.create("pdConfigDialog","KFOL助手设置"+(_Info2.default.isMobile?" (For Mobile)":""),e);t.submit(function(e){if(e.preventDefault(),verifyMainConfig(t)){var n=Config.timingModeEnabled;(0,_Config.read)();var a=getMainConfigValue(t);a=(0,_Config.normalize)(a),$.extend(Config,a),(0,_Config.write)();var i=t.find('[data-name="storageType"]').val();if(i!==_Info2.default.storageType){if(!confirm("是否修改存储类型？"))return;return(0,_Config.changeStorageType)(i),alert("存储类型已修改"),void location.reload()}Dialog.close("pdConfigDialog"),n!==a.timingModeEnabled&&confirm("你已修改了定时模式的设置，需要刷新页面才能生效，是否立即刷新？")&&location.reload()}}).find('[name="default"]').click(function(){confirm("是否重置所有设置？")&&((0,_Config.clear)(),alert("设置已重置"),location.reload())}).end().find('[data-name="clearTmpData"]').click(function(e){e.preventDefault();var t=prompt("可清除与助手有关的Cookies和本地临时数据（不包括助手设置和日志）\n请填写清除类型，0：全部清除；1：清除Cookies；2：清除本地临时数据",0);null!==t&&(t=parseInt(t),!isNaN(t)&&t>=0&&(clearTmpData(t),alert("缓存已清除")))}),t.on("click",'a[data-name^="open"][href="#"]',function(e){e.preventDefault();var t=$(this);if(!t.hasClass("pd_disabled_link")){var n=t.data("name");"openRumCommandDialog"===n&&showRunCommandDialog(),"openImportOrExportSettingDialog"===n&&showImportOrExportSettingDialog(),"openCustomSmColorDialog"===n?showCustomSmColorDialog():"openUserMemoDialog"===n?showUserMemoDialog():"openCustomCssDialog"===n?showCustomCssDialog():"openCustomScriptDialog"===n?Script.showDialog():"openFollowUserDialog"===n?showFollowUserDialog():"openBlockUserDialog"===n?showBlockUserDialog():"openBlockThreadDialog"===n&&showBlockThreadDialog()}}).find('[name="promoteHaloCostType"]').change(function(){var e=parseInt($(this).val());t.find('[data-id="promoteHaloLimitUnit"]').text(e>=11?"贡献":"KFB")}).end().find('[data-name="customMySmColorSelect"]').change(function(){t.find('[name="customMySmColor"]').val($(this).val().toString().toLowerCase())}).end().find('[name="customMySmColor"]').change(function(){var e=$.trim($(this).val());/^#[0-9a-fA-F]{6}$/.test(e)&&t.find('[data-name="customMySmColorSelect"]').val(e.toLowerCase())}),setMainConfigValue(t),Dialog.show("pdConfigDialog"),Script.runFunc("ConfigDialog.show_after_")}},setMainConfigValue=function(e){e.find("input[name], select[name]").each(function(){var e=$(this),t=e.attr("name");t in Config&&(e.is('[type="checkbox"]')&&"boolean"==typeof Config[t]?e.prop("checked",Config[t]===!0):e.val(Config[t]))}),e.find('[name="promoteHaloCostType"]').trigger("change"),e.find('[name="threadContentFontSize"]').val(Config.threadContentFontSize>0?Config.threadContentFontSize:""),e.find('[data-name="customMySmColorSelect"]').val(Config.customMySmColor),e.find('[data-name="storageType"]').val(_Info2.default.storageType),"undefined"==typeof GM_getValue&&e.find('[data-name="storageType"] > option:gt(0)').prop("disabled",!0)},getMainConfigValue=function(e){var t={};return e.find("input[name], select[name]").each(function(){var e=$(this),n=e.attr("name");if(n in Config)if(e.is('[type="checkbox"]')&&"boolean"==typeof Config[n])t[n]=Boolean(e.prop("checked"));else if("number"==typeof Config[n]){var a=$.trim(e.val());/\d+\.\d+/.test(a)?t[n]=parseFloat(a):t[n]=parseInt(a),"threadContentFontSize"===n&&isNaN(t[n])&&(t[n]=0)}else t[n]=$.trim(e.val())}),t},verifyMainConfig=function(e){var t=e.find('[name="checkLootAfterTime"]'),n=$.trim(t.val());if(!/^(2[0-3]|[0-1][0-9]):[0-5][0-9]:[0-5][0-9]$/.test(n))return alert("在指定时间之后争夺格式不正确"),t.select().focus(),!1;var a=e.find('[name="customMySmColor"]'),i=$.trim(a.val());if(i&&!/^#[0-9a-fA-F]{6}$/.test(i))return alert("自定义本人的神秘颜色格式不正确，例：#009cff"),a.select().focus(),!1;var o=e.find('[name="saveCurrentDepositAfterKfb"]'),r=e.find('[name="saveCurrentDepositKfb"]'),l=parseInt(o.val()),s=parseInt(r.val());if(l||s){if(!l||l<=0)return alert("自动活期存款满足额度格式不正确"),o.select().focus(),!1;if(!s||s<=0||s>l)return alert("想要存款的金额格式不正确"),r.select().focus(),!1}return!0},clearTmpData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e||1===e)for(var t in _Const2.default)/CookieName$/.test(t)&&Util.deleteCookie(_Const2.default[t]);0!==e&&2!==e||(TmpLog.clear(),localStorage.removeItem(_Const2.default.multiQuoteStorageName),localStorage.removeItem(_Const2.default.tempPointsLogListStorageName))},showRunCommandDialog=function(){if(!($("#pdRunCommandDialog").length>0)){Dialog.close("pdConfigDialog");var e=Dialog.create("pdRunCommandDialog","运行命令",'\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">\n    运行命令快捷键：<b>Ctrl+Enter</b>；清除命令快捷键：<b>Ctrl+退格键</b><br>\n    按<b>F12键</b>可打开浏览器控制台查看消息（需切换至控制台或Console标签）\n  </div>\n  <textarea name="cmd" wrap="off" style="width: 750px; height: 300px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit">运行</button>\n  <button name="clear" type="button">清除</button>\n  <button data-action="close" type="button">关闭</button>\n</div>'),t=e.find('[name="cmd"]');e.submit(function(e){e.preventDefault();var n=t.val();n&&Script.runCmd(n,!0)}).end().find('[name="clear"]').click(function(){t.val("").focus()}),t.keydown(function(t){t.ctrlKey&&13===t.keyCode?e.submit():t.ctrlKey&&8===t.keyCode&&e.find('[name="clear"]').click()}),Dialog.show("pdRunCommandDialog"),t.focus()}},showImportOrExportSettingDialog=function(){var e="pdImOrExSettingDialog";if(!($("#"+e).length>0)){(0,_Config.read)();var t=Dialog.create(e,"导入或导出设置",'\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到别处即可\n  </div>\n  <textarea name="setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find('[name="setting"]');t.submit(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim(n.val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("设置有错误")}if(!t||"object"!==$.type(t))return void alert("设置有错误");t=(0,_Config.normalize)(t),_Info2.default.w.Config=$.extend(!0,{},_Config.Config,t),(0,_Config.write)(),alert("设置已导入"),location.reload()}}}),Dialog.show(e),n.val(JSON.stringify(Util.getDifferenceSetOfObject(_Config.Config,Config))).select().focus()}},showCustomSmColorDialog=function(){var e="pdCustomSmColorDialog";if(!($("#"+e).length>0)){var t=Dialog.create(e,"自定义各等级神秘颜色",'\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    <strong>\n      示例（<a target="_blank" href="http://www.35ui.cn/jsnote/peise.html">常用配色表</a> / \n      <a target="_blank" href="read.php?tid=488016">配色方案收集贴</a>）：\n    </strong><br>\n    <b>等级范围：</b>4-4 <b>颜色：</b><span style="color: #0000ff;">#0000ff</span><br>\n    <b>等级范围：</b>10-99 <b>颜色：</b><span style="color: #5ad465;">#5ad465</span><br>\n    <b>等级范围：</b>5000-MAX <b>颜色：</b><span style="color: #ff0000;">#ff0000</span>\n  </div>\n  <ul data-name="smColorList"></ul>\n  <div style="margin-top: 5px;" data-name="customSmColorAddBtns">\n    <a class="pd_btn_link" data-action="addOne" href="#">增加1个</a>\n    <a class="pd_btn_link" data-action="addFive" href="#">增加5个</a>\n    <a class="pd_btn_link" data-action="clear" href="#">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExCustomSmColorConfigDialog" href="#">导入/导出配色方案</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',"min-width: 327px;"),n=t.find('[data-name="smColorList"]');n.on("change",'[name="color"]',function(){var e=$(this),t=$.trim(e.val());/^#[0-9a-fA-F]{6}$/.test(t)&&e.next('[type="color"]').val(t.toLowerCase())}).on("change",'[type="color"]',function(){var e=$(this);e.prev('[type="text"]').val(e.val().toString().toLowerCase())}).on("click","a",function(e){e.preventDefault(),$(this).closest("li").remove()});var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.min,n=void 0===t?"":t,a=e.max,i=void 0===a?"":a,o=e.color,r=void 0===o?"":o;return'\n<li>\n  <label>等级范围 <input name="min" type="text" maxlength="5" style="width: 30px;" value="'+n+'"></label>\n  <label>- <input name="max" type="text" maxlength="5" style="width: 30px;" value="'+i+'"></label>\n  <label>\n    &nbsp;颜色 <input name="color" type="text" maxlength="7" style="width: 50px;" value="'+r+'">\n    <input style="margin-left: 0;" type="color" value="'+r+'">\n  </label>\n  <a href="#">删除</a>\n</li>'},i="",o=!0,r=!1,l=void 0;try{for(var s,d=Config.customSmColorConfigList[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){i+=a(s.value)}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}n.html(i),t.submit(function(t){t.preventDefault();var a=[],i=!0;n.find("li").each(function(){var e=$(this),t=e.find('[name="min"]'),n=$.trim(t.val()).toUpperCase();if(""!==n){if(!/^(-?\d+|MAX)$/i.test(n))return i=!1,t.select().focus(),alert("等级范围格式不正确"),!1;var o=e.find('[name="max"]'),r=$.trim(o.val()).toUpperCase();if(""!==r){if(!/^(-?\d+|MAX)$/i.test(r))return i=!1,o.select().focus(),alert("等级范围格式不正确"),!1;if(Util.compareSmLevel(r,n)<0)return i=!1,t.select().focus(),alert("等级范围格式不正确"),!1;var l=e.find('[name="color"]'),s=$.trim(l.val()).toLowerCase();if(""!==s)return/^#[0-9a-fA-F]{6}$/.test(s)?void a.push({min:n,max:r,color:s}):(i=!1,l.select().focus(),alert("颜色格式不正确"),!1)}}}),i&&(a.sort(function(e,t){return Util.compareSmLevel(e.min,t.min)>0?1:-1}),Config.customSmColorConfigList=a,(0,_Config.write)(),Dialog.close(e))}).find('[data-action="addOne"], [data-action="addFive"]').click(function(t){t.preventDefault();var i=1;$(this).is('[data-action="addFive"]')&&(i=5);for(var o=1;o<=i;o++)n.append(a());Dialog.resize(e)}).end().find('[data-action="clear"]').click(function(t){t.preventDefault(),confirm("是否清除所有颜色？")&&(n.empty(),Dialog.resize(e))}).end().find('[data-name="openImOrExCustomSmColorConfigDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("配色方案","customSmColorConfigList",function(e){return e.find(".pd_cfg_about").append('<a target="_blank" href="read.php?tid=488016">其他人分享的配色方案</a>')})}),Dialog.show(e)}},showCustomCssDialog=function(){var e="pdCustomCssDialog";if(!($("#"+e).length>0)){var t=Dialog.create(e,"自定义CSS",'\n<div class="pd_cfg_main">\n  <strong>自定义CSS内容：</strong><br>\n  <textarea name="customCssContent" wrap="off" style="width: 750px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a target="_blank" href="read.php?tid=500969">CSS规则收集贴</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find('[name="customCssContent"]');t.submit(function(t){t.preventDefault(),Config.customCssContent=$.trim(n.val()),(0,_Config.write)(),Dialog.close(e),alert("自定义CSS修改成功（需刷新页面后才可生效）")}),n.val(Config.customCssContent),Dialog.show(e),n.focus()}},showUserMemoDialog=function(){var e="pdUserMemoDialog";if(!($("#"+e).length>0)){var t=Dialog.create(e,"用户备注",'\n<div class="pd_cfg_main">\n  按照“用户名:备注”的格式（注意是英文冒号），每行一个<br>\n  <textarea name="userMemoList" wrap="off" style="width: 320px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find('[name="userMemoList"]');t.submit(function(t){t.preventDefault();var a=$.trim(n.val());Config.userMemoList={};var i=!0,o=!1,r=void 0;try{
for(var l,s=a.split("\n")[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var d=l.value;if(d=$.trim(d)){if(!/.+?:.+/.test(d))return alert("用户备注格式不正确"),void n.focus();var c=d.split(":"),p=_slicedToArray(c,2),u=p[0],f=p[1],m=void 0===f?"":f;m&&(Config.userMemoList[u.trim()]=m.trim())}}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}(0,_Config.write)(),Dialog.close(e)});var a="",i=!0,o=!1,r=void 0;try{for(var l,s=Util.entries(Config.userMemoList)[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var d=_slicedToArray(l.value,2);a+=d[0]+":"+d[1]+"\n"}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}n.val(a),Dialog.show(e),n.focus()}},showFollowUserDialog=function(){var e="pdFollowUserDialog";if(!($("#"+e).length>0)){var t=Dialog.create(e,"关注用户",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label>\n      <input name="highlightFollowUserThreadInHpEnabled" type="checkbox"> 高亮所关注用户的首页帖子链接\n      <span class="pd_cfg_tips" title="高亮所关注用户在首页下的帖子链接">[?]</span>\n    </label><br>\n    <label>\n      <input name="highlightFollowUserThreadLinkEnabled" type="checkbox"> 高亮所关注用户的帖子链接\n      <span class="pd_cfg_tips" title="高亮所关注用户在版块页面下的帖子链接">[?]</span>\n    </label><br>\n  </div>\n  <ul id="pdFollowUserList" style="margin-top: 5px; min-width: 274px; line-height: 24px;"></ul>\n  <div style="margin-top: 5px;">\n    <div style="display: inline-block;">\n      <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n      <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n    </div>\n    <div style="float: right;">\n      <a class="pd_btn_link" data-name="deleteSelect" href="#">删除</a>\n    </div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input name="addFollowUser" style="width: 200px;" type="text">\n    <a class="pd_btn_link" data-name="add" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExFollowUserListDialog" href="#">导入/导出关注用户</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find("#pdFollowUserList"),a=function(e){$('\n<li>\n  <input type="checkbox">\n  <input name="username" type="text" style="width: 178px; margin-left: 5px;" maxlength="15" value="'+e+'">\n  <a class="pd_btn_link" data-name="delete" href="#">删除</a>\n</li>\n').appendTo(n)};t.submit(function(a){a.preventDefault(),Config.highlightFollowUserThreadInHPEnabled=t.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked"),Config.highlightFollowUserThreadLinkEnabled=t.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked"),Config.followUserList=[],n.find("li").each(function(){var e=$(this),t=$.trim(e.find('[name="username"]').val());""!==t&&Util.inFollowOrBlockUserList(t,Config.followUserList)===-1&&Config.followUserList.push({name:t})}),(0,_Config.write)(),Dialog.close(e)}),n.on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).parent().remove()}),t.find('[data-name="selectAll"]').click(function(){return Util.selectAll(n.find('[type="checkbox"]'))}).end().find('[data-name="selectInverse"]').click(function(){return Util.selectInverse(n.find('[type="checkbox"]'))}).end().find('[data-name="deleteSelect"]').click(function(t){t.preventDefault();var a=n.find('li:has([type="checkbox"]:checked)');a.length&&confirm("是否删除所选用户？")&&(a.remove(),Dialog.resize(e))}),t.find('[name="addFollowUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).end().find('[data-name="add"]').click(function(n){n.preventDefault();var i=!0,o=!1,r=void 0;try{for(var l,s=$.trim(t.find('[name="addFollowUser"]').val()).split(",")[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var d=l.value;d=$.trim(d),d&&(Util.inFollowOrBlockUserList(d,Config.followUserList)===-1&&a(d))}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}t.find('[name="addFollowUser"]').val(""),Dialog.resize(e)}).end().find('[data-name="openImOrExFollowUserListDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("关注用户","followUserList")}),t.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked",Config.highlightFollowUserThreadInHPEnabled),t.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked",Config.highlightFollowUserThreadLinkEnabled);var i=!0,o=!1,r=void 0;try{for(var l,s=Config.followUserList[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){a(l.value.name)}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}Dialog.show(e)}},showBlockUserDialog=function(){var e="pdBlockUserDialog";if(!($("#"+e).length>0)){var t=Dialog.create(e,"屏蔽用户",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px; line-height: 24px;">\n    <label>\n      默认屏蔽类型\n      <select name="blockUserDefaultType">\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n    </label>\n    <label class="pd_cfg_ml">\n      <input name="blockUserAtTipsEnabled" type="checkbox"> 屏蔽@提醒 <span class="pd_cfg_tips" title="屏蔽被屏蔽用户的@提醒">[?]</span>\n    </label><br>\n    <label>版块屏蔽范围\n      <select name="blockUserForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label><br>\n    <label>版块ID列表\n      <input name="blockUserFidList" type="text" style="width: 220px;"> \n      <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span>\n    </label>\n  </div>\n  <ul id="pdBlockUserList" style="margin-top: 5px; min-width: 362px; line-height: 24px;"></ul>\n  <div style="margin-top: 5px;">\n    <div style="display: inline-block;">\n      <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n      <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n    </div>\n    <div style="float: right;">\n      <a class="pd_btn_link" data-name="modify" href="#">修改为</a>\n      <select>\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n      <a class="pd_btn_link" data-name="deleteSelect" href="#">删除</a>\n    </div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input name="addBlockUser" style="width: 200px;" type="text">\n    <a class="pd_btn_link" data-name="add" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExBlockUserListDialog" href="#">导入/导出屏蔽用户</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find("#pdBlockUserList"),a=function(e,t){$('\n<li>\n  <input type="checkbox">\n  <input name="username" type="text" style="width: 150px; margin-left: 5px;" maxlength="15" value="'+e+'">\n  <select name="blockType" style="margin-left: 5px;">\n    <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n  </select>\n  <a class="pd_btn_link" data-name="delete" href="#">删除</a>\n</li>').appendTo(n).find('[name="blockType"]').val(t)};t.submit(function(a){a.preventDefault(),Config.blockUserDefaultType=parseInt(t.find('[name="blockUserDefaultType"]').val()),Config.blockUserAtTipsEnabled=t.find('[name="blockUserAtTipsEnabled"]').prop("checked"),Config.blockUserForumType=parseInt(t.find('[name="blockUserForumType"]').val());var i=new Set,o=!0,r=!1,l=void 0;try{for(var s,d=$.trim(t.find('[name="blockUserFidList"]').val()).split(",")[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;c=parseInt(c),!isNaN(c)&&c>0&&i.add(c)}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}Config.blockUserFidList=[].concat(_toConsumableArray(i)),Config.blockUserList=[],n.find("li").each(function(){var e=$(this),t=$.trim(e.find('[name="username"]').val());if(""!==t&&Util.inFollowOrBlockUserList(t,Config.blockUserList)===-1){var n=parseInt(e.find('[name="blockType"]').val());Config.blockUserList.push({name:t,type:n})}}),(0,_Config.write)(),Dialog.close(e)}),n.on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).parent().remove()}),t.find('[data-name="selectAll"]').click(function(){return Util.selectAll(n.find('input[type="checkbox"]'))}).end().find('[data-name="selectInverse"]').click(function(){return Util.selectInverse(n.find('input[type="checkbox"]'))}).end().find('[data-name="modify"]').click(function(e){e.preventDefault();var t=$(this).next("select").val();n.find('li:has([type="checkbox"]:checked) > select').val(t)}).end().find('[data-name="deleteSelect"]').click(function(t){t.preventDefault();var a=n.find('li:has([type="checkbox"]:checked)');a.length&&confirm("是否删除所选用户？")&&(a.remove(),Dialog.resize(e))}),t.find('[name="addBlockUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).end().find('[data-name="add"]').click(function(n){n.preventDefault();var i=parseInt(t.find('[name="blockUserDefaultType"]').val()),o=!0,r=!1,l=void 0;try{for(var s,d=$.trim(t.find('[name="addBlockUser"]').val()).split(",")[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;c=$.trim(c),c&&(Util.inFollowOrBlockUserList(c,Config.blockUserList)===-1&&a(c,i))}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}t.find('[name="addBlockUser"]').val(""),Dialog.resize(e)}).end().find('[name="blockUserForumType"]').change(function(){t.find('[name="blockUserFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find('[data-name="openImOrExBlockUserListDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("屏蔽用户","blockUserList")}),t.find('[name="blockUserDefaultType"]').val(Config.blockUserDefaultType),t.find('[name="blockUserAtTipsEnabled"]').prop("checked",Config.blockUserAtTipsEnabled),t.find('[name="blockUserForumType"]').val(Config.blockUserForumType).triggerHandler("change"),t.find('[name="blockUserFidList"]').val(Config.blockUserFidList.join(","));var i=!0,o=!1,r=void 0;try{for(var l,s=Config.blockUserList[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var d=l.value;a(d.name,d.type)}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}Dialog.show(e)}},showBlockThreadDialog=function showBlockThreadDialog(){var dialogName="pdBlockThreadDialog";if(!($("#"+dialogName).length>0)){var html='\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    标题关键字可使用普通字符串或正则表达式，正则表达式请使用<code>/abc/</code>的格式，例：<code>/关键字A.*关键字B/i</code><br>\n    用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\n    <label>\n      默认版块屏蔽范围\n      <select name="blockThreadDefForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label>\n    <label style="margin-left: 5px;">默认版块ID列表 <input name="blockThreadDefFidList" type="text" style="width: 150px;"></label>\n  </div>\n  <table id="pdBlockThreadList" style="line-height: 22px; text-align: center;">\n    <tbody>\n      <tr>\n        <th style="width: 220px;">标题关键字(必填)</th>\n        <th style="width: 62px;">屏蔽用户</th>\n        <th style="width: 200px;">用户名 <span class="pd_cfg_tips" title="多个用户名请用英文逗号分隔">[?]</span></th>\n        <th style="width: 62px;">屏蔽范围</th>\n        <th style="width: 132px;">版块ID <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span></th>\n        <th style="width: 35px;"></th>\n      </tr>\n    </tbody>\n  </table>\n  <div data-name="blockThreadAddBtns" style="margin-top: 5px;">\n    <a class="pd_btn_link" data-name="addOne" href="#">增加1个</a>\n    <a class="pd_btn_link" data-name="addFive" href="#">增加5个</a>\n    <a class="pd_btn_link pd_highlight" data-name="clear" href="#">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExBlockThreadListDialog" href="#">导入/导出屏蔽帖子</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',$dialog=Dialog.create(dialogName,"屏蔽帖子",'\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    标题关键字可使用普通字符串或正则表达式，正则表达式请使用<code>/abc/</code>的格式，例：<code>/关键字A.*关键字B/i</code><br>\n    用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\n    <label>\n      默认版块屏蔽范围\n      <select name="blockThreadDefForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label>\n    <label style="margin-left: 5px;">默认版块ID列表 <input name="blockThreadDefFidList" type="text" style="width: 150px;"></label>\n  </div>\n  <table id="pdBlockThreadList" style="line-height: 22px; text-align: center;">\n    <tbody>\n      <tr>\n        <th style="width: 220px;">标题关键字(必填)</th>\n        <th style="width: 62px;">屏蔽用户</th>\n        <th style="width: 200px;">用户名 <span class="pd_cfg_tips" title="多个用户名请用英文逗号分隔">[?]</span></th>\n        <th style="width: 62px;">屏蔽范围</th>\n        <th style="width: 132px;">版块ID <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span></th>\n        <th style="width: 35px;"></th>\n      </tr>\n    </tbody>\n  </table>\n  <div data-name="blockThreadAddBtns" style="margin-top: 5px;">\n    <a class="pd_btn_link" data-name="addOne" href="#">增加1个</a>\n    <a class="pd_btn_link" data-name="addFive" href="#">增加5个</a>\n    <a class="pd_btn_link pd_highlight" data-name="clear" href="#">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExBlockThreadListDialog" href="#">导入/导出屏蔽帖子</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',"width: 768px;"),$blockThreadList=$dialog.find("#pdBlockThreadList"),addBlockThread=function(e,t,n,a,i){$('\n<tr>\n  <td><input name="keyWord" type="text" style="width: 208px;" value="'+e+'"></td>\n  <td><select name="userType"><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input name="userList" type="text" style="width: 188px;" value="'+n.join(",")+'" '+(0===t?"disabled":"")+'></td>\n  <td><select name="fidType"><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input name="fidList" type="text" style="width: 120px;" value="'+i.join(",")+'" '+(0===a?"disabled":"")+'></td>\n  <td><a href="#" data-name="delete">删除</a></td>\n</tr>\n').appendTo($blockThreadList).find('[name="userType"]').val(t).end().find('[name="fidType"]').val(a)},verify=function verify(){var flag=!0;return $blockThreadList.find("tr:gt(0)").each(function(){var $this=$(this),$txtKeyWord=$this.find('[name="keyWord"]'),keyWord=$txtKeyWord.val();if(""!==$.trim(keyWord)&&/^\/.+\/[gimuy]*$/.test(keyWord))try{eval(keyWord)}catch(e){return alert("正则表达式不正确"),$txtKeyWord.select().focus(),flag=!1,!1}}),flag};$dialog.submit(function(e){if(e.preventDefault(),verify()){Config.blockThreadDefForumType=parseInt($dialog.find('[name="blockThreadDefForumType"]').val());var t=new Set,n=!0,a=!1,i=void 0;try{for(var o,r=$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(",")[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;l=parseInt(l),!isNaN(l)&&l>0&&t.add(l)}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}Config.blockThreadDefFidList=[].concat(_toConsumableArray(t)),Config.blockThreadList=[],$blockThreadList.find("tr:gt(0)").each(function(){var e=$(this),t=e.find('[name="keyWord"]').val();if(""!==$.trim(t)){var n={keyWord:t},a=parseInt(e.find('[name="userType"]').val());if(a>0){var i=new Set,o=!0,r=!1,l=void 0;try{for(var s,d=$.trim(e.find('[name="userList"]').val()).split(",")[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;c=$.trim(c),c&&i.add(c)}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}i.size>0&&(n[2===a?"excludeUser":"includeUser"]=[].concat(_toConsumableArray(i)))}var p=parseInt(e.find('[name="fidType"]').val());if(p>0){var u=new Set,f=!0,m=!1,g=void 0;try{for(var h,v=$.trim(e.find('[name="fidList"]').val()).split(",")[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var b=h.value;b=parseInt(b),!isNaN(b)&&b>0&&u.add(b)}}catch(e){m=!0,g=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw g}}u.size>0&&(n[2===p?"excludeFid":"includeFid"]=[].concat(_toConsumableArray(u)))}Config.blockThreadList.push(n)}}),(0,_Config.write)(),Dialog.close(dialogName)}}),$blockThreadList.on("change","select",function(){var e=$(this);e.parent("td").next("td").find("input").prop("disabled",0===parseInt(e.val()))}).on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).closest("tr").remove()}),$dialog.find('[data-name="addOne"], [data-name="addFive"]').click(function(e){e.preventDefault();var t=1;$(this).is('[data-name="addFive"]')&&(t=5);for(var n=1;n<=t;n++)addBlockThread("",0,[],parseInt($dialog.find('[name="blockThreadDefForumType"]').val()),$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(","));Dialog.resize(dialogName)}).end().find('[data-name="clear"]').click(function(e){e.preventDefault(),confirm("是否清除所有屏蔽关键字？")&&($blockThreadList.find("tbody > tr:gt(0)").remove(),Dialog.resize(dialogName))}).end().find('[name="blockThreadDefForumType"]').change(function(){$dialog.find('[name="blockThreadDefFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find('[data-name="openImOrExBlockThreadListDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("屏蔽帖子","blockThreadList")}),$dialog.find('[name="blockThreadDefForumType"]').val(Config.blockThreadDefForumType).triggerHandler("change"),$dialog.find('[name="blockThreadDefFidList"]').val(Config.blockThreadDefFidList.join(","));var _iteratorNormalCompletion12=!0,_didIteratorError12=!1,_iteratorError12=void 0;try{for(var _iterator12=Config.blockThreadList[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=!0){var data=_step12.value,keyWord=data.keyWord,includeUser=data.includeUser,excludeUser=data.excludeUser,includeFid=data.includeFid,excludeFid=data.excludeFid,userType=0,userList=[];void 0!==includeUser?(userType=1,userList=includeUser):void 0!==excludeUser&&(userType=2,userList=excludeUser);var fidType=0,fidList=[];void 0!==includeFid?(fidType=1,fidList=includeFid):void 0!==excludeFid&&(fidType=2,fidList=excludeFid),addBlockThread(keyWord,userType,userList,fidType,fidList)}}catch(e){_didIteratorError12=!0,_iteratorError12=e}finally{try{!_iteratorNormalCompletion12&&_iterator12.return&&_iterator12.return()}finally{if(_didIteratorError12)throw _iteratorError12}}Dialog.show(dialogName)}}},{"./Config":5,"./Const":7,"./Dialog":8,"./Info":10,"./Public":19,"./Script":21,"./TmpLog":22,"./Util":23}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={debug:!1,forumTimezoneOffset:-8,getDailyBonusAfterTime:"00:35:00",enemyStatLatestLevelNum:10,lootAttackPerCheckLevel:5,getCustomPoints:null,actionFinishRetryInterval:30,errorRefreshInterval:1,showRefreshModeTipsInterval:1,getDailyBonusSpecialInterval:60,minPromoteHaloInterval:480,promoteHaloLimitNextActionInterval:480,promoteHaloActionInterval:1e3,tmpHaloInfoExpires:90,lootAttackingExpires:10,changePointsInfoExpires:30,checkLootInterval:30,hideMarkReadAtTipsExpires:3,smLevelUpAlertInterval:3,smRankChangeAlertInterval:22,vipSurplusTimeExpires:60,fixedDepositDueTime:90,defAjaxTimeout:3e4,defAjaxInterval:200,specialAjaxInterval:function(){return Config.simulateManualActionEnabled?Math.floor(4e3*Math.random())+3e3:Math.floor(200*Math.random())+1e3},cycleUseItemsFirstAjaxInterval:function(){return Math.floor(250*Math.random())+2e3},minItemActionInterval:1e3,lootAttackInterval:function(){return Config.slowAttackEnabled?Math.floor(2e3*Math.random())+5e3:Math.floor(200*Math.random())+500},bankActionInterval:5e3,minBuyThreadWarningSell:6,statFloorMaxPage:300,ratingErrorSizePercent:3,customFastNavMenuContent:"",storagePrefix:"pd_",multiQuoteStorageName:"pd_multiQuote",postContentStorageName:"pd_postContent",tempPointsLogListStorageName:"pd_tempPointsLogList",itemLogStorageName:"pd_itemLog",smLevelUpTmpLogName:"SmLevelUp",smRankChangeTmpLogName:"SmRankChange",fixedDepositDueTmpLogName:"FixedDepositDue",prevAutoChangeIdColorTmpLogName:"PrevAutoChangeIdColor",haloInfoTmpLogName:"HaloInfo",getDailyBonusCookieName:"getDailyBonus",promoteHaloCookieName:"promoteHalo",lootCheckingCookieName:"lootChecking",lootAttackingCookieName:"lootAttacking",changePointsInfoCookieName:"changePointsInfo",lootCompleteCookieName:"lootComplete",hideReadAtTipsCookieName:"hideReadAtTips",prevReadAtTipsCookieName:"prevReadAtTips",fixedDepositDueAlertCookieName:"fixedDepositDueAlert",vipSurplusTimeCookieName:"vipSurplusTime",autoChangeIdColorCookieName:"autoChangeIdColor"};n.default=a},{}],8:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.close=n.resize=n.show=n.create=void 0;var i=e("./Info"),o=function(e){return e&&e.__esModule?e:{default:e}}(i),r=e("./Util"),l=a(r),s=e("./Public"),d=a(s),c=(n.create=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i='\n<form>\n<div class="pd_cfg_box" id="'+e+'" style="'+a+'">\n  <h1>'+t+'<span data-action="close">&times;</span></h1>\n  '+n+"\n</div>\n</form>",r=$(i).appendTo("body");return r.on("click",".pd_cfg_tips",function(e){return o.default.isMobile&&d.showElementTitleTips(e,this.title),!1}).on("click","a.pd_disabled_link",function(){return!1}).on("click",'[data-action="close"]',function(){return p(e)}).keydown(function(t){if(27===t.keyCode)return p(e)}).find('legend [type="checkbox"]').click(function(){var e=$(this),t=e.prop("checked");l.isOpera()||l.isEdge()?e.closest("fieldset").find("input, select, textarea, button").not("legend input").prop("disabled",!t):e.closest("fieldset").prop("disabled",!t)}).end().find("input[data-disabled]").click(function(){var e=$(this),t=e.prop("checked");$(e.data("disabled")).each(function(){var e=$(this);e.is("a")?t?e.removeClass("pd_disabled_link"):e.addClass("pd_disabled_link"):e.prop("disabled",!t)})}).end().find("input[data-mutex]").click(function(){var e=$(this),t=e.prop("checked");$(e.data("mutex")).each(function(){var e=$(this);e.is("a")?t?e.addClass("pd_disabled_link"):e.removeClass("pd_disabled_link"):e.prop("disabled",t)})}),o.default.isMobile||$(window).on("resize."+e,function(){return c(e)}),r},n.show=function(e){var t=$("#"+e);t.length&&(t.find('legend [type="checkbox"]').each(function(){$(this).triggerHandler("click")}).end().find("input[data-disabled], input[data-mutex]").each(function(){$(this).triggerHandler("click")}),t.fadeIn("fast"),c(e),t.find("input:first, select:first, a:first, textarea:first, button:first").eq(0).focus())},n.resize=function(e){var t=$("#"+e),n=$(window).height();t.find(".pd_cfg_main").css("max-height",n-80);var a=t.outerWidth(),i=$(window).width(),o=i/2-a/2;o+a>i&&(o=i-a-20),o<0&&(o=0);var r=n/2-t.outerHeight()/2;r<0&&(r=0),t.css({top:r,left:o})}),p=n.close=function(e){return $("#"+e).fadeOut("fast",function(){$(this).parent("form").remove()}),o.default.isMobile||$(window).off("resize."+e),!1}},{"./Info":10,"./Public":19,"./Util":23}],9:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.addChangePointsInfoTips=n.addPromoteHaloInterval=n.handleIndexLink=n.addSearchTypeSelectBox=n.showVipSurplusTime=n.addThreadFastGotoLink=n.smRankChangeAlert=n.smLevelUpAlert=n.handleAtTips=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),s=a(l),d=e("./Msg"),c=a(d),p=e("./Const"),u=i(p),f=e("./Log"),m=a(f),g=e("./TmpLog"),h=a(g),v=e("./Loot"),b=a(v);n.handleAtTips=function(){var e=Config.atTipsHandleType;if("default"!==e){var t=$('a.indbox5[href^="guanjianci.php?gjc="]'),n=function(){return t.removeClass("indbox5").addClass("indbox6")},a=function(){return t.parent().next("div.line").addBack().remove()},i=n;if("hide_box_1"!==e&&"hide_box_2"!==e||(i=a),["no_highlight","no_highlight_extra","hide_box_1","at_change_to_cao"].includes(e)){if(t.length>0){var o=s.getCookie(u.default.hideReadAtTipsCookieName),l=$.trim(t.text()),d=/\d+日\d+时\d+分/.exec(l);d&&(l=d[0]),o&&o===l?i():t.click(function(){var e=$(this);if(!e.data("disabled")){var t=s.getCookie(u.default.hideReadAtTipsCookieName);if(t)t!==l&&s.setCookie(u.default.prevReadAtTipsCookieName,t);else{var n=(new Date).getDate().toString();s.setCookie(u.default.prevReadAtTipsCookieName,n.padStart(2,"0")+"日00时00分")}s.setCookie(u.default.hideReadAtTipsCookieName,l,s.getDate("+"+u.default.hideMarkReadAtTipsExpires+"d")),e.data("disabled",!0),i()}}),"at_change_to_cao"===e&&t.text(t.text().replace("@","艹"))}else if(!t.length&&("no_highlight_extra"===e||"at_change_to_cao"===e)){var c='\n<div style="width: 300px;">\n  <a class="indbox6" href="guanjianci.php?gjc='+r.default.userName+'" target="_blank">最近无人'+("at_change_to_cao"===e?"艹":"@")+'你</a><br>\n  <div class="line"></div>\n  <div class="c"></div>\n</div>\n<div class="line"></div>';$('a[href="kf_givemekfb.php"][title="网站虚拟货币"]').parent().before(c)}}else"hide_box_2"===e&&t.length>0&&i()}},n.smLevelUpAlert=function(){var e=parseInt($("#pdSmLevel").data("smLevel"));if(e){var t=function(e){h.setValue(u.default.smLevelUpTmpLogName,{time:(new Date).getTime(),smLevel:e})},n=h.getValue(u.default.smLevelUpTmpLogName);if(n&&"number"===$.type(n.time)&&"number"===$.type(n.smLevel))if(e>n.smLevel){var a=Math.floor(((new Date).getTime()-n.time)/60/60/1e3);if(a>=u.default.smLevelUpAlertInterval){var i=new Date(n.time);t(e),m.push("神秘等级升级","自`"+s.getDateString(i)+"`以来，你的神秘等级共上升了`"+(e-n.smLevel)+"`级 (Lv.`"+n.smLevel+"`->Lv.`"+e+"`)"),c.show("自<em>"+s.getDateString(i)+"</em>以来，你的神秘等级共上升了<em>"+(e-n.smLevel)+"</em>级")}else a<0&&t(e)}else e<n.smLevel&&t(e);else t(e)}},n.smRankChangeAlert=function(){var e=$("#pdSmLevel").data("smRank");if(e&&!e.endsWith("+")){e=parseInt(e);var t=function(e){return h.setValue(u.default.smRankChangeTmpLogName,{time:(new Date).getTime(),smRank:e})},n=h.getValue(u.default.smRankChangeTmpLogName);if(n&&"number"===$.type(n.time)&&"number"===$.type(n.smRank)){if(e!==n.smRank){var a=Math.floor(((new Date).getTime()-n.time)/60/60/1e3);if(a>=u.default.smRankChangeAlertInterval){var i=new Date(n.time),o=e<n.smRank;t(e),m.push("神秘系数排名变化","自`"+s.getDateString(i)+"`以来，你的神秘系数排名共`"+(o?"上升":"下降")+"`了`"+Math.abs(e-n.smRank)+"`名 (No.`"+n.smRank+"`->No.`"+e+"`)"),c.show("自<em>"+s.getDateString(i)+'</em>以来，你的神秘系数排名共<b style="color: '+(o?"#F00":"#393")+'">'+(o?"上升":"下降")+"</b>了<em>"+Math.abs(e-n.smRank)+"</em>名")}else a<0&&t(e)}}else t(e)}},n.addThreadFastGotoLink=function(){$(".index1").on("mouseenter",'li.b_tit4:has("a"), li.b_tit4_1:has("a")',function(){var e=$(this);e.css("position","relative").prepend('<a class="pd_thread_goto" href="'+e.find("a").attr("href")+'&page=e#a">&raquo;</a>')}).on("mouseleave",'li.b_tit4:has("a"), li.b_tit4_1:has("a")',function(){$(this).css("position","static").find(".pd_thread_goto").remove()})},n.showVipSurplusTime=function(){var e=function(e){$("#pdSmLevel").parent().after('<div class="line"></div><div style="width: 300px;"><a href="kf_vmember.php" class="indbox'+(e>0?5:6)+'">VIP会员 ('+(e>0?"剩余"+e+"小时":"参与论坛获得的额外权限")+')</a><div class="c"></div></div>')},t=parseInt(s.getCookie(u.default.vipSurplusTimeCookieName));isNaN(t)||t<0?(console.log("检查VIP剩余时间Start"),$.get("kf_vmember.php?t="+(new Date).getTime(),function(t){var n=0,a=/我的VIP剩余时间\s*<b>(\d+)<\/b>\s*小时/i.exec(t);a&&(n=parseInt(a[1])),s.setCookie(u.default.vipSurplusTimeCookieName,n,s.getDate("+"+u.default.vipSurplusTimeExpires+"m")),e(n)})):e(t)},n.addSearchTypeSelectBox=function(){var e=$('form[action="search.php?"]');e.attr("name","pdSearchForm");var t=e.find('[type="text"][name="keyword"]');t.css("width","116px"),$('<div class="pd_search_type"><span>标题</span><i>&#8744;</i></div>').insertAfter(t)},n.handleIndexLink=function(){var e=$('a[href="kf_givemekfb.php"]'),t=/拥有(-?\d+)KFB/.exec(e.text());if(t){var n=parseInt(t[1]);e.html("拥有<b>"+n.toLocaleString()+"</b>KFB").data("kfb",n)}var a=$('a.indbox5[href="kf_growup.php"]');if(a.attr("id","pdSmLevel"),t=/神秘(-?\d+)级 \(系数排名第\s*(\d+\+?)\s*位/.exec(a.text())){var i=parseInt(t[1]),o=t[2];a.html("神秘<b>"+i+'</b>级 (系数排名第<b style="color: #00f;">'+o+"</b>位)").data("smLevel",i).data("smRank",o)}$('a.indbox5[href="kf_fw_ig_index.php"]').attr("id","pdLoot")},n.addPromoteHaloInterval=function(){var e=parseInt(s.getCookie(u.default.promoteHaloCookieName));if(e){var t=e-(new Date).getTime();if(t>0){var n=Math.ceil(t/60/1e3),a=Math.floor(n/60);n-=60*a,$("#pdLoot").append('<span id="pdHaloInterval"> (光环：'+(a>0?a+"时":"")+n+"分)</span>")}}},n.addChangePointsInfoTips=function e(){var t=s.getCookie(u.default.changePointsInfoCookieName);if(!t)return void b.getChangePointsCountDown().done(e).fail(function(){return setTimeout(e,u.default.defAjaxInterval)});var n="";if($.isNumeric(t)){var a=parseInt(t),i=a-(new Date).getTime();if(i>0){var o=Math.ceil(i/60/1e3),r=Math.floor(o/60);o-=60*r,n=(r>0?r+"时":"")+o+"分"}}else n=parseInt(t)+"次";n&&$("#pdLoot").append('<span id="pdChangePointsTips"> (改点：'+n+")</span>")}},{"./Const":7,"./Info":10,"./Log":12,"./Loot":14,"./Msg":16,"./TmpLog":22,"./Util":23}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={uid:0,userName:"",isInHomePage:"/"===location.pathname||"/index.php"===location.pathname,isMobile:!1,isInMiaolaDomain:location.host.endsWith(".miaola.info"),version:"",w:"undefined"!=typeof unsafeWindow?unsafeWindow:window,storageType:"Default",$userMenu:$(".topmenuo1 > .topmenuo3:last-child > .topmenuo2")};n.default=a},{}],11:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.addBatchUseAndSellItemsButton=n.addBatchBuyItemsLink=n.getItemUsedInfo=n.enhanceMyItemsPage=n.addBatchUseAndConvertOldItemTypesButton=n.getLevelByName=n.armTypeList=n.itemTypeList=void 0;var r=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=e("./Info"),s=i(l),d=e("./Util"),c=a(d),p=e("./Msg"),u=a(p),f=e("./Dialog"),m=a(f),g=e("./Const"),h=i(g),v=e("./Config"),b=e("./Log"),y=a(b),_=e("./Script"),x=a(_),k=e("./Public"),C=a(k),w=n.itemTypeList=["零时迷子的碎片","被遗弃的告白信","学校天台的钥匙","TMA最新作压缩包","LOLI的钱包","棒棒糖","蕾米莉亚同人漫画","十六夜同人漫画","档案室钥匙","傲娇LOLI娇蛮音CD","整形优惠卷","消逝之药"],I=(n.armTypeList=["普通的装备","幸运的装备","稀有的装备","传奇的装备","神秘的装备"],function(e){switch(e){case 1:return 2;case 2:return 10;case 3:return 50;case 4:return 300;case 5:return 2e3;default:return 0}}),L=function(e){switch(e){case 1:return 10;case 2:return 50;case 3:return 300;case 4:return 2e3;case 5:return 1e4;default:return 0}},S=n.getLevelByName=function(e){switch(e){case"零时迷子的碎片":case"被遗弃的告白信":case"学校天台的钥匙":case"TMA最新作压缩包":return 1;case"LOLI的钱包":case"棒棒糖":return 2;case"蕾米莉亚同人漫画":
case"十六夜同人漫画":return 3;case"档案室钥匙":case"傲娇LOLI娇蛮音CD":return 4;case"整形优惠卷":case"消逝之药":return 5;default:return 0}},T=function(e,t){if(/(错误的物品编号|无法再使用|该道具已经被使用)/.test(e))return-1;if(t>=7&&t<=12)return/成功！/.test(e)?{"有效道具":1}:{"无效道具":1};var n=/恢复能量增加了\s*(\d+)\s*点/.exec(e);return n?{"能量":parseInt(n[1])}:(n=/(\d+)KFB/.exec(e))?{KFB:parseInt(n[1])}:(n=/(\d+)点?贡献/.exec(e))?{"贡献":parseInt(n[1])}:(n=/贡献\+(\d+)/.exec(e))?{"贡献":parseInt(n[1])}:{}},D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[],a=e.match(/kf_fw_ig_my\.php\?pro=\d+/g);if(a)for(var i=0;i<a.length&&!(t>0&&i+1>t);i++){var o=/pro=(\d+)/i.exec(a[i]);o&&n.push(parseInt(o[1]))}return n},A=function(e,t){var n={type:1,itemIdList:[],safeId:"",itemLevel:0,itemTypeId:0,itemName:"",$itemLine:null,isTypeBatch:!1};$.extend(n,e),t&&(1===t.round?(console.log("循环使用道具Start，使用道具数量："+t.itemNum+"，有效道具使用次数上限："+(t.maxEffectiveItemCount?t.maxEffectiveItemCount:"无限制")+"，恢复道具成功次数上限："+(t.maxSuccessRestoreItemCount?t.maxSuccessRestoreItemCount:"无限制")),$(".kf_fw_ig1:last").parent().append('\n<ul class="pd_result">\n  <li class="pd_stat">\n    <strong>\n    对<em>'+t.itemNum+"</em>个【Lv."+n.itemLevel+"："+n.itemName+"】道具的循环使用开始（当前道具恢复能量<em>"+t.totalEnergyNum+"</em>点）<br>\n    （有效道具使用次数上限：<em>"+(t.maxEffectiveItemCount?t.maxEffectiveItemCount:"无限制")+"</em>，\n    恢复道具成功次数上限：<em>"+(t.maxSuccessRestoreItemCount?t.maxSuccessRestoreItemCount:"无限制")+"</em>）\n    </strong>\n  </li>\n</ul>\n")):$(".pd_result:last").append('<div class="pd_result_sep"></div>'),$(".pd_result:last").append('<li class="pd_stat" style="color: #ff3399;"><strong>第'+t.round+"轮循环开始：</strong></li>")),t?$(".pd_result:last").append("<li><strong>使用结果：</strong></li>"):$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+n.itemLevel+"："+n.itemName+"】使用结果：</strong></li></ul>");var a=0,i=0,o={"有效道具":0,"无效道具":0},r=[],l=!1;$(document).clearQueue("UseItems"),$.each(n.itemIdList,function(e,s){$(document).queue("UseItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_doit.php?id="+s+"&t="+(new Date).getTime(),timeout:h.default.defAjaxTimeout,success:function(d){C.showFormatLog("使用道具",d);var p=c.getResponseMsg(d),u=p.type,f=p.msg;if(1!==u||/(错误的物品编号|无法再使用|该道具已经被使用)/.test(f))i++,/无法再使用/.test(f)&&(r=[]);else{a++,r.push(s);var m=T(f,n.itemTypeId);if(m!==-1){var g=!0,h=!1,v=void 0;try{for(var b,y=Object.keys(m)[Symbol.iterator]();!(g=(b=y.next()).done);g=!0){var _=b.value;void 0===o[_]?o[_]=m[_]:o[_]+=m[_]}}catch(e){h=!0,v=e}finally{try{!g&&y.return&&y.return()}finally{if(h)throw v}}}}$(".pd_result:last").append("<li><b>第"+(e+1)+"次：</b>"+f+"</li>"),t&&t.maxEffectiveItemCount&&t.stat["有效道具"]+o["有效道具"]>=t.maxEffectiveItemCount&&(l=!0,console.log("有效道具使用次数到达设定上限，循环使用操作停止"),$(".pd_result:last").append('<li><span class="pd_notice">（有效道具使用次数到达设定上限，循环操作中止）</span></li>'))},error:function(){i++},complete:function(){var s=$(".pd_countdown:last");if(s.text(parseInt(s.text())-1),l=l||s.closest(".pd_msg").data("stop"),l&&($(document).clearQueue("UseItems"),n.isTypeBatch&&$(document).clearQueue("UseItemTypes")),l||e===n.itemIdList.length-1){u.remove(s.closest(".pd_msg")),0===o["有效道具"]&&delete o["有效道具"],0===o["无效道具"]&&delete o["无效道具"],!t&&a>0&&y.push("使用道具","共有`"+a+"`个【`Lv."+n.itemLevel+"："+n.itemName+"`】道具被使用",{gain:$.extend({},o,{"已使用道具":a}),pay:{"道具":-a}});var d="",c="",p="",f=!0,m=!1,g=void 0;try{for(var v,b=Object.keys(o)[Symbol.iterator]();!(f=(v=b.next()).done);f=!0){var _=v.value;d+="，"+_+"+"+o[_],c+="<i>"+_+"<em>+"+o[_]+"</em></i>",p+="<i>"+_+"<em>+"+o[_]+"</em></i> ",t&&(void 0===t.stat[_]?t.stat[_]=o[_]:t.stat[_]+=o[_])}}catch(e){m=!0,g=e}finally{try{!f&&b.return&&b.return()}finally{if(m)throw g}}console.log("共有"+a+"个道具被使用"+(i>0?"，共有"+i+"个道具未能使用":"")+d),u.show("<strong>共有<em>"+a+"</em>个道具被使用"+(i>0?"，共有<em>"+i+"</em>个道具未能使用":"")+"</strong>"+c,-1),""===p&&(p='<span class="pd_notice">无</span>'),$(".pd_result:last").append('<li class="pd_stat"><b>统计结果（共有<em>'+a+"</em>个道具被使用）：</b><br>"+p+"</li>"),U(n.$itemLine,a,-a),"零时迷子的碎片"===n.itemName&&j(),t?(n.itemIdList=r,n.itemIdList.length||(l=!0),t.countStat["被使用次数"]+=a,t.stat["道具"]-=a,t.stat["已使用道具"]+=a,P(l?0:2,n,t)):n.isTypeBatch&&$(document).dequeue("UseItemTypes")}else setTimeout(function(){return $(document).dequeue("UseItems")},"function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval)}})})}),$(document).dequeue("UseItems")},E=function(e,t){var n={type:1,itemIdList:[],safeId:"",itemLevel:0,itemTypeId:0,itemName:"",$itemLine:null};$.extend(n,e),t?$(".pd_result:last").append('<li class="pd_result_sep_inner"></li><li><strong>恢复结果：</strong></li>'):$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+n.itemLevel+"："+n.itemName+"】恢复结果：</strong></li></ul>");var a=0,i=0,o=0,r=L(n.itemLevel),l=!1,s=[];$(document).clearQueue("RestoreItems"),$.each(n.itemIdList,function(e,d){$(document).queue("RestoreItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_doit.php?renew="+n.safeId+"&id="+d+"&t="+(new Date).getTime(),timeout:h.default.defAjaxTimeout,success:function(n){C.showFormatLog("恢复道具",n);var p=c.getResponseMsg(n),u=p.type,f=p.msg;1===u&&(/该道具已经被恢复/.test(f)?(f="该道具已经被恢复",a++,o+=r,s.push(d),t&&t.maxSuccessRestoreItemCount&&t.countStat["恢复成功次数"]+a>=t.maxSuccessRestoreItemCount&&(l=!0,f+='<span class="pd_notice">（恢复道具成功次数已达到设定上限，恢复操作中止）</span>')):/恢复失败/.test(f)?(f="该道具恢复失败",i++):/你的能量不足以恢复本道具/.test(f)&&(l=!0,f='你的能量不足以恢复本道具<span class="pd_notice">（恢复操作中止）</span>')),$(".pd_result:last").append("<li><b>第"+(e+1)+"次：</b>"+f+"</li>")},complete:function(){var r=$(".pd_countdown:last");r.text(parseInt(r.text())-1),l=l||r.closest(".pd_msg").data("stop"),l&&$(document).clearQueue("RestoreItems"),l||e===n.itemIdList.length-1?(u.remove(r.closest(".pd_msg")),!t&&(a>0||i>0)&&y.push("恢复道具","共有`"+a+"`个【`Lv."+n.itemLevel+"："+n.itemName+"`】道具恢复成功，共有`"+i+"`个道具恢复失败",{gain:{"道具":a},pay:{"已使用道具":-(a+i),"能量":-o}}),console.log("共有"+a+"个道具恢复成功，共有"+i+"个道具恢复失败，能量-"+o),u.show("<strong>共有<em>"+a+"</em>个道具恢复成功，共有<em>"+i+"</em>个道具恢复失败</strong><i>能量<ins>-"+o+"</ins></i>",-1),$(".pd_result:last").append('<li class="pd_stat">共有<em>'+a+"</em>个道具恢复成功，共有<em>"+i+"</em>个道具恢复失败，<i>能量<ins>-"+o+"</ins></i></li>"),U(n.$itemLine,-(a+i),a,-o),t&&(n.itemIdList=s,n.itemIdList.length||(l=!0),l||t.round++,t.totalEnergyNum-=o,t.countStat["恢复成功次数"]+=a,t.countStat["恢复失败次数"]+=i,t.stat["能量"]-=o,t.stat["道具"]+=a,t.stat["已使用道具"]-=a+i,P(l?0:1,n,t))):setTimeout(function(){return $(document).dequeue("RestoreItems")},"function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval)}})})}),$(document).dequeue("RestoreItems")},P=function(e,t,n){n.countStat&&!$.isEmptyObject(n.countStat)||(n.countStat={"被使用次数":0,"恢复成功次数":0,"恢复失败次数":0}),n.stat&&!$.isEmptyObject(n.stat)||(n.stat={"能量":0,"道具":0,"已使用道具":0,"有效道具":0,"无效道具":0}),$(".pd_msg").length>=5&&u.remove($(".pd_msg:first"));var a=function(e,a){var i="",o=!0,r=!1,l=void 0;try{for(var s,d=Object.keys(a)[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var p=s.value;e>0&&("道具"===p||"已使用道具"===p)||(i+="<i>"+p+c.getStatFormatNumber(n.stat[p])+"</i> ")}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}$(".pd_result:last").append('\n<li class="pd_result_sep'+(e>0?"_inner":"")+'"></li>\n<li class="pd_stat">\n  <strong>\n    '+(e>0?"截至目前为止的统计":"【Lv."+t.itemLevel+"："+t.itemName+"】循环使用最终统计")+"（当前道具恢复能量<em>"+n.totalEnergyNum+'</em>点）：\n  </strong>\n</li>\n<li class="pd_stat">\n  '+(e>0?"":"共进行了<em>"+n.round+"</em>轮循环：")+"\n  <i>被使用次数<em>+"+n.countStat["被使用次数"]+"</em></i>\n  <i>恢复成功次数<em>+"+n.countStat["恢复成功次数"]+"</em></i>\n  <i>恢复失败次数<em>+"+n.countStat["恢复失败次数"]+'</em></i>\n</li>\n<li class="pd_stat">'+i+"</li>\n")};if(1===e)a(e,n.stat),u.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.itemIdList.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),setTimeout(function(){A(t,n)},1===n.round?500:"function"==typeof h.default.cycleUseItemsFirstAjaxInterval?h.default.cycleUseItemsFirstAjaxInterval():h.default.cycleUseItemsFirstAjaxInterval);else if(2===e)u.wait('<strong>正在恢复道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.itemIdList.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),setTimeout(function(){return E(t,n)},"function"==typeof h.default.cycleUseItemsFirstAjaxInterval?h.default.cycleUseItemsFirstAjaxInterval():h.default.cycleUseItemsFirstAjaxInterval);else{0===n.stat["道具"]&&delete n.stat["道具"],0===n.stat["已使用道具"]&&delete n.stat["已使用道具"],0===n.stat["有效道具"]&&delete n.stat["有效道具"],0===n.stat["无效道具"]&&delete n.stat["无效道具"];var i={},o={};for(var r in n.stat)n.stat[r]>0?i[r]=n.stat[r]:o[r]=n.stat[r];n.countStat["被使用次数"]>0&&y.push("循环使用道具","对`"+n.itemNum+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具进行了`"+n.round+"`轮循环使用(被使用次数`+"+n.countStat["被使用次数"]+"`，恢复成功次数`+"+n.countStat["恢复成功次数"]+"`，恢复失败次数`+"+n.countStat["恢复失败次数"]+"`)",{gain:i,pay:o}),console.log("共进行了"+n.round+"轮循环，被使用次数+"+n.countStat["被使用次数"]+"，恢复成功次数+"+n.countStat["恢复成功次数"]+"，恢复失败次数+"+n.countStat["恢复失败次数"]+"，能量"+n.stat["能量"]),u.show("<strong>共进行了<em>"+n.round+"</em>轮循环</strong><i>被使用次数<em>+"+n.countStat["被使用次数"]+"</em></i><i>恢复成功次数<em>+"+n.countStat["恢复成功次数"]+"</em></i><i>恢复失败次数<em>+"+n.countStat["恢复失败次数"]+"</em></i><i>能量<ins>"+n.stat["能量"]+'</ins></i><a href="#">清除消息框</a>',-1).find("a").click(function(e){e.preventDefault(),u.destroy()}),a(e,n.stat)}},N=function(e){var t={type:1,itemIdList:[],safeId:"",itemLevel:0,itemName:"",$itemLine:null,isTypeBatch:!1};$.extend(t,e),$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+t.itemLevel+"："+t.itemName+"】转换结果：</strong></li></ul>");var n=0,a=0,i=I(t.itemLevel);$(document).clearQueue("ConvertItemsToEnergy"),$.each(t.itemIdList,function(e,o){$(document).queue("ConvertItemsToEnergy",function(){$.ajax({type:"GET",url:"kf_fw_ig_doit.php?tomp="+t.safeId+"&id="+o+"&t="+(new Date).getTime(),timeout:h.default.defAjaxTimeout,success:function(e){C.showFormatLog("将道具转换为能量",e);var t=c.getResponseMsg(e),i=t.msg;/转换为了\s*\d+\s*点能量/.test(i)?n++:a++},error:function(){a++},complete:function(){var o=$(".pd_countdown:last");o.text(parseInt(o.text())-1);var r=o.closest(".pd_msg").data("stop");if(r&&($(document).clearQueue("ConvertItemsToEnergy"),t.isTypeBatch&&$(document).clearQueue("ConvertItemTypesToEnergy")),r||e===t.itemIdList.length-1){u.remove(o.closest(".pd_msg"));var l=n*i;n>0&&y.push("将道具转换为能量","共有`"+n+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具成功转换为能量",{gain:{"能量":l},pay:{"已使用道具":-n}}),console.log("共有"+n+"个道具成功转换为能量"+(a>0?"，共有"+a+"个道具转换失败":"")+"，能量+"+l),u.show("<strong>共有<em>"+n+"</em>个道具成功转换为能量"+(a>0?"，共有<em>"+a+"</em>个道具转换失败":"")+"</strong><i>能量<em>+"+l+"</em></i>",-1),$(".pd_result:last").append('<li class="pd_stat">共有<em>'+n+"</em>个道具成功转换为能量"+(a>0?"，共有<em>"+a+"</em>个道具转换失败":"")+"，<i>能量<em>+"+l+"</em></i></li>"),U(t.$itemLine,-n,null,l),t.isTypeBatch&&$(document).dequeue("ConvertItemTypesToEnergy")}else setTimeout(function(){return $(document).dequeue("ConvertItemsToEnergy")},h.default.defAjaxInterval)}})})}),$(document).dequeue("ConvertItemsToEnergy")},M=(n.addBatchUseAndConvertOldItemTypesButton=function(){var e=C.getSafeId();e&&($('\n<div class="pd_item_btns">\n  <button name="useItemTypes" type="button" title="批量使用指定种类的道具">批量使用</button>\n  <button class="pd_highlight" name="convertItemTypes" type="button" title="批量将指定种类的道具转换为能量">批量转换</button>\n  <button name="selectAll" type="button">全选</button>\n  <button name="selectInverse" type="button">反选</button>\n</div>\n').insertAfter(".pd_items").on("click","button",function(){var t=$(this).attr("name");if("useItemTypes"===t||"convertItemTypes"===t){var n=[];if($(".pd_item_type_chk:checked").each(function(){var e=$(this).closest("tr"),a=parseInt(e.find("td:first-child").text()),i=parseInt(e.data("itemTypeId")),o=e.find("td:nth-child(2)").text().trim();if(!(isNaN(i)||i<=0||"convertItemTypes"===t&&1===i)){var r=e.find("td:last-child").find("useItemTypes"===t?"a:first-child":"a:last-child").attr("href")+"&t="+(new Date).getTime();n.push({itemTypeId:i,itemLevel:a,itemName:o,$itemLine:e,itemListUrl:r})}}),!n.length)return;var a=parseInt(prompt("在指定种类道具中你要"+("useItemTypes"===t?"使用":"转换")+"多少个道具？（0表示不限制）",0));if(isNaN(a)||a<0)return;u.destroy();var i="useItemTypes"===t?"UseItemTypes":"ConvertItemTypesToEnergy";$(document).clearQueue(i),$.each(n,function(n,o){$(document).queue(i,function(){var n=u.wait("正在获取本种类"+("useItemTypes"===t?"未":"已")+"使用道具列表，请稍后&hellip;");$.ajax({type:"GET",url:o.itemListUrl,timeout:h.default.defAjaxTimeout,success:function(r){u.remove(n);var l=D(r,a);if(!l.length)return void $(document).dequeue(i);"useItemTypes"===t?(console.log("批量使用道具Start，使用道具数量："+l.length),u.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+l.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),A({type:1,itemIdList:l,safeId:e,itemLevel:o.itemLevel,itemTypeId:o.itemTypeId,itemName:o.itemName,$itemLine:o.$itemLine,isTypeBatch:!0})):(console.log("批量转换道具为能量Start，转换道具数量："+l.length),u.wait('<strong>正在转换能量中&hellip;</strong><i>剩余：<em class="pd_countdown">'+l.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),N({type:1,itemIdList:l,safeId:e,itemLevel:o.itemLevel,itemName:o.itemName,$itemLine:o.$itemLine,isTypeBatch:!0}))},error:function(){u.remove(n),$(document).dequeue(i)}})})}),$(document).dequeue(i)}else"selectAll"===t?c.selectAll($(".pd_item_type_chk")):"selectInverse"===t&&c.selectInverse($(".pd_item_type_chk"))}),C.addSimulateManualActionChecked($(".pd_item_btns")))},function(e){var t=C.getSafeId();t&&e.on("click",'a[href="#"]',function(e){e.preventDefault();var n=$(this);if(!n.is(".pd_disabled_link")){var a=n.closest("tr"),i=parseInt(a.find("td:first-child").text()),o=parseInt(a.data("itemTypeId")),r=a.find("td:nth-child(2)").text().trim(),l=parseInt(a.find("td:nth-child(3) > .pd_usable_num").text()),s=parseInt(a.find("td:nth-child(3) > .pd_used_num").text()),d="";if(!(isNaN(o)||o<=0))if(n.is(".pd_items_batch_use")){var c=parseInt(prompt("你要使用多少个【Lv."+i+"："+r+"】道具？（0表示不限制）",l?l:0));if(isNaN(c)||c<0)return;u.destroy(),u.wait("正在获取本种类未使用道具列表，请稍后&hellip;"),d=a.find("td:last-child").find("a:first-child").attr("href")+"&t="+(new Date).getTime(),$.get(d,function(e){u.destroy();var n=D(e,c);if(!n.length)return void alert("本种类没有未使用的道具");console.log("批量使用道具Start，使用道具数量："+n.length),u.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+n.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),A({type:1,itemIdList:n,safeId:t,itemLevel:i,itemTypeId:o,itemName:r,$itemLine:a})})}else if(n.is(".pd_items_cycle_use")){var p=prompt("你要循环使用多少个【Lv."+i+"："+r+"】道具？\n（可直接填写道具数量，也可使用“道具数量|有效道具使用次数上限|恢复道具成功次数上限”的格式[设为0表示不限制]，例一：7；例二：5|3；例三：3|0|6）",l?l:0);if(null===p)return;if(p=$.trim(p),!/\d+(\|\d+)?(\|\d+)?/.test(p))return void alert("格式不正确");var f=p.split("|"),m=0,g=0,h=0;if(m=parseInt(f[0]),isNaN(m)||m<0)return;void 0!==f[1]&&(g=parseInt(f[1])),void 0!==f[2]&&(h=parseInt(f[2])),u.destroy(),u.wait("正在获取本种类未使用道具列表，请稍后&hellip;"),d=a.find("td:last-child").find("a:first-child").attr("href")+"&t="+(new Date).getTime(),$.get(d,function(e){u.destroy();var n=D(e,m);if(!n.length)return void alert("本种类没有未使用的道具");u.wait("正在获取当前道具相关信息，请稍后&hellip;"),$.get("kf_fw_ig_my.php?t="+(new Date).getTime(),function(e){O(e),$.get("kf_fw_ig_renew.php?t="+(new Date).getTime(),function(e){u.destroy();var l=F(e);j(e),P(1,{type:1,itemIdList:n,safeId:t,itemLevel:i,itemTypeId:o,itemName:r,$itemLine:a},{itemNum:n.length,round:1,totalEnergyNum:l,countStat:{},stat:{},maxEffectiveItemCount:g,maxSuccessRestoreItemCount:h})})})})}else if(n.is(".pd_items_batch_restore")){var v=parseInt(prompt("你要恢复多少个【Lv."+i+"："+r+"】道具？（0表示不限制）",s?s:0));if(isNaN(v)||v<0)return;u.destroy(),d=a.find("td:last-child").find("a:last-child").attr("href")+"&t="+(new Date).getTime(),u.wait("正在获取本种类已使用道具列表，请稍后&hellip;"),$.get(d,function(e){u.destroy();var n=D(e,v);if(!n.length)return void alert("本种类没有已使用的道具");console.log("批量恢复道具Start，恢复道具数量："+n.length),u.wait('<strong>正在恢复道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+n.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),E({type:1,itemIdList:n,safeId:t,itemLevel:i,itemTypeId:o,itemName:r,$itemLine:a})})}else if(n.is(".pd_items_batch_convert")){var b=parseInt(prompt("你要将多少个【Lv."+i+"："+r+"】道具转换为能量？（0表示不限制）",s?s:0));if(isNaN(b)||b<0)return;u.destroy(),d=a.find("td:last-child").find("a:last-child").attr("href")+"&t="+(new Date).getTime(),u.wait("正在获取本种类已使用道具列表，请稍后&hellip;"),$.get(d,function(e){u.destroy();var n=D(e,b);if(!n.length)return void alert("本种类没有已使用的道具");console.log("批量转换道具为能量Start，转换道具数量："+n.length),u.wait('<strong>正在转换能量中&hellip;</strong><i>剩余：<em class="pd_countdown">'+n.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),N({type:1,itemIdList:n,safeId:t,itemLevel:i,itemName:r,$itemLine:a})})}}})}),U=(n.enhanceMyItemsPage=function(){var e=$(".kf_fw_ig1:last");e.addClass("pd_items").find("tbody > tr").each(function(e){var t=$(this);if(0===e)t.find("td").attr("colspan",6);else if(1===e)t.find("td:first-child").css("width","75px").end().find("td:nth-child(2)").css("width","185px").end().find("td:nth-child(3)").css("width","105px").html('<span class="pd_usable_num">可用数</span> / <span class="pd_used_num pd_custom_tips">已用数</span>').end().find("td:last-child").css("width","165px").before('<td style="width: 135px;">使用道具</td><td style="width: 135px;">恢复道具 和 转换能量</td>');else{t.find("td:first-child").prepend('<input class="pd_input pd_item_type_chk" type="checkbox">');var n=2===e?"pd_disabled_link":"";t.find("td:nth-child(3)").wrapInner('<span class="pd_usable_num" style="margin-left: 5px;"></span>').append(' / <span class="pd_used_num pd_custom_tips">?</span>').after('\n<td>\n  <a class="pd_items_batch_use" href="#" title="批量使用指定数量的道具">批量使用</a>\n  <a class="pd_items_cycle_use pd_highlight '+n+'" href="#" title="循环使用和恢复指定数量的道具，直至停止操作或没有道具可以恢复">循环使用</a>\n</td>\n<td>\n  <a class="pd_items_batch_restore '+n+'" href="#" title="批量恢复指定数量的道具">批量恢复</a>\n  <a class="pd_items_batch_convert pd_highlight '+n+'" href="#" title="批量将指定数量的道具转换为能量">批量转换</a>\n</td>\n');var a=t.find("td:last-child"),i=/lv=(\d+)/i.exec(a.find("a").attr("href"));if(i){var o=parseInt(i[1]);t.data("itemTypeId",o),a.find("a").text("未使用列表").after('<a class="pd_highlight" href="kf_fw_ig_renew.php?lv='+o+'">已使用列表</a>')}}}),M(e),j(),e.before('<div class="pd_highlight" style="margin-bottom: 5px;">此为旧版道具页面，在物品商店购买的新道具请到<a href="kf_fw_ig_mybp.php">角色/物品</a>页面查看！</div>')},function(e,t,n,a){var i=!1;if(e){var o=e.find("td:nth-child(3) > .pd_used_num"),r=e.find("td:nth-child(2)").text().trim();if(o.length>0&&"零时迷子的碎片"!==r){var l=parseInt(o.text());isNaN(l)||l+t<0?i=!0:(o.text(l+t),B())}if(n){var s=e.find("td:nth-child(3) > .pd_usable_num");if(s.length>0){var d=parseInt(s.text());isNaN(d)||d+n<0?i=!0:s.text(d+n)}}}if(a){var p=$(".pd_total_energy_num");if(p.length>0){var u=parseInt(p.text());isNaN(u)||u+a<0?i=!0:p.text(u+a)}else i=!0}i&&(j(),"/kf_fw_ig_my.php"!==location.pathname||c.getUrlParam("lv")||O())}),F=function(e){var t=0,n=/道具恢复能量<br\s*\/?><span.+?>(\d+)<\/span><br\s*\/?>点/i.exec(e);return n&&(t=parseInt(n[1])),t},B=function(){var e=0,t=0;$(".kf_fw_ig1:last > tbody > tr:gt(1) > td:nth-child(3) > .pd_used_num").each(function(){var n=$(this),a=parseInt(n.text());if(!(isNaN(a)||a<0)){var i=parseInt(n.closest("tr").find("td:first-child").text());if(i){var o=L(i),r=I(i);e+=o*a,t+=r*a,n.attr("title","全部恢复需要"+o*a+"点能量，全部转换可得"+r*a+"点能量")}}}),$(".kf_fw_ig1:last > tbody > tr:nth-child(2) > td:nth-child(3) > .pd_used_num").attr("title","全部恢复需要"+e+"点能量，全部转换可得"+t+"点能量")},j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=function(e){var t=F(e),n=/(1级道具转换得.+?点能量)。<br/.exec(e);if("/kf_fw_ig_my.php"===location.pathname&&$(".kf_fw_ig_title1:last").find("span:has(.pd_total_energy_num)").remove().end().append('<span class="pd_custom_tips" style="margin-left: 7px;" title="'+(n?n[1]:"")+'">(道具恢复能量 <b class="pd_total_energy_num" style="font-size: 14px;">'+t+"</b> 点)</span>"),$(".pd_used_num").length>0){var a=e.match(/">\d+<\/td><td>全部转换本级已使用道具为能量<\/td>/g);if(a){var i=[];for(var o in a){var r=/">(\d+)<\/td>/i.exec(a[o]);r&&i.push(r[1])}var l=$(".kf_fw_ig1:last > tbody > tr:gt(1) > td:nth-child(3) > .pd_used_num");l.length===a.length&&(l.each(function(e){$(this).text(i[e])}),B())}}};e?t(e):$.get("kf_fw_ig_renew.php?t="+(new Date).getTime(),function(e){return t(e)})},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=function(e){var t=e.match(/">\d+<\/td><td><a href="kf_fw_ig_my\.php\?lv=/gi);if(t){var n=[];for(var a in t){var i=/">(\d+)<\/td>/i.exec(t[a]);i&&n.push(i[1])}$(".kf_fw_ig1:last > tbody > tr:gt(1) > td:nth-child(3) > .pd_usable_num").each(function(e){$(this).text(n[e]?n[e]:0)})}};e?t(e):$.get("kf_fw_ig_my.php?t="+(new Date).getTime(),function(e){return t(e)})},q=(n.getItemUsedInfo=function(e){var t=new Map([["蕾米莉亚同人漫画",0],["十六夜同人漫画",0],["档案室钥匙",0],["傲娇LOLI娇蛮音CD",0],["消逝之药",0],["整形优惠卷",0]]),n=e.match(/value="\[\s*(\d+)\s*](\S+?)"/g);for(var a in n){var i=/value="\[\s*(\d+)\s*](\S+?)"/.exec(n[a]);t.set(i[2],parseInt(i[1]))}return t},n.addBatchBuyItemsLink=function(){var e=$(".kf_fw_ig1").addClass("pd_items");e.find("> tbody > tr:first-child > td:nth-child(2)").css("width","430px").next("td").next("td").css("width","120px"),e.find('a[href^="kf_fw_ig_shop.php?do=buy&id="]').after('<a data-name="batchBuyItem" href="#">批量购买</a>'),e.on("click",'[data-name="batchBuyItem"]',function(e){e.preventDefault();var t=$(this),n=t.closest("tr"),a=n.find("td:first-child").text().trim(),i=parseInt(n.find("td:nth-child(3)").text()),o=t.prev("a").attr("href");if(a.includes("道具")&&i&&o){var r=parseInt(prompt("你要购买多少个【"+a+"】？（单价："+i.toLocaleString()+" KFB）",0));!r||r<0||(u.wait('<strong>正在购买道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+r+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),q(r,a,i,o))}}).on("click",'a[href^="kf_fw_ig_shop.php?do=buy&id="]',function(){return confirm("是否购买该物品？")}),e.after('<div class="pd_item_btns"></div>'),C.addSimulateManualActionChecked($(".pd_item_btns")),R()},function(e,t,n,a){var i=0,o=0,l=[],s={},d=!1,p=function e(){$.ajax({type:"GET",url:a+"&t="+(new Date).getTime(),timeout:h.default.defAjaxTimeout,success:function(e){C.showFormatLog("购买道具",e);var t=c.getResponseMsg(e),a=t.msg;/购买成功，返回我的背包/.test(a)?(i++,o+=n):(d=!0,$(".pd_result:last").append("<li>"+a+'<span class="pd_notice">（购买中止）</span></li>')),setTimeout(f,h.default.defAjaxInterval)},error:function(){setTimeout(e,h.default.defAjaxInterval)}})},f=function n(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];$.ajax({type:"GET",url:"kf_fw_ig_mybp.php?t="+(new Date).getTime(),timeout:h.default.defAjaxTimeout,success:function(n){var f=[];$('.kf_fw_ig1 a[href^="kf_fw_ig_mybp.php?do=1&id="]',n).each(function(){var e=$(this),t=e.attr("href");if(f.push(t),!a&&!l.includes(t)){var n=e.closest("tr").find("td:nth-child(2)").text().trim();w.includes(n)&&(n in s||(s[n]=0),s[n]++,console.log("获得了一个【Lv."+S(n)+"："+n+"】道具"),$(".pd_result:last").append('<li>获得了一个【<b class="pd_highlight">Lv.'+S(n)+"："+n+"</b>】道具</li>"))}}),l=f;var m=$(".pd_countdown:last");if(m.text(e-i),(d=d||m.closest(".pd_msg").data("stop"))||i===e){u.remove(m.closest(".pd_msg"));var g=!0,v=!1,b=void 0;try{for(var _,x=c.entries(s)[Symbol.iterator]();!(g=(_=x.next()).done);g=!0){var k=r(_.value,2),C=k[0];k[1]||delete s[C]}}catch(e){v=!0,b=e}finally{try{!g&&x.return&&x.return()}finally{if(v)throw b}}i>0&&!$.isEmptyObject(s)&&y.push("购买道具","共有`"+i+"`个【`"+t+"`】购买成功",{gain:{"道具":i,item:s},pay:{KFB:-o}});var I="",L=!0,T=!1,D=void 0;try{for(var A,E=c.getSortedObjectKeyList(w,s)[Symbol.iterator]();!(L=(A=E.next()).done);L=!0){var C=A.value;I+="<i>"+C+"<em>+"+s[C]+"</em></i> "}}catch(e){T=!0,D=e}finally{try{!L&&E.return&&E.return()}finally{if(T)throw D}}$(".pd_result:last").append('\n<li class="pd_stat">\n  <b>统计结果：</b><br>\n  共有<em>'+i+"</em>个道具购买成功，<i>KFB<ins>-"+o.toLocaleString()+"</ins></i> "+I+'<br>\n  <span style="color: #666;">(请到<a href="kf_fw_ig_mybp.php">角色/物品页面</a>查看)</span>\n</li>\n'),console.log("共有"+i+"个【"+t+"】购买成功，KFB-"+o),u.show("<strong>共有<em>"+i+"</em>个【"+t+"】购买成功</strong><i>KFB<ins>-"+o.toLocaleString()+"</ins></i>",-1),R()}else{var P="function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval;setTimeout(p,a?h.default.defAjaxInterval:P)}},error:function(){setTimeout(function(){return n(a)},h.default.defAjaxInterval)}})};$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【'+t+"】购买结果：</strong></li></ul>"),f(!0)}),R=function(){$.get("profile.php?action=show&uid="+s.default.uid+"&t="+(new Date).getTime(),function(e){var t=/论坛货币：(\d+)\s*KFB<br/i.exec(e);if(t){var n=parseInt(t[1]);$(".kf_fw_ig_title1:last").find("span:last").remove().end().append('<span style="margin-left: 7px;">(当前持有 <b style="font-size: 14px;">'+n.toLocaleString()+"</b> KFB)</span>")}})},K=(n.addBatchUseAndSellItemsButton=function(){var e=C.getSafeId();if(e){var t=$(".kf_fw_ig1:eq(1)");$('\n<div class="pd_item_btns">\n  <button name="useItems" type="button" style="color: #00f;" title="批量使用指定道具">批量使用</button>\n  <button name="sellItems" type="button" style="color: #f00;" title="批量出售指定道具">批量出售</button>\n</div>\n').insertAfter(t).find('[name="useItems"]').click(function(){return K(1,e)}).end().find('[name="sellItems"]').click(function(){return K(2,e)}),C.addSimulateManualActionChecked($(".pd_item_btns:last"))}},function(e,t){var n="pdBatchUseAndSellItemsDialog";if(!($("#"+n).length>0)){u.destroy();var a=1===e?"使用":"出售";(0,v.read)();var i='\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">请选择想批量'+a+'的道具种类（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</div>\n  <select name="itemTypes" size="6" style="width: 320px;" multiple>\n    <option>蕾米莉亚同人漫画</option><option>十六夜同人漫画</option><option>档案室钥匙</option>\n    <option>傲娇LOLI娇蛮音CD</option><option>整形优惠卷</option><option>消逝之药</option>\n  </select>\n</div>\n<div class="pd_cfg_btns">\n  <button name="sell" type="button">'+a+'</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',o=m.create(n,"批量"+a+"道具",i);o.find('[name="itemTypes"]').keydown(function(e){e.ctrlKey&&65===e.keyCode&&(e.preventDefault(),$(this).children().prop("selected",!0))}).end().find('[name="sell"]').click(function(){var i=o.find('[name="itemTypes"]').val();Array.isArray(i)&&((0,v.read)(),1===e?Config.defUseItemTypeList=i:Config.defSellItemTypeList=i,(0,v.write)(),confirm("是否"+a+"所选道具种类？")&&(m.close(n),1===e?H(i,t):W(i,t)))}),o.find('[name="itemTypes"] > option').each(function(){var t=$(this);(1===e?Config.defUseItemTypeList:Config.defSellItemTypeList).includes(t.val())&&t.prop("selected",!0)}),m.show(n),x.runFunc("Item.showBatchUseAndSellItemsDialog_after_",e)}}),H=function(e,t){var n=$(".kf_fw_ig1:eq(1)"),a=0,i=0,l={},s=[].concat(o(e)),d=function(e,o,r){i++,$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=1&id="+e+"&safeid="+t,timeout:h.default.defAjaxTimeout}).done(function(t){if(t){var d=c.removeHtmlTag(t);if(/(成功|失败)！/.test(d))a++,o in l||(l[o]={"道具":0,"有效道具":0,"无效道具":0}),l[o]["道具"]++,/成功！/.test(d)?l[o]["有效道具"]++:l[o]["无效道具"]++,g.find(".pd_countdown").text(a),n.find('[id="wp_'+e+'"]').fadeOut("normal",function(){$(this).remove()});else if(/无法再使用/.test(d)){i=r;var p=s.indexOf(o);p>-1&&s.splice(p,1)}console.log("【Lv."+S(o)+"："+o+"】 "+d),$(".pd_result:last").append("<li>【Lv."+S(o)+"："+o+"】 "+d+"</li>"),x.runFunc("Item.useItems_after_")}}).fail(function(){$(".pd_result:last").append("<li>【Lv."+S(o)+"："+o+'】 <span class="pd_notice">连接超时</span></li>')}).always(function(){g.data("stop")?m():i===r?setTimeout(f,"function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval):setTimeout(function(){return $(document).dequeue("UseItems")},"function"==typeof h.default.specialAjaxInterval?h.default.specialAjaxInterval():h.default.specialAjaxInterval)})},p=function(){var e=[];if(n.find('tr[id^="wp_"]').each(function(){var t=$(this),n=/wp_(\d+)/.exec(t.attr("id"));if(n){var a=parseInt(n[1]),i=t.find("> td:nth-child(3)").text().trim();s.includes(i)&&e.push({itemId:a,itemName:i})}}),!e.length)return void m();i=0,$(document).clearQueue("UseItems"),$.each(e,function(t,n){var a=n.itemId,i=n.itemName;$(document).queue("UseItems",function(){return d(a,i,e.length)})}),$(document).dequeue("UseItems")},f=function(){C.getNextObjects(function(){g.data("stop")?m():setTimeout(p,h.default.defAjaxInterval)})},m=function(){if($(document).clearQueue("UseItems"),u.remove(g),$.isEmptyObject(l))return void alert("没有道具被使用！");var t=0,n="",i=!0,o=!1,s=void 0;try{for(var d,p=c.getSortedObjectKeyList(e,l)[Symbol.iterator]();!(i=(d=p.next()).done);i=!0){var f=d.value;t++;var m=S(f),h=l[f],v=h["道具"];if(delete h["道具"],0===h["有效道具"]&&delete h["有效道具"],0===h["无效道具"]&&delete h["无效道具"],!$.isEmptyObject(h)){n+="【Lv."+m+"："+f+"】 <i>道具<ins>-"+v+"</ins></i> ";var b=!0,_=!1,k=void 0;try{for(var C,w=c.entries(h)[Symbol.iterator]();!(b=(C=w.next()).done);b=!0){var I=r(C.value,2);n+="<i>"+I[0]+"<em>+"+I[1]+"</em></i> "}}catch(e){_=!0,k=e}finally{try{!b&&w.return&&w.return()}finally{if(_)throw k}}n+="<br>",y.push("使用道具","共有`"+v+"`个【`Lv."+m+"："+f+"`】道具被使用",{gain:h,pay:{"道具":-v}})}}}catch(e){o=!0,s=e}finally{try{!i&&p.return&&p.return()}finally{if(o)throw s}}$(".pd_result:last").append('\n<li class="pd_stat">\n  <b>统计结果（共有<em>'+t+"</em>个种类中的<em>"+a+"</em>个道具被使用）：</b><br>\n  "+n+"\n</li>"),console.log("共有"+t+"个种类中的"+a+"个道具被使用"),u.show("<strong>共有<em>"+t+"</em>个种类中的<em>"+a+"</em>个道具被使用</strong>",-1),x.runFunc("Item.useItems_complete_")};n.parent().append('<ul class="pd_result"><li><strong>使用结果：</strong></li></ul>');var g=u.wait('<strong>正在使用道具中&hellip;</strong><i>已使用：<em class="pd_countdown">0</em></i><a class="pd_stop_action" href="#">停止操作</a>');p()},W=function(e,t){var n=$(".kf_fw_ig1:eq(1)"),a=0,i=0,o={},r=function(e,r,l){i++,$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=2&id="+e+"&safeid="+t,timeout:h.default.defAjaxTimeout}).done(function(t){if(t){var i=c.removeHtmlTag(t);console.log("【Lv."+S(r)+"："+r+"】 "+i),$(".pd_result:last").append("<li>【Lv."+S(r)+"："+r+"】 "+i+"</li>"),n.find('[id="wp_'+e+'"]').fadeOut("normal",function(){$(this).remove()});var l=/出售该物品获得了\[\s*(\d+)\s*]KFB/.exec(i);l&&(a++,r in o||(o[r]={num:0,sell:0}),o[r].num++,o[r].sell+=parseInt(l[1]),p.find(".pd_countdown").text(a),x.runFunc("Item.sellItems_after_"))}}).fail(function(){$(".pd_result:last").append("<li>【Lv."+S(r)+"："+r+'】 <span class="pd_notice">连接超时</span></li>')}).always(function(){p.data("stop")?d():i===l?setTimeout(s,h.default.defAjaxInterval):setTimeout(function(){return $(document).dequeue("SellItems")},h.default.minItemActionInterval)})},l=function(){var t=[];if(n.find('tr[id^="wp_"]').each(function(){var n=$(this),a=/wp_(\d+)/.exec(n.attr("id"));if(a){var i=parseInt(a[1]),o=n.find("> td:nth-child(3)").text().trim();e.includes(o)&&t.push({itemId:i,itemName:o})}}),!t.length)return void d();i=0,$(document).clearQueue("SellItems"),$.each(t,function(e,n){var a=n.itemId,i=n.itemName;$(document).queue("SellItems",function(){return r(a,i,t.length)})}),$(document).dequeue("SellItems")},s=function(){C.getNextObjects(function(){p.data("stop")?d():setTimeout(l,h.default.defAjaxInterval)})},d=function(){if($(document).clearQueue("SellItems"),u.remove(p),$.isEmptyObject(o))return void alert("没有道具被出售！");var t=0,n=0,i="",r=!0,l=!1,s=void 0;try{for(var d,f=c.getSortedObjectKeyList(e,o)[Symbol.iterator]();!(r=(d=f.next()).done);r=!0){var m=d.value;t++;var g=S(m),h=o[m],v=h.sell,b=h.num;n+=v,i+="【Lv."+g+"："+m+"】 <i>道具<ins>-"+b+"</ins></i> <i>KFB<em>+"+v.toLocaleString()+"</em></i><br>",y.push("出售道具","共有`"+b+"`个【`Lv."+g+"："+m+"`】道具出售成功",{gain:{KFB:v},pay:{"道具":-b}})}}catch(e){l=!0,s=e}finally{try{!r&&f.return&&f.return()}finally{if(l)throw s}}
$(".pd_result:last").append('\n<li class="pd_stat">\n  <b>统计结果（共有<em>'+t+"</em>个种类中的<em>"+a+"</em>个道具出售成功）：</b> <i>KFB<em>+"+n.toLocaleString()+"</em></i><br>\n  "+i+"\n</li>"),console.log("共有"+t+"个种类中的"+a+"个道具出售成功，KFB+"+n),u.show("<strong>共有<em>"+t+"</em>个种类中的<em>"+a+"</em>个道具出售成功</strong><i>KFB<em>+"+n.toLocaleString()+"</em></i>",-1),x.runFunc("Item.sellItems_complete_")};n.parent().append('<ul class="pd_result"><li><strong>出售结果：</strong></li></ul>');var p=u.wait('<strong>正在出售道具中&hellip;</strong><i>已出售：<em class="pd_countdown">0</em></i><a class="pd_stop_action" href="#">停止操作</a>');l()}},{"./Config":5,"./Const":7,"./Dialog":8,"./Info":10,"./Log":12,"./Msg":16,"./Public":19,"./Script":21,"./Util":23}],12:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.getMergeLog=n.push=n.clear=n.write=n.read=void 0;var i=e("./Info"),o=a(i),r=e("./Util"),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r),s=e("./Const"),d=a(s),c=d.default.storagePrefix+"log",p=n.read=function(){var e={},t=l.readData(c+"_"+o.default.uid);if(!t)return e;try{t=JSON.parse(t)}catch(t){return e}return t&&"object"===$.type(t)?e=t:e},u=n.write=function(e){return l.writeData(c+"_"+o.default.uid,JSON.stringify(e))};n.clear=function(){return l.deleteData(c+"_"+o.default.uid)},n.push=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.gain,i=void 0===a?null:a,o=n.pay,r=void 0===o?null:o,s=p(),d=l.getDateString(l.getDate("-"+Config.logSaveDays+"d")),c=!0,f=!1,m=void 0;try{for(var g,h=l.getObjectKeyList(s,1)[Symbol.iterator]();!(c=(g=h.next()).done);c=!0){var v=g.value;if(!(v<=d))break;delete s[v]}}catch(e){f=!0,m=e}finally{try{!c&&h.return&&h.return()}finally{if(f)throw m}}var b=new Date,y=b.getTime(),_=l.getDateString(b),x={time:y,type:e,action:t};i&&(x.gain=i),r&&(x.pay=r),Array.isArray(s[_])||(s[_]=[]),s[_].push(x),u(s)},n.getMergeLog=function(e,t){for(var n in t)if(Array.isArray(e[n])){var a=!0,i=!1,o=void 0;try{for(var r,l=t[n][Symbol.iterator]();!(a=(r=l.next()).done);a=!0){(function(){var t=r.value;if("number"!=typeof t.time||"string"!=typeof t.type)return"continue";var a=e[n].findIndex(function(e){return t.time===e.time&&t.type===e.type});a>-1?e[n][a]=t:e[n].push(t)})()}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}e[n].sort(function(e,t){return e.time>t.time?1:-1})}else e[n]=t[n];return e}},{"./Const":7,"./Info":10,"./Util":23}],13:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.show=void 0;var i=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("./Util"),r=a(o),l=e("./Dialog"),s=a(l),d=e("./Config"),c=e("./Log"),p=a(c),u=e("./Item"),f=a(u),m=e("./Box"),g=a(m),h=e("./Script"),v=a(h),b=(n.show=function(){if(!($("#pdLogDialog").length>0)){(0,d.read)(),v.runFunc("LogDialog.show_before_");var e=s.create("pdLogDialog","KFOL助手日志",'\n<div class="pd_cfg_main">\n  <div class="pd_log_nav">\n    <a class="pd_disabled_link" data-name="start" href="#">&lt;&lt;</a>\n    <a class="pd_disabled_link" data-name="prev" href="#" style="padding: 0 7px;">&lt;</a>\n    <h2 class="pd_log_date pd_custom_tips">暂无日志</h2>\n    <a class="pd_disabled_link" data-name="next" href="#" style="padding: 0 7px;">&gt;</a>\n    <a class="pd_disabled_link" data-name="end" href="#">&gt;&gt;</a>\n  </div>\n  <fieldset>\n    <legend>日志内容</legend>\n    <div>\n      <strong>排序方式：</strong>\n      <label title="按时间顺序排序"><input type="radio" name="sortType" value="time" checked> 按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="sortType" value="type"> 按类别</label>\n    </div>\n    <div class="pd_stat pd_log_content">暂无日志</div>\n  </fieldset>\n  <fieldset>\n    <legend>统计结果</legend>\n    <div>\n      <strong>统计范围：</strong>\n      <label title="显示当天的统计结果"><input type="radio" name="statType" value="current" checked> 当天</label>\n      <label title="显示距该日N天内的统计结果"><input type="radio" name="statType" value="custom"></label>\n      <label title="显示距该日N天内的统计结果"><input name="statDays" type="text" style="width: 22px;" maxlength="3"> 天内</label>\n      <label title="显示全部统计结果"><input type="radio" name="statType" value="all"> 全部</label>\n    </div>\n    <div class="pd_stat" data-name="stat">暂无日志</div>\n  </fieldset>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExLogDialog" href="#">导入/导出日志</a></span>\n  <button data-action="close" type="button">关闭</button>\n  <button name="clear" type="button">清除日志</button>\n</div>',"width: 880px;"),t=e.find(".pd_log_nav"),n=p.read(),a=[],i=0;$.isEmptyObject(n)||(a=r.getObjectKeyList(n,1),i=a.length-1,t.find(".pd_log_date").attr("title","总共记录了"+a.length+"天的日志").text(a[i]),a.length>1&&(t.find('[data-name="start"]').attr("title",a[0]).removeClass("pd_disabled_link"),t.find('[data-name="prev"]').attr("title",a[i-1]).removeClass("pd_disabled_link"))),t.on("click","a[data-name]",function(o){o.preventDefault();var r=$(this);if(!r.hasClass("pd_disabled_link")){var l=r.data("name");if("start"===l)i=0;else if("prev"===l){if(!(i>0))return;i--}else if("next"===l){if(!(i<a.length-1))return;i++}else"end"===l&&(i=a.length-1);t.find(".pd_log_date").text(a[i]),b(n,a[i],e),_(n,a[i],e),i>0?(t.find('[data-name="start"]').attr("title",a[0]).removeClass("pd_disabled_link"),t.find('[data-name="prev"]').attr("title",a[i-1]).removeClass("pd_disabled_link")):t.find('[data-name="start"], [data-name="prev"]').removeAttr("title").addClass("pd_disabled_link"),i<a.length-1?(t.find('[data-name="next"]').attr("title",a[i+1]).removeClass("pd_disabled_link"),t.find('[data-name="end"]').attr("title",a[a.length-1]).removeClass("pd_disabled_link")):t.find('[data-name="next"], [data-name="end"]').removeAttr("title").addClass("pd_disabled_link")}}),e.find('[name="sortType"]').click(function(){var t=$(this).val();Config.logSortType!==t&&(Config.logSortType=t,(0,d.write)(),b(n,a[i],e))}).end().find('[name="statType"]').click(function(){var t=$(this).val();Config.logStatType!==t&&(Config.logStatType=t,(0,d.write)(),_(n,a[i],e))}).end().find('[name="statDays"]').keyup(function(){var t=parseInt($(this).val());t>0&&Config.logStatDays!==t&&(Config.logStatDays=t,(0,d.write)(),e.find('[name="statType"][value="custom"]:not(:checked)').click(),_(n,a[i],e))}).end().find('[name="sortType"][value="'+Config.logSortType+'"]').click().end().find('[name="statType"][value="'+Config.logStatType+'"]').click().end().find('[name="statDays"]').val(Config.logStatDays),e.find('[name="clear"]').click(function(e){e.preventDefault(),confirm("是否清除所有日志？")&&(p.clear(),alert("日志已清除"),location.reload())}).end().find('[data-name="openImOrExLogDialog"]').click(function(e){e.preventDefault(),k()}),b(n,a[i],e),_(n,a[i],e),$(window).height()<=750&&e.find(".pd_log_content").css("height","192px"),s.show("pdLogDialog"),v.runFunc("LogDialog.show_after_")}},function(e,t,n){Array.isArray(e[t])&&n.find(".pd_log_content").html(y(e,t,Config.logSortType)).parent().find("legend:first-child").text("日志内容 (共"+e[t].length+"项)")}),y=function(e,t,n){var a=e[t];if("type"===n){var i=["领取每日奖励","提升战力光环","争夺攻击","捐款","领取争夺奖励","批量攻击","试探攻击","抽取神秘盒子","抽取道具或卡片","打开盒子","使用道具","恢复道具","循环使用道具","将道具转换为能量","将卡片转换为VIP时间","购买道具","统计道具购买价格","出售道具","神秘抽奖","统计神秘抽奖结果","神秘等级升级","神秘系数排名变化","批量转账","购买帖子","自动存款"];a.sort(function(e,t){return i.indexOf(e.type)>i.indexOf(t.type)?1:-1})}else a.sort(function(e,t){return e.time>t.time?1:-1});var o="",l="",s=!0,d=!1,c=void 0;try{for(var p,u=a[Symbol.iterator]();!(s=(p=u.next()).done);s=!0){var m=p.value,h=m.time,v=m.type,b=m.action,y=m.gain,_=m.pay;if(void 0!==h&&void 0!==v&&void 0!==b){var x=new Date(h);"type"===n?(l!==v&&(o+="<h3>【"+v+"】</h3>",l=v),o+="<p><b>"+r.getTimeString(x)+"：</b>"+b.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>')):o+="<p><b>"+r.getTimeString(x)+" ("+v+")：</b>"+b.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>');var k="";if("object"===$.type(y)&&!$.isEmptyObject(y)){k+="，";var C=!0,w=!1,I=void 0;try{for(var L,S=Object.keys(y)[Symbol.iterator]();!(C=(L=S.next()).done);C=!0){var T=L.value;if("item"===T){var D=!0,A=!1,E=void 0;try{for(var P,N=r.getSortedObjectKeyList(f.itemTypeList,y[T])[Symbol.iterator]();!(D=(P=N.next()).done);D=!0){var M=P.value;k+="<i>"+M+"<em>+"+y[T][M].toLocaleString()+"</em></i> "}}catch(e){A=!0,E=e}finally{try{!D&&N.return&&N.return()}finally{if(A)throw E}}}else if("arm"===T){var U=!0,F=!1,B=void 0;try{for(var j,O=r.getSortedObjectKeyList(f.armTypeList,y[T])[Symbol.iterator]();!(U=(j=O.next()).done);U=!0){var q=j.value;k+="<i>"+q+"<em>+"+y[T][q].toLocaleString()+"</em></i> "}}catch(e){F=!0,B=e}finally{try{!U&&O.return&&O.return()}finally{if(F)throw B}}}else if("box"===T){var R=!0,K=!1,H=void 0;try{for(var W,z=r.getSortedObjectKeyList(g.boxTypeList,y[T])[Symbol.iterator]();!(R=(W=z.next()).done);R=!0){var V=W.value;k+="<i>"+V+"<em>+"+y[T][V].toLocaleString()+"</em></i> "}}catch(e){K=!0,H=e}finally{try{!R&&z.return&&z.return()}finally{if(K)throw H}}}else k+="<i>"+T+"<em>+"+y[T].toLocaleString()+"</em></i> "}}catch(e){w=!0,I=e}finally{try{!C&&S.return&&S.return()}finally{if(w)throw I}}}if("object"===$.type(_)&&!$.isEmptyObject(_)){k||(k+="，");var G=!0,Q=!1,J=void 0;try{for(var X,Y=Object.keys(_)[Symbol.iterator]();!(G=(X=Y.next()).done);G=!0){var Z=X.value;if("item"===Z){var ee=!0,te=!1,ne=void 0;try{for(var ae,ie=Object.keys(_[Z])[Symbol.iterator]();!(ee=(ae=ie.next()).done);ee=!0){var oe=ae.value;k+="<i>"+oe+"<ins>"+_[Z][oe].toLocaleString()+"</ins></i> "}}catch(e){te=!0,ne=e}finally{try{!ee&&ie.return&&ie.return()}finally{if(te)throw ne}}}else k+="<i>"+Z+"<ins>"+_[Z].toLocaleString()+"</ins></i> "}}catch(e){Q=!0,J=e}finally{try{!G&&Y.return&&Y.return()}finally{if(Q)throw J}}}o+=k+"</p>"}}}catch(e){d=!0,c=e}finally{try{!s&&u.return&&u.return()}finally{if(d)throw c}}return o},_=function(e,t,n){Array.isArray(e[t])&&n.find('[data-name="stat"]').html(x(e,t,Config.logStatType))},x=function(e,t,n){var a={};if("custom"===n){var o=new Date(t);o.setDate(o.getDate()-Config.logStatDays+1),o=r.getDateString(o);var l=!0,s=!1,d=void 0;try{for(var c,p=r.getObjectKeyList(e,1)[Symbol.iterator]();!(l=(c=p.next()).done);l=!0){var u=c.value;u>=o&&u<=t&&(a[u]=e[u])}}catch(e){s=!0,d=e}finally{try{!l&&p.return&&p.return()}finally{if(s)throw d}}}else"all"===n?a=e:a[t]=e[t];var m={},h={},v={},b=0,y={total:0,min:0,max:0},_=0,x={},k=0,C={},w={KFB:0,"经验值":0,"道具":0,"装备":0,item:{},arm:{}},I=0,L=0,S={},T=0,D=0,A={},E=0,P=0,N={},M=["item","arm","box","夺取KFB","VIP小时","神秘","燃烧伤害","命中","闪避","暴击比例","暴击几率","防御","有效道具","无效道具"];for(var U in a){var F=!0,B=!1,j=void 0;try{for(var O,q=a[U][Symbol.iterator]();!(F=(O=q.next()).done);F=!0){var R=O.value,K=R.type,H=R.action,W=R.gain,z=R.pay,V=R.notStat;if(void 0!==K&&void 0===V){if("object"===$.type(W)){var G=!0,Q=!1,J=void 0;try{for(var X,Y=Object.keys(W)[Symbol.iterator]();!(G=(X=Y.next()).done);G=!0){var Z=X.value;M.includes(Z)||(void 0===m[Z]?m[Z]=W[Z]:m[Z]+=W[Z])}}catch(e){Q=!0,J=e}finally{try{!G&&Y.return&&Y.return()}finally{if(Q)throw J}}}if("object"===$.type(z)){var ee=!0,te=!1,ne=void 0;try{for(var ae,ie=Object.keys(z)[Symbol.iterator]();!(ee=(ae=ie.next()).done);ee=!0){var oe=ae.value;M.includes(oe)||(void 0===h[oe]?h[oe]=z[oe]:h[oe]+=z[oe])}}catch(e){te=!0,ne=e}finally{try{!ee&&ie.return&&ie.return()}finally{if(te)throw ne}}}if("争夺攻击"===K&&"object"===$.type(W)){var re=/第`(\d+)`层/.exec(H);if(re){b++;var le=parseInt(re[1]);if(y.total+=le,y.max<le&&(y.max=le),(!y.min||y.min>le)&&(y.min=le),"object"===$.type(W.box)){var se=!0,de=!1,ce=void 0;try{for(var pe,ue=r.entries(W.box)[Symbol.iterator]();!(se=(pe=ue.next()).done);se=!0){var fe=i(pe.value,2),me=fe[0],ge=fe[1];_+=ge,me in x||(x[me]={total:0,min:-1,max:-1}),x[me].total+=ge,x[me].max<ge&&(x[me].max=ge),(x[me].min<0||x[me].min>ge)&&(x[me].min=ge)}}catch(e){de=!0,ce=e}finally{try{!se&&ue.return&&ue.return()}finally{if(de)throw ce}}var he=!0,ve=!1,be=void 0;try{for(var ye,_e=g.boxTypeList[Symbol.iterator]();!(he=(ye=_e.next()).done);he=!0){var me=ye.value;!(me in W.box)&&me in x&&(x[me].min=0)}}catch(e){ve=!0,be=e}finally{try{!he&&_e.return&&_e.return()}finally{if(ve)throw be}}}}}else if("打开盒子"===K&&"object"===$.type(W)&&"object"===$.type(z)){var xe=/【`(.+?)`】打开成功/.exec(H);if(!xe)continue;var ke=xe[1];k+=Math.abs(z["盒子"]),ke in C||(C[ke]=0),C[ke]+=Math.abs(z["盒子"]);var Ce=!0,we=!1,Ie=void 0;try{for(var Le,$e=r.entries(W)[Symbol.iterator]();!(Ce=(Le=$e.next()).done);Ce=!0){var Se=i(Le.value,2),Te=Se[0],De=Se[1];if(Te in w)if("object"===$.type(De)){var Ae=!0,Ee=!1,Pe=void 0;try{for(var Ne,Me=r.entries(De)[Symbol.iterator]();!(Ae=(Ne=Me.next()).done);Ae=!0){var Ue=i(Ne.value,2),Fe=Ue[0],ge=Ue[1];Fe in w[Te]||(w[Te][Fe]=0),w[Te][Fe]+=ge}}catch(e){Ee=!0,Pe=e}finally{try{!Ae&&Me.return&&Me.return()}finally{if(Ee)throw Pe}}}else w[Te]+=De}}catch(e){we=!0,Ie=e}finally{try{!Ce&&$e.return&&$e.return()}finally{if(we)throw Ie}}}else if("购买道具"===K&&"object"===$.type(W)&&"object"===$.type(W.item)&&"object"===$.type(z)){I+=W["道具"],L+=Math.abs(z.KFB);var Be=!0,je=!1,Oe=void 0;try{for(var qe,Re=r.entries(W.item)[Symbol.iterator]();!(Be=(qe=Re.next()).done);Be=!0){var Ke=i(qe.value,2),He=Ke[0],ge=Ke[1];He in S||(S[He]=0),S[He]+=ge}}catch(e){je=!0,Oe=e}finally{try{!Be&&Re.return&&Re.return()}finally{if(je)throw Oe}}}else if(("使用道具"===K||"循环使用道具"===K)&&"object"===$.type(W)){var We=/【`Lv.(\d+)：(.+?)`】/.exec(H);if(We){var ze=parseInt(We[1]),He=We[2];W["有效道具"]>0&&(T+=W["有效道具"],ze>=3&&(D+=W["有效道具"]),void 0===A[He]&&(A[He]=0),A[He]+=W["有效道具"]),W["无效道具"]>0&&(E+=W["无效道具"],ze>=3&&(P+=W["无效道具"]),void 0===N[He]&&(N[He]=0),N[He]+=W["无效道具"])}}}}}catch(e){B=!0,j=e}finally{try{!F&&q.return&&q.return()}finally{if(B)throw j}}}var Ve="",Ge=["KFB","经验值","贡献","转账额度","盒子","道具","已使用道具","装备","能量","卡片"];Ve+="<strong>收获：</strong>";var Qe=!0,Je=!1,Xe=void 0;try{for(var Ye,Ze=r.getSortedObjectKeyList(Ge,m)[Symbol.iterator]();!(Qe=(Ye=Ze.next()).done);Qe=!0){var et=Ye.value;v[et]=m[et],Ve+="<i>"+et+"<em>+"+m[et].toLocaleString()+"</em></i> "}}catch(e){Je=!0,Xe=e}finally{try{!Qe&&Ze.return&&Ze.return()}finally{if(Je)throw Xe}}Ve+="<br><strong>付出：</strong>";var tt=!0,nt=!1,at=void 0;try{for(var it,ot=r.getSortedObjectKeyList(Ge,h)[Symbol.iterator]();!(tt=(it=ot.next()).done);tt=!0){var rt=it.value;void 0===v[rt]?v[rt]=h[rt]:v[rt]+=h[rt],Ve+="<i>"+rt+"<ins>"+h[rt].toLocaleString()+"</ins></i> "}}catch(e){nt=!0,at=e}finally{try{!tt&&ot.return&&ot.return()}finally{if(nt)throw at}}Ve+="<br><strong>结余：</strong>";var lt=!0,st=!1,dt=void 0;try{for(var ct,pt=r.getSortedObjectKeyList(Ge,v)[Symbol.iterator]();!(lt=(ct=pt.next()).done);lt=!0){var ut=ct.value;Ve+="<i>"+ut+r.getStatFormatNumber(v[ut])+"</i> "}}catch(e){st=!0,dt=e}finally{try{!lt&&pt.return&&pt.return()}finally{if(st)throw dt}}if(Ve+='<div style="margin: 5px 0; border-bottom: 1px dashed #ccccff;"></div>',Ve+="\n<strong>争夺攻击统计：</strong><i>次数<em>+"+b+"</em></i> ",b>0){Ve+='<i>层数<span class="pd_stat_extra">(<em title="平均值">+'+(y.total/b).toFixed(2)+'</em>|<em title="最小值">+'+y.min+'</em>|<em title="最大值">+'+y.max+"</em>)</span></i> ",Ve+="<i>盒子<em>+"+_.toLocaleString()+"</em></i> ";var ft=!0,mt=!1,gt=void 0;try{for(var ht,vt=r.getSortedObjectKeyList(g.boxTypeList,x)[Symbol.iterator]();!(ft=(ht=vt.next()).done);ft=!0){var bt=ht.value;x[bt].total&&(Ve+="<i>"+bt+"<em>+"+x[bt].total.toLocaleString()+'</em><span class="pd_stat_extra">(<em title="平均值">+'+(x[bt].total/b).toFixed(2)+'</em>|<em title="最小值">+'+x[bt].min+'</em>|<em title="最大值">+'+x[bt].max+"</em>)</span></i> ")}}catch(e){mt=!0,gt=e}finally{try{!ft&&vt.return&&vt.return()}finally{if(mt)throw gt}}}var yt="",_t=!0,xt=!1,kt=void 0;try{for(var Ct,wt=r.getSortedObjectKeyList(g.boxTypeList,C)[Symbol.iterator]();!(_t=(Ct=wt.next()).done);_t=!0){var It=Ct.value;yt&&(yt+="|"),yt+='<ins title="'+It+'">-'+C[It].toLocaleString()+"</ins>"}}catch(e){xt=!0,kt=e}finally{try{!_t&&wt.return&&wt.return()}finally{if(xt)throw kt}}if(Ve+="<br><strong>盒子收获统计：</strong><i>盒子<ins>-"+k+'</ins><span class="pd_stat_extra">('+yt+")</span></i> ",k>0){var Lt=!0,$t=!1,St=void 0;try{for(var Tt,Dt=r.entries(w)[Symbol.iterator]();!(Lt=(Tt=Dt.next()).done);Lt=!0){var At=i(Tt.value,2),Et=At[0],De=At[1];if(De&&("object"!==$.type(De)||!$.isEmptyObject(De)))if("object"===$.type(De)){var Pt="item"===Et?f.itemTypeList:f.armTypeList,Nt=!0,Mt=!1,Ut=void 0;try{for(var Ft,Bt=r.getSortedObjectKeyList(Pt,De)[Symbol.iterator]();!(Nt=(Ft=Bt.next()).done);Nt=!0){var Fe=Ft.value;Ve+="<i>"+Fe+"<em>+"+De[Fe].toLocaleString()+"</em></i> "}}catch(e){Mt=!0,Ut=e}finally{try{!Nt&&Bt.return&&Bt.return()}finally{if(Mt)throw Ut}}}else Ve+="<i>"+Et+'<span class="pd_stat_extra"><em>+'+De.toLocaleString()+'</em>(<em title="平均值">+'+r.getFixedNumLocStr(De/k,2).toLocaleString()+"</em>)</span></i> "}}catch(e){$t=!0,St=e}finally{try{!Lt&&Dt.return&&Dt.return()}finally{if($t)throw St}}}Ve+="<br><strong>有效道具统计：</strong><i>有效道具<em>+"+T.toLocaleString()+'</em><span class="pd_stat_extra">(<em title="3级以上有效道具">+'+D.toLocaleString()+"</em>)</span></i> ";var jt=!0,Ot=!1,qt=void 0;try{for(var Rt,Kt=r.getSortedObjectKeyList(f.itemTypeList,A)[Symbol.iterator]();!(jt=(Rt=Kt.next()).done);jt=!0){var Ht=Rt.value;Ve+="<i>"+Ht+"<em>+"+A[Ht].toLocaleString()+"</em></i> "}}catch(e){Ot=!0,qt=e}finally{try{!jt&&Kt.return&&Kt.return()}finally{if(Ot)throw qt}}Ve+="<br><strong>无效道具统计：</strong><i>无效道具<em>+"+E.toLocaleString()+'</em><span class="pd_stat_extra">(<em title="3级以上无效道具">+'+P.toLocaleString()+"</em>)</span></i> ";var Wt=!0,zt=!1,Vt=void 0;try{for(var Gt,Qt=r.getSortedObjectKeyList(f.itemTypeList,N)[Symbol.iterator]();!(Wt=(Gt=Qt.next()).done);Wt=!0){var Jt=Gt.value;Ve+="<i>"+Jt+"<em>+"+N[Jt].toLocaleString()+"</em></i> "}}catch(e){zt=!0,Vt=e}finally{try{!Wt&&Qt.return&&Qt.return()}finally{if(zt)throw Vt}}return Ve},k=function(){if(!($("#pdImOrExLogDialog").length>0)){var e=p.read(),t=s.create("pdImOrExLogDialog","导入或导出日志",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label style="color: #f00;"><input type="radio" name="logType" value="setting" checked> 导入/导出日志</label>\n    <label style="color: #00f;"><input type="radio" name="logType" value="text"> 导出日志文本</label>\n  </div>\n  <div data-name="logSetting">\n    <strong>导入日志：</strong>将日志内容粘贴到文本框中并点击合并或覆盖按钮即可<br>\n    <strong>导出日志：</strong>复制文本框里的内容并粘贴到别处即可<br>\n    <textarea name="setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n  </div>\n  <div data-name="logText" style="display: none;">\n    <strong>导出日志文本</strong>：复制文本框里的内容并粘贴到别处即可\n    <div>\n      <label title="按时间顺序排序"><input type="radio" name="sortType2" value="time" checked> 按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="sortType2" value="type"> 按类别</label>\n      <label title="在日志文本里显示每日以及全部数据的统计结果"><input type="checkbox" name="showStat" checked> 显示统计</label>\n    </div>\n    <textarea name="text" style="width: 600px; height: 400px;" readonly></textarea>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <button name="merge" type="button">合并日志</button>\n  <button name="overwrite" type="button" style="color: #f00;">覆盖日志</button>\n  <button data-action="close" type="button">关闭</button>\n</div>');t.find('[name="sortType2"], [name="showStat"]').click(function(){C(e,t),t.find('[name="text"]').select()}).end().find('[name="logType"]').click(function(){var e=$(this).val();t.find('[data-name="log'+("text"===e?"Setting":"Text")+'"]').hide(),t.find('[data-name="log'+("text"===e?"Text":"Setting")+'"]').show(),t.find('[data-name="log'+("text"===e?"Text":"Setting")+'"]').select()}).end().find('[name="merge"], [name="overwrite"]').click(function(n){n.preventDefault();var a=$(this).attr("name");if(confirm("是否将文本框中的日志"+("overwrite"===a?"覆盖":"合并")+"到本地日志？")){var i=$.trim(t.find('[name="setting"]').val());if(i){try{i=JSON.parse(i)}catch(e){return void alert("日志有错误")}if(!i||"object"!==$.type(i))return void alert("日志有错误");e="merge"===a?p.getMergeLog(e,i):i,p.write(e),alert("日志已导入"),location.reload()}}}),s.show("pdImOrExLogDialog"),t.find('[name="sortType2"][value="'+Config.logSortType+'"]').prop("checked",!0).triggerHandler("click"),t.find('[name="setting"]').val(JSON.stringify(e)).select().focus(),v.runFunc("LogDialog.showImportOrExportLogDialog_after_")}},C=function(e,t){var n=t.find('input[name="sortType2"]:checked').val(),a=t.find('[name="showStat"]').prop("checked"),i="",o="",r=!0,l=!1,s=void 0;try{for(var d,c=Object.keys(e)[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){var p=d.value;Array.isArray(e[p])&&(o>p&&(o=p),i+="【"+p+"】(共"+e[p].length+"项)\n"+("type"===n?"":"\n")+y(e,p,n).replace(/<h3>/g,"\n").replace(/<\/h3>/g,"\n").replace(/<\/p>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"").replace(/`/g,""),a&&(i+="-".repeat(46)+"\n合计：\n"+x(e,p,"current").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")+"\n"),i+="=".repeat(46)+"\n")}}catch(e){l=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw s}}i&&a&&(i+="\n总计：\n"+x(e,o,"all").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")),t.find('[name="text"]').val(i)}},{"./Box":3,"./Config":5,"./Dialog":8,"./Item":11,"./Log":12,"./Script":21,"./Util":23}],14:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.getPromoteHaloCostByTypeId=n.promoteHalo=n.getPromoteHaloInfo=n.setHaloInfo=n.getHaloInfo=n.addUserLinkInHaloPage=n.addUserLinkInPkListPage=n.getChangePointsCountDown=n.autoSaveLootLog=n.checkLoot=n.getLevelInfoList=n.getLevelInfo=n.getLogList=n.getLog=n.getLootInfo=n.lootAttack=n.getRealProperty=n.getPointByProperty=n.getPropertyByPoint=n.getExtraPoint=n.getFieldNameByPointName=n.getPointNameByFieldName=n.getSkillAttack=n.getCurrentAssignedPoint=n.enhanceLootIndexPage=n.init=void 0;var r=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("./Info"),d=i(s),c=e("./Util"),p=a(c),u=e("./Msg"),f=a(u),m=e("./Dialog"),g=a(m),h=e("./Const"),v=i(h),b=e("./Config"),y=e("./Log"),_=a(y),x=e("./TmpLog"),k=a(x),C=e("./LootLog"),w=a(C),I=e("./Script"),L=a(I),S=e("./Public"),T=a(S),D=e("./Item"),A=a(D),E=e("./Box"),P=a(E),N=void 0,M=void 0,U=void 0,F=void 0,B="",j=[],O=[],q={},R={},K={},H=new Map,W=0,z=[],V=n.init=function(){N=$(".kf_fw_ig3:first"),M=$("#wdsx .kf_fw_ig1:first");var e=k.getValue(v.default.haloInfoTmpLogName);if(e&&"object"===$.type(e)){var t=(new Date).getTime()-e.time;t>=0&&t<60*v.default.tmpHaloInfoExpires*1e3?(delete e.time,Pe(e),G()):Ae(!0)}else Ae(!0)},G=n.enhanceLootIndexPage=function(){L.runFunc("Loot.enhanceLootIndexPage_before_"),q=Y(),H=A.getItemUsedInfo(N.html()),U=$("#pk_text_div"),F=$("#pk_text"),B=F.html(),j=_e(B),O=ke(j),/你被击败了/.test(B)||/本日无争夺记录/.test(B)?localStorage.removeItem(v.default.tempPointsLogListStorageName+"_"+d.default.uid):z=$e(j),Q(),J(),se(),pe(),B.includes("本日无争夺记录")&&F.html(B.replace(/点击这里/g,"点击上方的攻击按钮").replace("战斗记录框内任意地方点击自动战斗下一层","请点击上方的攻击按钮开始争夺战斗")),ge(),be(O),!Config.autoLootEnabled||/你被击败了/.test(B)||$.isNumeric(p.getCookie(v.default.changePointsInfoCookieName))||p.getCookie(v.default.lootAttackingCookieName)||$(document).ready(setTimeout(Te,500)),L.runFunc("Loot.enhanceLootIndexPage_after_")},Q=function(){return void N.find('input[value$="可分配属性"]').parent("td").css("position","relative").append('<span id="pdSurplusPoint" class="pd_property_diff" hidden>(<em></em>)</span>')},J=function(){M.find('[type="text"]:not([readonly])').attr("type","number").attr("min",1).attr("max",9999).prop("required",!0).css("width","60px").addClass("pd_point").next("span").addClass("pd_extra_point").after('<span class="pd_sum_point" style="color: #f03; cursor: pointer;" title="点击：给该项加上或减去剩余属性点"></span>'),M.find("input[readonly]").attr("type","number").prop("disabled",!0).css("width","60px");var e=M.find("> tbody > tr:last-child > td:last-child"),t=/当前修改配点可用\[(\d+)]次/.exec(e.text());t&&(W=parseInt(t[1]),e.wrapInner('<span id="pdChangeCount"></span>'));var n=/\(下次修改配点还需\[(\d+)]分钟\)/.exec(e.text());if(n){var a=p.getDate("+"+n[1]+"m");p.setCookie(v.default.changePointsInfoCookieName,a.getTime(),a)}else{parseInt(p.getCookie(v.default.changePointsInfoCookieName))!==W&&p.setCookie(v.default.changePointsInfoCookieName,W+"c",p.getDate("+"+v.default.changePointsInfoExpires+"m"))}R={"耐力":parseInt(M.find('[name="p"]').next("span").text()),"幸运":parseInt(M.find('[name="l"]').next("span").text())};var i=function(){var e=q["可分配属性点"]-ee(M.find(".pd_point"));$("#pdSurplusPoint").prop("hidden",0===e).css("color",0!==e?e>0?"#f03":"#393":"#000").find("em").text((e>0?"+":"")+e)};M.on("change",".pd_point",function(){$(this);i()}).on("click",".pd_sum_point",function(){var e=q["可分配属性点"]-ee(M.find(".pd_point"));if(e){var t=$(this).prev("span").prev(".pd_point");if(t.length){var n=parseInt(t.val());(isNaN(n)||n<0)&&(n=0),n+=e,t.val(n<1?1:n).trigger("change")}}}).closest("form").submit(function(){return p.deleteCookie(v.default.changePointsInfoCookieName),X(M)}).find(".pd_point").trigger("change")},X=function(e){var t=q["可分配属性点"]-ee(e.find(".pd_point"));return t<0?(alert("剩余属性点为负，请重新填写"),!1):!(t>0&&!confirm("可分配属性点尚未用完，是否继续？"))},Y=function(){var e={"攻击力":0,"生命值":0,"最大生命值":0,"攻击速度":0,"暴击几率":0,"技能伤害":0,"技能释放概率":0,"防御":0,"可分配属性点":0},t=N.html(),n=/"(\d+)攻击力"/.exec(t);return n&&(e["攻击力"]=parseInt(n[1])),n=/"(\d+)\/(\d+)生命值"/.exec(t),n&&(e["生命值"]=parseInt(n[1]),e["最大生命值"]=parseInt(n[2])),n=/"(\d+)攻击速度"/.exec(t),n&&(e["攻击速度"]=parseInt(n[1])),n=/"(\d+)%减伤"/.exec(t),n&&(e["防御"]=parseInt(n[1])),n=/"(\d+)\s*可分配属性"/.exec(t),n&&(e["可分配属性点"]=parseInt(n[1])),e},Z=function(e){var t=e.attr("name"),n=ne(t),a=parseInt(e.val());(isNaN(a)||a<0)&&(a=0);var i=parseInt(e.get(0).defaultValue),o=oe(n,a),r=0;switch(n){case"力量":r=o-q["攻击力"];break;case"体质":r=o-q["最大生命值"];break;case"敏捷":r=o-q["攻击速度"];break;case"灵活":r=o-q["暴击几率"];break;case"智力":r=o-q["技能释放概率"];break;case"意志":r=o-q["防御"]}if(N.find("#pdPro_"+t).text(o).css("color",0!==r||i!==a?"#00f":"#000"),"灵活"===n||"智力"===n){var l=Le(j)+1,s="",d=ie(n,a);l%10==0?s=le(n,a+d,l,"BOSS")+"%":(s=le(n,a+d,l,"普通")+"%",s+="|"+le(n,a+d,l,"快速")+"%"),N.find("#pdReal_"+t).text("("+s+")").attr("title","第"+l+"层的实际"+("灵活"===n?"暴击几率":"技能释放概率")+" ("+(l%10==0?"BOSS":"普通|快速")+")")}0!==r||i!==a?N.find("#pdNew_"+t).text("("+(r>=0?"+":"")+r+")").css("color",r>=0?"#f03":"#393"):N.find("#pdNew_"+t).text("")},ee=n.getCurrentAssignedPoint=function(e){var t=0;return e.each(function(){var e=$(this),n=(e.attr("name"),parseInt(e.val()));n&&n>0&&(t+=n)}),t},te=n.getSkillAttack=function(e,t,n){return 5*e+5*t+5*n},ne=n.getPointNameByFieldName=function(e){switch(e){case"s1":return"力量";case"s2":return"体质";case"d1":return"敏捷";case"d2":return"灵活";case"i1":return"智力";case"i2":return"意志";case"p":return"耐力";case"l":return"幸运";default:return""}},ae=n.getFieldNameByPointName=function(e){switch(e){case"力量":return"s1";case"体质":return"s2";case"敏捷":return"d1";case"灵活":return"d2";case"智力":return"i1";case"意志":return"i2";case"耐力":return"p";case"幸运":return"l";default:return""}},ie=n.getExtraPoint=function(e,t){var n=5*H.get("消逝之药"),a=K["全属性"];switch(e){case"力量":return Math.floor(t*a)+H.get("蕾米莉亚同人漫画")+n;case"体质":return Math.floor(t*a)+H.get("蕾米莉亚同人漫画")+n;case"敏捷":return Math.floor(t*a)+H.get("十六夜同人漫画")+n;case"灵活":return Math.floor(t*a)+H.get("十六夜同人漫画")+n;case"智力":return Math.floor(t*a)+n;case"意志":return Math.floor(t*a)+n;default:return 0}},oe=n.getPropertyByPoint=function(e,t){var n=t+ie(e,t);switch(e){case"力量":return 5*n+K["攻击力"];case"体质":return 20*n+(50===H.get("蕾米莉亚同人漫画")?700:0)+K["生命值"];case"敏捷":return 2*n+(50===H.get("十六夜同人漫画")?100:0);case"灵活":return Math.round(n/(n+100)*100);case"智力":return Math.round(n/(n+90)*100);case"意志":return Math.round(n/(n+150)*100);default:return 0}},re=n.getPointByProperty=function(e,t){var n=5*H.get("消逝之药"),a=1+K["全属性"],i=0;switch(e){case"力量":i=Math.ceil((Math.ceil((t-K["攻击力"])/5)-H.get("蕾米莉亚同人漫画")-n)/a);break;case"体质":i=Math.ceil((Math.ceil((t-K["生命值"]-(50===H.get("蕾米莉亚同人漫画")?700:0))/20)-H.get("蕾米莉亚同人漫画")-n)/a);break;case"敏捷":i=Math.ceil((Math.ceil((t-(50===H.get("十六夜同人漫画")?100:0))/2)-H.get("十六夜同人漫画")-n)/a);break;case"灵活":i=Math.floor((Math.round(100*t/(100-t))-H.get("十六夜同人漫画")-n)/a);break;case"智力":i=Math.floor((Math.round(90*t/(100-t))-n)/a);break;case"意志":i=Math.floor((Math.round(150*t/(100-t))-n)/a)}return(!isFinite(i)||i<1)&&(i=1),i},le=n.getRealProperty=function(e,t,n,a){var i={"普通":1,"强壮":1,"快速":1.5,"脆弱":1,"缓慢":1,BOSS:1.2},o="灵活"===e?100:90,r=Math.round(2*n*i[a]),l=Math.max(t-Math.round((r+t)/3),0);return Math.round(l/(l+o)*100)},se=function(){$('\n<tr>\n  <td colspan="2">\n    <select id="pdLevelPointListSelect" style="margin: 5px 0;">\n      <option>点数分配方案</option>\n      <option value="0">默认</option>\n    </select>\n    <a class="pd_btn_link" data-name="save" href="#" title="将当前点数设置保存为新的方案">保存</a>\n    <a class="pd_btn_link" data-name="edit" href="#" title="编辑各层点数分配方案">编辑</a>\n    <a class="pd_btn_link" data-name="fill" href="#" title="输入一串数字按顺序填充到各个点数字段中">填充</a><br>\n  </td>\n</tr>').prependTo(M.find("> tbody")).find("#pdLevelPointListSelect").change(function(){var e=parseInt($(this).val());if(e>0){var t=Config.levelPointList[parseInt(e)];if("object"!==(void 0===t?"undefined":l(t)))return;M.find(".pd_point").each(function(){var e=$(this),n=ne(e.attr("name"));e.val(t[n])}).trigger("change")}else 0===e&&M.find(".pd_point").each(function(){$(this).val(this.defaultValue)}).trigger("change")}).end().find('[data-name="save"]').click(function(e){if(e.preventDefault(),X(M)){var t=$("#pdLevelPointListSelect"),n=parseInt(t.val());if((n=parseInt(prompt("请输入层数：",n?n:"")))&&!(n<0)&&((0,b.read)(),!(n in Config.levelPointList)||confirm("该层数已存在，是否覆盖？"))){var a={},i=!0,o=!1,r=void 0;try{for(var l,s=Array.from(M.find(".pd_point"))[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var d=l.value,c=$(d),p=parseInt(c.val());if(!p||p<0)return;a[ne(c.attr("name"))]=p}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}Config.levelPointList[n]=a,(0,b.write)(),de(Config.levelPointList),t.val(n)}}}).end().find('[data-name="edit"]').click(function(e){e.preventDefault(),ce()}).end().find('[data-name="fill"]').click(function(e){e.preventDefault();var t=$.trim(prompt("请输入以空格分隔的一串数字，按顺序填充到各个点数字段中："));if(t){var n=t.replace(/\s+/g," ").split(" ");M.find(".pd_point").each(function(e){if(!(e<n.length))return!1;$(this).val(parseInt(n[e])).trigger("change")})}}),de(Config.levelPointList)},de=function(e){var t="",n=!0,a=!1,i=void 0;try{for(var o,r=Object.keys(e)[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;$.isNumeric(l)&&(t+='<option value="'+l+'">第'+l+"层</option>")}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()
}finally{if(a)throw i}}$("#pdLevelPointListSelect").find("option:gt(1)").remove().end().append(t)},ce=function e(t){var n="pdLevelPointListConfigDialog";if(!($("#"+n).length>0)){(0,b.read)();var a=g.create(n,"各层点数分配方案",'\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0; line-height: 1.6em;">\n    请填写各层对应的点数分配方案，相邻层数如数值完全相同的话，则只保留最前面的一层<br>\n    （例：11-19层点数相同的话，则只保留第11层）<br>\n    自定义点数分配方案脚本的参考范例请参见<a href="read.php?tid=500968&spid=13270735" target="_blank">此贴53楼</a>\n  </div>\n  <div style="overflow-y: auto; max-height: 400px;">\n    <table id="pdLevelPointList" style="text-align: center; white-space: nowrap;">\n      <tbody>\n        <tr><th></th><th>层数</th><th>力量</th><th>体质</th><th>敏捷</th><th>灵活</th><th>智力</th><th>意志</th><th></th></tr>\n      </tbody>\n    </table>\n  </div>\n  <hr>\n  <div style="float: left; line-height: 27px;">\n    <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n    <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n    <a class="pd_btn_link pd_highlight" data-name="add" href="#">增加</a>\n    <a class="pd_btn_link" data-name="deleteSelect" href="#">删除</a>\n  </div>\n  <div data-id="modifyArea" style="float: right;">\n    <input name="s1" type="text" maxlength="5" title="力量" placeholder="力量" style="width: 35px;">\n    <input name="s2" type="text" maxlength="5" title="体质" placeholder="体质" style="width: 35px;">\n    <input name="d1" type="text" maxlength="5" title="敏捷" placeholder="敏捷" style="width: 35px;">\n    <input name="d2" type="text" maxlength="5" title="灵活" placeholder="灵活" style="width: 35px;">\n    <input name="i1" type="text" maxlength="5" title="智力" placeholder="智力" style="width: 35px;">\n    <input name="i2" type="text" maxlength="5" title="意志" placeholder="意志" style="width: 35px;">\n    <a class="pd_btn_link" data-name="clear" href="#" title="清空各修改字段">清空</a>\n    <button type="button" name="modify">修改</button>\n    <span class="pd_cfg_tips" title="可将所选择的层数的相应属性修改为指定的数值；数字前可设+/-号，表示增加/减少相应数量；例：100、+5或-2">[?]</span>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExLevelPointListConfigDialog" href="#">导入/导出分配方案</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',"min-width: 665px;"),i=a.find("#pdLevelPointList > tbody"),o=function(e,t){$('\n<tr>\n  <td style="width: 25px; text-align: left;"><input type="checkbox"></td>\n  <td style="text-align: left;">\n    <label style="margin-right: 8px;">\n      第 <input name="level" type="text" value="'+(e?e:"")+'" style="width: 30px;"> 层\n    </label>\n  </td>\n  <td><input class="pd_point" name="s1" type="number" value="'+t["力量"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="s2" type="number" value="'+t["体质"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="d1" type="number" value="'+t["敏捷"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="d2" type="number" value="'+t["灵活"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="i1" type="number" value="'+t["智力"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="i2" type="number" value="'+t["意志"]+'" min="1" style="width: 50px;" required></td>\n  <td style="text-align: left;">\n    <a class="pd_btn_link" data-name="fill" href="#">填充</a>\n    <a class="pd_btn_link pd_highlight" data-name="delete" href="#">删除</a>\n  </td>\n</tr>\n<tr>\n  <td></td>\n  <td class="pd_custom_tips" title="剩余属性点">剩余：<span data-id="surplusPoint">0</span></td>\n  <td title="攻击力" hidden> <!-- 临时禁用 -->\n    攻：<span data-id="pro_s1" style="cursor: pointer;">0</span> <a data-id="opt_s1" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="最大生命值" hidden>\n    命：<span data-id="pro_s2" style="cursor: pointer;">0</span> <a data-id="opt_s2" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="攻击速度" hidden>\n    速：<span data-id="pro_d1" style="cursor: pointer;">0</span> <a data-id="opt_d1" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="暴击几率" hidden>\n    暴：<span data-id="pro_d2" style="cursor: pointer;">0</span>% <a data-id="opt_d2" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="技能释放概率" hidden>\n    技：<span data-id="pro_i1" style="cursor: pointer;">0</span>% <a data-id="opt_i1" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="防御减伤" hidden>\n    防：<span data-id="pro_i2" style="cursor: pointer;">0</span>% <a data-id="opt_i2" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td class="pd_custom_tips" title="[飞身劈斩]伤害：攻击+体质值*5+智力值*5" hidden>技伤：<span data-id="skillAttack">0</span></td>\n</tr>\n').appendTo(i).find(".pd_point").trigger("change")};a.submit(function(e){e.preventDefault(),(0,b.read)();var t={},a={},o=!1,r=!1;if(i.find("tr:gt(0)").each(function(){var e=$(this);if(e.find(".pd_point").length){var n=q["可分配属性点"]-ee(e.find(".pd_point"));if(n>0)r=!0;else if(n<0)return o=!0,!1;var i=parseInt(e.find('[name="level"]').val());if(i&&!(i<0)){var l={},s=!0,d=!1,c=void 0;try{for(var u,f=Array.from(e.find(".pd_point"))[Symbol.iterator]();!(s=(u=f.next()).done);s=!0){var m=u.value,g=$(m),h=parseInt(g.val());if(!h||h<0)return;l[ne(g.attr("name"))]=h}}catch(e){d=!0,c=e}finally{try{!s&&f.return&&f.return()}finally{if(d)throw c}}p.deepEqual(a,l)||(t[i]=l,a=l)}}}),!r||confirm("部分层数的可分配属性点尚未用完，是否提交？")){if(o)return void alert("部分层数的剩余属性点为负，请重新填写");Config.levelPointList=t,(0,b.write)(),g.close(n),de(Config.levelPointList)}}).find('[data-name="add"]').click(function(e){e.preventDefault(),o(0,{"力量":1,"体质":1,"敏捷":1,"灵活":1,"智力":1,"意志":1}),i.find('[name="level"]:last').focus(),g.resize(n)}).end().find('[data-name="deleteSelect"]').click(function(e){e.preventDefault();var t=i.find('[type="checkbox"]:checked');if(t.length&&confirm("是否删除所选层数？")){t.closest("tr").next("tr").addBack().remove(),g.resize(n)}}).end().find('[data-name="openImOrExLevelPointListConfigDialog"]').click(function(t){t.preventDefault(),T.showCommonImportOrExportConfigDialog("各层点数分配方案","levelPointList",null,function(){$("#pdLevelPointListConfigDialog").remove(),e(function(e){return e.submit()})})}).end().find('[data-name="selectAll"]').click(function(){return p.selectAll(i.find('[type="checkbox"]'))}).end().find('[data-name="selectInverse"]').click(function(){return p.selectInverse(i.find('[type="checkbox"]'))}),i.on("click",'[data-name="fill"]',function(e){e.preventDefault();var t=$(this).closest("tr"),n=$.trim(prompt("请输入以空格分隔的一串数字，按顺序填充到各个点数字段中："));if(n){var a=n.replace(/\s+/g," ").split(" ");t.find(".pd_point").each(function(e){if(!(e<a.length))return!1;$(this).val(parseInt(a[e])).trigger("change")})}}).on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).closest("tr").next("tr").addBack().remove(),g.resize(n)}).on("change",".pd_point",function(){var e=$(this),t=e.attr("name"),n=parseInt(e.val());if(n&&!(n<0)){var a=e.closest("tr"),i=a.next("tr");i.find('[data-id="pro_'+t+'"]').text(oe(ne(t),n));var o=parseInt(a.find('[name="s1"]').val()),r=parseInt(a.find('[name="s2"]').val()),l=parseInt(a.find('[name="i1"]').val());i.find('[data-id="skillAttack"]').text(te(o+ie("力量",o),r+ie("体质",r),l+ie("智力",l)));var s=q["可分配属性点"]-ee(a.find(".pd_point"));i.find('[data-id="surplusPoint"]').text(s).css("color",0!==s?"#f00":"#000")}}).on("click",'[data-id^="pro_"]',function(){var e=$(this),t=e.data("id").replace("pro_",""),n=parseInt(prompt("请输入数值：",e.text()));!n||n<0||e.closest("tr").prev("tr").find('[name="'+t+'"]').val(re(ne(t),n)).trigger("change")}).on("click",'[data-id^="opt_"]',function(e){e.preventDefault();var t=$(this),n=t.data("id").replace("opt_",""),a=t.closest("tr").prev("tr"),i=q["可分配属性点"]-ee(a.find(".pd_point"));if(i){var o=a.find('[name="'+n+'"]');if(o.length){var r=parseInt(o.val());(isNaN(r)||r<0)&&(r=0),r+=i;var l=parseInt(o.attr("min"));o.val(r<l?l:r).trigger("change")}}}),a.find('[name="modify"]').click(function(){var e=i.find('[type="checkbox"]:checked');if(e.length){var t={};a.find('[data-id="modifyArea"] [type="text"]').each(function(){var e=$(this),n=e.attr("name"),a=$.trim(e.val());if(a){var i=/^(-|\+)?(\d+)$/.exec(a);i||(alert("格式不正确"),e.select().focus()),t[n]={},void 0!==i[1]?t[n].action="+"===i[1]?"add":"minus":t[n].action="equal",t[n].value=parseInt(i[2])}}),e.each(function(){$(this).closest("tr").find(".pd_point").each(function(){var e=$(this),n=e.attr("name");if(n in t)if("equal"!==t[n].action){var a=parseInt(e.val());(!a||a<0)&&(a=0),a+="add"===t[n].action?t[n].value:-t[n].value,e.val(a>1?a:1)}else e.val(t[n].value)}).trigger("change")}),alert("点数已修改")}}).end().find('[data-name="clear"]').click(function(e){e.preventDefault(),$(this).closest('[data-id="modifyArea"]').find('[type="text"]').val("")});var l=!0,s=!1,d=void 0;try{for(var c,u=p.entries(Config.levelPointList)[Symbol.iterator]();!(l=(c=u.next()).done);l=!0){var f=r(c.value,2),m=f[0],h=f[1];$.isNumeric(m)&&o(m,h)}}catch(e){s=!0,d=e}finally{try{!l&&u.return&&u.return()}finally{if(s)throw d}}g.show(n),"function"==typeof t&&t(a)}},pe=function(){var e=T.getSafeId();e&&(U.off("click"),$('\n<div id="pdAttackBtns" class="pd_result" style="margin-top: 5px;">\n  <label>\n    <input class="pd_input" name="autoChangeLevelPointsEnabled" type="checkbox" '+(Config.autoChangeLevelPointsEnabled?"checked":"")+'>\n    自动修改点数分配方案\n    <span class="pd_cfg_tips" title="在攻击时可自动修改为相应层数的点数分配方案（仅限自动攻击相关按钮有效）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="customPointsScriptEnabled" type="checkbox" '+(Config.customPointsScriptEnabled?"checked":"")+" \n"+("function"!=typeof v.default.getCustomPoints?"disabled":"")+'> 使用自定义脚本\n    <span class="pd_cfg_tips" title="使用自定义点数分配脚本（仅限自动攻击相关按钮有效，需正确安装自定义脚本后此项才可勾选）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="unusedPointNumAlertEnabled" type="checkbox" '+(Config.unusedPointNumAlertEnabled?"checked":"")+'>\n    有剩余属性点时提醒\n    <span class="pd_cfg_tips" title="在攻击时如有剩余属性点则进行提醒（仅限自动攻击相关按钮有效）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="slowAttackEnabled" type="checkbox" '+(Config.slowAttackEnabled?"checked":"")+'> 慢速\n    <span class="pd_cfg_tips" title="延长每次攻击的时间间隔（在4~6秒之间）">[?]</span>\n  </label><br>\n  <button name="autoAttack" type="button" title="自动攻击到指定层数">自动攻击</button>\n  <button name="onceAttack" type="button" title="自动攻击一层">一层</button>\n  <span style="color: #888;">|</span>\n  <button name="manualAttack" type="button" title="手动攻击一层，会自动提交当前页面上的点数设置">手动攻击</button>\n</div>\n').insertAfter("#wdsx").on("click",'button[name$="Attack"]',function(){if(/你被击败了/.test(B))return void alert("你已经被击败了");if(!($(".pd_mask").length>0)){var t=$(this),n=t.attr("name"),a="manualAttack"===n?"manual":"auto",i=0;if("auto"===a){var o="+1";if("autoAttack"===n){var r=t.data("prevTargetLevel");o=$.trim(prompt("攻击到第几层？（0表示攻击到被击败为止，+n表示攻击到当前层数+n层）",r?r:Config.attackTargetLevel))}if(!/\+?\d+/.test(o))return;if(o.startsWith("+")){i=Le(j)+parseInt(o)}else i=parseInt(o);if(isNaN(i)||i<0)return;"autoAttack"===n&&t.data("prevTargetLevel",o)}f.destroy(),$("#pdLootLogHeader").find('[data-name="end"]').click();var l=(Config.autoChangeLevelPointsEnabled||Config.customPointsScriptEnabled&&"function"==typeof v.default.getCustomPoints)&&"auto"===a;(l||X(M))&&ue({type:a,targetLevel:i,autoChangePointsEnabled:l,safeId:e})}}).on("click",".pd_cfg_tips",function(){return!1}).on("click",'[type="checkbox"]',function(){var e=$(this),t=e.attr("name"),n=e.prop("checked");t in Config&&Config[t]!==n&&((0,b.read)(),Config[t]=e.prop("checked"),(0,b.write)())}).find('[name="customPointsScriptEnabled"]').click(function(){var e=$(this);e.prop("disabled")||$('[name="autoChangeLevelPointsEnabled"]').prop("disabled",e.prop("checked"))}).triggerHandler("click"))},ue=n.lootAttack=function(e){var t=e.type,n=e.targetLevel,a=e.autoChangePointsEnabled,i=e.safeId,l=Le(j);if(!(n>0&&n<=l)){var s=f.wait('<strong>正在攻击中，请稍等&hellip;</strong><i>当前层数：<em class="pd_countdown">'+l+'</em></i><a class="pd_stop_action pd_highlight" href="#">停止操作</a><a href="/" target="_blank">浏览其它页面</a>'),c=0,u=!1,m=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];q=Y();var t="",n="";M.find(".pd_point").each(function(){var e=$(this),n=ne(e.attr("name")),a=parseInt($.trim(e.val()));ie(n,a);t+=n+"："+a+"，"}),t=t.replace(/，$/,"");var a=!0,i=!1,o=void 0;try{for(var l,s=p.entries(q)[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var c=r(l.value,2),u=c[0],f=c[1];if("可分配属性点"!==u&&"生命值"!==u){var m="";(u.endsWith("率")||"防御"===u)&&(m="%"),n+=u+"："+f+m+"，"}}}catch(e){i=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}n=n.replace(/，$/,""),z[Le(j)+1]="点数方案（"+t+"）",localStorage.setItem(v.default.tempPointsLogListStorageName+"_"+d.default.uid,JSON.stringify({time:(new Date).getTime(),pointsLogList:z})),e&&console.log("【分配点数】点数方案（"+t+"）")},g=function(e){if(e>0&&Config.customPointsScriptEnabled&&"function"==typeof v.default.getCustomPoints){var t=null;try{t=v.default.getCustomPoints($.extend(fe(),{getExtraPoint:ie,getPointByProperty:re,getPropertyByPoint:oe}))}catch(e){console.log(e)}if("object"===$.type(t)){var n=!0,a=!1,i=void 0;try{for(var r,l=Object.keys(t)[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var s=r.value;M.find('[name="'+ae(s)+'"]').val(t[s]).trigger("change")}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}e=-1}else{if("number"!=typeof t)return t===!1?(m(),$.Deferred().resolve("success")):$.Deferred().resolve("error");e=parseInt(t),e=e>1?e:1}}var c=Le(j)+1,u=e>0?Math.max.apply(Math,o(Object.keys(Config.levelPointList).filter(function(t){return t<=e}))):-1,g=$("#pdLevelPointListSelect");u>0?g.val(u).trigger("change"):g.get(0).selectedIndex=0;var h=!1;if(M.find(".pd_point").each(function(){if(this.defaultValue!==$(this).val())return h=!0,!1}),h){if(Config.unusedPointNumAlertEnabled&&!d.default.w.unusedPointNumAlert&&parseInt($("#pdSurplusPoint > em").text())>0){if(!confirm("可分配属性点尚未用完，是否继续攻击？"))return $.Deferred().resolve("error");d.default.w.unusedPointNumAlert=!0}return $.ajax({type:"POST",url:"kf_fw_ig_enter.php",timeout:v.default.defAjaxTimeout,data:M.closest("form").serialize()}).then(function(e){var t=p.getResponseMsg(e),n=t.msg;if(/已经重新配置加点！/.test(n))return p.deleteCookie(v.default.changePointsInfoCookieName),m(!0),W=W>0?W-1:0,M.find("#pdChangeCount").text("(当前修改配点可用["+W+"]次)"),M.find(".pd_point").each(function(){this.defaultValue=$(this).val()}),L.runFunc("Loot.lootAttack_changePoints_success_",n),"success";var a=/你还需要等待(\d+)分钟/.exec(n);if(a){var i=p.getDate("+"+parseInt(a[1])+"m");p.setCookie(v.default.changePointsInfoCookieName,i.getTime(),i)}return f.show("<strong>第<em>"+c+"</em>层方案："+n+"</strong>",-1),L.runFunc("Loot.lootAttack_changePoints_error_",n),"error"},function(){return"timeout"})}return 1===c&&m(),$.Deferred().resolve("success")},h=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.default.lootAttackInterval;g(t>=0?t+1:-1).done(function(e){"success"===e&&setTimeout(b,"function"==typeof n?n():n)}).fail(function(a){"timeout"===a&&setTimeout(function(){return e(t,n)},v.default.defAjaxInterval)}).always(function(e){"success"!==e&&"timeout"!==e&&f.remove(s)})},b=function(){$.ajax({type:"POST",url:"kf_fw_ig_intel.php",data:{safeid:i},timeout:v.default.defAjaxTimeout}).done(function(e){if(c++,Config.autoLootEnabled&&p.setCookie(v.default.lootAttackingCookieName,1,p.getDate("+"+v.default.lootAttackingExpires+"m")),!/你\(\d+\)遭遇了/.test(e)||c%v.default.lootAttackPerCheckLevel==0)return void setTimeout(_,v.default.defAjaxInterval);B=e+B,y(),L.runFunc("Loot.lootAttack_attack_after_",e)}).fail(function(){console.log("【争夺攻击】超时重试..."),setTimeout(_,"function"==typeof v.default.lootAttackInterval?v.default.lootAttackInterval():v.default.lootAttackInterval)})},y=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];j=_e(B),O=ke(j),ye(j,O,z),be(O);var i=Le(j);console.log("【争夺攻击】当前层数："+i);var o=$(".pd_countdown:last");o.text(i),M.find(".pd_point").each(function(){Z($(this))});var r=O[i];N.find("#pdCurrentLife").text(r?r.life:0);var l=/你被击败了/.test(B);u=l||u||"auto"!==t||n&&i>=n||o.closest(".pd_msg").data("stop"),u?(Config.autoLootEnabled&&(p.deleteCookie(v.default.lootCheckingCookieName),p.deleteCookie(v.default.lootAttackingCookieName),p.setCookie(v.default.lootCompleteCookieName,1,Se())),l?(e?(f.remove(s),me(j,O,z)):setTimeout(_,v.default.defAjaxInterval),L.runFunc("Loot.lootAttack_complete_")):(e||setTimeout(function(){return _(!1)},v.default.defAjaxInterval),f.remove(s),f.show("<strong>你成功击败了第<em>"+i+"</em>层的NPC</strong>",-1),L.runFunc("Loot.lootAttack_after_"))):a?setTimeout(function(){return h(i)},v.default.defAjaxInterval):setTimeout(b,"function"==typeof v.default.lootAttackInterval?v.default.lootAttackInterval():v.default.lootAttackInterval)},_=function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.log("检查争夺记录Start"),$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+(new Date).getTime(),timeout:v.default.defAjaxTimeout}).done(function(e){var n=$("#pk_text",e);if(!n.length)return void f.remove(s);B=n.html();var a=/\(下次修改配点还需\[(\d+)]分钟\)/.exec(e);if(a){W=0;var i=p.getDate("+"+a[1]+"m");p.setCookie(v.default.changePointsInfoCookieName,i.getTime(),i)}var o=/当前修改配点可用\[(\d+)]次/.exec(e);o&&(W=parseInt(o[1]),p.setCookie(v.default.changePointsInfoCookieName,W+"c",p.getDate("+"+v.default.changePointsInfoExpires+"m"))),M.find("#pdChangeCount").text("(当前修改配点可用["+W+"]次)");var r=/可分配属性点：(\d+)/.exec(e);if(r){var l=parseInt(r[1]);q["可分配属性点"]!==l&&(q["可分配属性点"]=l,N.find("#pdDistributablePoint").text(l),/你被击败了/.test(B)||!Config.unusedPointNumAlertEnabled||d.default.w.unusedPointNumAlert||X(M)||(u=!0,M.find(".pd_point:first").trigger("change"),k.deleteValue(v.default.haloInfoTmpLogName)))}t&&y(!0),L.runFunc("Loot.lootAttack_check_after_",e)}).fail(function(){return setTimeout(e,v.default.defAjaxInterval)})};h(a?l:-1,0)}},fe=n.getLootInfo=function(){var e=Le(j),t=O[e],n=0,a=0;t&&(n=t.life,a=t.initLife);var i=Ie(O);return{currentLevel:e,currentLife:n,currentInitLife:a,levelPointList:Config.levelPointList,availablePoint:q["可分配属性点"],haloInfo:K,extraPointsList:R,propertyList:q,itemUsedNumList:H,changePointsAvailableCount:W,log:B,logList:j,enemyList:i}},me=function(e,t,n){p.setCookie(v.default.lootCompleteCookieName,2,Se()),localStorage.removeItem(v.default.tempPointsLogListStorageName+"_"+d.default.uid);var a={},i=!0,o=!1,l=void 0;try{for(var s,c=p.entries(we(t))[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=r(s.value,2),m=u[0],g=u[1];a[m]=g}}catch(e){o=!0,l=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw l}}var h="",b=!0,y=!1,x=void 0;try{for(var k,C=p.entries(a)[Symbol.iterator]();!(b=(k=C.next()).done);b=!0){var I=r(k.value,2),m=I[0],g=I[1];h+=m+"`+"+g+"` "}}catch(e){y=!0,x=e}finally{try{!b&&C.return&&C.return()}finally{if(y)throw x}}var S={},D=!0,A=!1,E=void 0;try{for(var N,M=p.entries(we(t.filter(function(t,n){return n>=e.length-v.default.enemyStatLatestLevelNum})))[Symbol.iterator]();!(D=(N=M.next()).done);D=!0){var U=r(N.value,2),m=U[0],g=U[1];S[m]=g}}catch(e){A=!0,E=e}finally{try{!D&&M.return&&M.return()}finally{if(A)throw E}}var F="",B=!0,j=!1,O=void 0;try{for(var q,R=p.entries(S)[Symbol.iterator]();!(B=(q=R.next()).done);B=!0){var K=r(q.value,2),m=K[0],g=K[1];F+=m+"`+"+g+"` "}}catch(e){j=!0,O=e}finally{try{!B&&R.return&&R.return()}finally{if(j)throw O}}var H=Le(e),W=Ce(t),z=W.boxNum,V=W.boxes;$.isEmptyObject(V)||(_.push("争夺攻击","你成功击败了第`"+(H-1)+"`层的NPC ("+h.trim()+")",{gain:{"盒子":z,box:V}}),w.record(e,n));var G="",Q=!0,J=!1,X=void 0;try{for(var Y,Z=p.getSortedObjectKeyList(P.boxTypeList,V)[Symbol.iterator]();!(Q=(Y=Z.next()).done);Q=!0){var ee=Y.value;G+="<i>"+ee+"<em>+"+V[ee].toLocaleString()+"</em></i>"}}catch(e){J=!0,X=e}finally{try{!Q&&Z.return&&Z.return()}finally{if(J)throw X}}f.show("<strong>你被第<em>"+H+"</em>层的NPC击败了</strong>"+(G.length>75?"<br>":"")+G,-1),Config.autoGetDailyBonusEnabled&&Config.getBonusAfterLootCompleteEnabled&&(p.deleteCookie(v.default.getDailyBonusCookieName),T.getDailyBonus()),L.runFunc("Loot.recordLootLog_after_")},ge=function(){$('\n<div id="pdLootLogHeader" style="padding: 0 5px 5px; line-height: 2em;">\n  <div class="pd_log_nav">\n    <a class="pd_disabled_link" data-name="start" href="#">&lt;&lt;</a>\n    <a class="pd_disabled_link" data-name="prev" href="#" style="padding: 0 7px;">&lt;</a>\n    <h2 class="pd_history_logs_key pd_custom_tips" title="共有0天的争夺记录">现在</h2>\n    <a class="pd_disabled_link" data-name="next" href="#" style="padding: 0 7px;">&gt;</a>\n    <a class="pd_disabled_link" data-name="end" href="#">&gt;&gt;</a>\n  </div>\n  <div style="text-align: right;">\n    <label>\n      <input class="pd_input" name="showLiteLootLogEnabled" type="checkbox" '+(Config.showLiteLootLogEnabled?"checked":"")+'> 显示精简记录\n    </label>\n    <label>\n      <input class="pd_input" name="showLevelEnemyStatEnabled" type="checkbox" '+(Config.showLevelEnemyStatEnabled?"checked":"")+'> 显示分层统计\n    </label>\n    <a class="pd_btn_link" data-name="openImOrExLootLogDialog" href="#">导入/导出争夺记录</a>\n    <a class="pd_btn_link pd_highlight" data-name="clearLootLog" href="#">清除记录</a>\n  </div>\n  <ul class="pd_stat" id="pdLogStat"></ul>\n</div>\n').insertBefore(U).find('[type="checkbox"]').click(function(){var e=$(this),t=e.attr("name"),n=e.prop("checked");t in Config&&Config[t]!==n&&((0,b.read)(),Config[t]=e.prop("checked"),(0,b.write)(),"showLiteLootLogEnabled"===t?ye(j,O,z):"showLevelEnemyStatEnabled"===t&&be(O))}).end().find('[data-name="openImOrExLootLogDialog"]').click(function(e){e.preventDefault(),he()}).end().find('[data-name="clearLootLog"]').click(function(e){e.preventDefault(),confirm("是否清除所有争夺记录？")&&(w.clear(),alert("争夺记录已清除"),location.reload())}),ve()},he=function(){var e="pdImOrExLootLogDialog";if(!($("#"+e).length>0)){var t=w.read(),n=g.create(e,"导入或导出争夺记录",'\n<div class="pd_cfg_main">\n  <strong>导入争夺记录：</strong>将争夺记录内容粘贴到文本框中并点击合并或覆盖按钮即可<br>\n  <strong>导出争夺记录：</strong>复制文本框里的内容并粘贴到别处即可<br>\n  <textarea name="lootLog" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button name="merge" type="button">合并记录</button>\n  <button name="overwrite" type="button" style="color: #f00;">覆盖记录</button>\n  <button data-action="close" type="button">关闭</button>\n</div>');n.find('[name="merge"], [name="overwrite"]').click(function(e){e.preventDefault();var a=$(this).attr("name");if(confirm("是否将文本框中的争夺记录"+("overwrite"===a?"覆盖":"合并")+"到本地争夺记录？")){var i=$.trim(n.find('[name="lootLog"]').val());if(i){try{i=JSON.parse(i)}catch(e){return void alert("争夺记录有错误")}if(!i||"object"!==$.type(i))return void alert("争夺记录有错误");t="merge"===a?w.getMergeLog(t,i):i,w.write(t),alert("争夺记录已导入"),location.reload()}}}),g.show(e),n.find('[name="lootLog"]').val(JSON.stringify(t)).select().focus()}},ve=function(){var e=$("#pdLootLogHeader").find(".pd_log_nav"),t=function(e){if(0===parseInt(e))return"现在";var t=new Date(parseInt(e));return p.getDateString(t)+" "+p.getTimeString(t,":",!1)},n=w.read(),a=[];if($.isEmptyObject(n))a.push(0);else{a=p.getObjectKeyList(n,1);var i=parseInt(a[a.length-1]);(!/你被击败了/.test(B)||i<=p.getDate("-1d").getTime()||n[i].log.join("").trim()!==j.join("").trim())&&a.push(0)}var o=a.length-1,r=0===a[o]?a.length-1:a.length;if(e.find(".pd_history_logs_key").attr("title","共有"+r+"天的争夺记录").text(t(a[o])),a.length>1&&(e.find('[data-name="start"]').attr("title",t(a[0])).removeClass("pd_disabled_link"),e.find('[data-name="prev"]').attr("title",t(a[o-1])).removeClass("pd_disabled_link")),e.on("click","a[data-name]",function(i){i.preventDefault();var r=$(this);if(!r.hasClass("pd_disabled_link")){var l=r.data("name");if("start"===l)o=0;else if("prev"===l){if(!(o>0))return;o--}else if("next"===l){if(!(o<a.length-1))return;o++}else"end"===l&&(o=a.length-1);e.find(".pd_history_logs_key").text(t(a[o]));var s=0===a[o]?j:n[a[o]].log,d=ke(s);ye(s,d,0===a[o]?z:n[a[o]].points),be(d),o>0?(e.find('[data-name="start"]').attr("title",t(a[0])).removeClass("pd_disabled_link"),e.find('[data-name="prev"]').attr("title",t(a[o-1])).removeClass("pd_disabled_link")):e.find('[data-name="start"], [data-name="prev"]').removeAttr("title").addClass("pd_disabled_link"),o<a.length-1?(e.find('[data-name="next"]').attr("title",t(a[o+1])).removeClass("pd_disabled_link"),e.find('[data-name="end"]').attr("title",t(a[a.length-1])).removeClass("pd_disabled_link")):e.find('[data-name="next"], [data-name="end"]').removeAttr("title").addClass("pd_disabled_link")}}),!B.includes("本日无争夺记录")){var l=0===a[o]?j:n[a[o]].log;ye(l,ke(l),0===a[o]?z:n[a[o]].points),Config.autoSaveLootLogInSpecialCaseEnabled&&/你被击败了/.test(B)&&0===a[o]&&(p.deleteCookie(v.default.lootCompleteCookieName),De())}},be=function(e){var t=Ce(e),n=t.boxNum,a=t.boxes,i="",o=!0,l=!1,s=void 0;try{for(var d,c=p.getSortedObjectKeyList(P.boxTypeList,a)[Symbol.iterator]();!(o=(d=c.next()).done);o=!0){var u=d.value;i+="<i>"+u+"<em>+"+a[u].toLocaleString()+"</em></i> "}}catch(e){l=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(l)throw s}}var f="",m=!0,g=!1,h=void 0;try{for(var b,y=p.entries(we(e))[Symbol.iterator]();!(m=(b=y.next()).done);m=!0){var _=r(b.value,2),x=_[0],k=_[1];f+="<i>"+x+"<em>+"+k+"</em></i> "}}catch(e){g=!0,h=e}finally{try{!m&&y.return&&y.return()}finally{if(g)throw h}}var C="",w=!0,I=!1,L=void 0;try{for(var S,T=p.entries(we(e.filter(function(t,n){return n>=e.length-v.default.enemyStatLatestLevelNum})))[Symbol.iterator]();!(w=(S=T.next()).done);w=!0){var D=r(S.value,2),x=D[0],k=D[1];C+="<i>"+x+"<em>+"+k+"</em></i> "}}catch(e){I=!0,L=e}finally{try{!w&&T.return&&T.return()}finally{if(I)throw L}}var A=$("#pdLogStat");if(A.html("\n<li><b>收获统计：</b><i>盒子<em>+"+n+"</em></i> "+(i?i:"无")+"</li>\n<li><b>全部层数：</b>"+f+"<br><b>最近"+v.default.enemyStatLatestLevelNum+"层：</b>"+C+"</li>\n"),Config.showLevelEnemyStatEnabled){for(var E="",N=1;N<e.length;N+=10)!function(t){E+="&nbsp;&nbsp;<b>"+t+"-"+(t+9<e.length?t+9:e.length-1)+"：</b>";var n="",a=!0,i=!1,o=void 0;try{for(var l,s=p.entries(we(e.filter(function(e,n){return n>=t&&n<t+10})))[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var d=r(l.value,2);n+="<i>"+d[0]+"<em>+"+d[1]+"</em></i> "}}catch(e){i=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}E+=(n?n:"无")+"<br>"}(N);A.append("<li><b>分层统计：</b>"+(E?"<br>"+E:"无")+"</li>")}},ye=function(e,t,n){var a=[];$.each(e,function(e,t){if(t){var i=/\[([^\]]+)的]NPC/.exec(t);if(i){var o=i[1],r="";switch(o){case"普通":r="#09c";break;case"特别脆弱":r="#c96";break;case"特别缓慢":r="#c69";break;case"特别强壮":r="#f93";break;case"特别快速":r="#f3c";break;case"BOSS":r="#f00";break;default:r="#0075ea"}if(a[e]=t.replace(i[0],'<span style="background-color: '+r+';">['+o+"的]</span>NPC"),n[e]){var l=n[e];o=o.replace("特别","");var s=/灵活：\d+\+\d+=(\d+)/.exec(l);if(s){var d=le("灵活",parseInt(s[1]),e,o);l=l.replace(/(暴击几率：\d+%)/,'$1<span class="pd_custom_tips" title="实际暴击几率">('+d+"%)</span>")}if(s=/智力：\d+\+\d+=(\d+)/.exec(l)){var c=le("智力",parseInt(s[1]),e,o);l=l.replace(/(技能释放概率：\d+%)/,'$1<span class="pd_custom_tips" title="实际技能释放概率">('+c+"%)</span>")}a[e]=a[e].replace("</li>",('</li><li class="pk_log_g" style="color: #666;">'+l+"</li>").replace(/\n/g,"<br>"))}}}}),F.html(a.reverse().join("")),Config.showLiteLootLogEnabled?$("#pdLiteLootLogStyle").length||$("head").append('<style id="pdLiteLootLogStyle">.pk_log_g, .pk_log_i, .pk_log_u, .pk_log_v { display: none; }</style>'):$("#pdLiteLootLogStyle").remove(),L.runFunc("Loot.showEnhanceLog_after_")},_e=(n.getLog=function(){return B},n.getLogList=function(e){var t=[],n=e.match(/<li class="pk_log_j">.+?(?=\s*<li class="pk_log_j">|\s*$)/g);for(var a in n){var i=/在\[\s*(\d+)\s*层]/.exec(p.removeHtmlTag(n[a]));i&&(t[parseInt(i[1])]=n[a])}return t}),xe=n.getLevelInfo=function(e){var t={enemy:"",life:0,initLife:0,box:""};if(!e)return t;e=p.removeHtmlTag(e.replace(/<\/li>/g,"</li>\n"));var n=/你\((\d+)\)遭遇了\[([^\]]+)的]NPC/.exec(e);return n&&(t.initLife=parseInt(n[1]),t.enemy=n[2],t.enemy=t.enemy.replace("特别","").replace("(后续更新前此路不通)","")),n=/生命值\[(\d+)\s*\/\s*\d+]/.exec(e),n&&(t.life=parseInt(n[1])),n=/敌人掉落了一个\s*\[\s*(\S+?盒子)\s*]/.exec(e),n&&(t.box=n[1]),t},ke=n.getLevelInfoList=function(e){var t=[];return $.each(e,function(e,n){n&&(t[e]=xe(n))}),t},Ce=function(e){var t=0,n={};return $.each(e,function(e,a){a&&a.box&&(a.box in n||(n[a.box]=0),n[a.box]++,t++)}),{boxNum:t,boxes:n}},we=function(e){var t={"普通":0,"强壮":0,"快速":0,"脆弱":0,"缓慢":0,BOSS:0,"大魔王":0};return $.each(Ie(e),function(e,n){n&&n in t&&t[n]++}),t.BOSS||delete t.BOSS,t["大魔王"]||delete t["大魔王"],t},Ie=function(e){var t=[];return $.each(e,function(e,n){n&&n.enemy&&(t[e]=n.enemy)}),t},Le=function(e){return e.length-1>=1?e.length-1:0},$e=function(e){var t=localStorage.getItem(v.default.tempPointsLogListStorageName+"_"+d.default.uid);if(!t)return[];try{t=JSON.parse(t)}catch(e){return[]}if(!t||"object"!==$.type(t)||"number"!==$.type(t.time)||!Array.isArray(t.pointsLogList))return[];var n=(new Date).getTime()-t.time;return t.pointsLogList.length>e.length||n>=864e5||n<0?(localStorage.removeItem(v.default.tempPointsLogListStorageName+"_"+d.default.uid),[]):t.pointsLogList},Se=function(){var e=new Date,t=p.getTimezoneDateByTime("02:30:00");return e>t&&(t=p.getTimezoneDateByTime("00:00:30"),t.setDate(t.getDate()+1)),e>t&&t.setDate(t.getDate()+1),t},Te=(n.checkLoot=function e(){if(!(new Date<p.getDateByTime(Config.checkLootAfterTime))){console.log("检查争夺情况Start");var t=f.wait("<strong>正在检查争夺情况中&hellip;</strong>");$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+(new Date).getTime(),timeout:v.default.defAjaxTimeout,success:function(e){if(f.remove(t),/你被击败了/.test(e))p.setCookie(v.default.lootCompleteCookieName,2,Se());else{if(p.getCookie(v.default.lootCheckingCookieName))return;var n=$("#pk_text",e);if(!n.length)return void p.setCookie(v.default.lootCompleteCookieName,-1,p.getDate("+"+v.default.checkLootInterval+"m"));if(Config.attackTargetLevel>0){var a=n.html(),i=_e(a),o=Le(i);if(Config.attackTargetLevel<=o)return void p.setCookie(v.default.lootCompleteCookieName,1,Se())}p.setCookie(v.default.lootCheckingCookieName,1,p.getDate("+1m")),f.destroy(),location.href="kf_fw_ig_index.php"}},error:function(){f.remove(t),setTimeout(e,v.default.defAjaxInterval)}})}},function(){if(!(/你被击败了/.test(B)||new Date<p.getDateByTime(Config.checkLootAfterTime))){var e=T.getSafeId(),t=Le(j);if(!e||Config.attackTargetLevel>0&&Config.attackTargetLevel<=t)return void p.setCookie(v.default.lootCompleteCookieName,1,Se());p.setCookie(v.default.lootAttackingCookieName,1,p.getDate("+"+v.default.lootAttackingExpires+"m")),p.deleteCookie(v.default.lootCompleteCookieName);var n=Config.autoChangeLevelPointsEnabled||Config.customPointsScriptEnabled&&"function"==typeof v.default.getCustomPoints;(!Config.unusedPointNumAlertEnabled||n||X(M))&&ue({type:"auto",targetLevel:Config.attackTargetLevel,autoChangePointsEnabled:n,safeId:e})}}),De=n.autoSaveLootLog=function e(){console.log("检查争夺情况Start");var t=f.wait("<strong>正在检查争夺情况中&hellip;</strong>");$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+(new Date).getTime(),timeout:v.default.defAjaxTimeout,success:function(e){if(f.remove(t),!p.getCookie(v.default.lootCompleteCookieName)){var n=$("#pk_text",e),a=n.html();if(/你被击败了/.test(a)){p.setCookie(v.default.lootCompleteCookieName,2,Se());var i=_e(a),o=ke(i),r=w.read();if(!$.isEmptyObject(r)){var l=p.getObjectKeyList(r,1),s=parseInt(l[l.length-1]);if(s>p.getDate("-1d").getTime()&&r[s].log.join("").trim()===i.join("").trim())return}me(i,o,[])}else p.setCookie(v.default.lootCompleteCookieName,-1,p.getDate("+"+v.default.checkLootInterval+"m"))}},error:function(){f.remove(t),setTimeout(e,v.default.defAjaxInterval)}})},Ae=(n.getChangePointsCountDown=function(){return console.log("获取改点倒计时Start"),$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+(new Date).getTime(),timeout:v.default.defAjaxTimeout}).then(function(e){
var t=/\(下次修改配点还需\[(\d+)]分钟\)/.exec(e);if(t){var n=p.getDate("+"+t[1]+"m");return p.setCookie(v.default.changePointsInfoCookieName,n.getTime(),n),n.getTime()}if(t=/当前修改配点可用\[(\d+)]次/.exec(e)){var a=parseInt(t[1]);return p.setCookie(v.default.changePointsInfoCookieName,a+"c",p.getDate("+"+v.default.changePointsInfoExpires+"m")),a}return"error"},function(){return"timeout"})},n.addUserLinkInPkListPage=function(){$(".kf_fw_ig1 > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===d.default.userName&&e.find("a").addClass("pd_highlight")})},n.addUserLinkInHaloPage=function(){$(".kf_fw_ig1:eq(1) > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===d.default.userName&&e.find("a").addClass("pd_highlight")})},function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("获取战力光环信息Start");var n=f.wait("<strong>正在获取战力光环信息，请稍候&hellip;</strong>");Ee().done(function(e){"object"===$.type(e)&&(Pe(e),t?G():M.find(".pd_point").trigger("change"))}).always(function(a){f.remove(n),"timeout"===a?setTimeout(function(){return e(t)},v.default.defAjaxInterval):"error"===a&&f.show("<strong>战力光环信息获取失败！</strong>")})}),Ee=n.getHaloInfo=function(){return $.ajax({type:"GET",url:"kf_fw_ig_halo.php?t="+(new Date).getTime(),timeout:v.default.defAjaxTimeout}).then(function(e){var t={"全属性":0,"攻击力":0,"生命值":0},n=/全属性\s*\+\s*(\d+(?:\.\d+)?)%/.exec(e);if(n){t["全属性"]=10*parseFloat(n[1])/1e3;var a=/福利加成\s*\+\s*(\d+)攻击力\s*&\s*\+\s*(\d+)生命值/.exec(e);return a&&(t["攻击力"]=parseInt(a[1]),t["生命值"]=parseInt(a[2])),k.setValue(v.default.haloInfoTmpLogName,$.extend(t,{time:(new Date).getTime()})),t}return"error"},function(){return"timeout"})},Pe=n.setHaloInfo=function(e){if(K=e,!$("#pdHaloInfo").length){var t=N.find('input[value$="整形优惠卷"]').parent("td");if(!t.length||3!==parseInt(t.attr("colspan")))return;t.removeAttr("colspan"),$('\n<td colspan="2">\n  <input id="pdHaloInfo" type="text" size="26" readonly>\n  <a class="pd_btn_link" data-name="reloadHaloInfo" href="#" title="如战力光环信息不正确时，请点此重新读取" hidden>重新读取</a>\n</td>\n').insertAfter(t).find('[data-name="reloadHaloInfo"]').click(function(e){e.preventDefault(),confirm("是否重新读取战力光环信息？")&&(k.deleteValue(v.default.haloInfoTmpLogName),Ae())})}$("#pdHaloInfo").val("全属性+"+1e3*K["全属性"]/10+"% (+"+K["攻击力"]+"|+"+K["生命值"]+")")},Ne=n.getPromoteHaloInfo=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];L.runFunc("Loot.getPromoteHaloInfo_before_"),console.log("获取战力光环页面信息Start");var n=f.wait("<strong>正在获取战力光环信息，请稍候&hellip;</strong>"),a=function(e){var n=p.getDate(e);return p.setCookie(v.default.promoteHaloCookieName,n.getTime(),n),t&&V(),!1},i=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;$.ajax({type:"GET",url:"kf_fw_ig_halo.php?t="+(new Date).getTime(),timeout:v.default.defAjaxTimeout}).done(function(e){f.remove(n);var o=/safeid=(\w+)"/.exec(e);if(!o)return a("+1h");var r=o[1],l=/下次随机还需\[(\d+)]分钟/.exec(e);if(l){var s=Config.promoteHaloAutoIntervalEnabled?v.default.minPromoteHaloInterval:60*Config.promoteHaloInterval;return s=s<v.default.minPromoteHaloInterval?v.default.minPromoteHaloInterval:s,a("+"+(s-(v.default.minPromoteHaloInterval-parseInt(l[1])))+"m")}var d=1,c=/当前光环随机可用\[(\d+)]次/.exec(e);Config.promoteHaloAutoIntervalEnabled&&c&&(d=parseInt(c[1]),i>-1&&(d=d>i?i:d)),Me(d,Config.promoteHaloCostType,r,t)}).fail(function(){f.remove(n),setTimeout(e,v.default.defAjaxInterval)})};Config.promoteHaloLimit>0?function e(){$.ajax({type:"GET",url:"profile.php?action=show&uid="+d.default.uid+"&t="+(new Date).getTime(),timeout:v.default.defAjaxTimeout}).done(function(e){f.remove(n);var t=Config.promoteHaloCostType>=11?/贡献数值：(\d+(?:\.\d+)?)/:/论坛货币：(-?\d+)\s*KFB/,o=t.exec(e);if(!o)return a("+"+v.default.promoteHaloLimitNextActionInterval+"m");var r=parseFloat(o[1]);if(!(r>Config.promoteHaloLimit))return a("+"+v.default.promoteHaloLimitNextActionInterval+"m");var l=Ue(Config.promoteHaloCostType),s=l.num,d=Math.floor((r-Config.promoteHaloLimit)/s);if(!(d>0))return a("+"+v.default.promoteHaloLimitNextActionInterval+"m");n=f.wait("<strong>正在获取战力光环信息，请稍候&hellip;</strong>"),i(d)}).fail(function(){return setTimeout(e,v.default.defAjaxInterval)})}():i()},Me=n.promoteHalo=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];console.log("提升战力光环Start");var i=f.wait('<strong>正在提升战力光环&hellip;</strong><i>剩余：<em class="pd_countdown">'+e+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');k.deleteValue(v.default.haloInfoTmpLogName);var o=!1,r=0,l=p.getDate("+10m").getTime();!function s(){$.ajax({type:"GET",url:"kf_fw_ig_halo.php?do=buy&id="+t+"&safeid="+n+"&t="+(new Date).getTime(),timeout:v.default.defAjaxTimeout}).done(function(e){T.showFormatLog("提升战力光环",e);var n=p.getResponseMsg(e),a=n.msg,i=/(新数值为|随机值为)\[(\d+(?:\.\d+)?)%]/.exec(a);if(i){var s="新数值为"===i[1];l=Config.promoteHaloAutoIntervalEnabled?0:p.getDate("+"+Config.promoteHaloInterval+"h").getTime();var d=parseFloat(i[2]),c=Ue(t);f.show("<strong>"+(s?"恭喜你提升了光环的效果！新数值为【<em>"+d+"%</em>】":"你本次随机值为【<em>"+d+"%</em>】，未超过光环效果")+"</strong><i>"+c.type+"<ins>"+(-c.num).toLocaleString()+"</ins></i>",-1);var u={};u[c.type]=-c.num,_.push("提升战力光环",s?"恭喜你提升了光环的效果！新数值为【`"+d+"%`】":"你本次随机值为【`"+d+"%`】，未超过光环效果",{pay:u}),r++}else if(/两次操作间隔过短/.test(a)?l=p.getDate("+10s").getTime():o=!0,i=/你的(贡献点数|KFB)不足/.exec(a),i&&(l=p.getDate("+"+Config.promoteHaloInterval+"h").getTime(),f.show("<strong>"+i[1]+'不足，无法提升战力光环</strong><a href="kf_fw_ig_halo.php" target="_blank">手动选择</a>',-1)),i=/你还需要等待(\d+)分钟/.exec(a)){var m=60*Config.promoteHaloInterval;m=m<v.default.minPromoteHaloInterval?v.default.minPromoteHaloInterval:m,l=p.getDate("+"+(60*Config.promoteHaloInterval-(v.default.minPromoteHaloInterval-parseInt(i[1])))+"m").getTime()}}).always(function(){i.find(".pd_countdown").text(e-r),o=o||i.data("stop"),o||r===e?(f.remove(i),l>0||o?p.setCookie(v.default.promoteHaloCookieName,l,new Date(l)):(p.deleteCookie(v.default.promoteHaloCookieName),Ne()),a&&V(),L.runFunc("Loot.promoteHalo_after_")):setTimeout(s,v.default.promoteHaloActionInterval)})}()},Ue=n.getPromoteHaloCostByTypeId=function(e){switch(e){case 1:return{type:"KFB",num:100};case 2:return{type:"KFB",num:1e3};case 11:return{type:"贡献",num:.2};case 12:return{type:"贡献",num:2};default:return{type:"KFB",num:0}}}},{"./Box":3,"./Config":5,"./Const":7,"./Dialog":8,"./Info":10,"./Item":11,"./Log":12,"./LootLog":15,"./Msg":16,"./Public":19,"./Script":21,"./TmpLog":22,"./Util":23}],15:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.getMergeLog=n.record=n.clear=n.write=n.read=void 0;var i=e("./Info"),o=a(i),r=e("./Const"),l=a(r),s=e("./Util"),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s),c=l.default.storagePrefix+"loot_log",p=n.read=function(){var e={},t=d.readData(c+"_"+o.default.uid);if(!t)return e;try{t=JSON.parse(t)}catch(t){return e}return t&&"object"===$.type(t)?e=t:e},u=n.write=function(e){return d.writeData(c+"_"+o.default.uid,JSON.stringify(e))};n.clear=function(){return d.deleteData(c+"_"+o.default.uid)},n.record=function(e,t){var n=p(),a=d.getDate("-"+Config.lootLogSaveDays+"d").getTime();$.each(d.getObjectKeyList(n,1),function(e,t){if(t=parseInt(t),!(isNaN(t)||t<=a))return!1;delete n[t]}),n[(new Date).getTime()]={log:e,points:t},u(n)},n.getMergeLog=function(e,t){for(var n in t)!$.isNumeric(n)||parseInt(n)<=0||"object"===$.type(t[n])&&Array.isArray(t[n].log)&&Array.isArray(t[n].points)&&(e[n]=t[n]);return e}},{"./Const":7,"./Info":10,"./Util":23}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=n.show=function(e,t){var n={msg:"",duration:Config.defShowMsgDuration,clickable:!0,preventable:!1};"object"===$.type(e)?$.extend(n,e):(n.msg=e,n.duration=void 0===t?Config.defShowMsgDuration:t),$(".pd_msg").length>20&&o();var a=$(".pd_msg_container"),r=0===a.length;if(!r&&!$(".pd_mask").length){var l=$(".pd_msg:last");if(l.length>0){var s=l.offset().top,d=$(window).scrollTop();(s<d||s>=d+$(window).height()-l.outerHeight()-10)&&(o(),r=!0)}}n.preventable&&!$(".pd_mask").length&&$('<div class="pd_mask"></div>').appendTo("body"),r&&(a=$('<div class="pd_msg_container"></div>').appendTo("body"));var c=$('<div class="pd_msg">'+n.msg+"</div>").appendTo(a);c.on("click",".pd_stop_action",function(e){e.preventDefault(),$(this).html("正在停止&hellip;").closest(".pd_msg").data("stop",!0)}),n.clickable&&c.css("cursor","pointer").click(function(){$(this).stop(!0,!0).fadeOut("slow",function(){i($(this))})}).find("a").click(function(e){e.stopPropagation()});var p=$(window).width(),u=c.outerWidth(),f=c.outerHeight(),m=p/2-u/2;m+u>p&&(m=p-u-20),m<0&&(m=0),r?a.css("top",$(window).height()/2-f/2):a.stop(!1,!0).animate({top:"-="+f/1.75});var g=c.prev(".pd_msg");return c.css({top:g.length>0?parseInt(g.css("top"))+g.outerHeight()+5:0,left:m}).fadeIn("slow"),n.duration!==-1&&c.delay(1e3*n.duration).fadeOut("slow",function(){i($(this))}),c},i=(n.wait=function(e){return a({msg:e,duration:-1,clickable:!1,preventable:!(arguments.length>1&&void 0!==arguments[1])||arguments[1]})},n.remove=function(e){var t=e.parent();e.remove(),$(".pd_msg").length?$(".pd_countdown").length||$(".pd_mask").remove():(t.remove(),$(".pd_mask").remove())}),o=n.destroy=function(){$(".pd_msg_container").remove(),$(".pd_mask").remove()}},{}],17:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.handleProfilePage=n.addUserNameLinkInRankPage=n.refreshWaitCheckRatingPage=n.addLinksInGoodPostPage=n.showSelfRatingErrorSizeSubmitWarning=n.highlightRatingErrorSize=n.addAvatarChangeAlert=n.syncModifyPerPageFloorNum=n.addAutoChangeIdColorButton=n.addMsgSelectButton=n.modifyMyPostLink=n.addFollowAndBlockAndMemoUserLink=n.addFastDrawMoneyLink=n.highlightUnReadAtTipsMsg=n.addFastGotoThreadPageLink=n.highlightNewPost=void 0;var o=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e("./Info"),l=i(r),s=e("./Util"),d=a(s),c=e("./Msg"),p=a(c),u=e("./Const"),f=i(u),m=e("./Config"),g=e("./ConfigDialog"),h=e("./TmpLog"),v=a(h),b=e("./Public"),y=a(b),_=e("./Bank"),x=a(_);n.highlightNewPost=function(){$(".thread1 > tbody > tr > td:last-child").has("a.bl").each(function(){var e=$(this).html();/\|\s*\d{2}:\d{2}<br>\n.*\d{2}:\d{2}/.test(e)&&(e=e.replace(/(\d{2}:\d{2})<br>/,'<span class="pd_highlight">$1</span><br>'),$(this).html(e))})},n.addFastGotoThreadPageLink=function(){$('.threadtit1 > a[href^="read.php"]').each(function(){var e=$(this),t=e.closest("td").next().find("ul > li > a").contents().eq(0).text();if(t&&!(t<Config.perPageFloorNum)){for(var n=e.attr("href"),a=Math.floor(t/Config.perPageFloorNum)+1,i="",o=1;o<a;o++){if(o>Config.maxFastGotoThreadPageNum){o+1<=a&&(i+='..<a href="'+n+"&page="+a+'">'+a+"</a>");break}i+='<a href="'+n+"&page="+(o+1)+'">'+(o+1)+"</a>"}i='<span class="pd_thread_page">&hellip;'+i+"</span>",e.after(i).parent().css("white-space","normal")}})},n.highlightUnReadAtTipsMsg=function(){if($(".kf_share1:first").text().trim()==="含有关键词 “"+l.default.userName+"” 的内容"){var e=d.getCookie(f.default.prevReadAtTipsCookieName);if(e&&/^\d+日\d+时\d+分$/.test(e)){var t="";$(".kf_share1:eq(1) > tbody > tr:gt(0) > td:first-child").each(function(n){var a=$(this),i=a.text().trim();if(0===n&&(t=i),!(e<i&&t>=i))return!1;a.addClass("pd_highlight"),t=i}),$(".kf_share1").on("click","td > a",function(){d.deleteCookie(f.default.prevReadAtTipsCookieName)})}}},n.addFastDrawMoneyLink=function(){if($('td:contains("SYSTEM")').length&&$('td:contains("收到了他人转账的KFB")').length){var e=$(".thread2 > tbody > tr:eq(-2) > td:last"),t=e.html(),n=/给你转帐(\d+)KFB/i.exec(t);if(n){var a=parseInt(n[1]);e.html(t.replace(/会员\[(.+?)\]通过论坛银行/,'会员[<a target="_blank" href="profile.php?action=show&username=$1">$1</a>]通过论坛银行').replace(n[0],'给你转帐<span class="pd_stat"><em>'+a.toLocaleString()+"</em></span>KFB")),$('<br><a title="从活期存款中取出当前转账的金额" href="#">快速取款</a> | <a title="取出银行账户中的所有活期存款" href="#">取出所有存款</a>').appendTo(e).filter("a:eq(0)").click(function(e){e.preventDefault(),p.destroy(),x.drawCurrentDeposit(a)}).end().filter("a:eq(1)").click(function(e){e.preventDefault(),p.destroy(),p.wait("<strong>正在获取当前活期存款金额&hellip;</strong>"),$.get("hack.php?H_name=bank&t="+(new Date).getTime(),function(e){p.destroy();var t=/活期存款：(\d+)KFB<br/.exec(e);if(!t)return void alert("获取当前活期存款金额失败");var n=parseInt(t[1]);if(n<=0)return void p.show("当前活期存款余额为零",-1);x.drawCurrentDeposit(n)})}),$('a[href^="message.php?action=write&remid="]').attr("href","#").addClass("pd_disabled_link").click(function(e){e.preventDefault(),alert("本短消息由系统发送，请勿直接回复；如需回复，请点击给你转账的用户链接，向其发送短消息")})}}},n.addFollowAndBlockAndMemoUserLink=function(){var e=/(.+?)\s*详细信息/.exec($('td:contains("详细信息")').text());if(e){var t=$.trim(e[1]);$('<span>[<a href="#">关注用户</a>] [<a href="#">屏蔽用户</a>]</span><br><span>[<a href="#">添加备注</a>]</span><br>').appendTo($('a[href^="message.php?action=write&touid="]').parent()).find("a").each(function(){var e=$(this);if(e.is('a:contains("备注")')){var n="",a=!0,i=!1,r=void 0;try{for(var l,s=d.entries(Config.userMemoList)[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var c=o(l.value,2),p=c[0],u=c[1];if(p===t){n=u;break}}}catch(e){i=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(i)throw r}}if(""!==n){e.text("修改备注").data("memo",n);var f=$(".log1 > tbody > tr:last-child > td:last-child");f.html("备注："+n+"<br>"+f.html())}}else{var m="关注",g=Config.followUserList;e.text().indexOf("屏蔽")>-1&&(m="屏蔽",g=Config.blockUserList),d.inFollowOrBlockUserList(t,g)>-1&&e.addClass("pd_highlight").text("解除"+m)}}).click(function(e){e.preventDefault(),(0,m.read)();var n=$(this);if(n.is('a:contains("备注")')){var a=n.data("memo");a||(a="");var i=prompt("为此用户添加备注（要删除备注请留空）：",a);if(null===i)return;Config.userMemoEnabled||(Config.userMemoEnabled=!0),i=$.trim(i),i?(Config.userMemoList[t]=i,n.text("修改备注")):(delete Config.userMemoList[t],n.text("添加备注")),n.data("memo",i),(0,m.write)()}else{var o="关注",r=Config.followUserList;if(n.text().includes("屏蔽")?(o="屏蔽",r=Config.blockUserList,Config.blockUserEnabled||(Config.blockUserEnabled=!0)):Config.followUserEnabled||(Config.followUserEnabled=!0),n.text()==="解除"+o){var l=d.inFollowOrBlockUserList(t,r);l>-1&&(r.splice(l,1),(0,m.write)()),n.removeClass("pd_highlight").text(o+"用户"),alert("该用户已被解除"+o)}else{if(d.inFollowOrBlockUserList(t,r)===-1){if("屏蔽"===o){var s=Config.blockUserDefaultType;if(null===(s=prompt("请填写屏蔽类型，0：屏蔽主题和回帖；1：仅屏蔽主题；2：仅屏蔽回帖",s)))return;s=parseInt(s),(isNaN(s)||s<0||s>2)&&(s=Config.blockUserDefaultType),r.push({name:t,type:s})}else r.push({name:t});(0,m.write)()}n.addClass("pd_highlight").text("解除"+o),alert("该用户已被"+o)}}})}},n.modifyMyPostLink=function(){$('.t a[href^="read.php?tid="]').each(function(){var e=$(this);e.attr("href",e.attr("href").replace(/&uid=\d+#(\d+)/,"&spid=$1"))})},n.addMsgSelectButton=function(){var e=$('.thread1 > tbody > tr > td:last-child > [type="checkbox"]');$('<input value="自定义" type="button" style="margin-right: 3px;">').insertBefore('[type="button"][value="全选"]').click(function(t){t.preventDefault();var n=$.trim(prompt("请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）","收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除"));if(""!==n){e.prop("checked",!1);var a=n.split("|");$(".thread1 > tbody > tr > td:nth-child(2) > a").each(function(){var e=$(this),t=!0,n=!1,i=void 0;try{for(var o,r=a[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var l=o.value;e.text().toLowerCase().includes(l.toLowerCase())&&e.closest("tr").find('td:last-child > input[type="checkbox"]').prop("checked",!0)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}})}}).parent().attr("colspan",4).prev("td").attr("colspan",3),$('<input value="反选" type="button" style="margin-left: 5px; margin-right: 1px;">').insertAfter('[type="button"][value="全选"]').click(function(){return d.selectInverse(e)})},n.addAutoChangeIdColorButton=function(){var e=$('table div > table > tbody > tr > td:contains("自定义ID颜色")');$('<span class="pd_highlight">低等级没人权？没有自己喜欢的颜色？快来试试助手的<a href="#">自定义本人神秘颜色</a>的功能吧！（虽然仅限自己可见 ╮(╯▽╰)╭）</span><br>').appendTo(e).find("a").click(function(e){e.preventDefault(),(0,g.show)()});var t=e.parent("tr").nextAll("tr").not("tr:last");if(!(t.find("a").length<=1)){var n=$('\n<form>\n<div data-name="autoChangeIdColorBtns" style="margin-top: 5px;">\n  <label><input name="autoChangeIdColorEnabled" class="pd_input" type="checkbox"> 自动更换ID颜色</label>\n</div>\n</form>\n').appendTo(e);n.find('[name="autoChangeIdColorEnabled"]').click(function(){var e=$(this),a=e.prop("checked");if(a!==Config.autoChangeIdColorEnabled&&((0,m.read)(),Config.autoChangeIdColorEnabled=a,(0,m.write)()),a){t.addClass("pd_id_color_select").find("td:not(:has(a))").css("cursor","not-allowed"),$('\n<label class="pd_cfg_ml">\n  更换顺序\n  <select name="autoChangeIdColorType" style="font-size: 12px;">\n    <option value="random">随机</option><option value="sequence">顺序</option>\n  </select>\n</label>&nbsp;\n<label>每隔 <input name="autoChangeIdColorInterval" class="pd_input" style="width: 25px;" type="text" maxlength="5"> 小时</label>\n<button name="save" type="button">保存</button>\n<button name="reset" type="button" style="margin-left: 3px;">重置</button><br>\n<a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n<a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n<label><input name="changeAllAvailableIdColorEnabled" class="pd_input" type="checkbox"> 选择当前所有可用的ID颜色</label>\n').insertAfter(e.parent()).filter('[name="save"]').click(function(){var e=n.find('[name="autoChangeIdColorInterval"]'),a=parseInt(e.val());if(isNaN(a)||a<=0)return alert("ID颜色更换时间间隔格式不正确"),void e.select().focus();var i=n.find('[name="changeAllAvailableIdColorEnabled"]').prop("checked"),o=[];if(t.find('[type="checkbox"]:checked').each(function(){o.push(parseInt($(this).val()))}),!i&&o.length<=1)return void alert("必须选择2种或以上的ID颜色");o.length<=1&&(o=[]);var r=Config.autoChangeIdColorInterval;(0,m.read)(),Config.autoChangeIdColorType=n.find('[name="autoChangeIdColorType"]').val().toLowerCase(),Config.autoChangeIdColorInterval=a,Config.changeAllAvailableIdColorEnabled=i,Config.customAutoChangeIdColorList=o,(0,m.write)(),r!==Config.autoChangeIdColorInterval&&d.deleteCookie(f.default.autoChangeIdColorCookieName),alert("设置保存成功")}).end().filter('[name="reset"]').click(function(){(0,m.read)(),Config.autoChangeIdColorEnabled=m.Config.autoChangeIdColorEnabled,Config.autoChangeIdColorType=m.Config.autoChangeIdColorType,Config.autoChangeIdColorInterval=m.Config.autoChangeIdColorInterval,Config.changeAllAvailableIdColorEnabled=m.Config.changeAllAvailableIdColorEnabled,Config.customAutoChangeIdColorList=m.Config.customAutoChangeIdColorList,(0,m.write)(),d.deleteCookie(f.default.autoChangeIdColorCookieName),v.deleteValue(f.default.prevAutoChangeIdColorTmpLogName),alert("设置已重置"),location.reload()}).end().filter('[data-name="selectAll"], [data-name="selectInverse"]').click(function(e){if(e.preventDefault(),t.find("input[disabled]").length>0)return alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),void n.find('[name="changeAllAvailableIdColorEnabled"]').focus();$(this).is('[data-name="selectAll"]')?d.selectAll(t.find('[type="checkbox"]')):d.selectInverse(t.find('[type="checkbox"]'))}),t.find("td:has(a)").each(function(){var e=$(this),t=/&color=(\d+)/i.exec(e.find("a").attr("href"));t&&e.append('<input type="checkbox" class="pd_input" value="'+t[1]+'">')}),n.find('[name="autoChangeIdColorType"]').val(Config.autoChangeIdColorType),n.find('[name="autoChangeIdColorInterval"]').val(Config.autoChangeIdColorInterval),n.find('[name="changeAllAvailableIdColorEnabled"]').click(function(){t.find("input").prop("disabled",$(this).prop("checked"))}).prop("checked",Config.changeAllAvailableIdColorEnabled).triggerHandler("click");var i=!0,o=!1,r=void 0;try{for(var l,s=Config.customAutoChangeIdColorList[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value;t.find('input[value="'+c+'"]').prop("checked",!0)}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}}else e.parent().nextAll().remove(),t.removeClass("pd_id_color_select").find("input").remove()}),t.on("click","td",function(e){if(!$(e.target).is("a")){var t=$(this);t.find("input[disabled]").length>0?(alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),n.find('[name="changeAllAvailableIdColorEnabled"]').focus()):$(e.target).is("input")||t.find("input").click()}}),Config.autoChangeIdColorEnabled&&n.find('[name="autoChangeIdColorEnabled"]').prop("checked",!0).triggerHandler("click")}},n.syncModifyPerPageFloorNum=function(){var e=function(){var e=parseInt($('select[name="p_num"]').val());isNaN(e)||(e||(e=10),e!==Config.perPageFloorNum&&(Config.perPageFloorNum=e,(0,m.write)()))};$("form#creator").submit(function(){(0,m.read)(),e()}),e()},n.addAvatarChangeAlert=function(){$('input[name="uploadurl[2]"]').parent().append('<div class="pd_highlight">本反向代理服务器为了提高性能对图片设置了缓存，更换头像后可能需等待<b>最多30分钟</b>才能看到效果</div>')},n.highlightRatingErrorSize=function(){$('.adp1 a[href^="read.php?tid="]').each(function(){var e=$(this),t=e.text(),n=0,a=e.parent("td").next("td"),i=/认定\[(\d+)\]/i.exec(a.text());i&&(n=parseInt(i[1]));var o=y.checkRatingSize(t,n),r=o.type,l=o.titleSize;r===-1?a.css("color","#ff9933").attr("title","标题文件大小无法解析").addClass("pd_custom_tips"):1===r&&a.addClass("pd_highlight pd_custom_tips").attr("title","标题文件大小("+l.toLocaleString()+"M)与认定文件大小("+n.toLocaleString()+"M)不一致")})},n.showSelfRatingErrorSizeSubmitWarning=function(){$('form[name="mail1"]').submit(function(){var e=parseFloat($('[name="psize"]').val());if(!(isNaN(e)||e<=0)){2===parseInt($('[name="psizegb"]').val())&&(e*=1024);var t=$('.adp1 a[href^="read.php?tid="]').text(),n=y.checkRatingSize(t,e),a=n.type,i=n.titleSize;return 1===a?confirm("标题文件大小("+i.toLocaleString()+"M)与认定文件大小("+e.toLocaleString()+"M)不一致，是否继续？"):void 0}})},n.addLinksInGoodPostPage=function(){/\/kf_fw_1wkfb\.php\?ping=5/i.test(location.href)?$(".adp1:last > tbody > tr:gt(0) > td:last-child").each(function(){var e=$(this),t=parseInt(e.text());e.wrapInner('<a class="'+(t===l.default.uid?"pd_highlight":"")+'" href="profile.php?action=show&uid='+t+'" target="_blank"></a>')}):/\/kf_fw_1wkfb\.php\?ping=6/i.test(location.href)&&($(".adp1:last > tbody > tr:gt(1) > td:nth-child(3)").each(function(){var e=$(this),t=e.text().trim();"0"!==t&&e.wrapInner('<a class="'+(t===l.default.userName?"pd_highlight":"")+'" href="profile.php?action=show&username='+t+'" target="_blank"></a>')}),$(".adp1:last > tbody > tr:gt(1) > td:last-child").each(function(){var e=$(this),t=/\[(\d+)]板块/.exec(e.text());t&&e.wrapInner('<a href="thread.php?fid='+t[1]+'" target="_blank"></a>')}))},n.refreshWaitCheckRatingPage=function(){if(/剩余-\d+分钟/.test($(".adp1:eq(1) > tbody > tr:last-child > td:first-child").text())){!function e(){console.log("自动刷新Start"),$.ajax({type:"GET",url:"kf_fw_1wkfb.php?ping=2&t="+(new Date).getTime(),timeout:1e4}).done(function(t){/剩余-\d+分钟/.test(t)&&setTimeout(e,f.default.defAjaxInterval)}).fail(function(){return setTimeout(e,f.default.defAjaxInterval)})}()}},n.addUserNameLinkInRankPage=function(){$(".kf_no11:eq(2) > tbody > tr:gt(0) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===l.default.userName&&e.find("a").addClass("pd_highlight")})},n.handleProfilePage=function(){var e=$(".log1 > tbody > tr:last-child > td:nth-child(2)");e.html(e.html().replace(/<b>在线<\/b>/,'<b style="color: #090;">在线</b>').replace(/<b>离线<\/b>/,'<b style="color: #999;">离线</b>').replace(/系统等级：(\S+)/,'系统等级：<span class="pd_highlight">$1</span>').replace(/发帖数量：(\d+)/,function(e,t){return'发帖数量：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/论坛货币：(-?\d+)/,function(e,t){return'论坛货币：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/在线时间：(\d+)/,function(e,t){return'在线时间：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/注册时间：((\d{4})-(\d{2})-(\d{2}))/,function(e,t,n,a,i){var o=new Date,r=t;return parseInt(a)===o.getMonth()+1&&parseInt(i)===o.getDate()&&parseInt(n)<=o.getFullYear()&&(r='<span class="pd_custom_tips pd_highlight" title="今天是该用户注册'+(o.getFullYear()-parseInt(n))+'周年纪念日">'+t+"</span>"),"注册时间："+r})).css("vertical-align","top")}},{"./Bank":2,"./Config":5,"./ConfigDialog":6,"./Const":7,"./Info":10,"./Msg":16,"./Public":19,"./TmpLog":22,"./Util":23}],18:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.addRedundantKeywordWarning=n.savePostContentWhenSubmit=n.preventCloseWindowWhenEditPost=n.importKfSmileEnhanceExtension=n.addAttachChangeAlert=n.modifyPostPreviewPage=n.addExtraOptionInPostPage=n.addExtraPostEditorButton=n.removeUnpairedBBCodeInQuoteContent=n.handleMultiQuote=void 0;var r=e("./Info"),l=i(r),s=e("./Util"),d=a(s),c=e("./Msg"),p=a(c),u=e("./Const"),f=i(u),m=e("./Script"),g=a(m);n.handleMultiQuote=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;g.runFunc("Post.handleMultiQuote_before_",e),$("#pdClearMultiQuoteData").length||$('<a id="pdClearMultiQuoteData" style="margin-left: 7px;" title="清除在浏览器中保存的多重引用数据" href="#">清除引用数据</a>').insertAfter('input[name="diy_guanjianci"]').click(function(t){t.preventDefault(),localStorage.removeItem(f.default.multiQuoteStorageName),$('input[name="diy_guanjianci"]').val(""),$(2===e?"#textarea":'[name="atc_content"]').val(""),alert("多重引用数据已被清除")});var t=localStorage[f.default.multiQuoteStorageName];if(t){try{t=JSON.parse(t)}catch(e){return}if(t&&"object"===$.type(t)&&!$.isEmptyObject(t)){var n=parseInt(d.getUrlParam("tid")),a=parseInt(d.getUrlParam("fid"));if(n&&void 0!==t.tid&&t.tid===n&&Array.isArray(t.quoteList)&&(2!==e||a)){var i=[],r=!0,l=!1,s=void 0;try{for(var c,u=t.quoteList[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var m=c.value;if(Array.isArray(m)){var h=!0,v=!1,b=void 0;try{for(var y,_=m[Symbol.iterator]();!(h=(y=_.next()).done);h=!0){var x=y.value;i.push(x)}}catch(e){v=!0,b=e}finally{try{!h&&_.return&&_.return()}finally{if(v)throw b}}}}}catch(e){l=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(l)throw s}}if(!i.length)return void localStorage.removeItem(f.default.multiQuoteStorageName);var k=new Set,C="",w=$('input[name="diy_guanjianci"]');2===e&&(p.wait('<strong>正在获取引用内容中&hellip;</strong><i>剩余：<em class="pd_countdown">'+i.length+"</em></i>"),$(document).clearQueue("MultiQuote")),$.each(i,function(t,o){void 0!==o.floor&&void 0!==o.pid&&(k.add(o.userName),2===e?$(document).queue("MultiQuote",function(){$.get("post.php?action=quote&fid="+a+"&tid="+n+"&pid="+o.pid+"&article="+o.floor+"&t="+(new Date).getTime(),function(e){var n=/<textarea id="textarea".*?>((.|\n)+?)<\/textarea>/i.exec(e);n&&(C+=d.removeUnpairedBBCodeContent(d.htmlDecode(n[1]).replace(/\n{2,}/g,"\n"))+(t===i.length-1?"":"\n"));var a=$(".pd_countdown:last");a.text(parseInt(a.text())-1),t===i.length-1?(p.destroy(),$("#textarea").val(C).focus(),w.trigger("change")):setTimeout(function(){$(document).dequeue("MultiQuote")},100)})}):C+="[quote]回 "+o.floor+"楼("+o.userName+") 的帖子[/quote]\n")}),w.val([].concat(o(k)).join(",")),$('form[name="FORM"]').submit(function(){localStorage.removeItem(f.default.multiQuoteStorageName)}),2===e?$(document).dequeue("MultiQuote"):($('[name="atc_content"]').val(C).focus(),w.trigger("change")),g.runFunc("Post.handleMultiQuote_after_",e)}}}},n.removeUnpairedBBCodeInQuoteContent=function(){var e=$("#textarea"),t=e.val(),n=/\[quote\](.|\r|\n)+?\[\/quote\]/.exec(t);if(n){var a=d.removeUnpairedBBCodeContent(n[0]);n[0]!==a&&e.val(t.replace(n[0],a))}},n.addExtraPostEditorButton=function(){var e=$("#textarea").get(0);e&&$('\n<span id="wy_post" title="插入隐藏内容" data-type="hide" style="background-position: 0 -280px;">插入隐藏内容</span>\n<span id="wy_justifyleft" title="左对齐" data-type="left" style="background-position: 0 -360px;">左对齐</span>\n<span id="wy_justifycenter" title="居中" data-type="center" style="background-position: 0 -380px;">居中</span>\n<span id="wy_justifyright" title="右对齐" data-type="right" style="background-position: 0 -400px;">右对齐</span>\n<span id="wy_subscript" title="下标" data-type="sub" style="background-position: 0 -80px;">下标</span>\n<span id="wy_superscript" title="上标" data-type="sup" style="background-position: 0 -100px;">上标</span>\n<span class="pd_editor_btn" title="插入飞行文字" data-type="fly">F</span>\n<span class="pd_editor_btn" title="插入HTML5音频" data-type="audio">A</span>\n<span class="pd_editor_btn" title="插入HTML5视频" data-type="video">V</span>\n').appendTo("#editor-button .editor-button").click(function(){var t=$(this),n=t.data("type"),a="";switch(n){case"hide":a=prompt("请输入神秘等级：",5);break;case"audio":a=prompt("请输入HTML5音频实际地址：\n（可直接输入网易云音乐的单曲地址，将自动转换为外链地址）","http://");var i=/^https?:\/\/music\.163\.com\/(?:#\/)?song\?id=(\d+)/i.exec(a);i&&(a="http://music.miaola.info/163/"+i[1]+".mp3"),i=/^https?:\/\/www\.xiami\.com\/song\/(\w+)/i.exec(a),i&&(a="http://music.miaola.info/xiami/"+i[1]+".mp3");break;case"video":a=prompt("请输入HTML5视频实际地址：\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）","http://");var o=/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w\-]+)/i.exec(a);o&&(a="http://video.miaola.info/youtube/"+o[1]),o=/^https?:\/\/youtu\.be\/([\w\-]+)$/i.exec(a),o&&(a="http://video.miaola.info/youtube/"+o[1])}if(null!==a){var r="",l="";switch(n){case"hide":r=d.getSelText(e),l="[hide="+a+"]"+r+"[/hide]";break;case"left":r=d.getSelText(e),l="[align=left]"+r+"[/align]";break;case"center":r=d.getSelText(e),l="[align=center]"+r+"[/align]";break;case"right":r=d.getSelText(e),l="[align=right]"+r+"[/align]";break;case"fly":r=d.getSelText(e),l="[fly]"+r+"[/fly]";break;case"sub":r=d.getSelText(e),l="[sub]"+r+"[/sub]";break;case"sup":r=d.getSelText(e),l="[sup]"+r+"[/sup]";break;case"audio":l="[audio]"+a+"[/audio]";break;case"video":l="[video]"+a+"[/video]"}l&&(d.addCode(e,l,r),e.focus())}}).mouseenter(function(){$(this).addClass("buttonHover")}).mouseleave(function(){$(this).removeClass("buttonHover")})},n.addExtraOptionInPostPage=function(){$('\n<div class="pd_post_extra_option">\n  <label><input type="checkbox" name="autoAnalyzeUrl" checked> 自动分析url</label><br>\n  <label><input type="checkbox" name="windCodeAutoConvert" checked> Wind Code自动转换</label>\n</div>\n').appendTo($("#menu_show").closest("td")).on("click",'[type="checkbox"]',function(){var e=$(this),t=e.is('[name="autoAnalyzeUrl"]')?"atc_autourl":"atc_convert";$('form[name="FORM"]').find('[name="'+t+'"]').val(e.prop("checked")?1:0)}),$('<input type="button" value="预览帖子" style="margin-left: 7px;">').insertAfter('[type="submit"][name="Submit"]').click(function(e){e.preventDefault();var t=$('form[name="preview"]');t.find('input[name="atc_content"]').val($("#textarea").val()),t.submit()})},n.modifyPostPreviewPage=function(){$("table > tbody > tr.tr1 > th").css({"text-align":"left","font-weight":"normal",border:"1px solid #9191ff",padding:"10px"})
},n.addAttachChangeAlert=function(){$(document).on("click",'.abtn[id^="md_"]',function(){$(document).data("attachUpdateAlert")||(alert("本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果"),$(document).data("attachUpdateAlert",!0))})},n.importKfSmileEnhanceExtension=function(){var e=document.createElement("script");e.type="text/javascript",e.charset="utf-8",e.src="https://kf.miaola.info/KfEmotion.min.user.js"+(void 0!==l.default.w.resTimestamp?"?ts="+l.default.w.resTimestamp:""),document.body.appendChild(e)},n.preventCloseWindowWhenEditPost=function(){window.addEventListener("beforeunload",function(e){var t=$("/post.php"===location.pathname?"#textarea":'[name="atc_content"]'),n=t.val();if(n&&n!==t.get(0).defaultValue&&!/\[\/quote]\n*$/.test(n)&&!l.default.w.isSubmit){var a="你可能正在撰写发帖内容中，确定要关闭页面吗？";return e.returnValue=a,a}}),$('form[action="post.php?"]').submit(function(){l.default.w.isSubmit=!0})},n.savePostContentWhenSubmit=function(){var e=$("/post.php"===location.pathname?"#textarea":'[name="atc_content"]');$('form[action="post.php?"]').submit(function(){var t=e.val();$.trim(t).length>0&&sessionStorage.setItem(f.default.postContentStorageName,t)});var t=sessionStorage.getItem(f.default.postContentStorageName);t&&$('\n<div style="padding: 0 10px; line-height: 2em; text-align: left; background-color: #fefee9; border: 1px solid #99f;">\n  <a class="pd_btn_link" data-name="restore" href="#">[恢复上次提交的内容]</a>\n  <a class="pd_btn_link" data-name="clear" href="#">[清除]</a>\n</div>\n').insertBefore(e).find('[data-name="restore"]').click(function(n){n.preventDefault(),e.val(t),$(this).parent().find('[data-name="clear"]').click()}).end().find('[data-name="clear"]').click(function(e){e.preventDefault(),sessionStorage.removeItem(f.default.postContentStorageName),$(this).parent().remove()})},n.addRedundantKeywordWarning=function(){$('input[name="diy_guanjianci"]').change(function(){var e=$(this);$.trim(e.val()).split(",").filter(function(e){return e}).length>5&&(alert("所填关键词已超过5个，多余的关键词将被忽略"),e.select().focus())})}},{"./Const":7,"./Info":10,"./Msg":16,"./Script":21,"./Util":23}],19:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNextObjects=exports.addSimulateManualActionChecked=exports.changeNewRateTipsColor=exports.showCommonImportOrExportConfigDialog=exports.checkRatingSize=exports.turnPageViaKeyboard=exports.repairBbsErrorCode=exports.addSearchDialogLink=exports.makeSearchByBelowTwoKeyWordAvailable=exports.bindSearchTypeSelectMenuClick=exports.bindElementTitleClick=exports.showElementTitleTips=exports.changeIdColor=exports.autoSaveCurrentDeposit=exports.addFastNavMenu=exports.modifySideBar=exports.blockThread=exports.blockUsers=exports.followUsers=exports.getDailyBonus=exports.startTimingMode=exports.getNextTimingIntervalInfo=exports.addPolyfill=exports.showFormatLog=exports.preventCloseWindowWhenActioning=exports.addConfigAndLogDialogLink=exports.appendCss=exports.checkBrowserType=exports.getSafeId=exports.getUidAndUserName=void 0;var _slicedToArray=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Msg=require("./Msg"),Msg=_interopRequireWildcard(_Msg),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Config=require("./Config"),_ConfigDialog=require("./ConfigDialog"),_Log=require("./Log"),Log=_interopRequireWildcard(_Log),_LogDialog=require("./LogDialog"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_Script=require("./Script"),Script=_interopRequireWildcard(_Script),_Read=require("./Read"),Read=_interopRequireWildcard(_Read),_Loot=require("./Loot"),Loot=_interopRequireWildcard(_Loot),getUidAndUserName=exports.getUidAndUserName=function(){var e=$('.topmenuo1 > .topmenuo3:last-child > a[href="javascript:;"]').eq(0),t=$('.topmenuo1 > .topmenuo3:last-child a[href^="profile.php?action=show&uid="]').eq(0);if(!e.length||!t.length)return!1;if(e.attr("id","pdUserName"),_Info2.default.userName=$.trim(e.contents().get(0).textContent),!_Info2.default.userName)return!1;var n=/&uid=(\d+)/.exec(t.attr("href"));return!!n&&(_Info2.default.uid=parseInt(n[1]),!0)},getSafeId=exports.getSafeId=function(){var e=$("input#safeid").val();if(!e){var t=/safeid=(\w+)/i.exec($('a[href*="safeid="]:first').attr("href"));t&&(e=t[1])}return e?e:""},checkBrowserType=exports.checkBrowserType=function(){"auto"===Config.browseType?_Info2.default.isMobile=/(Mobile|MIDP)/i.test(navigator.userAgent):_Info2.default.isMobile="mobile"===Config.browseType},appendCss=exports.appendCss=function(){$("head").append('\n<style>\n  /* 公共 */\n  .pd_highlight { color: #f00 !important; }\n  .pd_notice, .pd_msg .pd_notice { font-style: italic; color: #666; }\n  .pd_input, .pd_cfg_main input, .pd_cfg_main select {\n    vertical-align: middle; height: auto; margin-right: 0; line-height: 22px; font-size: 12px;\n  }\n  .pd_input[type="text"], .pd_input[type="number"], .pd_cfg_main input[type="text"], .pd_cfg_main input[type="number"] {\n    height: 22px; line-height: 22px;\n  }\n  .pd_input:focus, .pd_cfg_main input[type="text"]:focus, .pd_cfg_main input[type="number"]:focus, .pd_cfg_main textarea:focus,\n      .pd_textarea:focus { border-color: #7eb4ea; }\n  .pd_textarea, .pd_cfg_main textarea { border: 1px solid #ccc; font-size: 12px; }\n  .pd_btn_link { margin-left: 4px; margin-right: 4px; }\n  .pd_custom_tips { cursor: help; }\n  .pd_disabled_link { color: #999 !important; text-decoration: none !important; cursor: default; }\n  hr {\n    box-sizing: content-box; height: 0; margin-top: 7px; margin-bottom: 7px; border: 0;\n    border-top: 1px solid rgba(0, 0, 0, .2); overflow: visible;\n  }\n  .pd_overflow { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n  .pd_hide { width: 0 !important; height: 0 !important; font: 0/0 a; color: transparent; background-color: transparent; border: 0 !important; }\n  .pd_stat i { display: inline-block; font-style: normal; margin-right: 3px; }\n  .pd_stat_extra em, .pd_stat_extra ins { padding: 0 2px; cursor: help; }\n  .pd_panel { position: absolute; overflow-y: auto; background-color: #fff; border: 1px solid #9191ff; opacity: 0.9; }\n  .pd_title_tips {\n    position: absolute; max-width: 470px; font-size: 12px; line-height: 1.5em;\n    padding: 2px 5px; background-color: #fcfcfc; border: 1px solid #767676; z-index: 9999;\n  }\n  .pd_search_type {\n    float: left; height: 26px; line-height: 26px; width: 65px; text-align: center; border: 1px solid #ccc; border-left: none; cursor: pointer;\n  }\n  .pd_search_type i { font-style: normal; margin-left: 5px; font-family: sans-serif; }\n  .pd_search_type_list {\n    position: absolute; width: 63px; background-color: #fcfcfc; border: 1px solid #ccc; border-top: none; line-height: 26px;\n    text-indent: 13px; cursor: pointer; z-index: 1003;\n  }\n  .pd_search_type_list li:hover { color: #fff; background-color: #87c3cf; }\n  '+(_Info2.default.isMobile?".topmenu { position: static; }":"")+"\n  "+(_Info2.default.isMobile?".r_cmenu { position: static !important; }":"")+"\n  .topmenu { z-index: 1; }\n  \n  /* 消息框 */\n  .pd_mask { position: fixed; width: 100%; height: 100%; left: 0; top: 0; z-index: 1001; }\n  .pd_msg_container { position: "+(_Info2.default.isMobile?"absolute":"fixed")+'; width: 100%; z-index: 1002; }\n  .pd_msg {\n    border: 1px solid #6ca7c0; text-shadow: 0 0 3px rgba(0, 0, 0, 0.1); border-radius: 3px; padding: 10px 40px; text-align: center;\n    font-size: 14px; position: absolute; display: none; color: #333; line-height: 1.6em; background: #f8fcfe; background-repeat: no-repeat;\n    background-image: -webkit-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -moz-linear-gradient(top, #f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -o-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -ms-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n  }\n  .pd_msg strong { margin-right: 5px; }\n  .pd_msg i { font-style: normal; padding-left: 10px; }\n  .pd_msg em, .pd_stat em, .pd_msg ins, .pd_stat ins { font-weight: 700; font-style: normal; color:#ff6600; padding: 0 3px; }\n  .pd_msg ins, .pd_stat ins { text-decoration: none; color: #339933; }\n  .pd_msg a { font-weight: bold; margin-left: 15px; }\n  \n  /* 帖子页面 */\n  .readlou .pd_goto_link { color: #000; }\n  .readlou .pd_goto_link:hover { color: #51d; }\n  .pd_fast_goto_floor, .pd_multi_quote_chk { margin-right: 2px; }\n  .pd_user_memo { font-size: 12px; color: #999; line-height: 14px; }\n  .pd_user_memo_tips { font-size: 12px; color: #fff; margin-left: 3px; cursor: help; }\n  .pd_user_memo_tips:hover { color: #ddd; }\n  .readtext img[onclick] { max-width: 550px; }\n  .read_fds { text-align: left !important; font-weight: normal !important; font-style: normal !important; }\n  .pd_code_area { max-height: 550px; overflow-y: auto; font-size: 12px; font-family: Consolas, "Courier New"; }\n  \n  /* 道具页面 */\n  .pd_item_btns { text-align: right; margin-top: 5px;  }\n  .pd_item_btns button, .pd_item_btns input { margin-bottom: 2px; vertical-align: middle; }\n  .pd_items > tbody > tr > td > a + a { margin-left: 15px; }\n  .pd_result { border: 1px solid #99f; padding: 5px; margin-top: 10px; line-height: 2em; }\n  .pd_result_sep { border-bottom: 1px solid #999; margin: 7px 0; }\n  .pd_result_sep_inner { border-bottom: 1px dashed #999; margin: 5px 0; }\n  .pd_usable_num { color: #669933; }\n  .pd_used_num { color: #ff0033; }\n  .pd_used_item_info { color: #666; float: right; cursor: help; margin-right: 5px; }\n  .pd_item_type_chk { margin-right: 5px; }\n  \n  /* 发帖页面 */\n  #pdSmilePanel img { margin: 3px; cursor: pointer; }\n  .editor-button .pd_editor_btn { background: none; text-indent: 0; line-height: 18px; cursor: default; }\n  .pd_post_extra_option { text-align: left; margin-top: 5px; margin-left: 5px; }\n  .pd_post_extra_option input { vertical-align: middle; height: auto; margin-right: 0; }\n  \n  /* 其它页面 */\n  .pd_thread_page { margin-left: 5px; }\n  .pd_thread_page a { color: #444; padding: 0 3px; }\n  .pd_thread_page a:hover { color: #51d; }\n  .pd_card_chk { position: absolute; bottom: -8px; left: 1px; }\n  .b_tit4 .pd_thread_goto, .b_tit4_1 .pd_thread_goto { position: absolute; top: 0; right: 0; padding: 0 15px; }\n  .b_tit4 .pd_thread_goto:hover, .b_tit4_1 .pd_thread_goto:hover { padding-left: 15px; }\n  .pd_id_color_select > td { position: relative; cursor: pointer; }\n  .pd_id_color_select > td > input { position: absolute; top: 18px; left: 10px; }\n  .pd_property_diff { position: absolute; top: 0px; right: 28px; }\n  .pd_property_diff em { font-style: normal; }\n\n  /* 设置对话框 */\n  .pd_cfg_ml { margin-left: 10px; }\n  .pd_cfg_box {\n    position: '+(_Info2.default.isMobile?"absolute":"fixed")+'; border: 1px solid #9191ff; display: none; z-index: 1000;\n    -webkit-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); -moz-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);\n    -o-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);\n  }\n  .pd_cfg_box h1 {\n    text-align: center; font-size: 14px; background-color: #9191ff; color: #fff; line-height: 2em; margin: 0; padding-left: 20px;\n  }\n  .pd_cfg_box h1 span { float: right; cursor: pointer; padding: 0 10px; }\n  .pd_cfg_nav { text-align: right; margin-top: 5px; margin-bottom: -5px; }\n  .pd_cfg_main { background-color: #fcfcfc; padding: 0 10px; font-size: 12px; line-height: 24px; min-height: 50px; overflow: auto; }\n  .pd_cfg_main fieldset { border: 1px solid #ccccff; padding: 0 6px 6px; }\n  .pd_cfg_main legend { font-weight: bold; }\n  .pd_cfg_main input[type="color"] { height: 18px; width: 30px; padding: 0; }\n  .pd_cfg_main button { vertical-align: middle; }\n  .pd_cfg_tips { color: #51d; text-decoration: none; cursor: help; }\n  .pd_cfg_tips:hover { color: #ff0000; }\n  #pdConfigDialog .pd_cfg_main { overflow-x: hidden; white-space: nowrap; }\n  .pd_cfg_panel { display: inline-block; width: 400px; vertical-align: top; }\n  .pd_cfg_panel + .pd_cfg_panel { margin-left: 5px; }\n  .pd_cfg_btns { background-color: #fcfcfc; text-align: right; padding: 5px; }\n  .pd_cfg_btns button { min-width: 80px; }\n  .pd_cfg_about { float: left; line-height: 24px; margin-left: 5px; }\n  .pd_custom_script_header { margin: 7px 0; padding: 5px; background-color: #e8e8e8; border-radius: 5px; }\n  .pd_custom_script_content { display: none; width: 750px; height: 350px; white-space: pre; }\n\n  /* 日志对话框 */\n  .pd_log_nav { text-align: center; margin: -5px 0 -12px; font-size: 14px; line-height: 44px; }\n  .pd_log_nav a { display: inline-block; }\n  .pd_log_nav h2 { display: inline; font-size: 14px; margin-left: 7px; margin-right: 7px; }\n  .pd_log_content { height: 242px; overflow: auto; }\n  .pd_log_content h3 { display: inline-block; font-size: 12px; line-height: 22px; margin: 0; }\n  .pd_log_content h3:not(:first-child) { margin-top: 5px; }\n  .pd_log_content p { line-height: 22px; margin: 0; }\n</style>\n'),Config.customCssEnabled&&$("head").append("<style>"+Config.customCssContent+"</style>")},addConfigAndLogDialogLink=exports.addConfigAndLogDialogLink=function(){$('\n<li><a data-name="openConfigDialog" href="#">助手设置</a></li>\n<li><a data-name="openLogDialog" href="#">助手日志</a></li>\n').insertBefore(_Info2.default.$userMenu.find("> li:nth-last-child(1)")).find('[data-name="openConfigDialog"]').click(function(e){e.preventDefault(),(0,_ConfigDialog.show)()}).end().find('[data-name="openLogDialog"]').click(function(e){e.preventDefault(),(0,_LogDialog.show)()})},preventCloseWindowWhenActioning=exports.preventCloseWindowWhenActioning=function(e){if($(".pd_mask").length>0){var t="操作正在进行中，确定要关闭页面吗？";return e.returnValue=t,t}},showFormatLog=exports.showFormatLog=function(e,t){var n=Util.getResponseMsg(t),a=n.msg,i=n.url;console.log("【"+e+"】回应："+a+(i?"；跳转地址："+Util.getHostNameUrl()+i:""))},addPolyfill=exports.addPolyfill=function(){Array.prototype.includes||(Array.prototype.includes=function(e){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),n=parseInt(t.length)||0;if(0===n)return!1;var a=parseInt(arguments[1])||0,i=void 0;a>=0?i=a:(i=n+a)<0&&(i=0);for(var o=void 0;i<n;){if(o=t[i],e===o||e!==e&&o!==o)return!0;i++}return!1}),String.prototype.padStart||(String.prototype.padStart=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",n=Object(this),a=String(n),i=parseInt(e)||0,o=parseInt(a.length)||0;if(i<=o)return a;var r=void 0===t?" ":String(t);if(""===r)return a;for(var l=i-o;r.length<l;){var s=r.length,d=l-s;r+=s>d?r.slice(0,d):r}return r.slice(0,l)+a}),String.prototype.padEnd||(String.prototype.padEnd=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",n=Object(this),a=String(n),i=parseInt(e)||0,o=parseInt(a.length)||0;if(i<=o)return a;var r=void 0===t?" ":String(t);if(""===r)return a;for(var l=i-o;r.length<l;){var s=r.length,d=l-s;r+=s>d?r.slice(0,d):r}return a+r.slice(0,l)})},getNextTimingIntervalInfo=exports.getNextTimingIntervalInfo=function(){var e=-1;if(Config.autoPromoteHaloEnabled){var t=parseInt(Util.getCookie(_Const2.default.promoteHaloCookieName));e=t>0?Math.floor((t-(new Date).getTime())/1e3):0}var n=-1;if(Config.autoLootEnabled||Config.autoSaveLootLogInSpecialCaseEnabled){var a=parseInt(Util.getCookie(_Const2.default.lootCompleteCookieName));if(a<0)n=60*_Const2.default.checkLootInterval;else{var i=Util.getDateByTime(Config.checkLootAfterTime),o=new Date;a>0&&o>i&&i.setDate(i.getDate()+1),n=Math.floor((i-o)/1e3),n<0&&(n=0)}if(Util.getCookie(_Const2.default.lootAttackingCookieName))n=60*_Const2.default.lootAttackingExpires;else{var r=Util.getCookie(_Const2.default.changePointsInfoCookieName);r=$.isNumeric(r)?parseInt(r):0,r>0&&(n=Math.floor((r-(new Date).getTime())/1e3))}}var l=-1;if(Config.autoGetDailyBonusEnabled){var s=parseInt(Util.getCookie(_Const2.default.getDailyBonusCookieName));if(s>0){var d=Util.getTimezoneDateByTime(_Const2.default.getDailyBonusAfterTime);d.setDate(d.getDate()+1);var c=new Date;c>d&&d.setDate(d.getDate()+1),l=Math.floor((d-c)/1e3)}else l=s<0?60*_Const2.default.getDailyBonusSpecialInterval:0}var p=[{action:"提升战力光环",interval:e},{action:"检查争夺情况",interval:n},{action:"自动获取每日奖励",interval:l}],u="",f=-1,m=!0,g=!1,h=void 0;try{for(var v,b=p.filter(function(e){return e.interval>-1})[Symbol.iterator]();!(m=(v=b.next()).done);m=!0){var y=v.value,_=y.action,x=y.interval;(f<0||x<f)&&(u=_,f=x)}}catch(e){g=!0,h=e}finally{try{!m&&b.return&&b.return()}finally{if(g)throw h}}return{action:f>0?u:"",interval:f}},startTimingMode=exports.startTimingMode=function(){var e=getNextTimingIntervalInfo(),t=e.action,n=e.interval;if(n!==-1){var a=document.title,i=null,o=-1,r=0,l=function(e,t){var n=Util.getTimeDiffInfo(Util.getDate("+"+t+"s").getTime()),a=n.hours>0?n.hours+"时":"";return a+=1===e?(n.minutes>0?n.minutes+"分":"")+n.seconds+"秒":n.minutes+"分"},s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i&&window.clearInterval(i);var o=e;if(console.log("【定时模式】倒计时"+(t?"("+t+")":"")+"："+l(1,o)),"never"!==Config.showTimingModeTipsType.toLowerCase()){var r=function(){document.title=a+" (定时: "+l(e<60?1:2,o)+")",o=e<60?o-1:o-60};n||"always"===Config.showTimingModeTipsType.toLowerCase()||e<60?r():o=e<60?o-1:o-60,i=setInterval(r,60*_Const2.default.showRefreshModeTipsInterval*1e3)}},d=function e(){var t=0,n="";$.ajax({type:"GET",url:"index.php?t="+(new Date).getTime(),timeout:_Const2.default.defAjaxTimeout,success:function(e){/"kf_fw_ig_index.php"/.test(e)||(t=10,n="论坛维护或其它未知情况")},error:function(){t=_Const2.default.errorRefreshInterval,n="连接超时"},complete:function(){t>0?(console.log("定时操作失败（原因："+n+"），将在"+t+"分钟后重试..."),Msg.remove($(".pd_refresh_notice").parent()),Msg.show('<strong class="pd_refresh_notice">定时操作失败（原因：'+n+"），将在<em>"+t+"</em>分钟后重试&hellip;</strong>",-1),setTimeout(e,60*t*1e3),s(60*t,"",!0)):r>6?(r=0,t=15,setTimeout(c,60*t*1e3),s(60*t,"",!0)):(r++,c())}})},c=function e(){Msg.remove($(".pd_refresh_notice").parent());var t=!1;Config.autoPromoteHaloEnabled&&!Util.getCookie(_Const2.default.promoteHaloCookieName)&&(t=!0,Loot.getPromoteHaloInfo()),Util.getCookie(_Const2.default.lootCompleteCookieName)||(Config.autoLootEnabled&&!t?Util.getCookie(_Const2.default.lootAttackingCookieName)||$.isNumeric(Util.getCookie(_Const2.default.changePointsInfoCookieName))||Loot.checkLoot():Config.autoSaveLootLogInSpecialCaseEnabled&&Loot.autoSaveLootLog()),Config.autoGetDailyBonusEnabled&&!Util.getCookie(_Const2.default.getDailyBonusCookieName)&&getDailyBonus();var n=getNextTimingIntervalInfo(),a=n.action,l=n.interval;return l>0&&(r=0),0===l&&0===o?(o=-1,void d()):(o=l,l===-1?void(i&&clearInterval(i)):(0===l&&(l=_Const2.default.actionFinishRetryInterval),setTimeout(e,1e3*l),void s(l,a,!0)))};setTimeout(c,n<60?6e4:1e3*n),s(n<60?60:n,t)}},getDailyBonus=exports.getDailyBonus=function e(){Script.runFunc("Public.getDailyBonus_before_"),console.log("领取每日奖励Start");var t=Msg.wait("<strong>正在领取每日奖励，请稍候&hellip;</strong>"),n=function(){var e=Util.getTimezoneDateByTime(_Const2.default.getDailyBonusAfterTime);return e.setDate(e.getDate()+1),new Date>e&&e.setDate(e.getDate()+1),e};$.ajax({type:"GET",url:"kf_growup.php?t="+(new Date).getTime(),timeout:_Const2.default.defAjaxTimeout}).done(function(e){var a=/<a href="(kf_growup\.php\?ok=3&safeid=\w+)" target="_self">你可以领取\s*(\d+)KFB\s*\+\s*(\d+)经验\s*\+\s*(\d+(?:\.\d+)?)贡献\s*\+\s*(\d+)转账额度/.exec(e);if(a){if(Config.getBonusAfterLootCompleteEnabled&&!/<div class="gro_divlv">\r\n争夺奖励/.test(e))return Util.setCookie(_Const2.default.getDailyBonusCookieName,-1,Util.getDate("+"+_Const2.default.getDailyBonusSpecialInterval+"m")),void Msg.remove(t);if(Config.getBonusAfterSpeakCompleteEnabled&&!/<div class="gro_divlv">\r\n发言奖励/.test(e))return Util.setCookie(_Const2.default.getDailyBonusCookieName,-1,Util.getDate("+"+_Const2.default.getDailyBonusSpecialInterval+"m")),void Msg.remove(t);var i=a[1],o={};parseInt(a[2])>0&&(o.KFB=parseInt(a[2])),parseInt(a[3])>0&&(o["经验值"]=parseInt(a[3])),parseFloat(a[4])>0&&(o["贡献"]=parseFloat(a[4])),parseInt(a[5])>0&&(o["转账额度"]=parseInt(a[5])),$.get(i+"&t="+(new Date).getTime(),function(e){Util.setCookie(_Const2.default.getDailyBonusCookieName,1,n()),showFormatLog("领取每日奖励",e);var a=Util.getResponseMsg(e),i=a.msg;if(Msg.remove(t),/领取成功/.test(i)){var r="",l="",s=!0,d=!1,c=void 0;try{for(var p,u=Util.entries(o)[Symbol.iterator]();!(s=(p=u.next()).done);s=!0){var f=_slicedToArray(p.value,2),m=f[0],g=f[1];r+=m+"+"+g+" ",l+="<i>"+m+"<em>+"+g.toLocaleString()+"</em></i>"}}catch(e){d=!0,c=e}finally{try{!s&&u.return&&u.return()}finally{if(d)throw c}}console.log("领取每日奖励，"+r),Msg.show("<strong>领取每日奖励</strong>"+l,-1),$.isEmptyObject(o)||Log.push("领取每日奖励","领取每日奖励",{gain:o}),Config.promoteHaloLimit>0&&Util.deleteCookie(_Const2.default.promoteHaloCookieName)}Script.runFunc("Public.getDailyBonus_after_",i)}).fail(function(){return Msg.remove(t)})}else Msg.remove(t),Util.setCookie(_Const2.default.getDailyBonusCookieName,1,n())}).fail(function(){Msg.remove(t),setTimeout(e,_Const2.default.defAjaxInterval)})},followUsers=exports.followUsers=function(){Config.followUserList.length&&(_Info2.default.isInHomePage&&Config.highlightFollowUserThreadInHPEnabled?$(".b_tit4 > a, .b_tit4_1 > a").each(function(){var e=$(this),t=/》by：(.+)/.exec(e.attr("title"));t&&Util.inFollowOrBlockUserList(t[1],Config.followUserList)>-1&&e.addClass("pd_highlight")}):"/thread.php"===location.pathname?$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&(e.addClass("pd_highlight"),Config.highlightFollowUserThreadLinkEnabled&&e.parent("td").prev("td").prev("td").find('div > a[href^="read.php?tid="]').addClass("pd_highlight"))}):"/read.php"===location.pathname?$(".readidmsbottom > a, .readidmleft > a").each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.closest(".readtext").prev("div").prev(".readlou").find("div:nth-child(2) > span:first-child").find("a").addBack().addClass("pd_highlight")}):"/guanjianci.php"===location.pathname||"/kf_share.php"===location.pathname?$(".kf_share1 > tbody > tr > td:last-child").each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.addClass("pd_highlight")}):"/search.php"===location.pathname&&$('.thread1 a[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.addClass("pd_highlight")}))},blockUsers=exports.blockUsers=function(){if(Config.blockUserList.length){var e=0;if(_Info2.default.isInHomePage)$(".b_tit4 > a, .b_tit4_1 > a").each(function(){var t=$(this),n=/》by：(.+)/.exec(t.attr("title"));if(n){var a=Util.inFollowOrBlockUserList(n[1],Config.blockUserList);a>-1&&Config.blockUserList[a].type<2&&(e++,t.parent("li").remove())}});else if("/thread.php"===location.pathname){var t=parseInt($('input[name="f_fid"]:first').val());if(!t)return;if(1===Config.blockUserForumType&&!Config.blockUserFidList.includes(t))return;if(2===Config.blockUserForumType&&Config.blockUserFidList.includes(t))return;$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var t=$(this),n=Util.inFollowOrBlockUserList(t.text(),Config.blockUserList);n>-1&&Config.blockUserList[n].type<2&&(e++,t.closest("tr").remove())})}else if("/read.php"===location.pathname){if(Config.blockUserForumType>0){var n=parseInt($('input[name="fid"]:first').val());if(!n)return;if(1===Config.blockUserForumType&&!Config.blockUserFidList.includes(n))return;if(2===Config.blockUserForumType&&Config.blockUserFidList.includes(n))return}var a=Util.getCurrentThreadPage();$(".readidmsbottom > a, .readidmleft > a").each(function(t){var n=$(this),i=Util.inFollowOrBlockUserList(n.text(),Config.blockUserList);if(i>-1){var o=Config.blockUserList[i].type;if(0===t&&1===a&&o>1)return;if((0===t&&1!==a||t>0)&&1===o)return;e++;var r=n.closest(".readtext");r.prev("div").prev(".readlou").remove(),r.prev("div").remove(),r.next(".readlou").remove(),r.remove()}}),$('.readtext fieldset:has(legend:contains("Quote:"))').each(function(){var e=$(this),t=e.text(),n=!0,a=!1,i=void 0;try{for(var o,r=Config.blockUserList[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;if(1!==l.type)try{var s=new RegExp("^Quote:引用(第\\d+楼|楼主)"+l.name+"于","i"),d=new RegExp("^Quote:回\\s*\\d+楼\\("+l.name+"\\)\\s*的帖子","i");(s.test(t)||d.test(t))&&e.html('<legend>Quote:</legend><mark class="pd_custom_tips" title="被屏蔽用户：'+l.name+'">该用户已被屏蔽</mark>')}catch(e){}}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}})}else"/guanjianci.php"===location.pathname&&Config.blockUserAtTipsEnabled&&$(".kf_share1 > tbody > tr > td:last-child").each(function(){var t=$(this);Util.inFollowOrBlockUserList(t.text(),Config.blockUserList)>-1&&(e++,t.closest("tr").remove())});e>0&&console.log("【屏蔽用户】共有"+e+"个帖子或回复被屏蔽")}},blockThread=exports.blockThread=function blockThread(){if(Config.blockThreadList.length){var isBlock=function isBlock(title,userName){var fid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _iterator4=Config.blockThreadList[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var _step4$value=_step4.value,keyWord=_step4$value.keyWord,includeUser=_step4$value.includeUser,excludeUser=_step4$value.excludeUser,includeFid=_step4$value.includeFid,excludeFid=_step4$value.excludeFid,regex=null;if(/^\/.+\/[gimuy]*$/.test(keyWord))try{regex=eval(keyWord)}catch(e){console.log(e);continue}if(userName)if(includeUser){if(!includeUser.includes(userName))continue}else if(excludeUser&&excludeUser.includes(userName))continue;if(fid)if(includeFid){if(!includeFid.includes(fid))continue}else if(excludeFid&&excludeFid.includes(fid))continue;if(regex){if(regex.test(title))return!0}else if(title.toLowerCase().includes(keyWord.toLowerCase()))return!0}}catch(e){_didIteratorError4=!0,_iteratorError4=e}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}return!1},num=0;if(_Info2.default.isInHomePage)$(".b_tit4 a, .b_tit4_1 a").each(function(){var e=$(this),t=e.attr("title");if(t){var n=/^《(.+)》by：(.+)$/.exec(t);n&&isBlock(n[1],n[2])&&(num++,e.parent("li").remove())}});else if("/thread.php"===location.pathname){var fid=parseInt($('input[name="f_fid"]:first').val());if(!fid)return;$('.threadtit1 a[href^="read.php"]').each(function(){var e=$(this);isBlock(e.text(),e.closest("tr").find("td:last-child > a.bl").text(),fid)&&(num++,e.closest("tr").remove())})}else if("/read.php"===location.pathname){if(1!==Util.getCurrentThreadPage())return;var title=Read.getThreadTitle();if(!title)return;var $userName=$(".readidmsbottom > a, .readidmleft > a").eq(0);if("楼主"!==$userName.closest(".readtext").prev("div").prev(".readlou").find("div:nth-child(2) > span:first-child").text().trim())return;var userName=$userName.text();if(!userName)return;var _fid2=parseInt($('input[name="fid"]:first').val());if(!_fid2)return;if(isBlock(title,userName,_fid2)){num++;var $lou=$userName.closest(".readtext");$lou.prev("div").prev(".readlou").remove(),$lou.prev("div").remove(),$lou.next(".readlou").remove(),$lou.remove()}}num>0&&console.log("【屏蔽帖子】共有"+num+"个帖子被屏蔽")}},modifySideBar=exports.modifySideBar=function(){$("#r_menu").replaceWith('\n<div id="r_menu" style="width: 140px; color: #9999ff; font-size: 14px; line-height: 24px; text-align: center; border: 1px #ddddff solid; padding: 5px; overflow: hidden;">\n  <span style="color: #ff9999;">游戏</span><br>\n  <a href="thread.php?fid=102">游戏推荐</a> | <a href="thread.php?fid=106">新作动态</a><br>\n  <a href="thread.php?fid=52">游戏讨论</a> | <a href="thread.php?fid=24">疑难互助</a><br>\n  <a href="thread.php?fid=16">种子下载</a> | <a href="thread.php?fid=41">网盘下载</a><br>\n  <a href="thread.php?fid=67">图片共享</a> | <a href="thread.php?fid=57">同人漫本</a><br>\n  <span style="color: #ff9999;">动漫音乐</span><br>\n  <a href="thread.php?fid=84">动漫讨论</a> | <a href="thread.php?fid=92">动画共享</a><br>\n  <a href="thread.php?fid=127">漫画小说</a> | <a href="thread.php?fid=68">音乐共享</a><br>\n  <a href="thread.php?fid=163">LIVE共享</a>  | <a href="thread.php?fid=182">转载资源</a><br>\n  <span style="color: #ff9999;">综合</span><br>\n  <a href="thread.php?fid=94">原创美图</a> | <a href="thread.php?fid=87">宅物交流</a><br>\n  <a href="thread.php?fid=86">电子产品</a> | <a href="thread.php?fid=115">文字作品</a><br>\n  <a href="thread.php?fid=96">出处讨论</a>  | <a href="thread.php?fid=36">寻求资源</a><br>\n  <span style="color: #ff9999;">交流</span><br>\n  <a href="thread.php?fid=5">自由讨论</a> | <a href="thread.php?fid=56">个人日记</a><br>\n  <a href="thread.php?fid=98">日本语版</a>  | <a href="thread.php?fid=9">我的关注</a><br>\n  <a href="thread.php?fid=4">站务管理</a><br>\n  <span style="color: #ff9999;">专用</span><br>\n  <a href="thread.php?fid=93">管理组区</a> | <a href="thread.php?fid=59">原创组区</a><br>\n  <a href="/">论坛首页</a><br>\n</div>\n')},addFastNavMenu=exports.addFastNavMenu=function(){var e=$('.topmenuo1 > .topmenuo3:nth-last-child(2) > a:contains("本站主页")');if(e.length){var t=e.attr("href");e.text("快捷导航").attr("href","javascript:;").removeAttr("target").after('\n<ul class="topmenuo2">\n  <li><a href="'+t+'" target="_blank">本站主页</a></li>\n  <li><a href="guanjianci.php?gjc='+_Info2.default.userName+'">@提醒</a></li>\n  <li><a href="search.php?authorid='+_Info2.default.uid+'">我的主题</a></li>\n  <li><a href="personal.php?action=post">我的回复</a></li>\n  <li><a href="kf_fw_ig_mybp.php">我的物品</a></li>\n  <li><a href="kf_fw_ig_shop.php">物品商店</a></li>\n  <li><a href="kf_fw_ig_halo.php">战力光环</a></li>\n  <li><a href="hack.php?H_name=bank">银行</a></li>\n  <li><a href="profile.php?action=favor">收藏</a></li>\n  '+(_Info2.default.isInMiaolaDomain?'<li><a href="https://m.miaola.info/" target="_blank">移动版</a></li>':"")+"\n  "+_Const2.default.customFastNavMenuContent+"\n</ul>")}},autoSaveCurrentDeposit=exports.autoSaveCurrentDeposit=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Config.saveCurrentDepositAfterKfb>0&&Config.saveCurrentDepositKfb>0&&Config.saveCurrentDepositKfb<=Config.saveCurrentDepositAfterKfb){var t=$('a[href="kf_givemekfb.php"]'),n=function(e){if(!(e<Config.saveCurrentDepositAfterKfb)){var t=Math.floor((e-Config.saveCurrentDepositAfterKfb)/Config.saveCurrentDepositKfb);e-Config.saveCurrentDepositKfb*t>=Config.saveCurrentDepositAfterKfb&&t++;var n=Config.saveCurrentDepositKfb*t;n<=0||n>e||(console.log("自动活期存款Start"),$.post("hack.php?H_name=bank",{action:"save",btype:1,savemoney:n},function(e){showFormatLog("自动存款",e);var t=Util.getResponseMsg(e),a=t.msg;/完成存款/.test(a)&&(Log.push("自动存款","共有`"+n+"`KFB已自动存入活期存款"),console.log("共有"+n+"KFB已自动存入活期存款"),Msg.show("共有<em>"+n.toLocaleString()+"</em>KFB已自动存入活期存款"))}))}};if(e)console.log("获取当前持有KFB Start"),$.get("profile.php?action=show&uid="+_Info2.default.uid+"&t="+(new Date).getTime(),function(e){var t=/论坛货币：(\d+)\s*KFB/.exec(e);t&&n(parseInt(t[1]))});else{
var a=parseInt(t.data("kfb"));a&&n(a)}}},changeIdColor=exports.changeIdColor=function(){if(Config.changeAllAvailableIdColorEnabled||!(Config.customAutoChangeIdColorList.length<=1)){var e=function(){var e=Util.getDate("+"+Config.autoChangeIdColorInterval+"h");Util.setCookie(_Const2.default.autoChangeIdColorCookieName,e.getTime(),e)};console.log("自动更换ID颜色Start"),$.get("kf_growup.php?t="+(new Date).getTime(),function(t){if(!Util.getCookie(_Const2.default.autoChangeIdColorCookieName)){var n=t.match(/href="kf_growup\.php\?ok=2&safeid=\w+&color=\d+"/g);if(n){var a="",i=/safeid=(\w+)&/i.exec(n[0]);if(i&&(a=i[1]),!a)return void e();var o=[];for(var r in n){var l=/color=(\d+)/i.exec(n[r]);l&&o.push(parseInt(l[1]))}var s=o;if(!Config.changeAllAvailableIdColorEnabled){s=[];var d=!0,c=!1,p=void 0;try{for(var u,f=Config.customAutoChangeIdColorList[Symbol.iterator]();!(d=(u=f.next()).done);d=!0){var m=u.value;o.includes(m)&&s.push(m)}}catch(e){c=!0,p=e}finally{try{!d&&f.return&&f.return()}finally{if(c)throw p}}}if(s.length<=1)return void e();var g=parseInt(TmpLog.getValue(_Const2.default.prevAutoChangeIdColorTmpLogName));(isNaN(g)||g<0)&&(g=0);var h=0;if("sequence"===Config.autoChangeIdColorType.toLowerCase()){var v=!0,b=!1,y=void 0;try{for(var _,x=s.entries()[Symbol.iterator]();!(v=(_=x.next()).done);v=!0){var k=_slicedToArray(_.value,2),C=(k[0],k[1]);if(C>g){h=C;break}}}catch(e){b=!0,y=e}finally{try{!v&&x.return&&x.return()}finally{if(b)throw y}}0===h&&(h=s[0])}else{var w=!0,I=!1,L=void 0;try{for(var S,T=s.entries()[Symbol.iterator]();!(w=(S=T.next()).done);w=!0){var D=_slicedToArray(S.value,2),A=D[0];if(D[1]===g){s.splice(A,1);break}}}catch(e){I=!0,L=e}finally{try{!w&&T.return&&T.return()}finally{if(I)throw L}}h=s[Math.floor(Math.random()*s.length)]}$.get("kf_growup.php?ok=2&safeid="+a+"&color="+h+"&t="+(new Date).getTime(),function(t){e(),showFormatLog("自动更换ID颜色",t);var n=Util.getResponseMsg(t),a=n.msg;/等级颜色修改完毕/.test(a)&&(console.log("ID颜色更换为："+h),TmpLog.setValue(_Const2.default.prevAutoChangeIdColorTmpLogName,h))})}else e()}})}},showElementTitleTips=exports.showElementTitleTips=function(e,t){$(".pd_title_tips").remove(),t&&e.originalEvent&&$('<div class="pd_title_tips">'+t.replace(/\n/g,"<br>")+"</div>").appendTo("body").css("left",e.originalEvent.pageX-20).css("top",e.originalEvent.pageY+15)},bindElementTitleClick=exports.bindElementTitleClick=function(){var e=["A","IMG","INPUT","BUTTON","TEXTAREA","SELECT"];$(document).click(function(t){var n=t.target;!n.title&&!e.includes(n.nodeName)&&n.parentNode&&n.parentNode.title&&(n=n.parentNode),!n.title||e.includes(n.nodeName)||n.id&&n.id.startsWith("wy_")||$(n).is(".pd_editor_btn")?$(".pd_title_tips").remove():showElementTitleTips(t,n.title)})},bindSearchTypeSelectMenuClick=exports.bindSearchTypeSelectMenuClick=function(){$(document).on("click",".pd_search_type",function(){var e=$(this),t=$(".pd_search_type_list");if(t.length>0)return void t.remove();var n=e.data("type");t=$('<ul class="pd_search_type_list"><li>标题</li><li>作者</li><li>关键词</li><li>用户名</li></ul>').appendTo("body");var a=e.offset();t.css("top",a.top+e.height()+2).css("left",a.left+1),"dialog"===n&&t.css({width:"65px",left:a.left-1}),t.on("click","li",function(){var n=$(this),a=n.text().trim(),i=e.closest("form"),o=i.find('input[name="keyword"], input[name="pwuser"]');e.find("span").text(a),"关键词"!==a&&"用户名"!==a&&i.attr("action","search.php?"),"作者"===a?o.attr("name","pwuser"):o.attr("name","keyword");var r=i.find('[name="searchRange"][value="current"]');r.length>0&&r.prop("disabled","关键词"===a||"用户名"===a||!r.data("enabled")),t.remove(),o.focus()})}),$(document).on("submit",'form[name="pdSearchForm"]',function(){var e=$(this),t=$.trim(e.find(".pd_search_type > span").text());"关键词"===t?e.attr("action","guanjianci.php?gjc="+e.find('input[name="keyword"]').val()):"用户名"===t&&e.attr("action","profile.php?action=show&username="+e.find('input[name="keyword"]').val())})},makeSearchByBelowTwoKeyWordAvailable=exports.makeSearchByBelowTwoKeyWordAvailable=function(){$(document).on("submit",'form[action="search.php?"]',function(){var e=$(this),t=e.find('input[name="keyword"]'),n=e.find('input[name="method"]');if(t.length&&n.length){var a=$.trim(t.val());!a||Util.getStrByteLen(a)>2||(t.val(a+" "+Math.floor((new Date).getTime()/1e3)),n.val("OR"),setTimeout(function(){t.val(a),n.val("AND")},200))}})},addSearchDialogLink=exports.addSearchDialogLink=function(){$('<li><a data-name="search" href="#">搜索</a></li>').insertBefore(_Info2.default.$userMenu.find('a[href="profile.php?action=modify"]').parent()).find('[data-name="search"]').click(function(e){e.preventDefault();if(!($("#pdSearchDialog").length>0)){var t=Dialog.create("pdSearchDialog","搜索",'\n<div class="pd_cfg_main">\n  <input name="step" value="2" type="hidden">\n  <input name="method" value="AND" type="hidden">\n  <input name="sch_area" value="0" type="hidden">\n  <input name="s_type" value="forum" type="hidden">\n  <input name="f_fid" value="all" type="hidden">\n  <input name="orderway" value="lastpost" type="hidden">\n  <input name="asc" value="DESC" type="hidden">\n  <div style="margin-top: 15px;">\n    <input class="pd_input" name="keyword" type="search" style="float: left; width: 175px; line-height: 26px;" placeholder="关键字">\n    <div class="pd_search_type" data-type="dialog"><span>标题</span><i>∨</i></div>\n    <button class="indloginm" name="submit" type="submit">搜索</button>\n  </div>\n  <div style="margin-bottom: 8px; line-height: 35px;">\n    <label><input name="searchRange" type="radio" value="all" checked> 全站 </label>\n    <label><input name="searchRange" type="radio" value="current" disabled> 本版</label>\n  </div>\n</div>');t.closest("form").attr({name:"pdSearchForm",action:"search.php?",method:"post",target:"_blank"}).off("submit");var n=parseInt($('input[name="f_fid"]:first, input[name="fid"]:first').val());n&&(t.find('[name="searchRange"]').click(function(){var e=$(this);t.find('input[name="f_fid"]').val("current"===e.val()?n:"all")}),t.find('[name="searchRange"][value="current"]').prop("disabled",!1).data("enabled",!0).click()),t.keydown(function(e){27===e.keyCode&&$(".pd_search_type_list").remove()}).find("h1 > span").click(function(){$(".pd_search_type_list").remove()}),Dialog.show("pdSearchDialog"),t.find('[name="keyword"]').focus()}})},repairBbsErrorCode=exports.repairBbsErrorCode=function(){_Info2.default.w.is_ie=!1,"/read.php"===location.pathname&&(_Info2.default.w.strlen=Util.getStrByteLen)},turnPageViaKeyboard=exports.turnPageViaKeyboard=function(){$(document).keydown(function(e){if((37===e.keyCode||39===e.keyCode)&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){var t=$(".pages:first");if(t.find('li > a[href="javascript:;"]').length){var n=Util.getCurrentThreadPage(),a="";if(37===e.keyCode){if(n<=1)return;a=t.find('li > a:contains("上一页")').attr("href")}else{var i=/&page=(\d+)/.exec(t.find("li:last-child > a").attr("href"));if(!i)return;if(n>=parseInt(i[1]))return;a=t.find('li > a:contains("下一页")').attr("href")}location.href=a}}})},checkRatingSize=exports.checkRatingSize=function(e,t){var n=0,a=e.match(/\D(\d+(?:\.\d+)?)\s?(M|G)/gi);if(a)for(var i=0;i<a.length;i++){var o=/(\d+(?:\.\d+)?)\s?(M|G)/i.exec(a[i]);if(o){var r=parseFloat(o[1]);"G"===o[2].toUpperCase()&&(r*=1024),n+=r}}return n&&t?n>t*(100+_Const2.default.ratingErrorSizePercent)/100+1||n<t*(100-_Const2.default.ratingErrorSizePercent)/100-1?{type:1,titleSize:n,ratingSize:t}:{type:0}:{type:-1}},showCommonImportOrExportConfigDialog=exports.showCommonImportOrExportConfigDialog=function(e,t,n,a){var i="pdCommonImOrExConfigDialog";if(!($("#"+i).length>0)){(0,_Config.read)();var o=Dialog.create(i,"导入或导出"+e,'\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到别处即可\n  </div>\n  <textarea name="commonConfig" style="width: 500px; height: 300px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>');o.submit(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var n=$.trim(o.find('[name="commonConfig"]').val());if(n){try{n=JSON.parse(n)}catch(e){return void alert("设置有错误")}if(!n||$.type(n)!==$.type(Config[t]))return void alert("设置有错误");Config[t]=n,(0,_Config.write)(),alert("设置已导入"),Dialog.close(i),"function"==typeof a?a():location.reload()}}}),Dialog.show(i),o.find('[name="commonConfig"]').val(JSON.stringify(Config[t])).select().focus(),"function"==typeof n&&n(o)}},changeNewRateTipsColor=exports.changeNewRateTipsColor=function(){_Info2.default.$userMenu.find('a[href="kf_fw_1wkfb.php?ping=3"]:contains("有新的评分")').length>0&&$("#pdUserName").find("span").attr("id","pdNewRateTips").css("color","#5cb85c")},addSimulateManualActionChecked=exports.addSimulateManualActionChecked=function(e){$('\n<label style="margin-right: 5px;">\n  <input name="simulateManualActionEnabled" type="checkbox" '+(Config.simulateManualActionEnabled?"checked":"")+'> 模拟手动操作\n  <span class="pd_cfg_tips" title="延长部分批量操作的时间间隔（在3~7秒之间），以模拟手动使用道具、打开盒子等">[?]</span>\n</label>\n').prependTo(e).find('input[name="simulateManualActionEnabled"]').click(function(){var e=$(this).prop("checked");$('input[name="simulateManualActionEnabled"]').not(this).prop("checked",e),Config.simulateManualActionEnabled!==e&&((0,_Config.read)(),Config.simulateManualActionEnabled=e,(0,_Config.write)())})},getNextObjects=exports.getNextObjects=function e(t){console.log("获取下一批物品Start"),$.ajax({type:"GET",url:"kf_fw_ig_mybp.php?t="+$.now(),timeout:_Const2.default.defAjaxTimeout}).done(function(e){var n=/(<tr id="wp_\d+"><td>.+?<\/tr>)<tr><td colspan="4">/.exec(e);if(n){var a=$(".kf_fw_ig1:eq(1)"),i=n[1].match(/<tr id="wp_\d+">(.+?)<\/tr>/g),o="";for(var r in i){var l=/"wp_(\d+)"/.exec(i[r]);l&&(a.has('tr[id="wp_'+l[1]+'"]').length||(o+=i[r]))}o&&a.find("> tbody > tr:nth-child(2)").after(o),"function"==typeof t&&t()}}).fail(function(){setTimeout(function(){return e(t)},_Const2.default.defAjaxInterval)})}},{"./Config":5,"./ConfigDialog":6,"./Const":7,"./Dialog":8,"./Info":10,"./Log":12,"./LogDialog":13,"./Loot":14,"./Msg":16,"./Read":20,"./Script":21,"./TmpLog":22,"./Util":23}],20:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.getThreadTitle=n.showAttachImageOutsideSellBox=n.parseMediaTag=n.addMoreSmileLink=n.addCopyCodeLink=n.addUserMemo=n.modifyKFOtherDomainLink=n.addMultiQuoteButton=n.getMultiQuoteData=n.handleBuyThreadBtn=n.buyThreads=n.showStatFloorDialog=n.addStatAndBuyThreadBtn=n.addCopyBuyersListOption=n.adjustThreadContentFontSize=n.adjustThreadContentWidth=n.modifySmColor=n.modifyMySmColor=n.modifyFloorSmColor=n.fastGotoFloor=n.addFastGotoFloorInput=n.addFloorGotoLink=void 0;var r=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=e("./Info"),s=i(l),d=e("./Util"),c=a(d),p=e("./Msg"),u=a(p),f=e("./Dialog"),m=a(f),g=e("./Const"),h=i(g),v=e("./Log"),b=a(v),y=e("./Script"),_=a(y),x=e("./Public"),k=a(x),C=e("./Post"),w=a(C),I=(n.addFloorGotoLink=function(){$(".readlou > div:nth-child(2) > span").each(function(){var e=$(this),t=e.text();if(/^\d+楼$/.test(t)){var n=e.closest(".readlou").prev().attr("name");if(n&&/^\d+$/.test(n)){var a=c.getHostNameUrl()+"read.php?tid="+c.getUrlParam("tid")+"&spid="+n;e.html('<a class="pd_goto_link" href="'+a+'" title="复制楼层链接">'+t+"</a>"),e.find("a").click(function(e){e.preventDefault();var t=$(this),n=t.attr("href");t.data("copy-text",n),c.copyText(t,"楼层链接已复制")||prompt("本楼的跳转链接（请按Ctrl+C复制）：",n)})}}})},n.addFastGotoFloorInput=function(){$('\n<form>\n<li class="pd_fast_goto_floor">\n  电梯直达 <input class="pd_input" style="width: 30px;" type="text" maxlength="8">\n  <span data-name="submit" style="cursor: pointer;">楼</span>\n</li>\n</form>\n').prependTo($(".readtext:first").prev("div").prev(".readlou").find("> div:first-child > ul")).submit(function(e){e.preventDefault();var t=parseInt($(this).find("input").val());!t||t<0||(location.href="read.php?tid="+c.getUrlParam("tid")+"&page="+(parseInt(t/Config.perPageFloorNum)+1)+"&floor="+t)}).find('[data-name="submit"]').click(function(){$(this).closest("form").submit()}).end().closest("div").next().css({"max-width":"385px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"})},n.fastGotoFloor=function(){var e=parseInt(c.getUrlParam("floor"));if(e&&!(e<0)){var t=$('.readlou > div:nth-child(2) > span:contains("'+e+'楼")');if(t.length){var n=t.closest(".readlou").prev().attr("name");n&&/^\d+$/.test(n)&&(location.hash="#"+n)}}},n.modifyFloorSmColor=function(e,t){e.is(".readidmsbottom > a")&&e.css("color",t),e.closest(".readtext").css("border-color",t).prev("div").css("border-color",t).prev(".readlou").css("border-color",t).next().next().next(".readlou").css("border-color",t)}),L=(n.modifyMySmColor=function(){var e=$('.readidmsbottom > a[href="profile.php?action=show&uid='+s.default.uid+'"]');e.length||(e=$('.readidmleft > a[href="profile.php?action=show&uid='+s.default.uid+'"]')),e.length>0&&I(e,Config.customMySmColor)},n.modifySmColor=function(){Config.customSmColorConfigList.length&&$('.readidmsbottom > a[href^="profile.php?action=show&uid="], .readidmleft > a').each(function(){var e=$(this),t="";if(e.is(".readidmleft > a")){if(t=e.parent().next(".readidmright").text().toUpperCase(),!/(-?\d+|MAX)/i.test(t))return}else{var n=/(-?\d+|MAX)级神秘/i.exec(e.parent().contents().last().text());if(!n)return;t=n[1].toUpperCase()}var a=!0,i=!1,o=void 0;try{for(var r,l=Config.customSmColorConfigList[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var s=r.value,d=s.min,p=s.max,u=s.color;if(c.compareSmLevel(t,d)>=0&&c.compareSmLevel(t,p)<=0){I(e,u);break}}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}})},n.adjustThreadContentWidth=function(){$("head").append("\n<style>\n  .readtext > table > tbody > tr > td { padding-left: 192px; }\n  .readidms, .readidm { margin-left: -192px !important; }\n</style>\n")},n.adjustThreadContentFontSize=function(){Config.threadContentFontSize>0&&12!==Config.threadContentFontSize&&$("head").append("\n<style>\n  .readtext td { font-size: "+Config.threadContentFontSize+"px; line-height: 1.6em; }\n  .readtext td > div, .readtext td > .read_fds { font-size: 12px; }\n</style>\n")},n.addCopyBuyersListOption=function(){$('.readtext select[name="buyers"]').each(function(){$(this).find("option:first-child").after('<option value="copyList">复制名单</option>')}),$(document).on("change",'select[name="buyers"]',function(){var e=$(this);if("copyList"===e.val()){var t=e.find("option").map(function(e){var t=$(this).text();return 0===e||1===e||t.includes("-".repeat(11))?null:t}).get().join("\n");if(e.get(0).selectedIndex=0,!t)return void alert("暂时无人购买");var n="pdCopyBuyerListDialog";if(!($("#"+n).length>0)){var a='\n<div class="pd_cfg_main">\n  <textarea name="buyerList" style="width: 200px; height: 300px; margin: 5px 0;" readonly>'+t+"</textarea>\n</div>",i=m.create(n,"购买人名单",a);m.show(n),i.find('[name="buyerList"]').select().focus()}}})},n.addStatAndBuyThreadBtn=function(){$('<span style="margin: 0 5px;">|</span><a data-name="statAndBuyThread" title="统计回帖者名单以及批量购买帖子" href="#">统计和购买</a>').insertAfter('td > a[href^="kf_tidfavor.php?action=favor&tid="]').filter('[data-name="statAndBuyThread"]').click(function(e){if(e.preventDefault(),!($("#pdStatFloorDialog").length>0)){var t=parseInt(c.getUrlParam("tid"));if(t){var n=$.trim(prompt("统计到第几楼？（0表示统计所有楼层，可用m-n的方式来设定统计楼层的区间范围）",0));if(""!==n){if(!/^\d+(-\d+)?$/.test(n))return void alert("统计楼层格式不正确");var a=0,i=0,o=n.split("-");if(2===o.length?(a=parseInt(o[0]),i=parseInt(o[1])):i=parseInt(o[0]),i<a)return void alert("统计楼层格式不正确");var r=/(\d+)页/.exec($(".pages:eq(0) > li:last-child > a").text()),l=r?parseInt(r[1]):1;0===a&&(a=1),0===i&&(i=l*Config.perPageFloorNum-1);var s=Math.floor(a/Config.perPageFloorNum)+1,d=Math.floor(i/Config.perPageFloorNum)+1;if(d>l&&(d=l),d-s>h.default.statFloorMaxPage)return void alert("需访问的总页数不可超过"+h.default.statFloorMaxPage);u.destroy(),u.wait('<strong>正在统计楼层中&hellip;</strong><i>剩余页数：<em class="pd_countdown">'+(d-s+1)+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),L(t,s,d,a,i)}}}})},function(e,t,n,a,i){var o=!1,r=[];!function t(l){$.ajax({type:"GET",url:"read.php?tid="+e+"&page="+l+"&t="+(new Date).getTime(),timeout:h.default.defAjaxTimeout,success:function(e){$(".readtext",e).each(function(){var e={},t=$(this),n=t.prev("div").prev(".readlou"),l=parseInt(n.find("> div:nth-child(2) > span:first-child").text());if(l&&!(l<a)){if(l>i)return o=!0,!1;e.pid=parseInt(n.prev("a").attr("name"));var s=t.find(".readidms, .readidm");if(e.userName=s.find('a[href^="profile.php?action=show&uid="]').text(),e.smLevel="",s.hasClass("readidms")){var d=/(\S+)级神秘/.exec(s.find(".readidmsbottom").text());d&&(e.smLevel=d[1])}else e.smLevel=s.find(".readidmright").text().trim();var c=t.find('[name="buyers"]:first');if(e.status=0,c.length>0){var p=c.next("input");if(e.status=p.length>0?1:2,1===e.status){var u=/此帖售价\s*(\d+)\s*KFB/.exec(c.parent("legend").text());u&&(e.sell=parseInt(u[1])),u=/location\.href="(.+)"/i.exec(p.attr("onclick")),u&&(e.buyUrl=u[1])}}r[l]=e}});var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1),o=o||t.closest(".pd_msg").data("stop")},error:function(){setTimeout(function(){return t(l)},h.default.defAjaxInterval)},complete:function(){o||l>=n?(u.destroy(),S(r)):setTimeout(function(){return t(l+1)},h.default.defAjaxInterval)}})}(t)}),S=n.showStatFloorDialog=function(e){var t="pdStatFloorDialog",n=m.create(t,"统计楼层",'\n<div class="pd_cfg_main">\n  <div id="pdStatFloorFilter" style="margin-top: 5px;">\n    <label><input name="removeRepeatedEnabled" type="checkbox"> 去除重复</label>\n    <label><input name="removeTopFloorEnabled" type="checkbox"> 去除楼主</label>\n  </div>\n  <div id="pdStatFloorSelectBtns">\n    <label style="margin-left: 3px;">售价区间：</label>\n    <input name="startSell" type="number" value="1" min="1" max="100" style="width: 40px;"> -\n    <input name="endSell" type="number" value="100" min="1" max="100" style="width: 40px;">\n    <label style="margin-left: 3px;">\n      每名用户限选 <input name="limitNum" type="number" min="0" style="width: 32px;"> 个\n    </label>\n    <a class="pd_btn_link" data-name="selectFilter" href="#">筛选</a><br>\n    <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n    <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n  </div>\n  <div class="pd_highlight" style="text-align: center;">\n    共显示<b id="pdStatFloorShowCount">0</b>条项目，共选择<b id="pdStatFloorSelectCount">0</b>条项目\n  </div>\n  <table style="line-height: 1.8em; text-align: center;">\n    <thead>\n      <tr>\n        <th style="width: 30px;"></th>\n        <th style="width: 65px;">楼层号</th>\n        <th style="width: 120px;">用户名</th>\n        <th style="width: 80px;">神秘等级</th>\n        <th style="width: 100px;">\n          售价(KFB) <span class="pd_cfg_tips" title="注：售价信息在统计后可能会发生变化，如有必要，建议尽快购买帖子">[?]</span>\n        </th>\n      </tr>\n    </thead>\n    <tbody id="pdStatFloorList"></tbody>\n  </table>\n  <textarea name="statFloorListContent" style="margin-top: 8px; width: 250px; height: 300px;" hidden></textarea>\n</div>\n\n<div class="pd_cfg_btns">\n  <button name="copyList" type="button" style="color: #00f;" title="复制所有或所选楼层的用户名单">复制名单</button>\n  <button name="buyThread" type="button" style="color: #f00;" title="批量购买所选楼层的帖子">购买帖子</button>\n  <button data-action="close" type="button">关闭</button>\n</div>'),a=n.find("#pdStatFloorFilter"),i=n.find("#pdStatFloorList"),l=n.find('[name="statFloorListContent"]'),s=c.getUrlParam("tid"),d=function(){var t=[].concat(o(e)),d=a.find('[name="removeRepeatedEnabled"]').prop("checked"),c=a.find('[name="removeTopFloorEnabled"]').prop("checked");if(d&&(t=t.map(function(e,t,n){return e&&n.findIndex(function(t){return t&&t.userName===e.userName})===t?e:null})),c){var p=$(".readtext:first");if("tpc"===p.prev("div").prev(".readlou").prev("a").attr("name")){var u=p.find(".readidmsbottom, .readidmleft").find('a[href^="profile.php?action=show&uid="]').text();t=t.map(function(e){return e&&e.userName!==u?e:null})}}var f="",m="",g=0,h=!0,v=!1,b=void 0;try{for(var y,_=t.entries()[Symbol.iterator]();!(h=(y=_.next()).done);h=!0){var x=r(y.value,2),k=x[0],C=x[1];C&&(f+='\n<tr>\n  <td>\n    <label>\n      <input data-status="'+C.status+'" data-sell="'+(C.sell?C.sell:0)+'" data-url="'+(C.buyUrl?C.buyUrl:"")+'"\n        type="checkbox" value="'+C.userName+'">\n    </label>\n  </td>\n  <td><a href="read.php?tid='+s+"&spid="+C.pid+'" target="_blank">'+k+'楼</a></td>\n  <td><a href="profile.php?action=show&username='+C.userName+'" target="_blank" style="color: #000;">'+C.userName+'</a></td>\n  <td style="color: #f39;">'+C.smLevel+'</td>\n  <td class="pd_stat">'+(1===C.status?"<em>"+C.sell+"</em>":'<span class="pd_notice">'+(C.status?"已买":"无")+"</span>")+"</td>\n</tr>",m+=C.userName+"\n",g++)}}catch(e){v=!0,b=e}finally{try{!h&&_.return&&_.return()}finally{if(v)throw b}}i.html(f),l.val(m).data("copy-text",m),n.find("#pdStatFloorShowCount").text(g),n.find("#pdStatFloorSelectCount").text(0)};n.find("#pdStatFloorSelectBtns").on("click","[data-name]",function(e){e.preventDefault();var t=$(this).data("name");if("selectAll"===t)c.selectAll(i.find('[type="checkbox"]'));else if("selectInverse"===t)c.selectInverse(i.find('[type="checkbox"]'));else if("selectFilter"===t){var a=parseInt(n.find('[name="startSell"]').val()),o=parseInt(n.find('[name="endSell"]').val()),r=parseInt(n.find('[name="limitNum"]').val());if((!r||r<0)&&(r=0),!a||a<1||!o||o<1)return;var l={};i.find('[type="checkbox"]').each(function(){var e=$(this),t=parseInt(e.data("status"));if(t){var n=parseInt(e.data("sell")),i=e.val();i in l||(l[i]=0),l[i]++;var s=1===t&&n>=a&&n<=o;s&&r>0&&l[i]>r&&(s=!1),e.prop("checked",s)}})}n.find("#pdStatFloorSelectCount").text(i.find('[type="checkbox"]:checked').length)}).end().find('[name="copyList"]').click(function(){var e=$(this);if("取消复制"===e.text())return e.text("复制名单"),l.prop("hidden",!0),i.closest("table").prop("hidden",!1),void m.resize(t);var n="all",a=i.find('[type="checkbox"]:checked');if(a.length>0){n="select";var o="";a.each(function(){o+=$(this).val()+"\n"}),l.val(o).data("copy-text",o)}c.copyText(l,("all"===n?"所有":"所选")+"用户名单已复制")||(e.text("取消复制"),i.closest("table").prop("hidden",!0),l.prop("hidden",!1).select().focus(),m.resize(t))}).end().find('[name="buyThread"]').click(function(){var e=[],t=0;i.find('[type="checkbox"]:checked').length||n.find('[data-name="selectAll"]').click(),i.find('[type="checkbox"]:checked').each(function(){var n=$(this),a=n.data("url"),i=parseInt(n.data("sell"));a&&i>0&&(e.push({url:a,sell:i}),t+=i)}),e.length&&confirm("你共选择了 "+e.length+" 个可购买项，总售价 "+t.toLocaleString()+" KFB，均价 "+c.getFixedNumLocStr(t/e.length,2)+" KFB，是否批量购买？")&&(u.destroy(),u.wait('<strong>正在购买帖子中&hellip;</strong><i>剩余：<em class="pd_countdown">'+e.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),T(e))}),1!==c.getCurrentThreadPage()&&a.find('[name="removeTopFloorEnabled"]').prop("disabled",!0).parent("label").attr("title","请在第1页进行统计"),a.on("click",'[type="checkbox"]',d),d(),m.show(t),_.runFunc("Read.showStatFloorDialog_after_")},T=n.buyThreads=function(e){var t=0,n=0,a=0;$(document).clearQueue("BuyThread"),$.each(e,function(i,o){var r=o.url,l=o.sell;$(document).queue("BuyThread",function(){$.ajax({type:"GET",url:r+"&t="+(new Date).getTime(),timeout:h.default.defAjaxTimeout,success:function(e){k.showFormatLog("购买帖子",e);var i=c.getResponseMsg(e),o=i.msg;/操作完成/.test(o)?(t++,a+=l):n++},error:function(){n++},complete:function(){var o=$(".pd_countdown:last");o.text(parseInt(o.text())-1);var r=o.closest(".pd_msg").data("stop");r&&$(document).clearQueue("BuyThread"),r||i===e.length-1?(u.destroy(),t>0&&b.push("购买帖子","共有`"+t+"`个帖子购买成功",{pay:{KFB:-a}}),console.log("共有"+t+"个帖子购买成功，共有"+n+"个帖子购买失败，KFB-"+a),u.show("<strong>共有<em>"+t+"</em>个帖子购买成功"+(n>0?"，共有<em>"+n+"</em>个帖子购买失败":"")+"</strong><i>KFB<ins>-"+a+"</ins></i>",-1),_.runFunc("Read.buyThreads_after_",e)):setTimeout(function(){return $(document).dequeue("BuyThread")},h.default.defAjaxInterval)}})})}),$(document).dequeue("BuyThread")},D=(n.handleBuyThreadBtn=function(){$('.readtext input[type="button"][value="愿意购买,支付KFB"]').each(function(){var e=$(this),t=/此帖售价\s*(\d+)\s*KFB/.exec(e.closest("legend").contents().eq(0).text());if(t){var n=parseInt(t[1]);t=/location\.href="(.+?)"/i.exec(e.attr("onclick")),t&&e.data("sell",n).data("url",t[1]).removeAttr("onclick").click(function(e){e.preventDefault();var t=$(this),n=t.data("sell"),a=t.data("url");if(n&&a&&(!(n>=h.default.minBuyThreadWarningSell)||confirm("此贴售价 "+n+" KFB，是否购买？")))if(Config.buyThreadNoJumpEnabled){var i=u.wait("正在购买帖子&hellip;");$.get(a+"&t="+(new Date).getTime(),function(e){k.showFormatLog("购买帖子",e);var t=c.getResponseMsg(e),n=t.msg;u.remove(i),/操作完成/.test(n)?location.reload():/您已经购买此帖/.test(n)?(alert("你已经购买过此帖"),location.reload()):alert("帖子购买失败")})}else location.href=a})}})},n.getMultiQuoteData=function(){var e=[];return $(".pd_multi_quote_chk input:checked").each(function(){var t=$(this).closest(".readlou"),n=/(\d+)楼/.exec(t.find(".pd_goto_link").text()),a=n?parseInt(n[1]):0,i=t.prev("a").attr("name"),o=t.next("div").next(".readtext").find(".readidmsbottom > a, .readidmleft > a").text();o&&e.push({floor:a,pid:i,userName:o})}),e});n.addMultiQuoteButton=function(){var e=$('a[href^="post.php?action=reply"].b_tit2').attr("href");e&&($('<li class="pd_multi_quote_chk"><label title="多重引用"><input type="checkbox"> 引</label></li>').prependTo($(".readlou > div:first-child > ul").has('a[title="引用回复这个帖子"]')).find("input").click(function(){var e=parseInt(c.getUrlParam("tid")),t=localStorage[h.default.multiQuoteStorageName];if(t)try{t=JSON.parse(t),!t||"object"!==$.type(t)||$.isEmptyObject(t)?t=null:void 0!==t.tid&&t.tid===e&&Array.isArray(t.quoteList)||(t=null)}catch(e){t=null}else t=null;var n=D();t||(localStorage.removeItem(h.default.multiQuoteStorageName),t={tid:e,quoteList:[]});var a=c.getCurrentThreadPage();n.length>0?t.quoteList[a]=n:delete t.quoteList[a],localStorage[h.default.multiQuoteStorageName]=JSON.stringify(t)}),$(".readlou:last").next("div").find("table > tbody > tr > td:last-child").css({"text-align":"right",width:"320px"}).append('<span class="b_tit2" style="margin-left: 5px;"><a style="display: inline-block;" href="#" title="多重回复">回复</a> <a style="display: inline-block;" href="'+e+'&multiquote=1" title="多重引用">引用</a></span>').find(".b_tit2 > a:eq(0)").click(function(e){e.preventDefault(),w.handleMultiQuote(1)}))},n.modifyKFOtherDomainLink=function(){$(".readtext a, .thread2 a").each(function(){var e=$(this),t=e.attr("href");if(!/m\.miaola\.info\//i.test(t)){var n=/^(https?:\/\/(?:[\w\.]+?\.)?(?:2dgal|ddgal|9gal|9baka|9moe|kfgal|2dkf|miaola|kfer)\.\w+?\/).+/i.exec(t);n&&e.attr("href",t.replace(n[1],c.getHostNameUrl()))}})},n.addUserMemo=function(){$.isEmptyObject(Config.userMemoList)||$('.readidmsbottom > a[href^="profile.php?action=show&uid="], .readidmleft > a').each(function(){var e=$(this),t=e.text().trim(),n=Object.keys(Config.userMemoList).find(function(e){return e===t});if(n){var a=Config.userMemoList[n];if(e.is(".readidmleft > a"))e.after('<span class="pd_user_memo_tips" title="备注：'+a+'">[?]</span>');else{var i=a;a.length>24&&(i=i.substring(0,24)+"&hellip;"),e.after('<br><span class="pd_user_memo" title="备注：'+a+'">('+i+")</span>")}}})},n.addCopyCodeLink=function(){$('.readtext fieldset > legend:contains("Copy code")').html('<a class="pd_copy_code" href="#">复制代码</a>').parent("fieldset").addClass("pd_code_area"),$(".pd_copy_code").length&&$("#alldiv").on("click","a.pd_copy_code",function(e){e.preventDefault();var t=$(this),n=t.closest("fieldset");if(!c.copyText(n,"代码已复制",t.parent())){var a=n.data("content");if(a)n.html('<legend><a class="pd_copy_code" href="#">复制代码</a></legend>'+a).removeData("content");else{var i=n.html();i=i.replace(/<legend>.+?<\/legend>/i,""),n.data("content",i),i=c.htmlDecode(i);var o=n.height();o-=17,o<50&&(o=50),o>540&&(o=540),n.html('\n<legend><a class="pd_copy_code" href="#">还原代码</a></legend>\n<textarea wrap="off" class="pd_textarea" style="width: 100%; height: '+o+'px; line-height: 1.4em; white-space: pre;">'+i+"</textarea>\n"),n.find("textarea").select().focus()}}})},n.addMoreSmileLink=function(){var e=function(e){var t=$('[name="atc_content"]').get(0);if(t){var n="[s:"+e+"]";c.addCode(t,n),s.default.isMobile?t.blur():t.focus()}},t=$('input[name="diy_guanjianci"]').parent();t.on("click",'a[href="javascript:;"]',function(t){t.preventDefault();var n=$(this).data("id");n&&e(n)}).find('a[onclick^="javascript:addsmile"]').each(function(){var e=$(this),t=/addsmile\((\d+)\)/i.exec(e.attr("onclick"));t&&e.data("id",t[1]).removeAttr("onclick").attr("href","javascript:;")}),$('<a class="pd_highlight" href="#">[更多]</a>').appendTo(t).click(function(n){n.preventDefault();var a=$(this),i=$("#pdSmilePanel");if(i.length>0)return a.text("[更多]"),void i.remove();a.text("[关闭]");for(var o=["48","35","34","33","32","31","30","29","28","27","26","36","37","47","46","45","44","43","42","41","40","39","38","25","24","11","10","09","08","01","02","03","04","05","06","12","13","23","22","21","20","19","18","17","16","15","14","07"],r=[57,44,43,42,41,40,39,38,37,36,35,45,46,56,55,54,53,52,51,50,49,48,47,34,33,20,19,18,17,10,11,12,13,14,15,21,22,32,31,30,29,28,27,26,25,24,23,16],l="",d=0;d<o.length;d++)l+='<img src="'+s.default.w.imgpath+"/post/smile/em/em"+o[d]+'.gif" alt="[表情]" data-id="'+r[d]+'">';l='<div class="pd_panel" id="pdSmilePanel" style="width: 308px; height: 185px;">'+l+"</div>";var c=t.offset();i=$(l).appendTo("body"),i.css("top",c.top+t.height()+4).css("left",c.left+t.width()-i.width()+9).on("click","img",function(){var t=$(this).data("id");t&&e(t)}),_.runFunc("Read.addMoreSmileLink_after_click_")})},n.parseMediaTag=function(){$(".readtext > table > tbody > tr > td").each(function(){var e=$(this),t=e.html();/\[(audio|video)\](http|ftp)[^<>]+\[\/(audio|video)\]/.test(t)&&e.html(t.replace(/\[audio\]((?:http|ftp)[^<>]+?)\[\/audio\](?!<\/fieldset>)/g,'<audio src="$1" controls preload="none" style="margin: 3px 0;">[你的浏览器不支持audio标签]</audio>').replace(/\[video\]((?:http|ftp)[^<>]+?)\[\/video\](?!<\/fieldset>)/g,'<video src="$1" controls preload="none" style="max-width: '+(Config.adjustThreadContentWidthEnabled?627:820)+'px; margin:3px 0;">[你的浏览器不支持video标签]</video>'))})},n.showAttachImageOutsideSellBox=function(){$(".readtext > table > tbody > tr > td").each(function(){var e=$(this),t=e.html();if(/\[attachment=\d+\]/.test(t)){var n=e.closest(".readtext").prev("div").prev(".readlou").prev("a").attr("name"),a=c.getUrlParam("tid");e.html(t.replace(/\[attachment=(\d+)\]/g,'<img src="job.php?action=download&pid='+n+"&tid="+a+'&aid=$1" alt="[附件图片]" style="max-width:550px" onclick="if(this.width>=550) window.open(\'job.php?action=download&pid='+n+"&tid="+a+"&aid=$1');\">"))}})},n.getThreadTitle=function(){return $('form[name="delatc"] > div:first > table > tbody > tr > td > span').text().trim()}},{"./Const":7,"./Dialog":8,"./Info":10,"./Log":12,"./Msg":16,"./Post":18,"./Public":19,"./Script":21,"./Util":23}],21:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={}
;if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleInstallScriptLink=exports.showDialog=exports.runFunc=exports.addFunc=exports.runCmd=exports.runCustomScript=void 0;var _Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Config=require("./Config"),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Msg=require("./Msg"),Msg=_interopRequireWildcard(_Msg),_Log=require("./Log"),Log=_interopRequireWildcard(_Log),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_LootLog=require("./LootLog"),LootLog=_interopRequireWildcard(_LootLog),_Public=require("./Public"),Public=_interopRequireWildcard(_Public),_Index=require("./Index"),Index=_interopRequireWildcard(_Index),_Read=require("./Read"),Read=_interopRequireWildcard(_Read),_Post=require("./Post"),Post=_interopRequireWildcard(_Post),_Other=require("./Other"),Other=_interopRequireWildcard(_Other),_Bank=require("./Bank"),Bank=_interopRequireWildcard(_Bank),_Card=require("./Card"),Card=_interopRequireWildcard(_Card),_Item=require("./Item"),Item=_interopRequireWildcard(_Item),_Loot=require("./Loot"),Loot=_interopRequireWildcard(_Loot),_ConfigDialog=require("./ConfigDialog"),ConfigDialog=_interopRequireWildcard(_ConfigDialog),defScriptName="未命名脚本",metaRegex=/\/\/\s*==UserScript==((?:.|\n)+?)\/\/\s*==\/UserScript==/i,funcList=new Map,runCustomScript=exports.runCustomScript=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"end",t=!0,n=!1,a=void 0;try{for(var i,o=Config.customScriptList[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var r=i.value,l=r.enabled,s=r.trigger,d=r.content;l&&s===e&&d&&runCmd(d)}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}},runCmd=exports.runCmd=function runCmd(cmd){var isOutput=arguments.length>1&&void 0!==arguments[1]&&arguments[1],result=!0,response="";try{response=eval(cmd),isOutput&&console.log(response)}catch(e){result=!1,response=e,console.log(e)}return{result:result,response:String(response)}},addFunc=exports.addFunc=function(e,t){funcList.has(e)||funcList.set(e,[]),funcList.get(e).push(t)},runFunc=exports.runFunc=function(e,t){if(funcList.has(e)){var n=!0,a=!1,i=void 0;try{for(var o,r=funcList.get(e)[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;if("function"==typeof l)try{l(t)}catch(e){console.log(e)}}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}}},getScriptMeta=function(e){var t={name:"未命名脚本",version:"",trigger:"end",homepage:"",author:""},n=metaRegex.exec(e);if(!n)return t;var a=n[1];return n=/@name[ \t]+(.*)/i.exec(a),n&&(t.name=n[1]),n=/@version[ \t]+(.*)/i.exec(a),n&&(t.version=n[1]),n=/@trigger[ \t]+(.*)/i.exec(a),n&&(t.trigger="start"===n[1].toLowerCase()?"start":"end"),n=/@homepage[ \t]+(.*)/i.exec(a),n&&(t.homepage=n[1]),n=/@author[ \t]+(.*)/i.exec(a),n&&(t.author=n[1]),t},showDialog=exports.showDialog=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t="pdCustomScriptDialog";if(!($("#"+t).length>0)){(0,_Config.read)();var n=Dialog.create(t,"自定义脚本",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <a class="pd_highlight pd_btn_link" data-name="addNewScript" href="#">添加新脚本</a>\n    <a class="pd_btn_link" data-name="insertSample" href="#">插入范例</a>\n  </div>\n  <div data-name="customScriptList"></div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a class="pd_btn_link pd_highlight" href="read.php?tid=500968" target="_blank">自定义脚本收集贴</a>\n    <a class="pd_btn_link" data-name="openImOrExCustomScriptDialog" href="#">导入/导出所有脚本</a>\n  </span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n  <button class="pd_highlight" name="clear" type="button">清空</button>\n</div>',"min-width: 776px;"),a=n.find('[data-name="customScriptList"]');n.submit(function(e){e.preventDefault(),Config.customScriptList=[],a.find(".pd_custom_script_content").each(function(){var e=$(this),t=e.val();if($.trim(t)){var n=e.prev().find('[type="checkbox"]').prop("checked");Config.customScriptList.push($.extend(getScriptMeta(t),{enabled:n,content:t}))}}),(0,_Config.write)(),Dialog.close(t),alert("自定义脚本修改成功（需刷新页面后才可生效）")}).end().find('[name="clear"]').click(function(e){e.preventDefault(),confirm("是否清空所有脚本？")&&(a.html(""),Dialog.resize(t))});var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.enabled,n=void 0===t||t,i=e.name,o=void 0===i?"未命名脚本":i,r=e.version,l=void 0===r?"":r,s=e.homepage,d=void 0===s?"":s,c=e.trigger,p=void 0===c?"end":c,u=e.content,f=void 0===u?"":u;a.append('\n<div class="pd_custom_script_header">\n  <input type="checkbox" '+(n?"checked":"")+' title="是否启用此脚本">\n  <a class="pd_custom_script_name" href="#" style="margin-left: 5px;">['+o+']</a>\n  <span data-name="version" style="margin-left: 5px; color: #666;" '+(l?"":"hidden")+">"+l+'</span>\n  <span data-name="trigger" style="margin-left: 5px; color: '+("start"===p?"#f00":"#00f")+';" title="脚本执行时机">\n    ['+("start"===p?"开始时":"结束时")+']\n  </span>\n  <a data-name="homepage" href="'+d+'" target="_blank" style="margin-left: 5px;" '+(d?"":"hidden")+'>[主页]</a>\n  <a data-name="delete" href="#" style="margin-left: 5px; color: #666;">[删除]</a>\n</div>\n<textarea class="pd_custom_script_content" wrap="off">'+f+"</textarea>\n")},o=!0,r=!1,l=void 0;try{for(var s,d=Config.customScriptList[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){i(s.value)}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}n.find('[data-name="addNewScript"]').click(function(e){e.preventDefault(),a.find(".pd_custom_script_content").hide(),i(),a.find(".pd_custom_script_content:last").show().focus(),Dialog.resize(t)}).end().find('[data-name="insertSample"]').click(function(e){e.preventDefault();var t=a.find(".pd_custom_script_content:visible");t.val(("\n// ==UserScript==\n// @name        未命名脚本\n// @version     1.0\n// @author      "+_Info2.default.userName+"\n// @trigger     end\n// @homepage    read.php?tid=500968&spid=12318348\n// @description 这是一个未命名脚本\n// ==/UserScript==\n").trim()+"\n"+t.val()).focus()}).end().find('[data-name="openImOrExCustomScriptDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("自定义脚本","customScriptList")}),a.on("click",".pd_custom_script_name",function(e){e.preventDefault(),n.find(".pd_custom_script_content").hide(),$(this).parent().next().show().focus(),Dialog.resize(t)}).on("click",'[data-name="delete"]',function(e){if(e.preventDefault(),confirm("是否删除此脚本？")){var n=$(this).closest(".pd_custom_script_header");n.next().remove(),n.remove(),Dialog.resize(t)}}).on("change",".pd_custom_script_content",function(){var e=$(this),t=getScriptMeta(e.val()),n=t.name,a=t.version,i=t.homepage,o=t.trigger,r=e.prev();r.find(".pd_custom_script_name").text("["+(n?n:"未命名脚本")+"]"),r.find('[data-name="version"]').text(a).prop("hidden",!a),r.find('[data-name="homepage"]').attr("href",i?i:"").prop("hidden",!i),r.find('[data-name="trigger"]').html("["+("start"===o?"开始时":"结束时")+"]").css("color","start"===o?"#f00":"#00f")}),Dialog.show(t),"number"==typeof e&&a.find(".pd_custom_script_name").eq(e).click()}},handleInstallScriptLink=exports.handleInstallScriptLink=function(){$(document).on("click",'a[href$="#install-script"]',function(e){e.preventDefault();var t=$(this),n=t.nextAll(".pd_code_area").eq(0);if(n.length){var a=Util.htmlDecode(n.html().replace(/<legend>.+?<\/legend>/i,"")).trim();if(metaRegex.test(a)){(0,_Config.read)();var i=getScriptMeta(a),o=Config.customScriptList.findIndex(function(e){return e.name===i.name&&e.author===i.author}),r=o>-1?1:0;if(confirm("是否"+(1===r?"更新":"安装")+"此脚本？")){Config.customScriptEnabled=!0;var l=$.extend(i,{enabled:!0,content:a});1===r?Config.customScriptList[o]=l:Config.customScriptList.push(l),(0,_Config.write)(),Dialog.close("pdCustomScriptDialog"),showDialog(o)}}}})}},{"./Bank":2,"./Card":4,"./Config":5,"./ConfigDialog":6,"./Const":7,"./Dialog":8,"./Index":9,"./Info":10,"./Item":11,"./Log":12,"./Loot":14,"./LootLog":15,"./Msg":16,"./Other":17,"./Post":18,"./Public":19,"./Read":20,"./TmpLog":22,"./Util":23}],22:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.deleteValue=n.setValue=n.getValue=n.clear=n.write=n.read=void 0;var i=e("./Info"),o=a(i),r=e("./Const"),l=a(r),s=e("./Util"),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s),c=l.default.storagePrefix+"tmp_log",p=n.read=function(){var e={},t=d.readData(c+"_"+o.default.uid);if(!t)return e;try{t=JSON.parse(t)}catch(t){return e}if(!t||"object"!==$.type(t))return e;var n=[];for(var a in l.default)a.endsWith("TmpLogName")&&n.push(l.default[a]);var i=!0,r=!1,s=void 0;try{for(var p,u=Object.keys(t)[Symbol.iterator]();!(i=(p=u.next()).done);i=!0){var f=p.value;n.includes(f)||delete t[f]}}catch(e){r=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(r)throw s}}return e=t},u=n.write=function(e){return d.writeData(c+"_"+o.default.uid,JSON.stringify(e))};n.clear=function(){return d.deleteData(c+"_"+o.default.uid)},n.getValue=function(e){var t=p();return e in t?t[e]:null},n.setValue=function(e,t){var n=p();n[e]=t,u(n)},n.deleteValue=function(e){var t=p();e in t&&(delete t[e],u(t))}},{"./Const":7,"./Info":10,"./Util":23}],23:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.deleteData=n.writeData=n.readData=n.selectInverse=n.selectAll=n.inFollowOrBlockUserList=n.entries=n.getResponseMsg=n.copyText=n.getSelText=n.addCode=n.getStrByteLen=n.removeUnpairedBBCodeContent=n.getFixedNumLocStr=n.getCurrentThreadPage=n.compareSmLevel=n.isEdge=n.isOpera=n.getStatFormatNumber=n.getSortedObjectKeyList=n.getObjectKeyList=n.removeHtmlTag=n.htmlDecode=n.htmlEncode=n.getGBKEncodeString=n.getUrlParam=n.deepEqual=n.getDifferenceSetOfObject=n.getHostNameUrl=n.isBetweenInTimeRange=n.getTimeDiffInfo=n.getTimeString=n.getDateString=n.getDate=n.getMidnightHourDate=n.getTimezoneDateByTime=n.getDateByTime=n.deleteCookie=n.getCookie=n.setCookie=void 0;var i=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("./Info"),r=a(o),l=e("./Const"),s=a(l),d=(n.setCookie=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.default.uid+"_"+s.default.storagePrefix;document.cookie=""+a+e+"="+encodeURI(t)+(n?";expires="+n.toUTCString():"")+";path=/;"},n.getCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.uid+"_"+s.default.storagePrefix,n=new RegExp("(^| )"+t+e+"=([^;]*)(;|$)"),a=document.cookie.match(n);return a?decodeURI(a[2]):null},n.deleteCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.uid+"_"+s.default.storagePrefix;document.cookie=""+t+e+"=;expires="+c("-1d").toUTCString()+";path=/;"},n.getDateByTime=function(e){var t=new Date,n=e.split(":"),a=i(n,3),o=a[0],r=a[1],l=a[2];return void 0!==o&&t.setHours(parseInt(o)),void 0!==r&&t.setMinutes(parseInt(r)),void 0!==l&&t.setSeconds(parseInt(l)),t.setMilliseconds(0),t}),c=(n.getTimezoneDateByTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.forumTimezoneOffset,n=new Date,a=e.split(":"),o=i(a,3),r=o[0],l=o[1],d=o[2];void 0!==r&&n.setUTCHours(parseInt(r)+t),void 0!==l&&n.setUTCMinutes(parseInt(l)),void 0!==d&&n.setUTCSeconds(parseInt(d)),n.setUTCMilliseconds(0);var c=new Date;return(c.getDate()>n.getDate()||c.getMonth()>n.getMonth()||c.getFullYear()>n.getFullYear())&&n.setDate(n.getDate()+1),n},n.getMidnightHourDate=function(e){var t=d("00:00:00");return t.setDate(t.getDate()+e),t},n.getDate=function(e){var t=new Date,n=/^(-|\+)?(\d+)([a-zA-Z]{1,2})$/.exec(e);if(!n)return null;var a=void 0===n[1]?0:"+"===n[1]?1:-1,i=a===-1?-parseInt(n[2]):parseInt(n[2]);switch(n[3]){case"Y":t.setFullYear(i);break;case"y":t.setFullYear(0===a?i:t.getFullYear()+i);break;case"M":t.setMonth(0===a?i:t.getMonth()+i);break;case"d":t.setDate(0===a?i:t.getDate()+i);break;case"h":t.setHours(0===a?i:t.getHours()+i);break;case"m":t.setMinutes(0===a?i:t.getMinutes()+i);break;case"s":t.setSeconds(0===a?i:t.getSeconds()+i);break;case"ms":t.setMilliseconds(0===a?i:t.getMilliseconds()+i);break;default:return null}return t}),p=(n.getDateString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";e=e?e:new Date;var n=(e.getMonth()+1).toString(),a=e.getDate().toString();return e.getFullYear()+t+n.padStart(2,"0")+t+a.padStart(2,"0")},n.getTimeString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.getHours().toString(),i=e.getMinutes().toString(),o=e.getSeconds().toString();return a.padStart(2,"0")+t+i.padStart(2,"0")+(n?t:"")+(n?o.padStart(2,"0"):"")},n.getTimeDiffInfo=function(e){var t=e-(new Date).getTime();if(t>0){t=Math.floor(t/1e3);var n=Math.floor(t/60/60);if(n>=0){var a=Math.floor((t-60*n*60)/60);a<0&&(a=0);var i=Math.floor(t-60*n*60-60*a);return i<0&&(i=0),{hours:n,minutes:a,seconds:i}}}return{hours:0,minutes:0,seconds:0}},n.isBetweenInTimeRange=function(e,t){var n=t.split("-"),a=i(n,2),o=a[0],r=a[1];if(void 0===r)return null;var l=d(o),s=d(r);return s<l&&(e>s?s.setDate(s.getDate()+1):l.setDate(l.getDate()-1)),e>=l&&e<=s},n.getHostNameUrl=function(){return location.protocol+"//"+location.host+"/"},n.getDifferenceSetOfObject=function(e,t){var n={};return"object"!==$.type(e)||"object"!==$.type(t)?n:($.each(t,function(t,a){t in e&&(p(e[t],a)||(n[t]=a))}),n)},n.deepEqual=function e(t,n){if(t===n)return!0;if($.type(t)!==$.type(n))return!1;if("number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n))return!0;if($.isArray(t)&&$.isArray(n)||"object"===$.type(t)&&"object"===$.type(n)){if(t.length!==n.length)return!1;for(var a in $.extend($.isArray(t)?[]:{},t,n)){if(void 0===t[a]||void 0===n[a])return!1;if(!e(t[a],n[a]))return!1}return!0}return!1}),u=(n.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=location.search.substring(1).match(t);return n?decodeURI(n[2]):null},n.getGBKEncodeString=function(e){var t=$("<img>").appendTo("body").get(0);t.src="nothing?sp="+e;var n=t.src.split("nothing?sp=").pop();return $(t).remove(),n},n.htmlEncode=function(e){return e.length?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"<br>"):""},n.htmlDecode=function(e){return e.length?e.replace(/<br\s*\/?>/gi,"\n").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&nbsp;/gi," ").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&"):""},n.removeHtmlTag=function(e){return e?e.replace(/<br.*\/?>/g,"\n").replace(/<[^>]+>/g,""):""},n.getObjectKeyList=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];if("object"!==$.type(e))return n;for(var a in e)n.push(a);return 0!==t&&n.sort(function(e,n){return t>0?e>n?1:-1:e<n?1:-1}),n});n.getSortedObjectKeyList=function(e,t){var n=u(t);return n.sort(function(t,n){return e.indexOf(t)>e.indexOf(n)?1:-1}),n},n.getStatFormatNumber=function(e){return e>=0?"<em>+"+e.toLocaleString()+"</em>":"<ins>"+e.toLocaleString()+"</ins>"},n.isOpera=function(){return void 0!==r.default.w.opera},n.isEdge=function(){return navigator.appVersion&&navigator.appVersion.includes("Edge")},n.compareSmLevel=function(e,t){var n="MAX"===e.toUpperCase()?Number.MAX_VALUE:parseInt(e),a="MAX"===t.toUpperCase()?Number.MAX_VALUE:parseInt(t);return n>a?1:n<a?-1:0},n.getCurrentThreadPage=function(){var e=/- (\d+) -/.exec($('.pages:first > li > a[href="javascript:;"]').text());return e?parseInt(e[1]):1},n.getFixedNumLocStr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.toFixed(t).split("."),a=i(n,2),o=a[0],r=a[1],l=parseInt(o).toLocaleString(),s="";return void 0!==r&&(s="."+r),l+s},n.removeUnpairedBBCodeContent=function(e){for(var t=[/\[color=.+?\]/g,/\[backcolor=.+?\]/g,/\[size=.+?\]/g,/\[font=.+?\]/g,/\[align=.+?\]/g,/\[b\]/g,/\[i\]/g,/\[u\]/g,/\[strike\]/g,/\[sup\]/g,/\[sub\]/g],n=[/\[\/color\]/g,/\[\/backcolor\]/g,/\[\/size\]/g,/\[\/font\]/g,/\[\/align\]/g,/\[\/b\]/g,/\[\/i\]/g,/\[\/u\]/g,/\[\/strike\]/g,/\[\/sup\]/g,/\[\/sub\]/g],a=0;a<t.length;a++){var i=e.match(t[a]),o=e.match(n[a]);(i?i.length:0)!==(o?o.length:0)&&(e=e.replace(t[a],"").replace(n[a],""))}return e},n.getStrByteLen=function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n)<0||e.charCodeAt(n)>255?2:1;return t},n.addCode=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=n?t.indexOf(n):t.indexOf("]")+1;if(void 0!==e.selectionStart){var i=e.selectionStart;e.value=e.value.substring(0,i)+t+e.value.substring(e.selectionEnd),e.selectionStart=i+a,e.selectionEnd=i+a+n.length}else e.value+=t},n.getSelText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},n.copyText=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!("execCommand"in document&&t.length))return!1;var e=t.data("copy-text");e&&(t=$('<span class="pd_hide">'+e.replace(/\n/g,"<br>")+"</span>").insertAfter(t)),a&&a.prop("hidden",!0);var i=window.getSelection();i.selectAllChildren(t.get(0));var o=document.execCommand("copy");return i.removeAllRanges(),e&&t.remove(),a&&a.removeProp("hidden"),o&&alert(n?n:"已复制"),o},n.getResponseMsg=function(e){var t=0,n="",a="",i=/<span style=".+?">(.+?)<\/span><br\s*\/?><a href="(.+?)">/i.exec(e);if(i)t=1,n=i[1],a=i[2];else{var o=/操作提示<br\s*\/?>\r\n(.+?)<br\s*\/?>\r\n<a href="javascript:history\.go\(-1\);">返回上一步操作<\/a>/i.exec(e);o&&(t=-1,n=o[1])}return{type:t,msg:n?n:"未能获得预期的回应",url:a}},n.entries=regeneratorRuntime.mark(function e(t){var n,a,i,o,r,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,a=!1,i=void 0,e.prev=3,o=Object.keys(t)[Symbol.iterator]();case 5:if(n=(r=o.next()).done){e.next=12;break}return l=r.value,e.next=9,[l,t[l]];case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),a=!0,i=e.t0;case 18:e.prev=18,e.prev=19,!n&&o.return&&o.return();case 21:if(e.prev=21,!a){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}),n.inFollowOrBlockUserList=function(e,t){return t.findIndex(function(t){return t.name&&t.name===e})},n.selectAll=function(e){return e.prop("checked",!0),!1},n.selectInverse=function(e){return e.each(function(){var e=$(this);e.prop("checked",!e.prop("checked"))}),!1},n.readData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.storageType;return"ByUid"===t||"Global"===t?GM_getValue(e):localStorage.getItem(e)},n.writeData=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.default.storageType;"ByUid"===n||"Global"===n?GM_setValue(e,t):localStorage.setItem(e,t)},n.deleteData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.storageType;"ByUid"===t||"Global"===t?GM_deleteValue(e):localStorage.removeItem(e)}},{"./Const":7,"./Info":10}]},{},[1]);