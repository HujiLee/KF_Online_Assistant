!function e(t,n,a){function i(r,l){if(!n[r]){if(!t[r]){var s="function"==typeof require&&require;if(!l&&s)return s(r,!0);if(o)return o(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var c=n[r]={exports:{}};t[r][0].call(c.exports,function(e){var n=t[r][1][e];return i(n?n:e)},c,c.exports,e,t,n,a)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<a.length;r++)i(a[r]);return i}({1:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}var o=e("./module/Info"),r=i(o),l=e("./module/Util"),s=a(l),d=e("./module/Const"),c=i(d),p=e("./module/Config"),f=e("./module/Public"),u=a(f),h=e("./module/Index"),m=a(h),g=e("./module/Read"),v=a(g),_=e("./module/Post"),b=a(_),y=e("./module/Other"),x=a(y),k=e("./module/Bank"),C=a(k),w=e("./module/Card"),I=a(w),S=e("./module/Item"),T=a(S),L=e("./module/Loot"),D=a(L),U=e("./module/Script"),F=a(U),M="7.0";$(function(){if("undefined"!=typeof jQuery){var e=new Date;if(r.default.version=M,u.getUidAndUserName()){u.addPolyfill(),(0,p.init)(),u.checkBrowserType(),u.appendCss(),u.addConfigAndLogDialogLink(),Config.animationEffectOffEnabled&&($.fx.off=!0),Config.customScriptEnabled&&F.runCustomScript("start"),u.repairBbsErrorCode(),window.addEventListener("beforeunload",u.preventCloseWindowWhenActioning),Config.showSearchLinkEnabled&&u.addSearchDialogLink(),u.bindSearchTypeSelectMenuClick(),u.makeSearchByBelowTwoKeyWordAvailable(),Config.modifySideBarEnabled&&u.modifySideBar(),Config.addSideBarFastNavEnabled&&u.addFastNavForSideBar(),r.default.isInHomePage?(m.handleAtTips(),m.addSearchTypeSelectBoxInHomePage(),Config.smLevelUpAlertEnabled&&m.smLevelUpAlert(),Config.smRankChangeAlertEnabled&&m.smRankChangeAlert(),Config.showVipSurplusTimeEnabled&&m.showVipSurplusTime(),Config.homePageThreadFastGotoLinkEnabled&&m.addHomePageThreadFastGotoLink(),Config.fixedDepositDueAlertEnabled&&!s.getCookie(c.default.fixedDepositDueAlertCookieName)&&C.fixedDepositDueAlert()):"/read.php"===location.pathname?(Config.turnPageViaKeyboardEnabled&&u.turnPageViaKeyboard(),v.fastGotoFloor(),Config.adjustThreadContentWidthEnabled&&v.adjustThreadContentWidth(),v.adjustThreadContentFontSize(),v.showAttachImageOutsideSellBox(),Config.parseMediaTagEnabled&&v.parseMediaTag(),Config.modifyKfOtherDomainEnabled&&v.modifyKFOtherDomainLink(),Config.customSmColorEnabled&&v.modifySmColor(),Config.customMySmColor&&v.modifyMySmColor(),Config.multiQuoteEnabled&&v.addMultiQuoteButton(),v.addFastGotoFloorInput(),v.addFloorGotoLink(),v.addCopyBuyersListLink(),v.addStatRepliersLink(),v.handleBuyThreadBtn(),Config.batchBuyThreadEnabled&&v.addBatchBuyThreadButton(),Config.showSelfRatingLinkEnabled&&v.addSelfRatingLink(),Config.userMemoEnabled&&v.addUserMemo(),v.addCopyCodeLink(),v.addMoreSmileLink(),$('a[href$="#install-script"]').length>0&&F.handleInstallScriptLink()):"/thread.php"===location.pathname?(Config.highlightNewPostEnabled&&x.highlightNewPost(),Config.showFastGotoThreadPageEnabled&&x.addFastGotoThreadPageLink()):/\/kf_fw_ig_my\.php$/i.test(location.href)?(T.enhanceMyItemsPage(),T.addBatchUseAndConvertItemTypesButton()):/\/kf_fw_ig_renew\.php$/i.test(location.href)?T.addBatchConvertEnergyAndRestoreItemsLink():/\/kf_fw_ig_renew\.php\?lv=\d+$/i.test(location.href)?T.addConvertEnergyAndRestoreItemsButton():/\/kf_fw_ig_my\.php\?lv=\d+$/i.test(location.href)?T.addSellAndUseItemsButton():/\/kf_fw_ig_my\.php\?pro=\d+/i.test(location.href)?(T.modifyItemDescription(),/\/kf_fw_ig_my\.php\?pro=\d+&display=1$/i.test(location.href)&&T.addSampleItemTips()):"/kf_fw_ig_shop.php"===location.pathname?T.addBatchBuyItemsLink():"/kf_fw_ig_index.php"===location.pathname?D.enhanceLootIndexPage():"/kf_fw_ig_pklist.php"===location.pathname?D.addUserLinkInPkListPage():/\/hack\.php\?H_name=bank$/i.test(location.href)?(C.addBatchTransferButton(),C.handleInBankPage()):/\/kf_fw_card_my\.php$/i.test(location.href)?I.addStartBatchModeButton():/\/post\.php\?action=reply&fid=\d+&tid=\d+&multiquote=1/i.test(location.href)?Config.multiQuoteEnabled&&b.handleMultiQuote(2):/\/post\.php\?action=quote/i.test(location.href)?b.removeUnpairedBBCodeInQuoteContent():/\/message\.php\?action=read&mid=\d+/i.test(location.href)?(x.addFastDrawMoneyLink(),Config.modifyKfOtherDomainEnabled&&v.modifyKFOtherDomainLink()):/\/message\.php($|\?action=receivebox)/i.test(location.href)?x.addMsgSelectButton():/\/profile\.php\?action=show/i.test(location.href)?x.addFollowAndBlockAndMemoUserLink():/\/personal\.php\?action=post/i.test(location.href)?10===Config.perPageFloorNum&&x.modifyMyPostLink():"/kf_growup.php"===location.pathname?x.addAutoChangeIdColorButton():"/guanjianci.php"===location.pathname?x.highlightUnReadAtTipsMsg():/\/profile\.php\?action=modify$/i.test(location.href)?(x.syncModifyPerPageFloorNum(),r.default.isInMiaolaDomain&&x.addAvatarChangeAlert()):/\/job\.php\?action=preview$/i.test(location.href)?b.modifyPostPreviewPage():"/search.php"===location.pathname?Config.turnPageViaKeyboardEnabled&&u.turnPageViaKeyboard():/\/kf_fw_1wkfb\.php\?ping=(2|4)/i.test(location.href)?x.highlightRatingErrorSize():/\/kf_fw_1wkfb\.php\?do=1/i.test(location.href)?x.showSelfRatingErrorSizeSubmitWarning():"/kf_no1.php"===location.pathname?x.addUserNameLinkInRankPage():"/faq.php"===location.pathname&&x.modifyFaq(),"/post.php"===location.pathname&&(b.addExtraPostEditorButton(),b.addExtraOptionInPostPage(),r.default.isInMiaolaDomain&&b.addAttachChangeAlert()),Config.blockUserEnabled&&u.blockUsers(),Config.blockThreadEnabled&&u.blockThread(),Config.followUserEnabled&&u.followUsers(),r.default.isMobile&&u.bindElementTitleClick(),r.default.isInMiaolaDomain&&Config.kfSmileEnhanceExtensionEnabled&&["/read.php","/post.php","/message.php"].includes(location.pathname)&&u.importKfSmileEnhanceExtension();var t=Config.autoSaveCurrentDepositEnabled&&r.default.isInHomePage,n=!1;Config.autoDonationEnabled&&!s.getCookie(c.default.donationCookieName)&&(n=!0,u.donation(t)),t&&!n&&u.autoSaveCurrentDeposit(),Config.autoChangeIdColorEnabled&&!s.getCookie(c.default.autoChangeIdColorCookieName)&&u.changeIdColor(),Config.autoRefreshEnabled&&r.default.isInHomePage&&u.startAutoRefreshMode(),Config.customScriptEnabled&&F.runCustomScript("end");var a=new Date;console.log("【KF Online助手】加载完毕，加载耗时："+(a-e)+"ms")}}})},{"./module/Bank":2,"./module/Card":3,"./module/Config":4,"./module/Const":6,"./module/Index":9,"./module/Info":10,"./module/Item":11,"./module/Loot":14,"./module/Other":16,"./module/Post":17,"./module/Public":18,"./module/Read":19,"./module/Script":20,"./module/Util":22}],2:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.fixedDepositDueAlert=n.handleInBankPage=n.addBatchTransferButton=n.drawCurrentDeposit=void 0;var o=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e("./Util"),l=i(r),s=e("./Msg"),d=i(s),c=e("./Const"),p=a(c),f=e("./Log"),u=i(f),h=e("./TmpLog"),m=i(h),g=e("./Public"),v=i(g),_=20,b=function(e,t,n){var a=d.wait("正在存款中&hellip;");$.post("hack.php?H_name=bank",{action:"save",btype:1,savemoney:e},function(i){v.showFormatLog("存款",i);var o=l.getResponseMsg(i),r=o.msg;if(/完成存款/.test(r)){d.remove(a),console.log("共有"+e+"KFB存入活期存款");var s=$('.bank1 > tbody > tr:nth-child(2) > td:contains("当前所持：")');s.html(s.html().replace(/当前所持：-?\d+KFB/,"当前所持："+(t-e)+"KFB").replace(/活期存款：-?\d+KFB/,"活期存款："+(n+e)+"KFB")),setTimeout(function(){$(document).dequeue("Bank")},5e3)}else $(document).clearQueue("Bank"),alert("存款失败")})},y=(n.drawCurrentDeposit=function(e){var t=d.wait("正在取款中&hellip;");$.post("hack.php?H_name=bank",{action:"draw",btype:1,drawmoney:e},function(n){v.showFormatLog("取款",n);var a=l.getResponseMsg(n),i=a.msg;d.remove(t),/完成取款/.test(i)?(console.log("从活期存款中取出了"+e+"KFB"),d.show("从活期存款中取出了<em>"+e+"</em>KFB",-1)):/取款金额大于您的存款金额/.test(i)?d.show("取款金额大于当前活期存款金额",-1):/\d+秒内不允许重新交易/.test(i)?d.show("提交速度过快",-1):d.show("取款失败",-1)})},function(e,t,n,a){var i=0,r=0,s=0;$.each(e,function(n,c){var f=o(c,2),h=f[0],m=f[1];$(document).queue("Bank",function(){$.ajax({type:"POST",url:"hack.php?H_name=bank",timeout:p.default.defAjaxTimeout,data:"&action=virement&pwuser="+l.getGBKEncodeString(h)+"&to_money="+m+"&memo="+l.getGBKEncodeString(t),success:function(e){v.showFormatLog("批量转账",e);var t=l.getResponseMsg(e),n=t.msg,a="";/完成转帐!/.test(n)?(i++,s+=m,a=h+" <em>+"+m+"</em>"):(r++,/用户<b>.+?<\/b>不存在<br\s*\/?>/.test(n)?n="用户不存在":/您的存款不够支付转帐/.test(n)?n="存款不足":/转账额度不足/.test(n)?n="转账额度不足":/当前等级无法使用该功能/.test(n)?n="当前等级无法使用转账功能":/转帐数目填写不正确/.test(n)?n="转帐金额不正确":/自己无法给自己转帐/.test(n)?n="无法给自己转帐":/\d+秒内不允许重新交易/.test(n)&&(n="提交速度过快"),a=h+":"+m+' <span class="pd_notice">('+n+")</span>"),$(".pd_result:last").append("<li>"+a+"</li>")},error:function(){r++,$(".pd_result:last").append("\n<li>\n  "+h+":"+m+'\n  <span class="pd_notice">(连接超时，转账可能失败，请到<a target="_blank" href="hack.php?H_name=bank&action=log">银行日志</a>里进行确认)</span>\n</li>\n')},complete:function(){var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1);var o=t.closest(".pd_msg").data("stop");if(o&&$(document).clearQueue("Bank"),o||n===e.length-1){i>0&&u.push("批量转账","共有`"+i+"`名用户转账成功",{pay:{KFB:-s}}),d.destroy();var l=$('.bank1 > tbody > tr:nth-child(2) > td:contains("活期存款：")');l.html(l.html().replace(/活期存款：-?\d+KFB/,"活期存款："+(a-s)+"KFB")),console.log("共有"+i+"名用户转账成功，共有"+r+"名用户转账失败，KFB-"+s),$(".pd_result:last").append("<li><b>共有<em>"+i+"</em>名用户转账成功"+((r>0?"，共有<em>"+r+"</em>名用户转账失败":"")+"：</b>KFB <ins>-"+s+"</ins></li>")),d.show("<strong>共有<em>"+i+"</em>名用户转账成功"+((r>0?"，共有<em>"+r+"</em>名用户转账失败":"")+"</strong><i>KFB<ins>-"+s+"</ins></i>"),-1)}else setTimeout(function(){return $(document).dequeue("Bank")},5e3)}})})}),n||$(document).dequeue("Bank")}),x=function(e){var t=e.find('[name="users"]'),n=t.val();if(!/^\s*\S+\s*$/m.test(n)||/^\s*:/m.test(n)||/:/.test(n)&&/:(\D|$)/m.test(n))return alert("用户列表格式不正确"),t.select(),t.focus(),!1;if(/^\s*\S+?:0*[0-1]?\d\s*$/m.test(n))return alert("转帐金额不能小于"+_+"KFB"),t.select(),t.focus(),!1;var a=e.find('[name="money"]'),i=parseInt(a.val());if(/^\s*[^:]+\s*$/m.test(n)){if(!$.isNumeric(i))return alert("通用转账金额格式不正确"),a.select(),a.focus(),!1;if(i<_)return alert("转帐金额不能小于"+_+"KFB"),a.select(),a.focus(),!1}return!0};n.addBatchTransferButton=function(){var e='\n<tr id="pd_bank_transfer">\n  <td style="vertical-align: top;">\n    使用说明：<br>每行一名用户，<br>如需单独设定金额，<br>可写为“用户名:金额”<br>（注意是<b>英文冒号</b>）<br>例子：<br>\n    <pre style="border: 1px solid #9999ff; padding: 5px;">张三\n李四:200\n王五:500\n信仰风</pre>\n  </td>\n  <td>\n  <form>\n    <div style="display: inline-block;">\n      <label>用户列表：<br>\n        <textarea class="pd_textarea" name="users" style="width: 270px; height: 250px;"></textarea>\n      </label>\n    </div>\n    <div style="display: inline-block; margin-left: 10px;">\n      <label>通用转帐金额（如所有用户都已设定单独金额则可留空）：<br>\n        <input class="pd_input" name="money" type="text" style="width: 217px;" maxlength="15">\n      </label><br>\n      <label style="margin-top: 5px;">转帐附言（可留空）：<br>\n        <textarea class="pd_textarea" name="msg" style="width: 225px; height: 206px;"></textarea>\n      </label>\n    </div>\n    <div>\n      <input class="pd_input" type="submit" value="批量转账">\n      <input class="pd_input" type="reset" value="重置">\n      <input class="pd_input" name="random" type="button" value="随机金额" title="为用户列表上的每个用户设定指定范围内的随机金额">\n      （活期存款不足时，将自动进行存款；批量转账金额不会从定期存款中扣除）\n    </div>\n  </form>\n  </td>\n</tr>',t=$(e).appendTo(".bank1 > tbody");t.find("form").submit(function(e){if(e.preventDefault(),d.destroy(),x(t)){var n=parseInt(t.find('[name="money"]').val());n||(n=0);var a=t.find('[name="msg"]').val(),i=[],r=!0,l=!1,s=void 0;try{for(var c,p=t.find('[name="users"]').val().split("\n")[Symbol.iterator]();!(r=(c=p.next()).done);r=!0){var f=c.value;if(f=$.trim(f))if(f.includes(":")){var u=f.split(":"),h=o(u,2),m=h[0],g=h[1];if("undefined"==typeof g)continue;i.push([$.trim(m),parseInt(g)])}else i.push([f,n])}}catch(e){l=!0,s=e}finally{try{!r&&p.return&&p.return()}finally{if(l)throw s}}if(i.length){var v=/\(手续费(\d+)%\)/.exec($('td:contains("(手续费")').text());if(v){var _=parseInt(v[1])/100,k=0,C=!0,w=!1,I=void 0;try{for(var S,T=i[Symbol.iterator]();!(C=(S=T.next()).done);C=!0){var L=o(S.value,2),D=L[1];k+=D}}catch(e){w=!0,I=e}finally{try{!C&&T.return&&T.return()}finally{if(w)throw I}}if(k=Math.floor(k*(1+_)),confirm("共计"+i.length+"名用户，总额"+k.toLocaleString()+"KFB，是否转账？")){var U=d.wait("正在获取存款信息中&hellip;");$.get("hack.php?H_name=bank&t="+(new Date).getTime(),function(e){d.remove(U);var n=0,o=0,r=/当前所持：(-?\d+)KFB<br/i.exec(e);if(r&&(n=parseInt(r[1]),r=/活期存款：(-?\d+)KFB<br/i.exec(e))){if(o=parseInt(r[1]),k>n+o)return void alert("资金不足");$(document).clearQueue("Bank");var l=!1,s=k-o;s>0&&(l=!0,$(document).queue("Bank",function(){b(s,n,o),n-=s,o+=s}),$(document).dequeue("Bank")),d.wait('<strong>正在批量转账中，请耐心等待&hellip;</strong><i>剩余：<em class="pd_countdown">'+i.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),t.find("> td:last-child").append('<ul class="pd_result pd_stat"><li><strong>转账结果：</strong></li></ul>'),y(i,a,l,o)}})}}}}}).end().find('[name="random"]').click(function(e){e.preventDefault();var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=t.find('[name="users"]').val().split("\n")[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var s=r.value;s=$.trim(s),s&&n.push($.trim(s.split(":")[0]))}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}if(n.length){var d=prompt("设定随机金额的范围（注：最低转账金额为20KFB）","20-100");if(null!==d){if(d=$.trim(d),!/^\d+-\d+$/.test(d))return void alert("随机金额范围格式不正确");var c=d.split("-"),p=parseInt(c[0]),f=parseInt(c[1]);if(f<p)return void alert("最大值不能低于最小值");var u="",h=!0,m=!1,g=void 0;try{for(var v,_=n[Symbol.iterator]();!(h=(v=_.next()).done);h=!0){var b=v.value;u+=b+":"+Math.floor(Math.random()*(f-p+1)+p)+"\n"}}catch(e){m=!0,g=e}finally{try{!h&&_.return&&_.return()}finally{if(m)throw g}}t.find('[name="users"]').val(u)}}})},n.handleInBankPage=function(){var e=$('.bank1 > tbody > tr:nth-child(2) > td:contains("可获利息：")'),t=e.html(),n=/可获利息：(\d+)\(/i.exec(t),a=0;n&&(a=parseInt(n[1]),a>0&&e.html(t.replace(/可获利息：\d+\(/i,'可获利息：<b class="pd_highlight">'+a+"</b>(")));var i=e.html();if(n=/定期存款：(\d+)KFB/i.exec(i)){var o=parseInt(n[1]);if(o>0&&0===a){var r=parseInt(m.getValue(p.default.fixedDepositDueTmpLogName));if(!isNaN(r)&&r>(new Date).getTime()&&(i=i.replace("期间不存取定期，才可以获得利息）",'期间不存取定期，才可以获得利息）<span style="color: #339933;"> (到期时间：'+l.getDateString(new Date(r))+" "+(l.getTimeString(new Date(r),":",!1)+")</span>")),e.html(i)),n=/定期利息：([\d\.]+)%/.exec(i)){var s=parseFloat(n[1])/100,d=Math.round(o*s*p.default.fixedDepositDueTime);i=i.replace("取出定期将获得该数额的KFB利息)",'取出定期将获得该数额的KFB利息)<span style="color: #339933;"> (预期利息：'+d+" KFB)</span>"),e.html(i)}}}$('form[name="form1"], form[name="form2"]').submit(function(){var e=$(this),t=0;t=e.is('[name="form2"]')?parseInt(e.find('input[name="drawmoney"]').val()):parseInt(e.find('input[name="savemoney"]').val()),2===parseInt(e.find('input[name="btype"]:checked').val())&&t>0&&m.setValue(p.default.fixedDepositDueTmpLogName,l.getDate("+"+p.default.fixedDepositDueTime+"d").getTime())}),$('form[name="form3"]').submit(function(){var e=/活期存款：(-?\d+)KFB/.exec($('td:contains("活期存款：")').text());if(e){var t=parseInt(e[1]);if(e=/定期存款：(\d+)KFB/.exec($('td:contains("定期存款：")').text())){var n=parseInt(e[1]),a=parseInt($('input[name="to_money"]').val());return!isNaN(a)&&n>0&&a>t&&!confirm("你的活期存款不足，转账金额将从定期存款里扣除，是否继续？")?($(this).find('input[type="submit"]').prop("disabled",!1),!1):void 0}}})},n.fixedDepositDueAlert=function(){console.log("定期存款到期提醒Start"),$.get("hack.php?H_name=bank&t="+(new Date).getTime(),function(e){l.setCookie(p.default.fixedDepositDueAlertCookieName,1,l.getMidnightHourDate(1));var t=/可获利息：(\d+)\(/.exec(e);if(t){var n=parseInt(t[1]);n>0&&(l.setCookie(p.default.fixedDepositDueAlertCookieName,1,l.getMidnightHourDate(7)),confirm("您的定期存款已到期，共产生利息"+n+"KFB，是否前往银行取款？")&&(location.href="hack.php?H_name=bank"))}})}},{"./Const":6,"./Log":12,"./Msg":15,"./Public":18,"./TmpLog":21,"./Util":22}],3:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.addStartBatchModeButton=void 0;var o=e("./Util"),r=i(o),l=e("./Const"),s=a(l),d=e("./Msg"),c=i(d),p=e("./Log"),f=i(p),u=e("./Public"),h=i(u),m=function(e,t){var n=0,a=0,i=0,o=0;$(document).clearQueue("ConvertCardsToVipTime"),$.each(e,function(l,d){$(document).queue("ConvertCardsToVipTime",function(){$.ajax({type:"GET",url:"kf_fw_card_doit.php?do=recard&id="+d+"&safeid="+t+"&t="+(new Date).getTime(),timeout:s.default.defAjaxTimeout,success:function(e){h.showFormatLog("将卡片转换为VIP时间",e);var t=r.getResponseMsg(e),l=t.msg,s=/增加(\d+)小时VIP时间(?:.*?获得(\d+)点恢复能量)?/.exec(l);s?(n++,i+=parseInt(s[1]),"undefined"!=typeof s[2]&&(o+=parseInt(s[2]))):a++},error:function(){a++},complete:function(){var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1);var r=t.closest(".pd_msg").data("stop");r&&$(document).clearQueue("ConvertCardsToVipTime"),r||l===e.length-1?(n>0&&f.push("将卡片转换为VIP时间","共有`"+n+"`张卡片成功为VIP时间",{gain:{"VIP小时":i,"能量":o},pay:{"卡片":-n}}),c.destroy(),console.log("共有"+n+"张卡片转换成功，共有"+a+"张卡片转换失败，VIP小时+"+i+"，能量+"+o),c.show("<strong>共有<em>"+n+"</em>张卡片转换成功"+(a>0?"，共有<em>"+a+"</em>张卡片转换失败":"")+"</strong>"+("<i>VIP小时<em>+"+i+"</em></i><i>能量<em>+"+o+"</em></i>"),-1),$(".kf_fw_ig2 .pd_card_chk:checked").closest("td").fadeOut("normal",function(){var e=$(this).parent();$(this).remove(),e.children().length||e.remove()})):setTimeout(function(){$(document).dequeue("ConvertCardsToVipTime")},s.default.defAjaxInterval)}})})}),$(document).dequeue("ConvertCardsToVipTime")};n.addStartBatchModeButton=function(){var e=h.getSafeId();e&&$('.kf_fw_ig2 a[href^="kf_fw_card_my.php?id="]').length&&$('<div class="pd_item_btns"><button>开启批量模式</button></div>').insertAfter(".kf_fw_ig2").find("button").click(function(){var t=$(this),n=$(".kf_fw_ig2 > tbody > tr:gt(2)");"开启批量模式"===t.text()?!function(){t.text("关闭批量模式"),n.on("click","a",function(e){e.preventDefault(),$(this).next(".pd_card_chk").click()}).find("td").has("a").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&$(this).css("position","relative").append('<input class="pd_card_chk" type="checkbox" value="'+e[1]+'">')});var a=[];$(".kf_fw_ig2 > tbody > tr:nth-child(2) > td").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&a.push(parseInt(e[1]))});var i=function(){var e=!0,t=!1,i=void 0;try{for(var o,r=a[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var l=o.value;n.find("td").has('a[href="kf_fw_card_my.php?id='+l+'"]').find("input:checked").prop("checked",!1)}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}},o=$('\n<label><input name="uncheckPlayedCard" type="checkbox" checked> 不选已出战的卡片</label>\n<button name="selectOnlyOne">每类只保留一张</button>\n<button name="selectAll">全选</button>\n<button name="selectInverse">反选</button><br>\n<button name="convertCardsToVipTime">转换为VIP时间</button>\n').insertBefore(t);o.filter('[name="selectOnlyOne"]').click(function(){n.find("input").prop("checked",!0),o.find('[name="uncheckPlayedCard"]').prop("checked")&&i();var e=new Set;n.find("a > img").each(function(){e.add($(this).attr("src"))});var t=!0,a=!1,r=void 0;try{for(var l,s=e[Symbol.iterator]();!(t=(l=s.next()).done);t=!0){var d=l.value,c=n.find("td").has('img[src="'+d+'"]'),p=c.length,f=c.has("input:checked").length;p>1?p===f&&c.eq(0).find("input:checked").prop("checked",!1):c.find("input:checked").prop("checked",!1)}}catch(e){a=!0,r=e}finally{try{!t&&s.return&&s.return()}finally{if(a)throw r}}}).end().filter('[name="selectAll"]').click(function(){n.find("input").prop("checked",!0),o.find('[name="uncheckPlayedCard"]').prop("checked")&&i()}).end().filter('[name="selectInverse"]').click(function(){n.find("input").each(function(){$(this).prop("checked",!$(this).prop("checked"))}),o.find('[name="uncheckPlayedCard"]').prop("checked")&&i()}).end().filter('[name="convertCardsToVipTime"]').click(function(){c.destroy();var t=[];n.find("input:checked").each(function(){t.push(parseInt($(this).val()))}),t.length&&confirm("共选择了"+t.length+"张卡片，是否将卡片批量转换为VIP时间？")&&(c.wait('<strong>正在批量转换中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),m(t,e))})}():(t.text("开启批量模式"),n.off("click").find(".pd_card_chk").remove(),t.prevAll().remove())})}},{"./Const":6,"./Log":12,"./Msg":15,"./Public":18,"./Util":22}],4:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.normalize=n.changeStorageType=n.clear=n.write=n.read=n.init=n.Config=void 0;var o=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e("./Info"),l=i(r),s=e("./Util"),d=a(s),c=e("./Const"),p=i(c),f=e("./Log"),u=a(f),h=e("./TmpLog"),m=a(h),g=p.default.storagePrefix+"config",v=n.Config={autoRefreshEnabled:!1,showRefreshModeTipsType:"auto",autoDonationEnabled:!1,donationKfb:"1",donationAfterTime:"00:30:00",atTipsHandleType:"no_highlight",smLevelUpAlertEnabled:!1,fixedDepositDueAlertEnabled:!1,smRankChangeAlertEnabled:!1,homePageThreadFastGotoLinkEnabled:!0,showVipSurplusTimeEnabled:!1,showFastGotoThreadPageEnabled:!1,maxFastGotoThreadPageNum:5,perPageFloorNum:10,highlightNewPostEnabled:!0,adjustThreadContentWidthEnabled:!1,threadContentFontSize:0,customMySmColor:"",customSmColorEnabled:!1,customSmColorConfigList:[],modifyKfOtherDomainEnabled:!0,multiQuoteEnabled:!0,batchBuyThreadEnabled:!0,userMemoEnabled:!1,userMemoList:{},parseMediaTagEnabled:!0,turnPageViaKeyboardEnabled:!1,showSelfRatingLinkEnabled:!1,buyThreadViaAjaxEnabled:!0,kfSmileEnhanceExtensionEnabled:!1,defShowMsgDuration:-1,animationEffectOffEnabled:!1,showSearchLinkEnabled:!0,addSideBarFastNavEnabled:!0,modifySideBarEnabled:!1,customCssEnabled:!1,customCssContent:"",customScriptEnabled:!1,customScriptList:[],customScriptStartContent:"",customScriptEndContent:"",browseType:"auto",followUserEnabled:!1,followUserList:[],highlightFollowUserThreadInHPEnabled:!0,highlightFollowUserThreadLinkEnabled:!0,blockUserEnabled:!1,blockUserDefaultType:0,blockUserAtTipsEnabled:!0,blockUserForumType:0,blockUserFidList:[],blockUserList:[],blockThreadEnabled:!1,blockThreadDefForumType:0,blockThreadDefFidList:[],blockThreadList:[],autoSaveCurrentDepositEnabled:!1,saveCurrentDepositAfterKfb:0,saveCurrentDepositKfb:0,logSaveDays:30,logSortType:"time",logStatType:"current",logStatDays:7,autoChangeIdColorEnabled:!1,autoChangeIdColorType:"random",autoChangeIdColorInterval:24,changeAllAvailableIdColorEnabled:!0,customAutoChangeIdColorList:[],simulateManualHandleItemEnabled:!1,lootLevelPointList:{}},_=(n.init=function(){l.default.w.Config=$.extend(!0,{},v),"undefined"!=typeof GM_getValue&&(l.default.storageType=GM_getValue("StorageType"),"ByUid"!==l.default.storageType&&"Global"!==l.default.storageType&&(l.default.storageType="Default")),_()},n.read=function(){var e=null;if(e="ByUid"===l.default.storageType?GM_getValue(g+"_"+l.default.uid):"Global"===l.default.storageType?GM_getValue(g):localStorage.getItem(g)){try{e=JSON.parse(e)}catch(e){return}e&&"object"===$.type(e)&&!$.isEmptyObject(e)&&(e=y(e),l.default.w.Config=$.extend(!0,{},v,e))}}),b=n.write=function(){var e=d.getDifferenceSetOfObject(v,l.default.w.Config);"ByUid"===l.default.storageType?GM_setValue(g+"_"+l.default.uid,JSON.stringify(e)):"Global"===l.default.storageType?GM_setValue(g,JSON.stringify(e)):localStorage.setItem(g,JSON.stringify(e))},y=(n.clear=function(){"ByUid"===l.default.storageType?GM_deleteValue(g+"_"+l.default.uid):"Global"===l.default.storageType?GM_deleteValue(g):localStorage.removeItem(g)},n.changeStorageType=function(e){var t=u.read(),n=m.read();l.default.storageType=e,"undefined"!=typeof GM_setValue&&GM_setValue("StorageType",l.default.storageType),d.deepEqual(v,l.default.w.Config)&&$.isEmptyObject(t)||confirm("是否将助手设置和日志转移到对应存储类型中？（对应存储类型中的数据将被覆盖）")&&(b(),u.write(t),m.write(n))},n.normalize=function(e){var t={};if("object"!==$.type(e))return t;"number"==typeof e.donationKfb&&(e.donationKfb=e.donationKfb.toString());var n=!0,a=!1,i=void 0;try{for(var r,l=d.entries(e)[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var s=o(r.value,2),c=s[0],p=s[1];c in v&&$.type(p)===$.type(v[c])&&(t[c]=p)}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}return t})},{"./Const":6,"./Info":10,"./Log":12,"./TmpLog":21,"./Util":22}],5:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.showCommonImportOrExportConfigDialog=exports.show=void 0;var _slicedToArray=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Func=require("./Func"),Func=_interopRequireWildcard(_Func),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Config=require("./Config"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_Script=require("./Script"),Script=_interopRequireWildcard(_Script),show=exports.show=function(){var e="pdConfigDialog";if(!($("#"+e).length>0)){(0,_Config.read)(),Func.run("ConfigDialog.show_before_");var t='\n<div class="pd_cfg_main">\n  <div class="pd_cfg_nav">\n    <a class="pd_btn_link" data-name="clearTmpData" title="清除与助手有关的Cookies和本地存储数据（不包括助手设置和日志）" href="#">清除临时数据</a>\n    <a class="pd_btn_link" data-name="openRumCommandDialog" href="#">运行命令</a>\n    <a class="pd_btn_link" data-name="openImportOrExportSettingDialog" href="#">导入/导出设置</a>\n  </div>\n\n  <div class="pd_cfg_panel" style="margin-bottom: 5px;">\n    <fieldset>\n      <legend>\n        <label>\n          <input name="autoRefreshEnabled" type="checkbox"> 定时模式\n          <span class="pd_cfg_tips" title="可按时进行自动操作（包括捐款、自动更换ID颜色，需开启相关功能），只在论坛首页生效（不开启此模式的话只能在刷新页面后才会进行操作）">[?]</span>\n        </label>\n      </legend>\n      <label>\n        标题提示方案\n        <select name="showRefreshModeTipsType">\n          <option value="auto">停留一分钟后显示</option>\n          <option value="always">总是显示</option>\n          <option value="never">不显示</option>\n        </select>\n        <span class="pd_cfg_tips" title="在首页的网页标题上显示定时模式提示的方案">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label><input name="autoDonationEnabled" type="checkbox"> 自动KFB捐款</label>\n      </legend>\n      <label>\n        KFB捐款额度\n        <input name="donationKfb" maxlength="4" style="width: 32px;" type="text">\n        <span class="pd_cfg_tips" title="取值范围在1-5000的整数之间；可设置为百分比，表示捐款额度为当前所持现金的百分比（最多不超过5000KFB），例：80%">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        在 <input name="donationAfterTime" maxlength="8" style="width: 55px;" type="text"> 之后捐款\n        <span class="pd_cfg_tips" title="在当天的指定时间之后捐款（24小时制），例：22:30:00（注意不要设置得太接近零点，以免错过捐款）">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>首页相关</legend>\n      <label>\n        @提醒\n        <select name="atTipsHandleType" style="width: 130px;">\n          <option value="no_highlight">取消已读提醒高亮</option>\n          <option value="no_highlight_extra">取消已读提醒高亮，并在无提醒时补上消息框</option>\n          <option value="hide_box_1">不显示已读提醒的消息框</option>\n          <option value="hide_box_2">永不显示消息框</option>\n          <option value="default">保持默认</option>\n          <option value="at_change_to_cao">将@改为艹(其他和方式2相同)</option>\n        </select>\n        <span class="pd_cfg_tips" title="对首页上的有人@你的消息框进行处理的方案">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="smLevelUpAlertEnabled" type="checkbox"> 神秘等级升级提醒\n        <span class="pd_cfg_tips" title="在神秘等级升级后进行提醒，只在首页生效">[?]</span>\n      </label><br>\n      <label>\n        <input name="fixedDepositDueAlertEnabled" type="checkbox"> 定期存款到期提醒\n        <span class="pd_cfg_tips" title="在定时存款到期时进行提醒，只在首页生效">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="smRankChangeAlertEnabled" type="checkbox"> 系数排名变化提醒\n        <span class="pd_cfg_tips" title="在神秘系数排名发生变化时进行提醒，只在首页生效">[?]</span>\n      </label><br>\n      <label>\n        <input name="homePageThreadFastGotoLinkEnabled" type="checkbox"> 在首页帖子旁显示跳转链接\n        <span class="pd_cfg_tips" title="在首页帖子链接旁显示快速跳转至页末的链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="showVipSurplusTimeEnabled" type="checkbox"> 显示VIP剩余时间\n        <span class="pd_cfg_tips" title="在首页显示VIP剩余时间">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>帖子页面相关</legend>\n      <label>\n        帖子每页楼层数量\n        <select name="perPageFloorNum">\n          <option value="10">10</option>\n          <option value="20">20</option>\n          <option value="30">30</option>\n        </select>\n        <span class="pd_cfg_tips" title="用于电梯直达和帖子页数快捷链接功能，如果修改了KF设置里的“文章列表每页个数”，请在此修改成相同的数目">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        帖子内容字体大小 <input name="threadContentFontSize" maxlength="2" style="width: 20px;" type="text"> px\n        <span class="pd_cfg_tips" title="帖子内容字体大小，留空表示使用默认大小，推荐值：14">[?]</span>\n      </label><br>\n      <label>\n        <input name="adjustThreadContentWidthEnabled" type="checkbox"> 调整帖子内容宽度\n        <span class="pd_cfg_tips" title="调整帖子内容宽度，使其保持一致">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="turnPageViaKeyboardEnabled" type="checkbox"> 通过左右键翻页\n        <span class="pd_cfg_tips" title="在帖子和搜索页面通过左右键进行翻页">[?]</span>\n      </label><br>\n      <label>\n        <input name="autoChangeIdColorEnabled" type="checkbox" data-disabled="[data-name=openAutoChangeSmColorPage]"> 自动更换ID颜色\n        <span class="pd_cfg_tips" title="可自动更换ID颜色，请点击详细设置前往相应页面进行自定义设置">[?]</span>\n      </label>\n      <a data-name="openAutoChangeSmColorPage" class="pd_cfg_ml" target="_blank" href="kf_growup.php">详细设置&raquo;</a><br>\n      <label>\n        自定义本人的神秘颜色 <input name="customMySmColor" maxlength="7" style="width: 50px;" type="text">\n        <input style="margin-left: 0;" type="color" data-name="customMySmColorSelect">\n        <span class="pd_cfg_tips" title="自定义本人的神秘颜色（包括帖子页面的ID显示颜色和楼层边框颜色，仅自己可见），例：#009cff，如无需求可留空">[?]</span>\n      </label><br>\n      <label>\n        <input name="customSmColorEnabled" type="checkbox" data-disabled="[data-name=openCustomSmColorDialog]"> 自定义各等级神秘颜色\n        <span class="pd_cfg_tips" title="自定义各等级神秘颜色（包括帖子页面的ID显示颜色和楼层边框颜色，仅自己可见），请点击详细设置自定义各等级颜色">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomSmColorDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="userMemoEnabled" type="checkbox" data-disabled="[data-name=openUserMemoDialog]"> 显示用户备注\n        <span class="pd_cfg_tips" title="显示用户的自定义备注，请点击详细设置自定义用户备注">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openUserMemoDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="modifyKfOtherDomainEnabled" type="checkbox"> 将绯月其它域名的链接修改为当前域名\n        <span class="pd_cfg_tips" title="将帖子和短消息中的绯月其它域名的链接修改为当前域名">[?]</span>\n      </label><br>\n      <label>\n        <input name="multiQuoteEnabled" type="checkbox"> 开启多重引用功能\n        <span class="pd_cfg_tips" title="在帖子页面开启多重回复和多重引用功能">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="parseMediaTagEnabled" type="checkbox"> 解析多媒体标签\n        <span class="pd_cfg_tips" title="在帖子页面解析HTML5多媒体标签，详见【常见问题12】">[?]</span>\n      </label><br>\n      <label>\n        <input name="batchBuyThreadEnabled" type="checkbox"> 开启批量购买帖子功能\n        <span class="pd_cfg_tips" title="在帖子页面开启批量购买帖子的功能">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="buyThreadViaAjaxEnabled" type="checkbox"> 使用Ajax购买帖子\n        <span class="pd_cfg_tips" title="使用Ajax的方式购买帖子，购买时页面不会跳转">[?]</span>\n      </label><br>\n      <label>\n        <input name="showSelfRatingLinkEnabled" type="checkbox"> 显示自助评分链接\n        <span class="pd_cfg_tips" title="在符合条件的帖子页面显示自助评分的链接（仅限自助评分测试人员使用）">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="kfSmileEnhanceExtensionEnabled" type="checkbox" '+(_Info2.default.isInMiaolaDomain?"":"disabled")+'> 开启绯月表情增强插件\n        <span class="pd_cfg_tips" title="在发帖框上显示绯月表情增强插件（仅在miaola.info域名下生效），该插件由eddie32开发">[?]</span>\n      </label>\n    </fieldset>\n  </div>\n\n  <div class="pd_cfg_panel">\n    <fieldset>\n      <legend>版块页面相关</legend>\n      <label>\n        <input name="showFastGotoThreadPageEnabled" type="checkbox" data-disabled="[name=maxFastGotoThreadPageNum]"> 显示帖子页数快捷链接\n        <span class="pd_cfg_tips" title="在版块页面中显示帖子页数快捷链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        页数链接最大数量 <input name="maxFastGotoThreadPageNum" style="width: 25px;" maxlength="4" type="text">\n        <span class="pd_cfg_tips" title="在帖子页数快捷链接中显示页数链接的最大数量">[?]</span>\n      </label><br>\n      <label>\n        <input name="highlightNewPostEnabled" type="checkbox"> 高亮今日的新帖\n        <span class="pd_cfg_tips" title="在版块页面中高亮今日新发表帖子的发表时间">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>其它设置</legend>\n      <label class="pd_highlight">\n        存储类型\n        <select data-name="storageType">\n          <option value="Default">默认</option>\n          <option value="ByUid">按uid</option>\n          <option value="Global">全局</option>\n        </select>\n        <span class="pd_cfg_tips" title="助手设置和日志的存储方式，详情参见【常见问题1】">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        浏览器类型\n        <select name="browseType">\n          <option value="auto">自动检测</option>\n          <option value="desktop">桌面版</option>\n          <option value="mobile">移动版</option>\n        </select>\n        <span class="pd_cfg_tips" title="用于在KFOL助手上判断浏览器的类型，一般使用自动检测即可；\n如果当前浏览器与自动检测的类型不相符（移动版会在设置界面标题上显示“For Mobile”的字样），请手动设置为正确的类型">[?]</span>\n      </label><br>\n      <label>\n        <input name="showSearchLinkEnabled" type="checkbox"> 显示搜索链接\n        <span class="pd_cfg_tips" title="在页面上方显示搜索对话框的链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="animationEffectOffEnabled" type="checkbox"> 禁用动画效果\n        <span class="pd_cfg_tips" title="禁用jQuery的动画效果（推荐在配置较差的机器上使用）">[?]</span>\n      </label><br>\n      <label>\n        默认的消息显示时间 <input name="defShowMsgDuration" maxlength="5" style="width: 30px;" type="text"> 秒\n        <span class="pd_cfg_tips" title="默认的消息显示时间（秒），设置为-1表示永久显示，例：15">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        日志保存天数 <input name="logSaveDays" maxlength="3" style="width: 25px;" type="text">\n        <span class="pd_cfg_tips" title="默认值：'+_Config.Config.logSaveDays+'">[?]</span>\n      </label><br>\n      <label>\n        <input name="addSideBarFastNavEnabled" type="checkbox"> 为侧边栏添加快捷导航\n        <span class="pd_cfg_tips" title="为侧边栏添加快捷导航的链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="modifySideBarEnabled" type="checkbox"> 将侧边栏修改为平铺样式\n        <span class="pd_cfg_tips" title="将侧边栏修改为和手机相同的平铺样式">[?]</span>\n      </label><br>\n      <label>\n        <input name="customCssEnabled" type="checkbox" data-disabled="[data-name=openCustomCssDialog]"> 添加自定义CSS\n        <span class="pd_cfg_tips" title="为页面添加自定义的CSS内容，请点击详细设置填入自定义的CSS内容">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomCssDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="customScriptEnabled" type="checkbox" data-disabled="[data-name=openCustomScriptDialog]"> 执行自定义脚本\n        <span class="pd_cfg_tips" title="执行自定义的javascript脚本，请点击详细设置填入自定义的脚本内容">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomScriptDialog" href="#">详细设置&raquo;</a>\n    </fieldset>\n    <fieldset>\n      <legend>关注和屏蔽</legend>\n      <label>\n        <input name="followUserEnabled" type="checkbox" data-disabled="[data-name=openFollowUserDialog]"> 关注用户\n        <span class="pd_cfg_tips" title="开启关注用户的功能，所关注的用户将被加注记号，请点击详细设置管理关注用户">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openFollowUserDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="blockUserEnabled" type="checkbox" data-disabled="[data-name=openBlockUserDialog]"> 屏蔽用户\n        <span class="pd_cfg_tips" title="开启屏蔽用户的功能，你将看不见所屏蔽用户的发言，请点击详细设置管理屏蔽用户">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openBlockUserDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="blockThreadEnabled" type="checkbox" data-disabled="[data-name=openBlockThreadDialog]"> 屏蔽帖子\n        <span class="pd_cfg_tips" title="开启屏蔽标题包含指定关键字的帖子的功能，请点击详细设置管理屏蔽关键字">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openBlockThreadDialog" href="#">详细设置&raquo;</a><br>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label>\n          <input name="autoSaveCurrentDepositEnabled" type="checkbox"> 自动活期存款\n          <span class="pd_cfg_tips" title="在当前收入满足指定额度之后自动将指定数额存入活期存款中，只会在首页触发">[?]</span>\n        </label>\n      </legend>\n      <label>\n        在当前收入已满 <input name="saveCurrentDepositAfterKfb" maxlength="10" style="width: 45px;" type="text"> KFB之后\n        <span class="pd_cfg_tips" title="在当前收入已满指定KFB额度之后自动进行活期存款，例：1000">[?]</span>\n      </label><br>\n      <label>\n        将 <input name="saveCurrentDepositKfb" maxlength="10" style="width: 45px;" type="text"> KFB存入活期存款\n        <span class="pd_cfg_tips" title="将指定额度的KFB存入活期存款中，例：900；举例：设定已满1000存900，当前收入为2000，则自动存入金额为1800">[?]</span>\n      </label>\n    </fieldset>\n  </div>\n</div>\n\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a target="_blank" href="read.php?tid=508450">By 喵拉布丁</a>\n    <i style="color: #666; font-style: normal;">(V'+_Info2.default.version+')</i>\n    <a target="_blank" href="https://git.oschina.net/miaolapd/KF_Online_Assistant/wikis/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">[常见问题]</a>\n  </span>\n  <button name="ok">确定</button>\n  <button name="cancel">取消</button>\n  <button name="default">默认值</button>\n</div>',n=Dialog.create(e,"KFOL助手设置"+(_Info2.default.isMobile?" (For Mobile)":""),t);
n.find('[name="cancel"]').click(function(){return Dialog.close(e)}).end().find('[name="default"]').click(function(e){e.preventDefault(),confirm("是否重置所有设置？")&&((0,_Config.clear)(),alert("设置已重置"),location.reload())}).end().find('[data-name="clearTmpData"]').click(function(e){e.preventDefault();var t=prompt("可清除与助手有关的Cookies和本地临时数据（不包括助手设置和日志）\n请填写清除类型，0：全部清除；1：清除Cookies；2：清除本地临时数据",0);null!==t&&(t=parseInt(t),!isNaN(t)&&t>=0&&(clearTmpData(t),alert("缓存已清除")))}),n.on("click",'a[data-name^="open"][href="#"]',function(e){e.preventDefault();var t=$(this);if(!t.hasClass("pd_disabled_link")){var n=t.data("name");"openRumCommandDialog"===n&&showRunCommandDialog(),"openImportOrExportSettingDialog"===n&&showImportOrExportSettingDialog(),"openCustomSmColorDialog"===n?showCustomSmColorDialog():"openUserMemoDialog"===n?showUserMemoDialog():"openCustomCssDialog"===n?showCustomCssDialog():"openCustomScriptDialog"===n?Script.showDialog():"openFollowUserDialog"===n?showFollowUserDialog():"openBlockUserDialog"===n?showBlockUserDialog():"openBlockThreadDialog"===n&&showBlockThreadDialog()}}).end().find('[data-name="customMySmColorSelect"]').change(function(){n.find('[name="customMySmColor"]').val($(this).val().toString().toLowerCase())}).end().find('[name="customMySmColor"]').change(function(){var e=$.trim($(this).val());/^#[0-9a-fA-F]{6}$/.test(e)&&n.find('[data-name="customMySmColorSelect"]').val(e.toLowerCase())}),setMainConfigValue(n),n.submit(function(e){e.preventDefault(),$(".pd_cfg_btns > button:first").click()}).end().find(".pd_cfg_btns > button:first").click(function(t){if(t.preventDefault(),verifyMainConfig(n)){var a=Config.autoRefreshEnabled;(0,_Config.read)();var i=getMainConfigValue(n);i=(0,_Config.normalize)(i),$.extend(Config,i),(0,_Config.write)();var o=n.find('[data-name="storageType"]').val();if(o!==_Info2.default.storageType){if(!confirm("是否修改存储类型？"))return;return(0,_Config.changeStorageType)(o),alert("存储类型已修改"),void location.reload()}Dialog.close(e),a!==i.autoRefreshEnabled&&confirm("你已修改了定时模式的设置，需要刷新页面才能生效，是否立即刷新？")&&location.reload()}}),Dialog.show(e),n.find("a:first").focus(),Func.run("ConfigDialog.show_after_")}},setMainConfigValue=function(e){e.find("input[name], select[name]").each(function(){var e=$(this),t=e.attr("name");t in Config&&(e.is('[type="checkbox"]')&&"boolean"==typeof Config[t]?e.prop("checked",Config[t]===!0):e.val(Config[t]))}),e.find('[name="threadContentFontSize"]').val(Config.threadContentFontSize>0?Config.threadContentFontSize:""),e.find('[data-name="customMySmColorSelect"]').val(Config.customMySmColor),e.find('[data-name="storageType"]').val(_Info2.default.storageType),"undefined"==typeof GM_getValue&&e.find('[data-name="storageType"] > option:gt(0)').prop("disabled",!0)},getMainConfigValue=function(e){var t={};return e.find("input[name], select[name]").each(function(){var e=$(this),n=e.attr("name");n in Config&&(e.is('[type="checkbox"]')&&"boolean"==typeof Config[n]?t[n]=Boolean(e.prop("checked")):"number"==typeof Config[n]?t[n]=parseInt(e.val()):t[n]=$.trim(e.val()))}),t},verifyMainConfig=function(e){var t=e.find('[name="donationKfb"]'),n=$.trim(t.val());if(/%$/.test(n)){if(!/^1?\d?\d%$/.test(n))return alert("KFB捐款额度格式不正确"),t.select(),t.focus(),!1;if(parseInt(n)<=0||parseInt(n)>100)return alert("KFB捐款额度百分比的取值范围在1-100之间"),t.select(),t.focus(),!1}else{if(!$.isNumeric(n))return alert("KFB捐款额度格式不正确"),t.select(),t.focus(),!1;if(parseInt(n)<=0||parseInt(n)>_Const2.default.maxDonationKfb)return alert("KFB捐款额度的取值范围在1-"+_Const2.default.maxDonationKfb+"之间"),t.select(),t.focus(),!1}var a=e.find('[name="donationAfterTime"]'),i=$.trim(a.val());if(!/^(2[0-3]|[0-1][0-9]):[0-5][0-9]:[0-5][0-9]$/.test(i))return alert("在指定时间之后捐款格式不正确"),a.select(),a.focus(),!1;var o=e.find('[name="maxFastGotoThreadPageNum"]'),r=$.trim(o.val());if(!$.isNumeric(r)||parseInt(r)<=0)return alert("页数链接最大数量格式不正确"),o.select(),o.focus(),!1;var l=e.find('[name="threadContentFontSize"]'),s=$.trim(l.val());if(s&&(isNaN(parseInt(s))||parseInt(s)<0))return alert("帖子内容字体大小格式不正确"),l.select(),l.focus(),!1;var d=e.find('[name="customMySmColor"]'),c=$.trim(d.val());if(c&&!/^#[0-9a-fA-F]{6}$/.test(c))return alert("自定义本人的神秘颜色格式不正确，例：#009cff"),d.select(),d.focus(),!1;var p=e.find('[name="defShowMsgDuration"]'),f=$.trim(p.val());if(!$.isNumeric(f)||parseInt(f)<-1)return alert("默认的消息显示时间格式不正确"),p.select(),p.focus(),!1;var u=e.find('[name="logSaveDays"]'),h=$.trim(u.val());if(!$.isNumeric(h)||parseInt(h)<1)return alert("日志保存天数格式不正确"),u.select(),u.focus(),!1;var m=e.find('[name="saveCurrentDepositAfterKfb"]'),g=e.find('[name="saveCurrentDepositKfb"]'),v=parseInt(m.val()),_=parseInt(g.val());if(v||_){if(!v||v<=0)return alert("自动活期存款满足额度格式不正确"),m.select(),m.focus(),!1;if(!_||_<=0||_>v)return alert("想要存款的金额格式不正确"),g.select(),g.focus(),!1}return!0},clearTmpData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e||1===e)for(var t in _Const2.default)/CookieName$/.test(t)&&Util.deleteCookie(_Const2.default[t]);0!==e&&2!==e||(TmpLog.clear(),localStorage.removeItem(_Const2.default.multiQuoteStorageName))},showRunCommandDialog=function(){var e="pdRunCommandDialog";if(!($("#"+e).length>0)){Dialog.close("pdConfigDialog");var t='\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">\n    运行命令快捷键：<b>Ctrl+Enter</b>；清除命令快捷键：<b>Ctrl+退格键</b><br>\n    按<b>F12键</b>可打开浏览器控制台查看消息（需切换至控制台或Console标签）\n  </div>\n  <textarea name="cmd" wrap="off" style="width: 750px; height: 300px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button>运行</button> <button>清除</button> <button>关闭</button>\n</div>',n=Dialog.create(e,"运行命令",t),a=n.find('[name="cmd"]');n.find(".pd_cfg_btns > button:first").click(function(e){e.preventDefault();var t=a.val();t&&Script.runCmd(t,!0)}).next("button").click(function(e){e.preventDefault(),a.val("").focus()}).next("button").click(function(){return Dialog.close(e)}),Dialog.show(e),a.keyup(function(e){e.ctrlKey&&13===e.keyCode?n.find(".pd_cfg_btns > button:first").click():e.ctrlKey&&8===e.keyCode&&n.find(".pd_cfg_btns > button:eq(1)").click()}).focus()}},showImportOrExportSettingDialog=function(){var e="pdImOrExSettingDialog";if(!($("#"+e).length>0)){(0,_Config.read)();var t='\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到文本文件里即可\n  </div>\n  <textarea name="setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button>保存</button> <button>取消</button>\n</div>',n=Dialog.create(e,"导入或导出设置",t),a=n.find('[name="setting"]');n.find(".pd_cfg_btns > button:first").click(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim(a.val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("设置有错误")}if(!t||"object"!==$.type(t))return void alert("设置有错误");t=(0,_Config.normalize)(t),_Info2.default.w.Config=$.extend(!0,{},_Config.Config,t),(0,_Config.write)(),alert("设置已导入"),location.reload()}}}).next("button").click(function(){return Dialog.close(e)}),Dialog.show(e),a.val(JSON.stringify(Util.getDifferenceSetOfObject(_Config.Config,Config))).select()}},showCustomSmColorDialog=function(){var e="pdCustomSmColorDialog";if(!($("#"+e).length>0)){var t='\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    <strong>\n      示例（<a target="_blank" href="http://www.35ui.cn/jsnote/peise.html">常用配色表</a> / \n      <a target="_blank" href="read.php?tid=488016">配色方案收集贴</a>）：\n    </strong><br>\n    <b>等级范围：</b>4-4 <b>颜色：</b><span style="color: #0000ff;">#0000ff</span><br>\n    <b>等级范围：</b>10-99 <b>颜色：</b><span style="color: #5ad465;">#5ad465</span><br>\n    <b>等级范围：</b>5000-MAX <b>颜色：</b><span style="color: #ff0000;">#ff0000</span>\n  </div>\n  <ul data-name="smColorList"></ul>\n  <div style="margin-top: 5px;" data-name="customSmColorAddBtns">\n    <a class="pd_btn_link" data-action="addOne" href="#">增加1个</a>\n    <a class="pd_btn_link" data-action="addFive" href="#">增加5个</a>\n    <a class="pd_btn_link" data-action="clear" href="#">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a href="#">导入/导出配色方案</a></span>\n  <button>确定</button> <button>取消</button>\n</div>',n=Dialog.create(e,"自定义各等级神秘颜色",t,"min-width: 327px;"),a=n.find('[data-name="smColorList"]');n.find(".pd_cfg_btns > button:last").click(function(){return Dialog.close(e)}),a.on("change",'[name="color"]',function(){var e=$(this),t=$.trim(e.val());/^#[0-9a-fA-F]{6}$/.test(t)&&e.next('[type="color"]').val(t.toLowerCase())}).on("change",'[type="color"]',function(){var e=$(this);e.prev('[type="text"]').val(e.val().toString().toLowerCase())}).on("click","a",function(e){e.preventDefault(),$(this).closest("li").remove()});var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.min,n=void 0===t?"":t,a=e.max,i=void 0===a?"":a,o=e.color,r=void 0===o?"":o;return'\n<li>\n  <label>等级范围 <input name="min" type="text" maxlength="5" style="width: 30px;" value="'+n+'"></label>\n  <label>- <input name="max" type="text" maxlength="5" style="width: 30px;" value="'+i+'"></label>\n  <label>\n    &nbsp;颜色 <input name="color" type="text" maxlength="7" style="width: 50px;" value="'+r+'">\n    <input style="margin-left: 0;" type="color" value="'+r+'">\n  </label>\n  <a href="#">删除</a>\n</li>'};n.find('[data-action="addOne"], [data-action="addFive"]').click(function(t){t.preventDefault();var n=1;$(this).is('[data-action="addFive"]')&&(n=5);for(var o=1;o<=n;o++)a.append(i());Dialog.show(e)}).end().find('[data-action="clear"]').click(function(t){t.preventDefault(),confirm("是否清除所有颜色？")&&(a.empty(),Dialog.show(e))}),n.find(".pd_cfg_about > a").click(function(e){e.preventDefault(),showImportOrExportSmColorConfigDialog()});var o="",r=!0,l=!1,s=void 0;try{for(var d,c=Config.customSmColorConfigList[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){var p=d.value;o+=i(p)}}catch(e){l=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw s}}a.html(o),n.submit(function(t){t.preventDefault();var n=[],i=!0;a.find("li").each(function(){var e=$(this),t=e.find('[name="min"]'),a=$.trim(t.val()).toUpperCase();if(""!==a){if(!/^(-?\d+|MAX)$/i.test(a))return i=!1,t.select(),t.focus(),alert("等级范围格式不正确"),!1;var o=e.find('[name="max"]'),r=$.trim(o.val()).toUpperCase();if(""!==r){if(!/^(-?\d+|MAX)$/i.test(r))return i=!1,o.select(),o.focus(),alert("等级范围格式不正确"),!1;if(Util.compareSmLevel(r,a)<0)return i=!1,t.select(),t.focus(),alert("等级范围格式不正确"),!1;var l=e.find('[name="color"]'),s=$.trim(l.val()).toLowerCase();if(""!==s)return/^#[0-9a-fA-F]{6}$/.test(s)?void n.push({min:a,max:r,color:s}):(i=!1,l.select(),l.focus(),alert("颜色格式不正确"),!1)}}}),i&&(n.sort(function(e,t){return Util.compareSmLevel(e.min,t.min)>0}),Config.customSmColorConfigList=n,(0,_Config.write)(),Dialog.close(e))}),Dialog.show(e),a.find("input").length>0?a.find("input:first").focus():n.find('[data-name="customSmColorAddBtns"] > a:first').focus()}},showImportOrExportSmColorConfigDialog=function(){var e="pdImOrExSmColorConfigDialog";if(!($("#"+e).length>0)){(0,_Config.read)();var t='\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入配色方案：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出配色方案：</strong>复制文本框里的内容并粘贴到文本文件里即可\n  </div>\n  <textarea name="smColorConfig" style="width: 420px; height: 200px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a target="_blank" href="read.php?tid=488016">其他人分享的配色方案</a></span>\n  <button>保存</button> <button>取消</button>\n</div>',n=Dialog.create(e,"导入或导出配色方案",t);n.find(".pd_cfg_btns > button:first").click(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim(n.find('[name="smColorConfig"]').val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("配色方案有错误")}if(!t||!Array.isArray(t))return void alert("配色方案有错误");Config.customSmColorConfigList=t,(0,_Config.write)(),alert("配色方案已导入"),location.reload()}}}).next("button").click(function(){return Dialog.close(e)}),Dialog.show(e),n.find('[name="smColorConfig"]').val(JSON.stringify(Config.customSmColorConfigList)).select()}},showCustomCssDialog=function(){var e="pdCustomCssDialog";if(!($("#"+e).length>0)){var t='\n<div class="pd_cfg_main">\n  <strong>自定义CSS内容：</strong><br>\n  <textarea name="customCssContent" wrap="off" style="width: 750px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a target="_blank" href="read.php?tid=500969">CSS规则收集贴</a></span>\n  <button>确定</button> <button>取消</button>\n</div>',n=Dialog.create(e,"自定义CSS",t),a=n.find('[name="customCssContent"]');n.find(".pd_cfg_btns > button:first").click(function(t){t.preventDefault(),Config.customCssContent=$.trim(a.val()),(0,_Config.write)(),Dialog.close(e)}).next("button").click(function(){return Dialog.close(e)}),a.val(Config.customCssContent),Dialog.show(e),a.focus()}},showUserMemoDialog=function(){var e="pdUserMemoDialog";if(!($("#"+e).length>0)){var t='\n<div class="pd_cfg_main">\n  按照“用户名:备注”的格式（注意是英文冒号），每行一个<br>\n  <textarea name="userMemoList" wrap="off" style="width: 320px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button>确定</button> <button>取消</button>\n</div>',n=Dialog.create(e,"用户备注",t),a=n.find('[name="userMemoList"]');n.find(".pd_cfg_btns > button:first").click(function(t){t.preventDefault();var n=$.trim(a.val());Config.userMemoList={};var i=!0,o=!1,r=void 0;try{for(var l,s=n.split("\n")[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var d=l.value;if(d=$.trim(d)){if(!/.+?:.+/.test(d))return alert("用户备注格式不正确"),void a.focus();var c=d.split(":"),p=_slicedToArray(c,2),f=p[0],u=p[1],h=void 0===u?"":u;h&&(Config.userMemoList[f.trim()]=h.trim())}}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}(0,_Config.write)(),Dialog.close(e)}).next("button").click(function(){return Dialog.close(e)});var i="",o=!0,r=!1,l=void 0;try{for(var s,d=Util.entries(Config.userMemoList)[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=_slicedToArray(s.value,2),p=c[0],f=c[1];i+=p+":"+f+"\n"}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}a.val(i),Dialog.show(e),a.focus()}},showFollowUserDialog=function(){var e="pdFollowUserDialog";if(!($("#"+e).length>0)){var t='\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label>\n      <input name="highlightFollowUserThreadInHpEnabled" type="checkbox"> 高亮所关注用户的首页帖子链接\n      <span class="pd_cfg_tips" title="高亮所关注用户在首页下的帖子链接">[?]</span>\n    </label><br>\n    <label>\n      <input name="highlightFollowUserThreadLinkEnabled" type="checkbox"> 高亮所关注用户的帖子链接\n      <span class="pd_cfg_tips" title="高亮所关注用户在版块页面下的帖子链接">[?]</span>\n    </label><br>\n  </div>\n  <ul data-name="followUserList" style="margin-top: 5px; min-width: 274px; line-height: 24px;"></ul>\n  <div data-name="followUserBtns" style="margin-top: 5px;">\n    <div style="display: inline-block;">\n      <a class="pd_btn_link" href="#">全选</a>\n      <a class="pd_btn_link" href="#">反选</a>\n    </div>\n    <div style="float: right;">\n      <a class="pd_btn_link" href="#">删除</a>\n    </div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input data-name="addFollowUser" style="width: 200px;" type="text">\n    <a class="pd_btn_link" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a href="#">导入/导出关注用户</a></span>\n  <button>确定</button> <button>取消</button>\n</div>',n=Dialog.create(e,"关注用户",t),a=n.find('[data-name="followUserList"]');n.submit(function(e){e.preventDefault(),n.find(".pd_cfg_btns > button:first").click()}).find(".pd_cfg_btns > button:first").click(function(t){t.preventDefault(),Config.highlightFollowUserThreadInHPEnabled=n.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked"),Config.highlightFollowUserThreadLinkEnabled=n.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked"),Config.followUserList=[],a.find("li").each(function(){var e=$(this),t=$.trim(e.find('[type="text"]').val());""!==t&&Util.inFollowOrBlockUserList(t,Config.followUserList)===-1&&Config.followUserList.push({name:t})}),(0,_Config.write)(),Dialog.close(e)}).end().find(".pd_cfg_btns > button:last").click(function(){return Dialog.close(e)}),n.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked",Config.highlightFollowUserThreadInHPEnabled),n.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked",Config.highlightFollowUserThreadLinkEnabled);var i=function(e){$('\n<li>\n  <input type="checkbox">\n  <input type="text" style="width: 178px; margin-left: 5px;" maxlength="15" value="'+e+'">\n  <a class="pd_btn_link" href="#">删除</a>\n</li>\n').appendTo(a)},o=!0,r=!1,l=void 0;try{for(var s,d=Config.followUserList[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;i(c.name)}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}a.on("click","a",function(e){e.preventDefault(),$(this).parent().remove()}),n.find('[data-name="followUserBtns"]').find("a:first").click(function(e){e.preventDefault(),a.find('[type="checkbox"]').prop("checked",!0)}).end().find("a:eq(1)").click(function(e){e.preventDefault(),a.find('[type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))})}).end().find("a:last").click(function(t){t.preventDefault();var n=a.find('li:has([type="checkbox"]:checked)');n.length&&confirm("是否删除所选用户？")&&(n.remove(),Dialog.show(e))}),n.find('[data-name="addFollowUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).next("a").click(function(t){t.preventDefault();var a=!0,o=!1,r=void 0;try{for(var l,s=$.trim(n.find('[data-name="addFollowUser"]').val()).split(",")[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var d=l.value;d=$.trim(d),d&&Util.inFollowOrBlockUserList(d,Config.followUserList)===-1&&i(d)}}catch(e){o=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}n.find('[data-name="addFollowUser"]').val(""),Dialog.show(e)}),n.find(".pd_cfg_about > a").click(function(e){e.preventDefault(),showCommonImportOrExportConfigDialog("followUser")}),Dialog.show(e),n.find('[name="highlightFollowUserThreadInHpEnabled"]').focus()}},showBlockUserDialog=function(){var e="pdBlockUserDialog";if(!($("#"+e).length>0)){var t='\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px; line-height: 24px;">\n    <label>\n      默认屏蔽类型\n      <select name="blockUserDefaultType">\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n    </label>\n    <label class="pd_cfg_ml">\n      <input name="blockUserAtTipsEnabled" type="checkbox">屏蔽@提醒 <span class="pd_cfg_tips" title="屏蔽被屏蔽用户的@提醒">[?]</span>\n    </label><br>\n    <label>版块屏蔽范围\n      <select name="blockUserForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label><br>\n    <label>版块ID列表\n      <input name="blockUserFidList" type="text" style="width: 220px;"> \n      <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span>\n    </label>\n  </div>\n  <ul data-name="blockUserList" style="margin-top: 5px; min-width: 362px; line-height: 24px;"></ul>\n  <div data-name="blockUserBtns" style="margin-top: 5px;">\n    <div style="display: inline-block;"><a href="#">全选</a><a style="margin-left: 7px;" href="#">反选</a></div>\n    <div style="float: right;">\n      <a href="#">修改为</a>\n      <select style="margin-left: 7px;">\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n      <a style="margin-left: 7px;" href="#">删除</a>\n    </div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input name="addBlockUser" style="width: 200px;" type="text">\n    <a style="margin-left: 7px;" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a href="#">导入/导出屏蔽用户</a></span>\n  <button>确定</button> <button>取消</button>\n</div>',n=Dialog.create(e,"屏蔽用户",t),a=n.find('[data-name="blockUserList"]');n.submit(function(e){e.preventDefault(),n.find(".pd_cfg_btns > button:first").click()}).find(".pd_cfg_btns > button:first").click(function(t){t.preventDefault(),Config.blockUserDefaultType=parseInt(n.find('[name="blockUserDefaultType"]').val()),Config.blockUserAtTipsEnabled=n.find('[name="blockUserAtTipsEnabled"]').prop("checked"),Config.blockUserForumType=parseInt(n.find('[name="blockUserForumType"]').val()),Config.blockUserFidList=[];var i=!0,o=!1,r=void 0;try{for(var l,s=$.trim(n.find('[name="blockUserFidList"]').val()).split(",")[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var d=l.value;d=parseInt(d),!isNaN(d)&&d>0&&Config.blockUserFidList.push(d)}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}Config.blockUserList=[],a.find("li").each(function(){var e=$(this),t=$.trim(e.find('input[type="text"]').val());if(""!==t&&Util.inFollowOrBlockUserList(t,Config.blockUserList)===-1){var n=parseInt(e.find("select").val());Config.blockUserList.push({name:t,type:n})}}),(0,_Config.write)(),Dialog.close(e)}).end().find(".pd_cfg_btns > button:last").click(function(){return Dialog.close(e)}),n.find('[name="blockUserDefaultType"]').val(Config.blockUserDefaultType),n.find('[name="blockUserAtTipsEnabled"]').prop("checked",Config.blockUserAtTipsEnabled),n.find('[name="blockUserForumType"]').val(Config.blockUserForumType),n.find('[name="blockUserFidList"]').val(Config.blockUserFidList.join(","));var i=function(e,t){$('\n<li>\n  <input type="checkbox">\n  <input type="text" style="width: 150px; margin-left: 5px;" maxlength="15" value="'+e+'">\n  <select style="margin-left: 5px;">\n    <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n  </select>\n  <a style="margin-left: 7px;" href="#">删除</a>\n</li>').appendTo(a).find("select").val(t)},o=!0,r=!1,l=void 0;try{for(var s,d=Config.blockUserList[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;i(c.name,c.type)}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}a.on("click","a",function(e){e.preventDefault(),$(this).parent().remove()}),n.find('[data-name="blockUserBtns"]').find("a:first").click(function(e){e.preventDefault(),a.find('input[type="checkbox"]').prop("checked",!0)}).end().find("a:eq(1)").click(function(e){e.preventDefault(),a.find('input[type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))})}).end().find("a:eq(2)").click(function(e){e.preventDefault();var t=$(this).next("select").val();a.find('li:has(input[type="checkbox"]:checked) > select').val(t)}).end().find("a:last").click(function(t){t.preventDefault();var n=a.find('li:has(input[type="checkbox"]:checked)');n.length&&confirm("是否删除所选用户？")&&(n.remove(),Dialog.show(e))}),n.find('[name="addBlockUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).next("a").click(function(t){t.preventDefault();var a=parseInt($('[name="blockUserDefaultType"]').val()),o=!0,r=!1,l=void 0;try{for(var s,d=$.trim(n.find('[name="addBlockUser"]').val()).split(",")[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;c=$.trim(c),c&&Util.inFollowOrBlockUserList(c,Config.blockUserList)===-1&&i(c,a)}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}n.find('[name="addBlockUser"]').val(""),Dialog.show(e)}),n.find('[name="blockUserForumType"]').change(function(){$('[name="blockUserFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find(".pd_cfg_about > a").click(function(e){e.preventDefault(),showCommonImportOrExportConfigDialog("blockUser")}),Dialog.show(e),n.find('[name="blockUserForumType"]').triggerHandler("change"),n.find('[name="blockUserDefaultType"]').focus()}},showBlockThreadDialog=function showBlockThreadDialog(){var dialogName="pdBlockThreadDialog";if(!($("#"+dialogName).length>0)){var html='\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    标题关键字可使用普通字符串或正则表达式，正则表达式请使用/abc/的格式，例：/关键字A.*关键字B/i<br>\n    用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\n    <label>\n      默认版块屏蔽范围\n      <select name="blockThreadDefForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label>\n    <label style="margin-left: 5px;">默认版块ID列表 <input name="blockThreadDefFidList" type="text" style="width: 150px;"></label>\n  </div>\n  <table data-name="blockThreadList" style="line-height: 22px; text-align: center;">\n    <tbody>\n      <tr>\n        <th style="width: 220px;">标题关键字(必填)</th>\n        <th style="width: 62px;">屏蔽用户</th>\n        <th style="width: 200px;">用户名 <span class="pd_cfg_tips" title="多个用户名请用英文逗号分隔">[?]</span></th>\n        <th style="width: 62px;">屏蔽范围</th>\n        <th style="width: 132px;">版块ID <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span></th>\n        <th style="width: 35px;"></th>\n      </tr>\n    </tbody>\n  </table>\n  <div data-name="blockThreadAddBtns" style="margin-top: 5px;">\n    <a class="pd_btn_link" href="#">增加1个</a>\n    <a class="pd_btn_link" href="#">增加5个</a>\n    <a class="pd_btn_link" href="#">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a href="#">导入/导出屏蔽帖子</a></span>\n  <button>确定</button> <button>取消</button>\n</div>',$dialog=Dialog.create(dialogName,"屏蔽帖子",html,"width: 768px;"),$blockThreadList=$dialog.find('[data-name="blockThreadList"]'),verify=function verify(){var flag=!0;return $blockThreadList.find("tr:gt(0)").each(function(){var $this=$(this),$txtKeyWord=$this.find("td:first-child > input"),keyWord=$txtKeyWord.val();if(""!==$.trim(keyWord)&&/^\/.+\/[gimuy]*$/.test(keyWord))try{eval(keyWord)}catch(e){return alert("正则表达式不正确"),$txtKeyWord.select(),$txtKeyWord.focus(),flag=!1,!1}}),flag};$dialog.submit(function(e){e.preventDefault(),$dialog.find(".pd_cfg_btns > button:first").click()}).find(".pd_cfg_btns > button:first").click(function(e){if(e.preventDefault(),verify()){Config.blockThreadDefForumType=parseInt($dialog.find('[name="blockThreadDefForumType"]').val()),Config.blockThreadDefFidList=[];var t=!0,n=!1,a=void 0;try{for(var i,o=$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(",")[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var r=i.value;r=parseInt(r),!isNaN(r)&&r>0&&Config.blockThreadDefFidList.push(r)}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}Config.blockThreadList=[],$blockThreadList.find("tr:gt(0)").each(function(){var e=$(this),t=e.find("td:first-child > input").val();if(""!==$.trim(t)){var n={keyWord:t},a=parseInt(e.find("td:nth-child(2) > select").val());if(a>0){var i=[],o=!0,r=!1,l=void 0;try{for(var s,d=$.trim(e.find("td:nth-child(3) > input").val()).split(",")[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;c=$.trim(c),c&&i.push(c)}}catch(e){r=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}i.length>0&&(n[2===a?"excludeUser":"includeUser"]=i)}var p=parseInt(e.find("td:nth-child(4) > select").val());if(p>0){var f=[],u=!0,h=!1,m=void 0;try{for(var g,v=$.trim(e.find("td:nth-child(5) > input").val()).split(",")[Symbol.iterator]();!(u=(g=v.next()).done);u=!0){var _=g.value;_=parseInt(_),!isNaN(_)&&_>0&&f.push(_)}}catch(e){h=!0,m=e}finally{try{!u&&v.return&&v.return()}finally{if(h)throw m}}f.length>0&&(n[2===p?"excludeFid":"includeFid"]=f)}Config.blockThreadList.push(n)}}),(0,_Config.write)(),Dialog.close(dialogName)}}).end().find(".pd_cfg_btns > button:last").click(function(){return Dialog.close(dialogName)}),$blockThreadList.on("change","select",function(){var e=$(this);e.parent("td").next("td").find("input").prop("disabled",0===parseInt(e.val()))}).on("click","td > a",function(e){e.preventDefault(),$(this).closest("tr").remove()});var addBlockThread=function(e,t,n,a,i){$('\n<tr>\n  <td><input type="text" style="width: 208px;" value="'+e+'"></td>\n  <td><select><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input type="text" style="width: 188px;" value="'+n.join(",")+'" '+(0===t?"disabled":"")+'></td>\n  <td><select><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input type="text" style="width: 120px;" value="'+i.join(",")+'" '+(0===a?"disabled":"")+'></td>\n  <td><a href="#">删除</a></td>\n</tr>\n').appendTo($blockThreadList).find("td:nth-child(2) > select").val(t).end().find("td:nth-child(4) > select").val(a)},_iteratorNormalCompletion12=!0,_didIteratorError12=!1,_iteratorError12=void 0;try{for(var _iterator12=Config.blockThreadList[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=!0){var data=_step12.value,keyWord=data.keyWord,includeUser=data.includeUser,excludeUser=data.excludeUser,includeFid=data.includeFid,excludeFid=data.excludeFid,userType=0,userList=[];"undefined"!=typeof includeUser?(userType=1,userList=includeUser):"undefined"!=typeof excludeUser&&(userType=2,userList=excludeUser);var fidType=0,fidList=[];"undefined"!=typeof includeFid?(fidType=1,fidList=includeFid):"undefined"!=typeof excludeFid&&(fidType=2,fidList=excludeFid),addBlockThread(keyWord,userType,userList,fidType,fidList)}}catch(e){_didIteratorError12=!0,_iteratorError12=e}finally{try{!_iteratorNormalCompletion12&&_iterator12.return&&_iterator12.return()}finally{if(_didIteratorError12)throw _iteratorError12}}$dialog.find('[data-name="blockThreadAddBtns"]').find("a:lt(2)").click(function(e){e.preventDefault();var t=1;$(this).is('[data-name="blockThreadAddBtns"] > a:eq(1)')&&(t=5);for(var n=1;n<=t;n++)addBlockThread("",0,[],parseInt($dialog.find('[name="blockThreadDefForumType"]').val()),$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(","));Dialog.show(dialogName)}).end().find("a:last").click(function(e){e.preventDefault(),confirm("是否清除所有屏蔽关键字？")&&($blockThreadList.find("tbody > tr:gt(0)").remove(),Dialog.show(dialogName))}),$dialog.find('[name="blockThreadDefForumType"]').change(function(){$dialog.find('[name="blockThreadDefFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find(".pd_cfg_about > a").click(function(e){e.preventDefault(),showCommonImportOrExportConfigDialog("blockThread")}),Dialog.show(dialogName),$dialog.find('[name="blockThreadDefForumType"]').val(Config.blockThreadDefForumType).focus().triggerHandler("change"),$dialog.find('[name="blockThreadDefFidList"]').val(Config.blockThreadDefFidList.join(","))}},showCommonImportOrExportConfigDialog=exports.showCommonImportOrExportConfigDialog=function(e){var t="pdCommonImOrExConfigDialog";if(!($("#"+t).length>0)){(0,_Config.read)();var n='\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到文本文件里即可\n  </div>\n  <textarea name="commonConfig" style="width: 420px; height: 200px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button>保存</button> <button>取消</button>\n</div>',a="";switch(e){case"followUser":a="关注用户";break;case"blockUser":a="屏蔽用户";break;case"blockThread":a="屏蔽帖子";break;case"customScript":a="自定义脚本";break;default:return}var i=Dialog.create(t,"导入或导出"+a,n);i.find(".pd_cfg_btns > button:first").click(function(t){if(t.preventDefault(),confirm("是否导入文本框中的设置？")){var n=$.trim(i.find('[name="commonConfig"]').val());if(n){try{n=JSON.parse(n)}catch(e){return void alert("设置有错误")}if(!n||!Array.isArray(n))return void alert("设置有错误");switch(e){case"followUser":Config.followUserList=n;break;case"blockUser":Config.blockUserList=n;break;case"blockThread":Config.blockThreadList=n;break;case"customScript":Config.customScriptList=n}(0,_Config.write)(),alert("设置已导入"),location.reload()}
}}).next("button").click(function(){return Dialog.close(t)}),Dialog.show(t);var o=null;switch(e){case"followUser":o=Config.followUserList;break;case"blockUser":o=Config.blockUserList;break;case"blockThread":o=Config.blockThreadList;break;case"customScript":o=Config.customScriptList}i.find('[name="commonConfig"]').val(JSON.stringify(o)).select()}}},{"./Config":4,"./Const":6,"./Dialog":7,"./Func":8,"./Info":10,"./Script":20,"./TmpLog":21,"./Util":22}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a="pd_",i={debug:!1,forumTimezoneOffset:-8,maxDonationKfb:5e3,actionFinishRetryInterval:30,errorRefreshInterval:1,showRefreshModeTipsInterval:1,hideMarkReadAtTipsExpires:3,smLevelUpAlertInterval:3,smRankChangeAlertInterval:22,vipSurplusTimeExpires:60,defAjaxTimeout:3e4,defAjaxInterval:200,specialAjaxInterval:function(){return Math.floor(150*Math.random())+200},cycleUseItemsFirstAjaxInterval:function(){return Math.floor(250*Math.random())+2e3},minBuyThreadWarningSell:6,statRepliersMaxPage:300,sampleItemIdList:new Map([["零时迷子的碎片",2257935],["被遗弃的告白信",2005272],["学校天台的钥匙",2001303],["TMA最新作压缩包",1990834],["LOLI的钱包",1836588],["棒棒糖",1942370],["蕾米莉亚同人漫画",1000888],["十六夜同人漫画",1002668],["档案室钥匙",1013984],["傲娇LOLI娇蛮音CD",4621],["整形优惠卷",1003993],["消逝之药",1000306]]),fixedDepositDueTime:90,ratingErrorSizePercent:3,customSideBarContent:"",customTileSideBarContent:"",selfRatingFidList:[41,67,92,127,68],storagePrefix:a,multiQuoteStorageName:a+"multiQuote",smLevelUpTmpLogName:"SmLevelUp",smRankChangeTmpLogName:"SmRankChange",fixedDepositDueTmpLogName:"FixedDepositDue",prevAutoChangeIdColorTmpLogName:"PrevAutoChangeIdColor",donationCookieName:"donation",hideReadAtTipsCookieName:"hideReadAtTips",prevReadAtTipsCookieName:"prevReadAtTips",fixedDepositDueAlertCookieName:"fixedDepositDueAlert",vipSurplusTimeCookieName:"vipSurplusTime",autoChangeIdColorCookieName:"autoChangeIdColor",checkOverdueLogCookieName:"checkOverdueLog"};n.default=i},{}],7:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.close=n.show=n.create=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),s=a(l),d=e("./Public"),c=a(d),p=(n.create=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i='\n<form>\n<div class="pd_cfg_box" id="'+e+'" style="'+a+'">\n  <h1>'+t+"<span>&times;</span></h1>\n  "+n+"\n</div>\n</form>",o=$(i).appendTo("body");return o.on("click",".pd_cfg_tips",function(e){return r.default.isMobile&&c.showElementTitleTips(e,this.title),!1}).on("click","a.pd_disabled_link",function(){return!1}).keydown(function(t){if(27===t.keyCode)return f(e)}).find("h1 > span").click(function(){return f(e)}).end().find('legend [type="checkbox"]').click(function(){var e=$(this),t=e.prop("checked");s.isOpera()||s.isEdge()?e.closest("fieldset").find("input, select, textarea, button").not("legend input").prop("disabled",!t):e.closest("fieldset").prop("disabled",!t)}).end().find("input[data-disabled]").click(function(){var e=$(this),t=e.prop("checked");$(e.data("disabled")).each(function(){var e=$(this);e.is("a")?t?e.removeClass("pd_disabled_link"):e.addClass("pd_disabled_link"):e.prop("disabled",!t)})}),r.default.isMobile||$(window).on("resize."+e,function(){p(e)}),o},n.show=function(e){var t=$("#"+e);if(t.length){t.find(".pd_cfg_main").css("max-height",$(window).height()-80).end().find('legend [type="checkbox"]').each(function(){$(this).triggerHandler("click")}).end().find("input[data-disabled]").each(function(){$(this).triggerHandler("click")});var n=t.width(),a=$(window).width(),i=a/2-n/2;i+n>a&&(i=a-n-20),i<0&&(i=0);var o=$(window).height()/2-t.height()/2;o<0&&(o=0),t.css({top:o,left:i}).fadeIn("fast")}}),f=n.close=function(e){return $("#"+e).fadeOut("fast",function(){$(this).parent("form").remove()}),r.default.isMobile||$(window).off("resize."+e),!1}},{"./Info":10,"./Public":18,"./Util":22}],8:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.run=n.add=void 0;var i=e("./Script"),o=(a(i),new Map);n.add=function(e,t){o.has(e)||o.set(e,[]),o.get(e).push(t)},n.run=function(e,t){if(o.has(e)){var n=!0,a=!1,i=void 0;try{for(var r,l=o.get(e)[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var s=r.value;if("function"==typeof s)try{s(t)}catch(e){console.log(e)}}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}}}},{"./Script":20}],9:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.addSearchTypeSelectBoxInHomePage=n.showVipSurplusTime=n.addHomePageThreadFastGotoLink=n.smRankChangeAlert=n.smLevelUpAlert=n.handleAtTips=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),s=a(l),d=e("./Msg"),c=a(d),p=e("./Const"),f=i(p),u=e("./Log"),h=a(u),m=e("./TmpLog"),g=a(m);n.handleAtTips=function(){var e=Config.atTipsHandleType;if("default"!==e){var t=$('a[href^="guanjianci.php?gjc="]'),n=function(){return t.removeClass("indbox5").addClass("indbox6")},a=function(){return t.parent().next("div.line").addBack().remove()},i=n;if("hide_box_1"!==e&&"hide_box_2"!==e||(i=a),["no_highlight","no_highlight_extra","hide_box_1","at_change_to_cao"].includes(e)){if(t.length>0)!function(){var n=s.getCookie(f.default.hideReadAtTipsCookieName),a=$.trim(t.text()),o=/\d+日\d+时\d+分/.exec(a);o&&(a=o[0]),n&&n===a?i():t.click(function(){var e=$(this);if(!e.data("disabled")){var t=s.getCookie(f.default.hideReadAtTipsCookieName);if(t)t!==a&&s.setCookie(f.default.prevReadAtTipsCookieName,t);else{var n=(new Date).getDate().toString();s.setCookie(f.default.prevReadAtTipsCookieName,n.padStart(2,"0")+"日00时00分")}s.setCookie(f.default.hideReadAtTipsCookieName,a,s.getDate("+"+f.default.hideMarkReadAtTipsExpires+"d")),e.data("disabled",!0),i()}}),"at_change_to_cao"===e&&t.text(t.text().replace("@","艹"))}();else if(!t.length&&("no_highlight_extra"===e||"at_change_to_cao"===e)){var o='\n<div style="width: 300px;">\n  <a class="indbox6" href="guanjianci.php?gjc='+r.default.userName+'" target="_blank">最近无人'+("at_change_to_cao"===e?"艹":"@")+'你</a><br>\n  <div class="line"></div>\n  <div class="c"></div>\n</div>\n<div class="line"></div>';$('a[href="kf_givemekfb.php"][title="网站虚拟货币"]').parent().before(o)}}else"hide_box_2"===e&&t.length>0&&i()}},n.smLevelUpAlert=function(){var e=/神秘(\d+)级/.exec($('a[href="kf_growup.php"]').text());if(e){var t=parseInt(e[1]),n=function(e){g.setValue(f.default.smLevelUpTmpLogName,{time:(new Date).getTime(),smLevel:e})},a=g.getValue(f.default.smLevelUpTmpLogName);if(a&&"number"===$.type(a.time)&&"number"===$.type(a.smLevel))if(t>a.smLevel){var i=Math.floor(((new Date).getTime()-a.time)/60/60/1e3);if(i>=f.default.smLevelUpAlertInterval){var o=new Date(a.time);n(t),h.push("神秘等级升级","自`"+s.getDateString(o)+"`以来，你的神秘等级共上升了`"+(t-a.smLevel)+"`级 (Lv.`"+a.smLevel+"`->Lv.`"+t+"`)"),c.show("自<em>"+s.getDateString(o)+"</em>以来，你的神秘等级共上升了<em>"+(t-a.smLevel)+"</em>级")}else i<0&&n(t)}else t<a.smLevel&&n(t);else n(t)}},n.smRankChangeAlert=function(){var e=/系数排名第\s*(\d+)\s*位/.exec($('a[href="kf_growup.php"]').text());if(e){var t=parseInt(e[1]),n=function(e){return g.setValue(f.default.smRankChangeTmpLogName,{time:(new Date).getTime(),smRank:e})},a=g.getValue(f.default.smRankChangeTmpLogName);if(a&&"number"===$.type(a.time)&&"number"===$.type(a.smRank)){if(t!==a.smRank){var i=Math.floor(((new Date).getTime()-a.time)/60/60/1e3);if(i>=f.default.smRankChangeAlertInterval){var o=new Date(a.time),r=t<a.smRank;n(t),h.push("神秘系数排名变化","自`"+s.getDateString(o)+"`以来，你的神秘系数排名共`"+(r?"上升":"下降")+"`了`"+Math.abs(t-a.smRank)+"`名 "+("(No.`"+a.smRank+"`->No.`"+t+"`)")),c.show("自<em>"+s.getDateString(o)+'</em>以来，你的神秘系数排名共<b style="color: '+(r?"#F00":"#393")+'">'+(r?"上升":"下降")+"</b>了"+("<em>"+Math.abs(t-a.smRank)+"</em>名"))}else i<0&&n(t)}}else n(t)}},n.addHomePageThreadFastGotoLink=function(){$(".index1").on("mouseenter",'li.b_tit4:has("a"), li.b_tit4_1:has("a")',function(){var e=$(this);e.css("position","relative").prepend('<a class="pd_thread_goto" href="'+e.find("a").attr("href")+'&page=e#a">&raquo;</a>')}).on("mouseleave",'li.b_tit4:has("a"), li.b_tit4_1:has("a")',function(){$(this).css("position","static").find(".pd_thread_goto").remove()})},n.showVipSurplusTime=function(){var e=function(e){$('a[href="kf_growup.php"]').parent().after('<div class="line"></div><div style="width: 300px;"><a href="kf_vmember.php" class="indbox'+(e>0?5:6)+'">VIP会员 '+("("+(e>0?"剩余"+e+"小时":"参与论坛获得的额外权限")+')</a><div class="c"></div></div>'))},t=parseInt(s.getCookie(f.default.vipSurplusTimeCookieName));isNaN(t)||t<0?(console.log("检查VIP剩余时间Start"),$.get("kf_vmember.php?t="+(new Date).getTime(),function(t){var n=0,a=/我的VIP剩余时间\s*<b>(\d+)<\/b>\s*小时/i.exec(t);a&&(n=parseInt(a[1])),s.setCookie(f.default.vipSurplusTimeCookieName,n,s.getDate("+"+f.default.vipSurplusTimeExpires+"m")),e(n)})):e(t)},n.addSearchTypeSelectBoxInHomePage=function(){var e=$('form[action="search.php?"]');e.attr("name","pdSearchForm");var t=e.find('[type="text"][name="keyword"]');t.css("width","116px"),$('<div class="pd_search_type"><span>标题</span><i>&#8744;</i></div>').insertAfter(t)}},{"./Const":6,"./Info":10,"./Log":12,"./Msg":15,"./TmpLog":21,"./Util":22}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={uid:0,userName:"",isInHomePage:"/"===location.pathname||"/index.php"===location.pathname,isMobile:!1,isInMiaolaDomain:location.host.endsWith(".miaola.info"),version:"",w:"undefined"!=typeof unsafeWindow?unsafeWindow:window,storageType:"Default"};n.default=a},{}],11:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.modifyItemDescription=n.addBatchBuyItemsLink=n.addSampleItemTips=n.getItemUsedInfo=n.enhanceMyItemsPage=n.addBatchUseAndConvertItemTypesButton=n.addConvertEnergyAndRestoreItemsButton=n.addSellAndUseItemsButton=n.getLevelByName=n.getTypeIdByName=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=e("./Info"),l=i(r),s=e("./Util"),d=a(s),c=e("./Msg"),p=a(c),f=e("./Const"),u=i(f),h=e("./Config"),m=e("./Log"),g=a(m),v=e("./Public"),_=a(v),b=function(e){switch(e){case 1:return 2;case 2:return 10;case 3:return 50;case 4:return 300;case 5:return 2e3;default:return 0}},y=function(e){switch(e){case 1:return 10;case 2:return 50;case 3:return 300;case 4:return 2e3;case 5:return 1e4;default:return 0}},x=function(e){switch(e){case 3:return 300;case 4:return 2e3;case 5:return 1e4;default:return 0}},k=(n.getTypeIdByName=function(e){switch(e){case"零时迷子的碎片":return 1;case"被遗弃的告白信":return 2;case"学校天台的钥匙":return 3;case"TMA最新作压缩包":return 4;case"LOLI的钱包":return 5;case"棒棒糖":return 6;case"蕾米莉亚同人漫画":return 11;case"十六夜同人漫画":return 7;case"档案室钥匙":return 8;case"傲娇LOLI娇蛮音CD":return 12;case"整形优惠卷":return 9;case"消逝之药":return 10;default:return 0}},n.getLevelByName=function(e){switch(e){case"零时迷子的碎片":case"被遗弃的告白信":case"学校天台的钥匙":case"TMA最新作压缩包":return 1;case"LOLI的钱包":case"棒棒糖":return 2;case"蕾米莉亚同人漫画":case"十六夜同人漫画":return 3;case"档案室钥匙":case"傲娇LOLI娇蛮音CD":return 4;case"整形优惠卷":case"消逝之药":return 5;default:return 0}}),C=function(e){switch(e){case"蕾米莉亚同人漫画":case"十六夜同人漫画":return 50;case"档案室钥匙":case"傲娇LOLI娇蛮音CD":return 30;case"整形优惠卷":case"消逝之药":return 10;default:return-1}},w=function(e,t){if(/(错误的物品编号|无法再使用|该道具已经被使用)/.test(e))return-1;if(t>=7&&t<=12){if(/成功！/.test(e))return{"效果":1}}else{var n=/恢复能量增加了\s*(\d+)\s*点/i.exec(e);if(n)return{"能量":parseInt(n[1])};if(n=/(\d+)KFB/i.exec(e))return{KFB:parseInt(n[1])};if(n=/(\d+)点?贡献/i.exec(e))return{"贡献":parseInt(n[1])};if(n=/贡献\+(\d+)/i.exec(e))return{"贡献":parseInt(n[1])}}return{}},I=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[],a=e.match(/kf_fw_ig_my\.php\?pro=\d+/g);if(a)for(var i=0;i<a.length&&!(t>0&&i+1>t);i++){var o=/pro=(\d+)/i.exec(a[i]);o&&n.push(parseInt(o[1]))}return n},S=function(e,t){var n={type:1,itemIdList:[],safeId:"",itemLevel:0,itemTypeId:0,itemName:"",$itemLine:null,isTypeBatch:!1};$.extend(n,e),t&&(1===t.round?(console.log("循环使用道具Start，使用道具数量："+t.itemNum+"，有效道具使用次数上限："+(t.maxEffectiveItemCount?t.maxEffectiveItemCount:"无限制")+"，恢复道具成功次数上限："+(t.maxSuccessRestoreItemCount?t.maxSuccessRestoreItemCount:"无限制")),$(".kf_fw_ig1:last").parent().append('\n<ul class="pd_result">\n  <li class="pd_stat">\n    <strong>\n    对<em>'+t.itemNum+"</em>个【Lv."+n.itemLevel+"："+n.itemName+"】道具的循环使用开始（当前道具恢复能量<em>"+t.totalEnergyNum+"</em>点）<br>\n    （有效道具使用次数上限：<em>"+(t.maxEffectiveItemCount?t.maxEffectiveItemCount:"无限制")+"</em>，\n    恢复道具成功次数上限：<em>"+(t.maxSuccessRestoreItemCount?t.maxSuccessRestoreItemCount:"无限制")+"</em>）\n    </strong>\n  </li>\n</ul>\n")):$(".pd_result:last").append('<div class="pd_result_sep"></div>'),$(".pd_result:last").append('<li class="pd_stat" style="color: #ff3399;"><strong>第'+t.round+"轮循环开始：</strong></li>")),t?$(".pd_result:last").append("<li><strong>使用结果：</strong></li>"):$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+n.itemLevel+"："+n.itemName+"】使用结果：</strong></li></ul>");var a=0,i=0,o={"有效道具":0,"无效道具":0},r=[],l=!1;$(document).clearQueue("UseItems"),$.each(n.itemIdList,function(e,s){$(document).queue("UseItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_doit.php?id="+s+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(c){_.showFormatLog("使用道具",c);var p=d.getResponseMsg(c),f=p.type,u=p.msg;if(1!==f||/(错误的物品编号|无法再使用|该道具已经被使用)/.test(u))i++,/无法再使用/.test(u)&&(r=[]);else{a++,r.push(s);var h=w(u,n.itemTypeId);if(h!==-1&&($.isEmptyObject(h)?o["无效道具"]++:o["有效道具"]++,n.itemTypeId<=6)){var m=!0,g=!1,v=void 0;try{for(var b,y=Object.keys(h)[Symbol.iterator]();!(m=(b=y.next()).done);m=!0){var x=b.value;"undefined"==typeof o[x]?o[x]=h[x]:o[x]+=h[x]}}catch(e){g=!0,v=e}finally{try{!m&&y.return&&y.return()}finally{if(g)throw v}}}}$(".pd_result:last").append("<li><b>第"+(e+1)+"次：</b>"+u+"</li>"),t&&t.maxEffectiveItemCount&&t.stat["有效道具"]+o["有效道具"]>=t.maxEffectiveItemCount&&(l=!0,console.log("有效道具使用次数到达设定上限，循环使用操作停止"),$(".pd_result:last").append('<li><span class="pd_notice">（有效道具使用次数到达设定上限，循环操作中止）</span></li>'))},error:function(){i++},complete:function(){var s=$(".pd_countdown:last");if(s.text(parseInt(s.text())-1),l=l||s.closest(".pd_msg").data("stop"),l&&($(document).clearQueue("UseItems"),n.isTypeBatch&&$(document).clearQueue("UseItemTypes")),l||e===n.itemIdList.length-1){p.remove(s.closest(".pd_msg")),0===o["有效道具"]&&delete o["有效道具"],0===o["无效道具"]&&delete o["无效道具"],!t&&a>0&&g.push("使用道具","共有`"+a+"`个【`Lv."+n.itemLevel+"："+n.itemName+"`】道具被使用",{gain:$.extend({},o,{"已使用道具":a}),pay:{"道具":-a}});var d="",c="",f="",h=!0,m=!1,v=void 0;try{for(var _,b=Object.keys(o)[Symbol.iterator]();!(h=(_=b.next()).done);h=!0){var y=_.value;d+="，"+y+"+"+o[y],c+="<i>"+y+"<em>+"+o[y]+"</em></i>",f+="<i>"+y+"<em>+"+o[y]+"</em></i> ",t&&("undefined"==typeof t.stat[y]?t.stat[y]=o[y]:t.stat[y]+=o[y])}}catch(e){m=!0,v=e}finally{try{!h&&b.return&&b.return()}finally{if(m)throw v}}console.log("共有"+a+"个道具被使用"+(i>0?"，共有"+i+"个道具未能使用":"")+d),p.show("<strong>共有<em>"+a+"</em>个道具被使用"+(i>0?"，共有<em>"+i+"</em>个道具未能使用":"")+"</strong>"+c,-1),""===f&&(f='<span class="pd_notice">无</span>'),$(".pd_result:last").append('<li class="pd_stat"><b>统计结果（共有<em>'+a+"</em>个道具被使用）：</b><br>"+f+"</li>"),2===n.type?$('.kf_fw_ig1 input[type="checkbox"]:checked').closest("tr").fadeOut("normal",function(){$(this).remove()}):(M(n.$itemLine,a,-a),O(n.$itemLine.closest("tbody").find("tr:gt(1) > td:nth-child(2) > a"))),"零时迷子的碎片"===n.itemName&&E(),t?(n.itemIdList=r,n.itemIdList.length||(l=!0),t.countStat["被使用次数"]+=a,t.stat["道具"]-=a,t.stat["已使用道具"]+=a,L(l?0:2,n,t)):n.isTypeBatch&&$(document).dequeue("UseItemTypes")}else setTimeout(function(){return $(document).dequeue("UseItems")},"function"==typeof u.default.specialAjaxInterval?u.default.specialAjaxInterval():u.default.specialAjaxInterval)}})})}),$(document).dequeue("UseItems")},T=function(e,t){var n={type:1,itemIdList:[],safeId:"",itemLevel:0,itemTypeId:0,itemName:"",$itemLine:null};$.extend(n,e),t?$(".pd_result:last").append('<li class="pd_result_sep_inner"></li><li><strong>恢复结果：</strong></li>'):$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+n.itemLevel+"："+n.itemName+"】恢复结果：</strong></li></ul>");var a=0,i=0,o=0,r=y(n.itemLevel),l=!1,s=[];$(document).clearQueue("RestoreItems"),$.each(n.itemIdList,function(e,c){$(document).queue("RestoreItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_doit.php?renew="+n.safeId+"&id="+c+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(n){_.showFormatLog("恢复道具",n);var p=d.getResponseMsg(n),f=p.type,u=p.msg;1===f&&(/该道具已经被恢复/.test(u)?(u="该道具已经被恢复",a++,o+=r,s.push(c),t&&t.maxSuccessRestoreItemCount&&t.countStat["恢复成功次数"]+a>=t.maxSuccessRestoreItemCount&&(l=!0,u+='<span class="pd_notice">（恢复道具成功次数已达到设定上限，恢复操作中止）</span>')):/恢复失败/.test(u)?(u="该道具恢复失败",i++):/你的能量不足以恢复本道具/.test(u)&&(l=!0,u='你的能量不足以恢复本道具<span class="pd_notice">（恢复操作中止）</span>')),$(".pd_result:last").append("<li><b>第"+(e+1)+"次：</b>"+u+"</li>")},complete:function(){var r=$(".pd_countdown:last");r.text(parseInt(r.text())-1),l=l||r.closest(".pd_msg").data("stop"),l&&$(document).clearQueue("RestoreItems"),l||e===n.itemIdList.length-1?(p.remove(r.closest(".pd_msg")),!t&&(a>0||i>0)&&g.push("恢复道具","共有`"+a+"`个【`Lv."+n.itemLevel+"："+n.itemName+"`】道具恢复成功，共有`"+i+"`个道具恢复失败",{gain:{"道具":a},pay:{"已使用道具":-(a+i),"能量":-o}}),console.log("共有"+a+"个道具恢复成功，共有"+i+"个道具恢复失败，能量-"+o),p.show("<strong>共有<em>"+a+"</em>个道具恢复成功，共有<em>"+i+"</em>个道具恢复失败</strong>"+("<i>能量<ins>-"+o+"</ins></i>"),-1),$(".pd_result:last").append('<li class="pd_stat">共有<em>'+a+"</em>个道具恢复成功，共有<em>"+i+"</em>个道具恢复失败，"+("<i>能量<ins>-"+o+"</ins></i></li>")),2===n.type&&$('.kf_fw_ig1:eq(1) input[type="checkbox"]:checked').closest("tr").fadeOut("normal",function(){$(this).remove()}),M(n.$itemLine,-(a+i),a,-o),t&&(n.itemIdList=s,n.itemIdList.length||(l=!0),l||t.round++,t.totalEnergyNum-=o,t.countStat["恢复成功次数"]+=a,t.countStat["恢复失败次数"]+=i,t.stat["能量"]-=o,t.stat["道具"]+=a,t.stat["已使用道具"]-=a+i,L(l?0:1,n,t))):setTimeout(function(){return $(document).dequeue("RestoreItems")},"function"==typeof u.default.specialAjaxInterval?u.default.specialAjaxInterval():u.default.specialAjaxInterval)}})})}),$(document).dequeue("RestoreItems")},L=function(e,t,n){n.countStat&&!$.isEmptyObject(n.countStat)||(n.countStat={"被使用次数":0,"恢复成功次数":0,"恢复失败次数":0}),n.stat&&!$.isEmptyObject(n.stat)||(n.stat={"能量":0,"道具":0,"已使用道具":0,"有效道具":0,"无效道具":0}),$(".pd_msg").length>=5&&p.remove($(".pd_msg:first"));var a=function(e,a){var i="",o=!0,r=!1,l=void 0;try{for(var s,c=Object.keys(a)[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var p=s.value;e>0&&("道具"===p||"已使用道具"===p)||(i+="<i>"+p+d.getStatFormatNumber(n.stat[p])+"</i> ")}}catch(e){r=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(r)throw l}}$(".pd_result:last").append('\n<li class="pd_result_sep'+(e>0?"_inner":"")+'"></li>\n<li class="pd_stat">\n  <strong>\n    '+(e>0?"截至目前为止的统计":"【Lv."+t.itemLevel+"："+t.itemName+"】循环使用最终统计")+"（当前道具恢复能量<em>"+n.totalEnergyNum+'</em>点）：\n  </strong>\n</li>\n<li class="pd_stat">\n  '+(e>0?"":"共进行了<em>"+n.round+"</em>轮循环：")+"\n  <i>被使用次数<em>+"+n.countStat["被使用次数"]+"</em></i>\n  <i>恢复成功次数<em>+"+n.countStat["恢复成功次数"]+"</em></i>\n  <i>恢复失败次数<em>+"+n.countStat["恢复失败次数"]+'</em></i>\n</li>\n<li class="pd_stat">'+i+"</li>\n")};if(1===e)a(e,n.stat),p.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.itemIdList.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),setTimeout(function(){S(t,n)},1===n.round?500:"function"==typeof u.default.cycleUseItemsFirstAjaxInterval?u.default.cycleUseItemsFirstAjaxInterval():u.default.cycleUseItemsFirstAjaxInterval);else if(2===e)p.wait('<strong>正在恢复道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.itemIdList.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),setTimeout(function(){return T(t,n)},"function"==typeof u.default.cycleUseItemsFirstAjaxInterval?u.default.cycleUseItemsFirstAjaxInterval():u.default.cycleUseItemsFirstAjaxInterval);else{0===n.stat["道具"]&&delete n.stat["道具"],0===n.stat["已使用道具"]&&delete n.stat["已使用道具"],0===n.stat["有效道具"]&&delete n.stat["有效道具"],0===n.stat["无效道具"]&&delete n.stat["无效道具"];var i={},o={};for(var r in n.stat)n.stat[r]>0?i[r]=n.stat[r]:o[r]=n.stat[r];n.countStat["被使用次数"]>0&&g.push("循环使用道具","对`"+n.itemNum+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具进行了`"+n.round+"`轮循环使用"+("(被使用次数`+"+n.countStat["被使用次数"]+"`，恢复成功次数`+"+n.countStat["恢复成功次数"]+"`，")+("恢复失败次数`+"+n.countStat["恢复失败次数"]+"`)"),{gain:i,pay:o}),console.log("共进行了"+n.round+"轮循环，被使用次数+"+n.countStat["被使用次数"]+"，恢复成功次数+"+n.countStat["恢复成功次数"]+"，"+("恢复失败次数+"+n.countStat["恢复失败次数"]+"，能量"+n.stat["能量"])),p.show("<strong>共进行了<em>"+n.round+"</em>轮循环</strong><i>被使用次数<em>+"+n.countStat["被使用次数"]+"</em></i>"+("<i>恢复成功次数<em>+"+n.countStat["恢复成功次数"]+"</em></i><i>恢复失败次数<em>+"+n.countStat["恢复失败次数"]+"</em></i>")+("<i>能量<ins>"+n.stat["能量"]+'</ins></i><a href="#">清除消息框</a>'),-1).find("a").click(function(e){e.preventDefault(),p.destroy()}),a(e,n.stat)}},D=function(e){var t={type:1,itemIdList:[],safeId:"",itemLevel:0,itemName:"",$itemLine:null,isTypeBatch:!1};$.extend(t,e),$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+t.itemLevel+"："+t.itemName+"】转换结果：</strong></li></ul>");var n=0,a=0,i=b(t.itemLevel);$(document).clearQueue("ConvertItemsToEnergy"),$.each(t.itemIdList,function(e,o){$(document).queue("ConvertItemsToEnergy",function(){$.ajax({type:"GET",url:"kf_fw_ig_doit.php?tomp="+t.safeId+"&id="+o+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(e){_.showFormatLog("将道具转换为能量",e);var t=d.getResponseMsg(e),i=t.msg;/转换为了\s*\d+\s*点能量/.test(i)?n++:a++},error:function(){a++},complete:function(){var o=$(".pd_countdown:last");o.text(parseInt(o.text())-1);var r=o.closest(".pd_msg").data("stop");if(r&&($(document).clearQueue("ConvertItemsToEnergy"),t.isTypeBatch&&$(document).clearQueue("ConvertItemTypesToEnergy")),r||e===t.itemIdList.length-1){p.remove(o.closest(".pd_msg"));var l=n*i;n>0&&g.push("将道具转换为能量","共有`"+n+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具成功转换为能量",{gain:{"能量":l},pay:{"已使用道具":-n}}),console.log("共有"+n+"个道具成功转换为能量"+(a>0?"，共有"+a+"个道具转换失败":"")+"，能量+"+l),p.show("<strong>共有<em>"+n+"</em>个道具成功转换为能量"+(a>0?"，共有<em>"+a+"</em>个道具转换失败":"")+"</strong>"+("<i>能量<em>+"+l+"</em></i>"),-1),$(".pd_result:last").append('<li class="pd_stat">共有<em>'+n+"</em>个道具成功转换为能量"+(a>0?"，共有<em>"+a+"</em>个道具转换失败":"")+"，"+("<i>能量<em>+"+l+"</em></i></li>")),2===t.type&&$('.kf_fw_ig1:eq(1) input[type="checkbox"]:checked').closest("tr").fadeOut("normal",function(){$(this).remove()}),M(t.$itemLine,-n,null,l),t.isTypeBatch&&$(document).dequeue("ConvertItemTypesToEnergy")}else setTimeout(function(){return $(document).dequeue("ConvertItemsToEnergy")},u.default.defAjaxInterval)}})})}),$(document).dequeue("ConvertItemsToEnergy")},U=function(e){var t={itemIdList:[],itemLevel:0,itemName:""};$.extend(t,e),$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+t.itemLevel+"："+t.itemName+"】出售结果：</strong></li></ul>");var n=0,a=0,i=0;$(document).clearQueue("SellItems"),$.each(t.itemIdList,function(e,o){$(document).queue("SellItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_shop.php?sell=yes&id="+o+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(e){_.showFormatLog("出售道具",e);var o=d.getResponseMsg(e),r=o.msg;/出售成功/.test(r)?(n++,i+=x(t.itemLevel)):a++},error:function(){a++},complete:function(){var o=$(".pd_countdown:last");o.text(parseInt(o.text())-1);var r=o.closest(".pd_msg").data("stop");r&&$(document).clearQueue("SellItems"),r||e===t.itemIdList.length-1?(p.remove(o.closest(".pd_msg")),n>0&&g.push("出售道具","共有`"+n+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具出售成功",{gain:{KFB:i},pay:{"道具":-n}}),$('.kf_fw_ig1 input[type="checkbox"]:checked').closest("tr").fadeOut("normal",function(){$(this).remove()}),console.log("共有"+n+"个道具出售成功，共有"+a+"个道具出售失败，KFB+"+i),p.show("<strong>共有<em>"+n+"</em>个道具出售成功"+(a>0?"，共有<em>"+a+"</em>个道具出售失败":"")+"</strong>"+("<i>KFB<em>+"+i+"</em></i>"),-1),$(".pd_result:last").append('<li class="pd_stat">共有<em>'+n+"</em>个道具出售成功"+(a>0?"，共有<em>"+a+"</em>个道具出售失败":"")+"，"+("<i>KFB<em>+"+i+"</em></i></li>"))):setTimeout(function(){return $(document).dequeue("SellItems")},u.default.defAjaxInterval)}})})}),$(document).dequeue("SellItems")},F=(n.addSellAndUseItemsButton=function(){var e=_.getSafeId();if(e){var t=$(".kf_fw_ig1 > tbody > tr:last-child"),n=t.find("td:first-child").text();if(n){var a=/(\d+)级道具/.exec(t.find("td:nth-child(2)").text());if(a){var i=parseInt(a[1]),o=parseInt(d.getUrlParam("lv"));o&&($(".kf_fw_ig1 > tbody > tr > td:last-child").each(function(){var e=/kf_fw_ig_my\.php\?pro=(\d+)/.exec($(this).find("a").attr("href"));e&&$(this).css("width","163").parent().append('<td style="width: 20px; padding-right: 5px;"><input class="pd_input" type="checkbox" value="'+e[1]+'"></td>')}),$(".kf_fw_ig1 > tbody > tr:lt(2)").find("td").attr("colspan",5),$('\n<div class="pd_item_btns">\n  '+(o>=7&&o<=12?'<button name="sellItem" style="color: #f00;" title="批量出售指定道具">出售道具</button>':"")+"\n  "+(o>1?'<button name="cycleUseItem" style="color: #00f;" title="循环使用和恢复指定数量的道具，直至停止操作或没有道具可以恢复">循环使用</button>':"")+'\n  <button name="useItem" title="批量使用指定道具">使用道具</button>\n  <button name="selectAll">全选</button>\n  <button name="selectInverse">反选</button>\n</div>\n').insertAfter(".kf_fw_ig1").find('[name="useItem"]').click(function(){p.destroy();var t=[];$('.kf_fw_ig1 [type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length&&confirm("共选择了"+t.length+"个道具，是否批量使用道具？")&&(p.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),S({type:2,itemIdList:t,safeId:e,itemLevel:i,itemTypeId:o,itemName:n}))}).end().find('[name="selectAll"]').click(function(){$('.kf_fw_ig1 [type="checkbox"]').prop("checked",!0)}).end().find('[name="selectInverse"]').click(function(){$('.kf_fw_ig1 [type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))})}).end().find('[name="cycleUseItem"]').click(function(){p.destroy();var t=[];if($('.kf_fw_ig1 [type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length){var a=prompt("你要循环使用多少个道具？\n（可直接填写道具数量，也可使用“道具数量|有效道具使用次数上限|恢复道具成功次数上限”的格式[设为0表示不限制]，例一：7；例二：5|3；例三：3|0|6）",t.length);if(null!==a){if(a=$.trim(a),!/\d+(\|\d+)?(\|\d+)?/.test(a))return void alert("格式不正确");var r=a.split("|"),l=parseInt(r[0]),s=0,d=0;if(l){"undefined"!=typeof r[1]&&(s=parseInt(r[1])),"undefined"!=typeof r[2]&&(d=parseInt(r[2])),p.destroy(),l>t.length&&(l=t.length);for(var c=[],f=0;f<l;f++)c.push(t[f]);t=c,p.wait("正在获取当前道具相关信息，请稍后&hellip;"),$.get("kf_fw_ig_renew.php?t="+(new Date).getTime(),function(a){p.destroy();var r=B(a);E(a),L(1,{type:2,itemIdList:t,safeId:e,itemLevel:i,itemTypeId:o,itemName:n},{itemNum:t.length,round:1,totalEnergyNum:r,countStat:{},stat:{},maxEffectiveItemCount:s,maxSuccessRestoreItemCount:d})})}}}}).end().find('[name="sellItem"]').click(function(){p.destroy();var e=[];$('.kf_fw_ig1 [type="checkbox"]:checked').each(function(){e.push(parseInt($(this).val()))}),e.length&&confirm("共选择了"+e.length+"个道具，是否批量出售道具？")&&(p.wait('<strong>正在出售道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+e.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),U({itemIdList:e,itemLevel:i,itemName:n}))}),E())}}}},n.addConvertEnergyAndRestoreItemsButton=function(){var e=_.getSafeId();if(e){var t=$(".kf_fw_ig1:eq(1) > tbody > tr:last-child"),n=t.find("td:first-child").text();if(n){var a=/(\d+)级道具/.exec(t.find("td:nth-child(2)").text());if(a){var i=parseInt(a[1]),o=parseInt(d.getUrlParam("lv"));o&&($(".kf_fw_ig1:eq(1) > tbody > tr > td:last-child").each(function(){var e=/kf_fw_ig_my\.php\?pro=(\d+)/.exec($(this).find("a").attr("href"));e&&$(this).css("width","500").parent().append('<td style="width: 20px; padding-right: 5px;"><input class="pd_input" type="checkbox" value="'+e[1]+'"></td>')}),$('\n<div class="pd_item_btns">\n  <button class="pd_highlight" name="convertEnergy" title="批量将指定道具转换为能量">转换能量</button>\n  <button name="restoreItem" title="批量恢复指定道具">恢复道具</button>\n  <button name="selectAll">全选</button>\n  <button name="selectInverse">反选</button>\n</div>\n').insertAfter(".kf_fw_ig1:eq(1)").find('[name="convertEnergy"]').click(function(){p.destroy();var t=[];$('.kf_fw_ig1:eq(1) input[type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length&&confirm("共选择了"+t.length+"个道具，是否转换为能量？")&&(p.wait('<strong>正在转换能量中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),D({type:2,itemIdList:t,safeId:e,itemLevel:i,itemName:n}))}).end().find('[name="restoreItem"]').click(function(){p.destroy();var t=[];if($('.kf_fw_ig1:eq(1) input[type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length){var a=t.length*y(i);if(confirm("共选择了"+t.length+"个道具，共需要"+a+"点恢复能量，是否恢复道具？")){var r=parseInt($('.kf_fw_ig1 td:contains("道具恢复能量")').find("span").text());if(!r||r<a)return void alert("所需恢复能量不足");p.wait('<strong>正在恢复道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),T({type:2,itemIdList:t,safeId:e,itemLevel:i,itemTypeId:o,itemName:n})}}}).end().find('[name="selectAll"]').click(function(){$('.kf_fw_ig1:eq(1) input[type="checkbox"]').prop("checked",!0)}).end().find('[name="selectInverse"]').click(function(){$('.kf_fw_ig1:eq(1) input[type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))})}))}}}},n.addBatchUseAndConvertItemTypesButton=function(){var e=_.getSafeId();e&&$('\n<div class="pd_item_btns">\n  <label style="margin-right: 5px;" title="延长道具批量操作的时间间隔（在2~6秒之间），以模拟手动使用和恢复道具（仅限此页面有效）">\n    <input name="simulateManualHandleItemEnabled" type="checkbox" '+(Config.simulateManualHandleItemEnabled?"checked":"")+'>\n    模拟手动操作道具\n  </label>\n  <button title="批量使用指定种类的道具" data-action="useItemTypes">批量使用</button>\n  <button class="pd_highlight" title="批量将指定种类的道具转换为能量" data-action="convertItemTypes">批量转换</button>\n  <button data-action="selectAll">全选</button>\n  <button data-action="selectInverse">反选</button>\n</div>\n').insertAfter(".pd_my_items").on("click","button",function(){var t=$(this).data("action");if("useItemTypes"===t||"convertItemTypes"===t){var n=function(){var n=[];if($(".pd_item_type_chk:checked").each(function(){var e=$(this).closest("tr"),a=parseInt(e.find("td:first-child").text()),i=parseInt(e.data("itemTypeId")),o=e.find("td:nth-child(2) > a").text();if(!(isNaN(i)||i<=0||"convertItemTypes"===t&&1===i)){var r=e.find("td:last-child").find("useItemTypes"===t?"a:first-child":"a:last-child").attr("href")+"&t="+(new Date).getTime();n.push({itemTypeId:i,itemLevel:a,itemName:o,$itemLine:e,itemListUrl:r})}}),!n.length)return{v:void 0};var a=parseInt(prompt("在指定种类道具中你要"+("useItemTypes"===t?"使用":"转换")+"多少个道具？（0表示不限制）",0));if(isNaN(a)||a<0)return{v:void 0};p.destroy();var i="useItemTypes"===t?"UseItemTypes":"ConvertItemTypesToEnergy";$(document).clearQueue(i),$.each(n,function(n,o){$(document).queue(i,function(){var n=p.wait("正在获取本种类"+("useItemTypes"===t?"未":"已")+"使用道具列表，请稍后&hellip;");$.ajax({
type:"GET",url:o.itemListUrl,timeout:u.default.defAjaxTimeout,success:function(r){p.remove(n);var l=I(r,a);return l.length?void("useItemTypes"===t?(console.log("批量使用道具Start，使用道具数量："+l.length),p.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+l.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),S({type:1,itemIdList:l,safeId:e,itemLevel:o.itemLevel,itemTypeId:o.itemTypeId,itemName:o.itemName,$itemLine:o.$itemLine,isTypeBatch:!0})):(console.log("批量转换道具为能量Start，转换道具数量："+l.length),p.wait('<strong>正在转换能量中&hellip;</strong><i>剩余：<em class="pd_countdown">'+l.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),D({type:1,itemIdList:l,safeId:e,itemLevel:o.itemLevel,itemName:o.itemName,$itemLine:o.$itemLine,isTypeBatch:!0}))):void $(document).dequeue(i)},error:function(){p.remove(n),$(document).dequeue(i)}})})}),$(document).dequeue(i)}();if("object"===("undefined"==typeof n?"undefined":o(n)))return n.v}else"selectAll"===t?$(".pd_item_type_chk").prop("checked",!0):"selectInverse"===t&&$(".pd_item_type_chk").each(function(){$(this).prop("checked",!$(this).prop("checked"))})}).find('[name="simulateManualHandleItemEnabled"]').click(function(){"_specialAjaxInterval"in u.default||(u.default._specialAjaxInterval=u.default.specialAjaxInterval);var e=$(this).prop("checked");e?u.default.specialAjaxInterval=function(){return Math.floor(4e3*Math.random())+2e3}:u.default.specialAjaxInterval=u.default._specialAjaxInterval,(0,h.read)(),Config.simulateManualHandleItemEnabled=e,(0,h.write)()}).triggerHandler("click")},function(e){var t=_.getSafeId();t&&e.on("click",'a[href="#"]',function(e){e.preventDefault();var n=$(this);if(!n.is(".pd_disabled_link")){var a=n.closest("tr"),i=parseInt(a.find("td:first-child").text()),r=parseInt(a.data("itemTypeId")),l=a.find("td:nth-child(2) > a").text(),s=parseInt(a.find("td:nth-child(3) > .pd_usable_num").text()),d=parseInt(a.find("td:nth-child(3) > .pd_used_num").text()),c="";if(!(isNaN(r)||r<=0))if(n.is(".pd_items_batch_use")){var f=function(){var e=parseInt(prompt("你要使用多少个【Lv."+i+"："+l+"】道具？（0表示不限制）",s?s:0));return isNaN(e)||e<0?{v:void 0}:(p.destroy(),p.wait("正在获取本种类未使用道具列表，请稍后&hellip;"),c=a.find("td:last-child").find("a:first-child").attr("href")+"&t="+(new Date).getTime(),void $.get(c,function(n){p.destroy();var o=I(n,e);return o.length?(console.log("批量使用道具Start，使用道具数量："+o.length),p.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+o.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),void S({type:1,itemIdList:o,safeId:t,itemLevel:i,itemTypeId:r,itemName:l,$itemLine:a})):void alert("本种类没有未使用的道具")}))}();if("object"===("undefined"==typeof f?"undefined":o(f)))return f.v}else if(n.is(".pd_items_cycle_use")){var u=function(){var e=prompt("你要循环使用多少个【Lv."+i+"："+l+"】道具？\n（可直接填写道具数量，也可使用“道具数量|有效道具使用次数上限|恢复道具成功次数上限”的格式[设为0表示不限制]，例一：7；例二：5|3；例三：3|0|6）",s?s:0);if(null===e)return{v:void 0};if(e=$.trim(e),!/\d+(\|\d+)?(\|\d+)?/.test(e))return alert("格式不正确"),{v:void 0};var n=e.split("|"),o=0,d=0,f=0;return o=parseInt(n[0]),isNaN(o)||o<0?{v:void 0}:("undefined"!=typeof n[1]&&(d=parseInt(n[1])),"undefined"!=typeof n[2]&&(f=parseInt(n[2])),p.destroy(),p.wait("正在获取本种类未使用道具列表，请稍后&hellip;"),c=a.find("td:last-child").find("a:first-child").attr("href")+"&t="+(new Date).getTime(),void $.get(c,function(e){p.destroy();var n=I(e,o);return n.length?(p.wait("正在获取当前道具相关信息，请稍后&hellip;"),void $.get("kf_fw_ig_my.php?t="+(new Date).getTime(),function(e){N(e),$.get("kf_fw_ig_renew.php?t="+(new Date).getTime(),function(e){p.destroy();var o=B(e);E(e),L(1,{type:1,itemIdList:n,safeId:t,itemLevel:i,itemTypeId:r,itemName:l,$itemLine:a},{itemNum:n.length,round:1,totalEnergyNum:o,countStat:{},stat:{},maxEffectiveItemCount:d,maxSuccessRestoreItemCount:f})})})):void alert("本种类没有未使用的道具")}))}();if("object"===("undefined"==typeof u?"undefined":o(u)))return u.v}else if(n.is(".pd_items_batch_restore")){var h=function(){var e=parseInt(prompt("你要恢复多少个【Lv."+i+"："+l+"】道具？（0表示不限制）",d?d:0));return isNaN(e)||e<0?{v:void 0}:(p.destroy(),c=a.find("td:last-child").find("a:last-child").attr("href")+"&t="+(new Date).getTime(),p.wait("正在获取本种类已使用道具列表，请稍后&hellip;"),void $.get(c,function(n){p.destroy();var o=I(n,e);return o.length?(console.log("批量恢复道具Start，恢复道具数量："+o.length),p.wait('<strong>正在恢复道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+o.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),void T({type:1,itemIdList:o,safeId:t,itemLevel:i,itemTypeId:r,itemName:l,$itemLine:a})):void alert("本种类没有已使用的道具")}))}();if("object"===("undefined"==typeof h?"undefined":o(h)))return h.v}else if(n.is(".pd_items_batch_convert")){var m=function(){var e=parseInt(prompt("你要将多少个【Lv."+i+"："+l+"】道具转换为能量？（0表示不限制）",d?d:0));return isNaN(e)||e<0?{v:void 0}:(p.destroy(),c=a.find("td:last-child").find("a:last-child").attr("href")+"&t="+(new Date).getTime(),p.wait("正在获取本种类已使用道具列表，请稍后&hellip;"),void $.get(c,function(n){p.destroy();var o=I(n,e);return o.length?(console.log("批量转换道具为能量Start，转换道具数量："+o.length),p.wait('<strong>正在转换能量中&hellip;</strong><i>剩余：<em class="pd_countdown">'+o.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),void D({type:1,itemIdList:o,safeId:t,itemLevel:i,itemName:l,$itemLine:a})):void alert("本种类没有已使用的道具")}))}();if("object"===("undefined"==typeof m?"undefined":o(m)))return m.v}}})}),M=(n.enhanceMyItemsPage=function(){var e=$(".kf_fw_ig1:last");e.addClass("pd_my_items").find("tbody > tr").each(function(e){var t=$(this);if(0===e)t.find("td").attr("colspan",6);else if(1===e)t.find("td:first-child").css("width","75px").end().find("td:nth-child(2)").css("width","185px").end().find("td:nth-child(3)").css("width","105px").html('<span class="pd_usable_num">可用数</span> / <span class="pd_used_num pd_custom_tips">已用数</span>').end().find("td:last-child").css("width","165px").before('<td style="width: 135px;">使用道具</td><td style="width: 135px;">恢复道具 和 转换能量</td>');else{t.find("td:first-child").prepend('<input class="pd_input pd_item_type_chk" type="checkbox">');var n=2===e?"pd_disabled_link":"";t.find("td:nth-child(3)").wrapInner('<span class="pd_usable_num" style="margin-left: 5px;"></span>').append(' / <span class="pd_used_num pd_custom_tips">?</span>').after('\n<td>\n  <a class="pd_items_batch_use" href="#" title="批量使用指定数量的道具">批量使用</a>\n  <a class="pd_items_cycle_use pd_highlight '+n+'" href="#" title="循环使用和恢复指定数量的道具，直至停止操作或没有道具可以恢复">循环使用</a>\n</td>\n<td>\n  <a class="pd_items_batch_restore '+n+'" href="#" title="批量恢复指定数量的道具">批量恢复</a>\n  <a class="pd_items_batch_convert pd_highlight '+n+'" href="#" title="批量将指定数量的道具转换为能量">批量转换</a>\n</td>\n');var a=t.find("td:last-child"),i=/lv=(\d+)/i.exec(a.find("a").attr("href"));if(i){var o=parseInt(i[1]);t.data("itemTypeId",o),a.find("a").text("未使用列表").after('<a class="pd_highlight" href="kf_fw_ig_renew.php?lv='+o+'">已使用列表</a>')}}}),F(e);var t=e.find("tbody > tr:gt(1) > td:nth-child(2)");j(t),O(t.find("a")),E()},function(e,t,n,a){var i=!1;if(e){var o=e.find("td:nth-child(3) > .pd_used_num"),r=e.find("td:nth-child(2) > a").text();if(o.length>0&&"零时迷子的碎片"!==r){var l=parseInt(o.text());isNaN(l)||l+t<0?i=!0:(o.text(l+t),A())}if(n){var s=e.find("td:nth-child(3) > .pd_usable_num");if(s.length>0){var c=parseInt(s.text());isNaN(c)||c+n<0?i=!0:s.text(c+n)}}}if(a){var p=$(".pd_total_energy_num");if("/kf_fw_ig_renew.php"===location.pathname&&(p=$('.kf_fw_ig1:first > tbody > tr:nth-child(2) > td:contains("道具恢复能量") > span')),p.length>0){var f=parseInt(p.text());isNaN(f)||f+a<0?i=!0:p.text(f+a)}else i=!0}i&&(E(),"/kf_fw_ig_my.php"!==location.pathname||d.getUrlParam("lv")||N())}),B=function(e){var t=0,n=/道具恢复能量<br\s*\/?><span.+?>(\d+)<\/span><br\s*\/?>点/i.exec(e);return n&&(t=parseInt(n[1])),t},A=function(){var e=0,t=0;$(".kf_fw_ig1:last > tbody > tr:gt(1) > td:nth-child(3) > .pd_used_num").each(function(){var n=$(this),a=parseInt(n.text());if(!(isNaN(a)||a<0)){var i=parseInt(n.closest("tr").find("td:first-child").text());if(i){var o=y(i),r=b(i);e+=o*a,t+=r*a,n.attr("title","全部恢复需要"+o*a+"点能量，全部转换可得"+r*a+"点能量")}}}),$(".kf_fw_ig1:last > tbody > tr:nth-child(2) > td:nth-child(3) > .pd_used_num").attr("title","全部恢复需要"+e+"点能量，全部转换可得"+t+"点能量")},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=function(e){var t=B(e),n=/(1级道具转换得.+?点能量)。<br/.exec(e);if("/kf_fw_ig_my.php"===location.pathname?$(".kf_fw_ig_title1:last").find("span:has(.pd_total_energy_num)").remove().end().append('<span class="pd_custom_tips" style="margin-left: 7px;" title="'+(n?n[1]:"")+'">'+('(道具恢复能量 <b class="pd_total_energy_num" style="font-size: 14px;">'+t+"</b> 点)</span>")):$('.kf_fw_ig1:first > tbody > tr:nth-child(2) > td:contains("道具恢复能量") > span').text(t),$(".pd_used_num").length>0){var a=e.match(/">\d+<\/td><td>全部转换本级已使用道具为能量<\/td>/g);a&&!function(){var e=[];for(var t in a){var n=/">(\d+)<\/td>/i.exec(a[t]);n&&e.push(n[1])}var i=$(".kf_fw_ig1:last > tbody > tr:gt(1) > td:nth-child(3) > .pd_used_num");i.length===a.length&&(i.each(function(t){$(this).text(e[t])}),A())}()}};e?t(e):$.get("kf_fw_ig_renew.php?t="+(new Date).getTime(),function(e){return t(e)})},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=function(e){var t=e.match(/">\d+<\/td><td><a href="kf_fw_ig_my\.php\?lv=/gi);if(t){var n=[];for(var a in t){var i=/">(\d+)<\/td>/i.exec(t[a]);i&&n.push(i[1])}$(".kf_fw_ig1:last > tbody > tr:gt(1) > td:nth-child(3) > .pd_usable_num").each(function(e){$(this).text(n[e]?n[e]:0)})}};e?t(e):$.get("kf_fw_ig_my.php?t="+(new Date).getTime(),function(e){return t(e)})},P=n.getItemUsedInfo=function(e){var t=new Map([["蕾米莉亚同人漫画",0],["十六夜同人漫画",0],["档案室钥匙",0],["傲娇LOLI娇蛮音CD",0],["消逝之药",0],["整形优惠卷",0]]),n=/道具：\[(蕾米莉亚同人漫画)：(\d+)]\[(十六夜同人漫画)：(\d+)]\[(档案室钥匙)：(\d+)]\[(傲娇LOLI娇蛮音CD)：(\d+)]\[(消逝之药)：(\d+)]\[(整形优惠卷)：(\d+)]/.exec(e);if(n)for(var a=1;a<n.length;a+=2)t.set(n[a],parseInt(n[a+1]));return t},O=function(e){var t=["仅供参考","←谁信谁傻逼","←不管你信不信，反正我是信了","要是失败了出门左转找XX风","退KFOL保一生平安","←这一切都是XX风的阴谋","这样的几率大丈夫？大丈夫，萌大奶！","玄不救非，氪不改命","严重警告：此地的概率学已死","←概率对非洲人是不适用的","要相信RP守恒定律"];$.get("kf_fw_ig_index.php?t="+(new Date).getTime(),function(n){var a=P(n);e.next(".pd_used_item_info").remove(),e.each(function(){var e=$(this),n=e.text();if(a.has(n)){var i=a.get(n),o=C(n),r=0;r=i>o?0:100*(1-i/o);var l="";i<o&&i>0&&(l="（"+t[Math.floor(Math.random()*t.length)]+"）"),e.after('<span class="pd_used_item_info" title="下个道具使用成功几率：'+(i>=o?"无":r.toFixed(2)+"%")+l+'">'+('(<span style="'+(i>=o?"color: #f00;":"")+'">'+i+'</span>/<span style="color: #f00;">'+o+"</span>)</span>"))}})})},j=function(e){e.each(function(){var e=$(this),t=e.text().trim(),n=k(t);if(t&&u.default.sampleItemIdList.has(t)){var a="";a="零时迷子的碎片"!==t?"恢复此道具需"+y(n)+"点能量，转换此道具可得"+b(n)+"点能量":"此道具不可恢复和转换",e.html('<a href="kf_fw_ig_my.php?pro='+u.default.sampleItemIdList.get(t)+'&display=1" title="'+a+'">'+t+"</a>")}})},R=(n.addSampleItemTips=function(){var e=parseInt(d.getUrlParam("pro"));if(!(isNaN(e)||e<=0)){var t=!0,n=!1,a=void 0;try{for(var i,o=u.default.sampleItemIdList.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var r=i.value;if(e===r){$(".kf_fw_ig1 > tbody > tr:nth-child(3) > td:last-child").find("span:first").after('<span class="pd_notice" style="margin-left: 5px;">(展示用样品)</span>');break}}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}}},function(e){var t={itemTypeId:0,num:0,safeId:"",itemLevel:0,itemName:""};$.extend(t,e),$(".kf_fw_ig1").parent().append('<ul class="pd_result"><li><strong>【Lv.'+t.itemLevel+"："+t.itemName+"】购买结果：</strong></li></ul>");var n=0,a=0,i=!1;$(document).clearQueue("BatchBuyItems"),$.each(new Array(t.num),function(e){$(document).queue("BatchBuyItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_shop.php?lvid="+t.itemTypeId+"&safeid="+t.safeId+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(t){_.showFormatLog("购买道具",t);var a=d.getResponseMsg(t),o=a.msg,r=a.url,l=/kf_fw_ig_my\.php\?pro=(\d+)/.exec(r);l?(n++,o='获得了<a target="_blank" href="kf_fw_ig_my.php?pro='+l[1]+'" data-id="'+l[1]+'">一个道具</a>'):/你需要持有该道具两倍市场价的KFB/.test(t)&&(o='你需要持有该道具两倍市场价的KFB<span class="pd_notice">（购买操作中止）</span>',i=!0),$(".pd_result:last").append("<li><b>第"+(e+1)+"次：</b>"+o+"</li>")},error:function(){a++},complete:function(){var o=$(".pd_countdown:last");o.text(parseInt(o.text())-1),i=i||o.closest(".pd_msg").data("stop"),i&&$(document).clearQueue("BatchBuyItems"),i||e===t.num-1?(p.remove(o.closest(".pd_msg")),n>0&&g.push("购买道具","共有`"+n+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具购买成功",{gain:{"道具":n}}),console.log("共有"+n+"个【Lv."+t.itemLevel+"："+t.itemName+"】道具购买成功"+(a>0?"，共有"+a+"个道具购买失败":"")),p.show("<strong>共有<em>"+n+"</em>个【<em>Lv."+t.itemLevel+"</em>"+t.itemName+"】道具购买成功"+((a>0?"，共有<em>"+a+"</em>个道具购买失败":"")+"</strong>"),-1),n>0&&($('<li><a href="#">统计购买价格</a></li>').appendTo(".pd_result:last").find("a").click(function(e){e.preventDefault();var n=$(this).closest(".pd_result");$(this).parent().remove(),p.destroy(),q(n,t.itemLevel,t.itemName)}),K())):setTimeout(function(){return $(document).dequeue("BatchBuyItems")},"function"==typeof u.default.specialAjaxInterval?u.default.specialAjaxInterval():u.default.specialAjaxInterval)}})})}),$(document).dequeue("BatchBuyItems")}),q=function(e,t,n){var a=0,i=0,o=0,r=0,l=0,s=0,c=e.find("li > a").length;$(".kf_fw_ig1:first > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this);if(e.find("a").text()===n)return s=parseInt(e.next("td").find(".pd_item_price").text()),!1}),s||(s=1),p.wait('<strong>正在统计购买价格中&hellip;</strong><i>剩余：<em class="pd_countdown">'+c+"</em></i>"),$(document).clearQueue("StatBuyItemsPrice"),e.find("li > a").each(function(f){var h=$(this),m=h.data("id");m&&$(document).queue("StatBuyItemsPrice",function(){$.ajax({type:"GET",url:"kf_fw_ig_my.php?pro="+m+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(e){var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1);var n=/从商店购买，购买价(\d+)KFB。<br/.exec(e);if(n){a++;var s=parseInt(n[1]);o+=s,0===r?r=s:s<r&&(r=s),s>l&&(l=s),h.after('（购买价：<b class="pd_highlight">'+s+"</b>KFB）")}else i++,h.after('<span class="pd_notice">（未能获得预期的回应）</span>')},error:function(){i++,h.after('<span class="pd_notice">（连接超时）</span>')},complete:function(){f===c-1?(p.destroy(),a>0&&g.push("统计道具购买价格","共有`"+a+"`个【`Lv."+t+"："+n+"`】道具统计成功"+((i>0?"（共有`"+i+"`个道具未能统计成功）":"")+"，总计价格：`"+o.toLocaleString()+"`，")+("平均价格：`"+(a>0?d.getFixedNumLocStr(o/a,2):0)+"`")+("(`"+(a>0?Math.round(o/a/s*100):0)+"%`)，")+("最低价格：`"+r.toLocaleString()+"`(`"+Math.round(r/s*100)+"%`)，")+("最高价格：`"+l.toLocaleString()+"`(`"+Math.round(l/s*100)+"%`)"),{pay:{KFB:-o}}),console.log("统计道具购买价格（KFB）（共有"+i+"个道具未能统计成功），统计成功数量："+a+"，总计价格："+o.toLocaleString()+"，"+("平均价格："+(a>0?d.getFixedNumLocStr(o/a,2):0)+" ")+("("+(a>0?Math.round(o/a/s*100):0)+"%)，最低价格："+r.toLocaleString()+" ")+("("+Math.round(r/s*100)+"%)，最高价格："+l.toLocaleString()+" ("+Math.round(l/s*100)+"%)")),e.append('\n<li class="pd_stat">\n  <b>统计结果'+(i>0?'<span class="pd_notice">（共有'+i+"个道具未能统计成功）</span>":"")+"：</b><br>\n  <i>统计成功数量：<em>"+a+"</em></i>\n  <i>总计价格：<em>"+o.toLocaleString()+"</em></i>\n  <i>平均价格：<em>"+(a>0?d.getFixedNumLocStr(o/a,2):0)+" \n("+(a>0?Math.round(o/a/s*100):0)+"%)</em></i>\n  <i>最低价格：<em>"+r.toLocaleString()+" ("+Math.round(r/s*100)+"%)</em></i>\n  <i>最高价格：<em>"+l.toLocaleString()+" ("+Math.round(l/s*100)+"%)</em></i>\n</li>\n")):setTimeout(function(){return $(document).dequeue("StatBuyItemsPrice")},u.default.defAjaxInterval)}})})}),$(document).dequeue("StatBuyItemsPrice")},K=(n.addBatchBuyItemsLink=function(){var e=$(".kf_fw_ig1:first");e.find("tbody > tr:nth-child(2)").find("td:nth-child(2)").css("width","243px").end().find("td:nth-child(3)").css("width","155px").end().find("td:last-child").css("width","110px"),e.find("tbody > tr:gt(1)").each(function(){$(this).find("td:nth-child(3)").wrapInner('<span class="pd_item_price"></span>').end().find("td:last-child").append('<a class="pd_batch_buy_items" style="margin-left: 15px;" href="#">批量购买</a>')}),e.on("click",'a[href^="kf_fw_ig_shop.php?lvid="]',function(){var e=$(this),t=parseInt(e.closest("tr").find("td:first-child").text());if(t){var n=e.closest("tr").find("td:nth-child(2) > a").text();if(n)return!!confirm("是否购买【Lv."+t+"："+n+"】道具？")&&void 0}}).on("click","a.pd_batch_buy_items",function(e){e.preventDefault(),p.destroy();var t=$(this),n=parseInt(t.closest("tr").find("td:first-child").text());if(n){var a=t.closest("tr").find("td:nth-child(2) > a").text();if(a){var i=/lvid=(\d+)&safeid=(\w+)/i.exec(t.prev("a").attr("href"));if(i){var o=parseInt(i[1]),r=i[2],l=parseInt(prompt("你要批量购买多少个【Lv."+n+"："+a+"】道具？",0));!l||l<0||(p.wait('<strong>正在购买道具中&hellip;</strong><i>剩余：<em class="pd_countdown">'+l+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),R({itemTypeId:o,num:l,safeId:r,itemLevel:n,itemName:a}))}}}}),e.find("tbody > tr:gt(1) > td:nth-child(4)").each(function(){var e=$(this),t=parseInt(e.prev("td").text());isNaN(t)||e.addClass("pd_custom_tips").attr("title",Math.floor(.5*t)+"~"+2*t+"（均价："+Math.floor(1.25*t)+"）")});var t=e.find("tbody > tr:gt(1) > td:nth-child(2)");j(t),O(t.find("a")),K(),e.find("tbody > tr:first-child > td").append('<br><span class="pd_highlight">想买道具却害怕使用失败？快来试试<a href="read.php?tid=526110" target="_blank" title="喵拉布丁：我绝对没收广告费~">道具使用险</a>吧！</span>')},function(){$.get("profile.php?action=show&uid="+l.default.uid+"&t="+(new Date).getTime(),function(e){var t=/论坛货币：(\d+)\s*KFB<br/i.exec(e);if(t){var n=parseInt(t[1]);$(".kf_fw_ig_title1:last").find("span:last").remove().end().append('<span style="margin-left: 7px;">(当前持有 <b style="font-size: 14px;">'+n+"</b> KFB)</span>"),$(".kf_fw_ig1:first > tbody > tr:gt(1) > td:nth-child(3) > .pd_item_price").each(function(){var e=$(this);e.next(".pd_verify_tips").remove();var t=parseInt(e.text());if(!isNaN(t)){var a="",i="";2*t<=n?(a='<span style="color: #669933;">可买</span>',i="有足够KFB购买此道具"):(a='<span style="color: #ff0033;">差'+(2*t-n)+"</span>",i="还差"+(2*t-n)+"KFB才可购买此道具"),e.after('<span class="pd_verify_tips" title="'+i+'" style="font-size: 12px; margin-left: 3px;">('+a+")</span>")}})}})});n.modifyItemDescription=function(){var e=$(".kf_fw_ig1 > tbody > tr:nth-child(3) > td:last-child"),t=/道具名称：(.+)/.exec(e.find("span:first").text().trim());if(t){var n=t[1],a=new Map([["蕾米莉亚同人漫画",["燃烧伤害+1。上限50。","力量+1，体质+1；满50本时，追加+700生命值。"]],["十六夜同人漫画",["命中+3，闪避+1。上限50。","敏捷+1，灵活+1；满50本时，追加+100攻击速度。"]],["档案室钥匙",["暴击伤害加成+10%。上限30。","增加5%盒子获得概率[原概率*(100%+追加概率)]；满30枚时，增加50点可分配点数。"]],["傲娇LOLI娇蛮音CD",["闪避+3，命中+1。上限30。","降低对手生命值上限的0.5%；满30张时，追加降低对手10%攻击力。"]],["整形优惠卷",[["暴击几率+3%。上限10。"],["在获得盒子时，增加3%的几率直接获得高一级的盒子；<br>满10张时，这个概率直接提升为50%(无法将传奇盒子升级为神秘盒子)。"]]],["消逝之药",["消除伤害。<br>防御效果+7%。上限10。","所有属性+5(不含耐力、幸运)；满10瓶时，追加200点可分配点数。"]]]);a.has(n)&&e.html(e.html().replace(a.get(n)[0],a.get(n)[1]))}}},{"./Config":4,"./Const":6,"./Info":10,"./Log":12,"./Msg":15,"./Public":18,"./Util":22}],12:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.getMergeLog=n.push=n.clear=n.write=n.read=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),s=a(l),d=e("./Const"),c=i(d),p=c.default.storagePrefix+"log",f=n.read=function(){var e={},t=null;if(t="ByUid"===r.default.storageType||"Global"===r.default.storageType?GM_getValue(p+"_"+r.default.uid):localStorage.getItem(p+"_"+r.default.uid),!t)return e;try{t=JSON.parse(t)}catch(t){return e}return t&&"object"===$.type(t)?(e=t,s.getCookie(c.default.checkOverdueLogCookieName)||h(e),e):e},u=n.write=function(e){"ByUid"===r.default.storageType||"Global"===r.default.storageType?GM_setValue(p+"_"+r.default.uid,JSON.stringify(e)):localStorage.setItem(p+"_"+r.default.uid,JSON.stringify(e))},h=(n.clear=function(){"ByUid"===r.default.storageType||"Global"===r.default.storageType?GM_deleteValue(p+"_"+r.default.uid):localStorage.removeItem(p+"_"+r.default.uid)},function(e){var t=s.getObjectKeyList(e,1),n=s.getDateString(s.getDate("-"+Config.logSaveDays+"d")),a=!1,i=!0,o=!1,r=void 0;try{for(var l,d=t[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var p=l.value;if(!(p<=n))break;delete e[p],a=!0}}catch(e){o=!0,r=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw r}}a&&u(e),s.setCookie(c.default.checkOverdueLogCookieName,1,s.getMidnightHourDate(1))});n.push=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.gain,i=void 0===a?null:a,o=n.pay,r=void 0===o?null:o,l=new Date,d=l.getTime(),c=s.getDateString(l),p={time:d,type:e,action:t};i&&(p.gain=i),r&&(p.pay=r);var h=f();Array.isArray(h[c])||(h[c]=[]),h[c].push(p),u(h)},n.getMergeLog=function(e,t){for(var n in t)if(Array.isArray(e[n])){var a=!0,i=!1,o=void 0;try{for(var r,l=function(){var t=r.value;if("number"!=typeof t.time||"string"!=typeof t.type)return"continue";var a=e[n].findIndex(function(e){return t.time===e.time&&t.type===e.type});a>-1?e[n][a]=t:e[n].push(t)},s=t[n][Symbol.iterator]();!(a=(r=s.next()).done);a=!0){l()}}catch(e){i=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}e[n].sort(function(e,t){return e.time>t.time})}else e[n]=t[n];return e}},{"./Const":6,"./Info":10,"./Util":22}],13:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.show=void 0;var i=e("./Util"),o=a(i),r=e("./Dialog"),l=a(r),s=e("./Func"),d=a(s),c=e("./Config"),p=e("./Log"),f=a(p),u=e("./Item"),h=a(u),m=(n.show=function(){var e="pdLogDialog";if(!($("#"+e).length>0)){(0,c.read)(),d.run("LogDialog.show_before_");var t='\n<div class="pd_cfg_main">\n  <div class="pd_log_nav">\n    <a class="pd_disabled_link" href="#">&lt;&lt;</a>\n    <a style="padding: 0 7px;" class="pd_disabled_link" href="#">&lt;</a>\n    <h2 class="pd_custom_tips">暂无日志</h2>\n    <a style="padding: 0 7px;" class="pd_disabled_link" href="#">&gt;</a>\n    <a class="pd_disabled_link" href="#">&gt;&gt;</a>\n  </div>\n  <fieldset>\n    <legend>日志内容</legend>\n    <div>\n      <strong>排序方式：</strong>\n      <label title="按时间顺序排序"><input type="radio" name="sortType" value="time" checked> 按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="sortType" value="type"> 按类别</label>\n    </div>\n    <div class="pd_stat pd_log_content">暂无日志</div>\n  </fieldset>\n  <fieldset>\n    <legend>统计结果</legend>\n    <div>\n      <strong>统计范围：</strong>\n      <label title="显示当天的统计结果"><input type="radio" name="statType" value="current" checked> 当天</label>\n      <label title="显示距该日N天内的统计结果"><input type="radio" name="statType" value="custom"></label>\n      <label title="显示距该日N天内的统计结果"><input name="statDays" type="text" style="width: 22px;" maxlength="3"> 天内</label>\n      <label title="显示全部统计结果"><input type="radio" name="statType" value="all"> 全部</label>\n    </div>\n    <div class="pd_stat" data-name="stat">暂无日志</div>\n  </fieldset>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExLogDialog" href="#">导入/导出日志</a></span>\n  <button>关闭</button> <button>清除日志</button>\n</div>',n=l.create(e,"KFOL助手日志",t,"width: 880px;"),a=f.read(),i=[],r=0;$.isEmptyObject(a)||(i=o.getObjectKeyList(a,1),r=i.length-1,n.find(".pd_log_nav h2").attr("title","总共记录了"+i.length+"天的日志").text(i[r]),i.length>1&&(n.find(".pd_log_nav > a:eq(0)").attr("title",i[0]).removeClass("pd_disabled_link"),n.find(".pd_log_nav > a:eq(1)").attr("title",i[r-1]).removeClass("pd_disabled_link"))),n.find(".pd_log_nav a").click(function(e){if(e.preventDefault(),$(this).is(".pd_log_nav a:eq(0)"))r=0;else if($(this).is(".pd_log_nav a:eq(1)")){if(!(r>0))return;r--}else if($(this).is(".pd_log_nav a:eq(2)")){if(!(r<i.length-1))return;r++}else $(this).is(".pd_log_nav a:eq(3)")&&(r=i.length-1);n.find(".pd_log_nav h2").text(i[r]),m(a,i[r],n),v(a,i[r],n),r>0?(n.find(".pd_log_nav > a:eq(0)").attr("title",i[0]).removeClass("pd_disabled_link"),n.find(".pd_log_nav > a:eq(1)").attr("title",i[r-1]).removeClass("pd_disabled_link")):n.find(".pd_log_nav > a:lt(2)").removeAttr("title").addClass("pd_disabled_link"),r<i.length-1?(n.find(".pd_log_nav > a:eq(2)").attr("title",i[r-1]).removeClass("pd_disabled_link"),n.find(".pd_log_nav > a:eq(3)").attr("title",i[i.length-1]).removeClass("pd_disabled_link")):n.find(".pd_log_nav > a:gt(1)").removeAttr("title").addClass("pd_disabled_link")}).end().find('[name="sortType"]').click(function(){var e=$(this).val();Config.logSortType!==e&&(Config.logSortType=e,(0,c.write)(),m(a,i[r],n))}).end().find('[name="statType"]').click(function(){var e=$(this).val();Config.logStatType!==e&&(Config.logStatType=e,(0,c.write)(),v(a,i[r],n))}).end().find('[name="statDays"]').keyup(function(){var e=parseInt($(this).val());e>0&&Config.logStatDays!==e&&(Config.logStatDays=e,(0,c.write)(),n.find('[name="statType"][value="custom"]:not(:checked)').click(),v(a,i[r],n))}).end().find('[name="sortType"][value="'+Config.logSortType+'"]').click().end().find('[name="statType"][value="'+Config.logStatType+'"]').click().end().find('[name="statDays"]').val(Config.logStatDays),n.find(".pd_cfg_btns > button:first").click(function(){return l.close(e)}).next("button").click(function(e){e.preventDefault(),confirm("是否清除所有日志？")&&(f.clear(),alert("日志已清除"),location.reload())}),n.find('[data-name="openImOrExLogDialog"]').click(function(e){e.preventDefault(),b()}),m(a,i[r],n),v(a,i[r],n),$(window).height()<=750&&n.find(".pd_log_content").css("height","216px"),l.show(e),n.find("input:first").focus(),d.run("LogDialog.show_after_")}},function(e,t,n){Array.isArray(e[t])&&n.find(".pd_log_content").html(g(e,t,Config.logSortType)).parent().find("legend:first-child").text("日志内容 (共"+e[t].length+"项)")}),g=function(e,t,n){var a=e[t];"type"===n?!function(){var e=["捐款","领取争夺奖励","批量攻击","试探攻击","抽取神秘盒子","抽取道具或卡片","使用道具","恢复道具","循环使用道具","将道具转换为能量","将卡片转换为VIP时间","购买道具","统计道具购买价格","出售道具","神秘抽奖","统计神秘抽奖结果","神秘等级升级","神秘系数排名变化","批量转账","购买帖子","自动存款"];a.sort(function(t,n){return e.indexOf(t.type)>e.indexOf(n.type)})}():a.sort(function(e,t){return e.time>t.time});var i="",r="",l=!0,s=!1,d=void 0;try{for(var c,p=a[Symbol.iterator]();!(l=(c=p.next()).done);l=!0){var f=c.value,u=f.time,h=f.type,m=f.action,g=f.gain,v=f.pay;if("undefined"!=typeof u&&"undefined"!=typeof h&&"undefined"!=typeof m){var _=new Date(u);"type"===n?(r!==h&&(i+="<h3>【"+h+"】</h3>",r=h),i+="<p><b>"+o.getTimeString(_)+"：</b>"+m.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>')):i+="<p><b>"+o.getTimeString(_)+" ("+h+")：</b>"+m.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>');var b="";if("object"===$.type(g)&&!$.isEmptyObject(g)){b+="，";var y=!0,x=!1,k=void 0;try{for(var C,w=Object.keys(g)[Symbol.iterator]();!(y=(C=w.next()).done);y=!0){var I=C.value;if("item"===I){var S=!0,T=!1,L=void 0;try{for(var D,U=Object.keys(g[I])[Symbol.iterator]();!(S=(D=U.next()).done);S=!0){var F=D.value;b+="<i>"+F+"<em>+"+g[I][F].toLocaleString()+"</em></i> "}}catch(e){T=!0,L=e}finally{try{!S&&U.return&&U.return()}finally{if(T)throw L}}}else b+="<i>"+I+"<em>+"+g[I].toLocaleString()+"</em></i> "}}catch(e){x=!0,k=e}finally{try{!y&&w.return&&w.return()}finally{if(x)throw k}}}if("object"===$.type(v)&&!$.isEmptyObject(v)){b||(b+="，");var M=!0,B=!1,A=void 0;try{for(var E,N=Object.keys(v)[Symbol.iterator]();!(M=(E=N.next()).done);M=!0){var P=E.value;if("item"===P){var O=!0,j=!1,R=void 0;try{for(var q,K=Object.keys(v[P])[Symbol.iterator]();!(O=(q=K.next()).done);O=!0){var V=q.value;b+="<i>"+V+"<ins>"+v[P][V].toLocaleString()+"</ins></i> "}}catch(e){j=!0,R=e}finally{try{!O&&K.return&&K.return()}finally{if(j)throw R}}}else b+="<i>"+P+"<ins>"+v[P].toLocaleString()+"</ins></i> "}}catch(e){B=!0,A=e}finally{try{!M&&N.return&&N.return()}finally{if(B)throw A}}}i+=b+"</p>"}}}catch(e){s=!0,d=e}finally{try{!l&&p.return&&p.return()}finally{if(s)throw d}}return i},v=function(e,t,n){Array.isArray(e[t])&&n.find('[data-name="stat"]').html(_(e,t,Config.logStatType))},_=function(e,t,n){var a={};if("custom"===n){var i=new Date(t);i.setDate(i.getDate()-Config.logStatDays+1),i=o.getDateString(i);var r=!0,l=!1,s=void 0;try{for(var d,c=o.getObjectKeyList(e,1)[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){var p=d.value;p>=i&&p<=t&&(a[p]=e[p])}}catch(e){l=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw s}}}else"all"===n?a=e:a[t]=e[t];var f={},u={},m={},g=0,v=0,_={},b=0,y=0,x={},k=0,C=0,w=0,I=0,S=0,T={},L=["item","夺取KFB","VIP小时","神秘","燃烧伤害","命中","闪避","暴击比例","暴击几率","防御","有效道具","无效道具"];for(var D in a){var U=!0,F=!1,M=void 0;try{for(var B,A=a[D][Symbol.iterator]();!(U=(B=A.next()).done);U=!0){var E=B.value,N=E.type,P=E.action,O=E.gain,j=E.pay,R=E.notStat;if("undefined"!=typeof N&&"undefined"==typeof R){if("object"===$.type(O)){var q=!0,K=!1,V=void 0;try{for(var W,H=Object.keys(O)[Symbol.iterator]();!(q=(W=H.next()).done);q=!0){var z=W.value;L.includes(z)||("undefined"==typeof f[z]?f[z]=O[z]:f[z]+=O[z])}}catch(e){K=!0,V=e}finally{try{!q&&H.return&&H.return()}finally{if(K)throw V}}}if("object"===$.type(j)){var G=!0,Q=!1,J=void 0;try{for(var X,Y=Object.keys(j)[Symbol.iterator]();!(G=(X=Y.next()).done);G=!0){var Z=X.value;L.includes(Z)||("undefined"==typeof u[Z]?u[Z]=j[Z]:u[Z]+=j[Z])}}catch(e){Q=!0,J=e}finally{try{!G&&Y.return&&Y.return()}finally{if(Q)throw J}}}if("使用道具"!==N&&"循环使用道具"!==N||"object"!==$.type(O)){if("统计道具购买价格"===N&&"object"===$.type(j)&&"undefined"!=typeof j.KFB){var ee=/共有`(\d+)`个【`Lv.\d+：(.+?)`】道具统计成功，总计价格：`[^`]+?`，平均价格：`[^`]+?`\(`(\d+)%`\)，最低价格：`[^`]+?`\(`(\d+)%`\)，最高价格：`[^`]+?`\(`(\d+)%`\)/.exec(P);if(ee){var te=parseInt(ee[1]),ne=ee[2];"undefined"==typeof T[ne]&&(T[ne]={"道具数量":0,"总计价格":0,"总计价格比例":0,"最低价格比例":0,"最高价格比例":0}),k+=te,T[ne]["道具数量"]+=te,C+=Math.abs(j.KFB),T[ne]["总计价格"]+=Math.abs(j.KFB),w+=parseInt(ee[3])*te,T[ne]["总计价格比例"]+=parseInt(ee[3])*te,(I<=0||parseInt(ee[4])<I)&&(I=parseInt(ee[4])),parseInt(ee[5])>S&&(S=parseInt(ee[5])),(T[ne]["最低价格比例"]<=0||parseInt(ee[4])<T[ne]["最低价格比例"])&&(T[ne]["最低价格比例"]=parseInt(ee[4])),parseInt(ee[5])>T[ne]["最高价格比例"]&&(T[ne]["最高价格比例"]=parseInt(ee[5]))}}}else{var ae=/【`Lv.(\d+)：(.+?)`】/.exec(P);if(ae){var ie=parseInt(ae[1]),oe=ae[2];O["有效道具"]>0&&(g+=O["有效道具"],ie>=3&&(v+=O["有效道具"]),"undefined"==typeof _[oe]&&(_[oe]=0),_[oe]+=O["有效道具"]),O["无效道具"]>0&&(b+=O["无效道具"],ie>=3&&(y+=O["无效道具"]),"undefined"==typeof x[oe]&&(x[oe]=0),x[oe]+=O["无效道具"])}}}}}catch(e){F=!0,M=e}finally{try{!U&&A.return&&A.return()}finally{if(F)throw M}}}var re="",le=["KFB","经验值","能量","贡献","道具","已使用道具","卡片"];re+="<strong>收获：</strong>";var se=!0,de=!1,ce=void 0;try{for(var pe,fe=o.getSortedObjectKeyList(le,f)[Symbol.iterator]();!(se=(pe=fe.next()).done);se=!0){var ue=pe.value;m[ue]=f[ue],re+="<i>"+ue+"<em>+"+f[ue].toLocaleString()+"</em></i> "}}catch(e){de=!0,ce=e}finally{try{!se&&fe.return&&fe.return()}finally{if(de)throw ce}}re+="<br><strong>付出：</strong>";var he=!0,me=!1,ge=void 0;try{for(var ve,_e=o.getSortedObjectKeyList(le,u)[Symbol.iterator]();!(he=(ve=_e.next()).done);he=!0){var be=ve.value;"undefined"==typeof m[be]?m[be]=u[be]:m[be]+=u[be],re+="<i>"+be+"<ins>"+u[be].toLocaleString()+"</ins></i> "}}catch(e){me=!0,ge=e}finally{try{!he&&_e.return&&_e.return()}finally{if(me)throw ge}}re+="<br><strong>结余：</strong>";var ye=!0,xe=!1,ke=void 0;try{for(var Ce,we=o.getSortedObjectKeyList(le,m)[Symbol.iterator]();!(ye=(Ce=we.next()).done);ye=!0){var $e=Ce.value;re+="<i>"+$e+o.getStatFormatNumber(m[$e])+"</i> "}}catch(e){xe=!0,ke=e}finally{try{!ye&&we.return&&we.return()}finally{if(xe)throw ke}}re+='<div style="margin: 5px 0; border-bottom: 1px dashed #ccccff;"></div>';var Ie=["零时迷子的碎片","被遗弃的告白信","学校天台的钥匙","TMA最新作压缩包","LOLI的钱包","棒棒糖","蕾米莉亚同人漫画","十六夜同人漫画","档案室钥匙","傲娇LOLI娇蛮音CD","整形优惠卷","消逝之药"];re+='\n<strong>有效道具统计：</strong><i>有效道具<span class="pd_stat_extra"><em>+'+g.toLocaleString()+"</em>"+('(<em title="3级以上有效道具">+'+v.toLocaleString()+"</em>)</i></span> ");var Se=!0,Te=!1,Le=void 0;try{for(var De,Ue=o.getSortedObjectKeyList(Ie,_)[Symbol.iterator]();!(Se=(De=Ue.next()).done);Se=!0){
var Fe=De.value;re+="<i>"+Fe+"<em>+"+_[Fe].toLocaleString()+"</em></i> "}}catch(e){Te=!0,Le=e}finally{try{!Se&&Ue.return&&Ue.return()}finally{if(Te)throw Le}}re+='<br><strong>无效道具统计：</strong><i>无效道具<span class="pd_stat_extra"><em>+'+b.toLocaleString()+"</em>"+('(<em title="3级以上无效道具">+'+y.toLocaleString()+"</em>)</i></span> ");var Me=!0,Be=!1,Ae=void 0;try{for(var Ee,Ne=o.getSortedObjectKeyList(Ie,x)[Symbol.iterator]();!(Me=(Ee=Ne.next()).done);Me=!0){var Pe=Ee.value;re+="<i>"+Pe+"<em>+"+x[Pe].toLocaleString()+"</em></i> "}}catch(e){Be=!0,Ae=e}finally{try{!Me&&Ne.return&&Ne.return()}finally{if(Be)throw Ae}}var Oe="",je=o.getObjectKeyList(T,0);je.sort(function(e,t){return h.getLevelByName(e)>h.getLevelByName(t)});var Re=!0,qe=!1,Ke=void 0;try{for(var Ve,We=je[Symbol.iterator]();!(Re=(Ve=We.next()).done);Re=!0){var He=Ve.value,ze=T[He];Oe+='<i class="pd_custom_tips" title="总价：'+ze["总计价格"].toLocaleString()+"，"+("平均价格比例："+(ze["道具数量"]>0?o.getFixedNumLocStr(ze["总计价格比例"]/ze["道具数量"],2):0)+"%，")+("最低价格比例："+ze["最低价格比例"]+"%，最高价格比例："+ze["最高价格比例"]+'%">'+He+"<em>+"+ze["道具数量"]+"</em></i> ")}}catch(e){qe=!0,Ke=e}finally{try{!Re&&We.return&&We.return()}finally{if(qe)throw Ke}}return re+="<br><strong>购买道具统计：</strong><i>道具<em>+"+k+"</em></i> "+('<i>道具价格<span class="pd_stat_extra"><em title="道具总价">+'+C.toLocaleString()+"</em>")+('(<em title="平均价格比例">'+(k>0?o.getFixedNumLocStr(w/k,2):0)+"%</em>|")+('<em title="最低价格比例">'+I+'%</em>|<em title="最高价格比例">'+S+"%</em>)</span></i> "+Oe)},b=function(){var e="pdImOrExLogDialog";if(!($("#"+e).length>0)){var t=f.read(),n='\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label style="color: #f00;"><input type="radio" name="logType" value="setting" checked> 导入/导出日志</label>\n    <label style="color: #00f;"><input type="radio" name="logType" value="text"> 导出日志文本</label>\n  </div>\n  <div data-name="logSetting">\n    <strong>导入日志：</strong>将日志内容粘贴到文本框中并点击合并或覆盖按钮即可<br>\n    <strong>导出日志：</strong>复制文本框里的内容并粘贴到文本文件里即可<br>\n    <textarea name="setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n  </div>\n  <div data-name="logText" style="display: none;">\n    <strong>导出日志文本</strong>：复制文本框里的内容并粘贴到文本文件里即可\n    <div>\n      <label title="按时间顺序排序"><input type="radio" name="sortType2" value="time" checked> 按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="sortType2" value="type"> 按类别</label>\n      <label title="在日志文本里显示每日以及全部数据的统计结果"><input type="checkbox" name="showStat" checked> 显示统计</label>\n    </div>\n    <textarea name="text" style="width: 600px; height: 400px;" readonly></textarea>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <button name="merge">合并日志</button>\n  <button name="overwrite" style="color: #f00;">覆盖日志</button>\n  <button>关闭</button>\n</div>',a=l.create(e,"导入或导出日志",n);a.find('[name="sortType2"], [name="showStat"]').click(function(){y(t,a),a.find('[name="text"]').select()}).end().find('[name="logType"]').click(function(){var e=$(this).val();a.find('[data-name="log'+("text"===e?"Setting":"Text")+'"]').hide(),a.find('[data-name="log'+("text"===e?"Text":"Setting")+'"]').show(),a.find('[data-name="log'+("text"===e?"Text":"Setting")+'"]').select()}).end().find(".pd_cfg_btns > button").click(function(n){n.preventDefault();var i=$(this).attr("name");if("merge"!==i&&"overwrite"!==i)return l.close(e);if(confirm("是否将文本框中的日志"+("overwrite"===i?"覆盖":"合并")+"到本地日志？")){var o=$.trim(a.find('[name="setting"]').val());if(o){try{o=JSON.parse(o)}catch(e){return void alert("日志有错误")}return o&&"object"===$.type(o)?(t="merge"===i?f.getMergeLog(t,o):o,f.write(t),alert("日志已导入"),location.reload(),void 0):void alert("日志有错误")}}}),l.show(e),a.find('[name="setting"]').val(JSON.stringify(t)).select(),a.find('[name="sortType2"][value="'+Config.logSortType+'"]').prop("checked",!0).triggerHandler("click"),d.run("LogDialog.showImportOrExportLogDialog_after_")}},y=function(e,t){var n=t.find('input[name="sortType2"]:checked').val(),a=t.find('[name="showStat"]').prop("checked"),i="",o="",r=!0,l=!1,s=void 0;try{for(var d,c=Object.keys(e)[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){var p=d.value;Array.isArray(e[p])&&(o>p&&(o=p),i+="【"+p+"】(共"+e[p].length+"项)\n"+("type"===n?"":"\n")+g(e,p,n).replace(/<h3>/g,"\n").replace(/<\/h3>/g,"\n").replace(/<\/p>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"").replace(/`/g,""),a&&(i+="-".repeat(46)+"\n合计：\n"+_(e,p,"current").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")+"\n"),i+="=".repeat(46)+"\n")}}catch(e){l=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw s}}i&&a&&(i+="\n总计：\n"+_(e,o,"all").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")),t.find('[name="text"]').val(i)}},{"./Config":4,"./Dialog":7,"./Func":8,"./Item":11,"./Log":12,"./Util":22}],14:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.addUserLinkInPkListPage=n.enhanceLootIndexPage=void 0;var i=(function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}),o=e("./Util"),r=(a(o),e("./Dialog")),l=(a(r),e("./Config"),e("./Item")),s=a(l),d=void 0,c=void 0,p=void 0,f=void 0,u=void 0,h=void 0,m=(n.enhanceLootIndexPage=function(){d=$(".kf_fw_ig1:first"),c=d.find("> tbody > tr:nth-child(3) > td:first-child"),p=d.find("> tbody > tr:nth-child(3) > td:nth-child(2)"),f=v(),u=x(),h=s.getItemUsedInfo(d.find("> tbody > tr:nth-child(4) > td").html()),m(),g(),S(),T()},function(){var e="灵活和智力的抵消机制：\n战斗开始前，会重新计算战斗双方的灵活和智力；灵活=(自己的灵活值-(双方灵活值之和 x 33%))；智力=(自己的智力值-(双方智力值之和 x 33%))",t=c.html().replace(/(攻击力：)(\d+)/,'$1<span id="pdPro_s1" title="原值：$2">$2</span> <span id="pdNew_s1"></span>').replace(/(生命值：\d+)\s*\(最大(\d+)\)/,'$1 (最大<span id="pdPro_s2" title="原值：$2">$2</span>) <span id="pdNew_s2"></span>').replace(/(攻击速度：)(\d+)/,'$1<span id="pdPro_d1" title="原值：$2">$2</span> <span id="pdNew_d1"></span>').replace(/(暴击几率：)(\d+)%\s*\(抵消机制见说明\)/,'$1<span id="pdPro_d2" title="原值：$2">$2</span>% <span class="pd_cfg_tips" title="'+e+'">[?]</span> <span id="pdNew_d2"></span>').replace(/(技能释放概率：)(\d+)%\s*\(抵消机制见说明\)/,'$1<span id="pdPro_i1" title="原值：$2">$2</span>% <span class="pd_cfg_tips" title="'+e+'">[?]</span> <span id="pdNew_i1"></span>').replace(/(防御：)(\d+)%减伤/,'$1<span id="pdPro_i2" title="原值：$2">$2</span>%减伤 <span id="pdNew_i2"></span>').replace("技能伤害：攻击伤害+(体质点数*6)",'技能伤害：<span class="pd_custom_tips" id="pdSkillAttack" title="攻击伤害+(体质点数*6)"></span>');c.html(t).find("br:first").after('<span>剩余属性点：<span id="pdSurplusPoint"></span></span><br>'),c.on("click",'[id^="pdPro_"]',function(){var e=$(this);e.hide();var t=e.attr("id").replace("pdPro_",""),n=1;"s1"===t?n=5:"s2"===t?n=20:"d1"===t&&(n=2),$('<input data-name="'+t+'" type="number" value="'+parseInt(e.text())+'" min="1" step="'+n+'" '+('style="width: 65px; margin-right: 5px;" title="'+e.attr("title")+'">')).insertAfter(e).focus().select().blur(function(){var e=$(this),t=e.data("name"),n=parseInt(e.val());n>0&&p.find('[name="'+t+'"]').val(I(k(t),n)).trigger("change"),e.prev().show().end().remove()}).keyup(function(e){var t=$(this);13===e.keyCode?t.blur():27===e.keyCode&&t.val("").blur()})}).find("[id^=pdPro_]").css("cursor","pointer")}),g=function(){p.find('[type="text"]').attr("type","number").attr("min",1).attr("max",999).prop("required",!0).css("width","60px"),p.find("input[readonly]").attr("min",0).prop("disabled",!0).removeProp("required",!0),p.on("change",'[type="number"]',function(){var e=$(this),t=f.get("可分配属性点")-_(p.find('[type="number"]'));$("#pdSurplusPoint").text(t).css("color",0!==t?"#f00":"#000").css("font-weight",0!==t?"bold":"normal"),C(e),y(e),$("#pdSkillAttack").text(b(parseInt(d.find('[name="s1"]').val()),parseInt(d.find('[name="s2"]').val())))}).on("click",".pd_point_sum",function(){var e=f.get("可分配属性点")-_(p.find('[type="number"]'));if(e){var t=$(this).prev("span").prev('[type="number"]'),n=parseInt(t.val());(isNaN(n)||n<0)&&(n=0),t.val(n+e).trigger("change")}}).find("form").submit(function(){var e=f.get("可分配属性点")-_(p.find('[type="number"]'));return e<0?(alert("剩余属性点为负，请重新填写"),!1):e>0?confirm("你的可分配属性点尚未用完，是否提交？"):void 0}).find('[type="number"]').trigger("change")},v=function(){var e=new Map([["攻击力",0],["最大生命值",0],["攻击速度",0],["暴击几率",0],["技能释放概率",0],["防御",0],["可分配属性点",0]]),t=c.html(),n=/攻击力：(\d+)/.exec(t);return n&&e.set("攻击力",parseInt(n[1])),n=/生命值：\d+\s*\(最大(\d+)\)/.exec(t),n&&e.set("最大生命值",parseInt(n[1])),n=/攻击速度：(\d+)/.exec(t),n&&e.set("攻击速度",parseInt(n[1])),n=/暴击几率：(\d+)%/.exec(t),n&&e.set("暴击几率",parseInt(n[1])),n=/技能释放概率：(\d+)%/.exec(t),n&&e.set("技能释放概率",parseInt(n[1])),n=/防御：(\d+)%/.exec(t),n&&e.set("防御",parseInt(n[1])),n=/可分配属性点：(\d+)/.exec(t),n&&e.set("可分配属性点",parseInt(n[1])),e},_=function(e){var t=0;return e.each(function(){var e=parseInt($(this).val());e&&e>0&&(t+=e)}),t},b=function(e,t){return 5*(e+u.get("力量"))+6*t},y=function(e){var t=parseInt(e.val());(isNaN(t)||t<0)&&(t=0);var n=parseInt(e.next("span").text()),a=e.next("span").next(".pd_point_sum");a.length||(a=$('<span class="pd_point_sum" style="color: #ff0033; cursor: pointer;" title="点击：给该项加上或减去剩余属性点"></span>').insertAfter(e.next("span"))),a.text("="+(t+n))},x=function(){var e=new Map([["力量",0],["体质",0],["敏捷",0],["灵活",0],["智力",0],["意志",0],["耐力",0],["幸运",0]]);return p.find('[type="text"]').each(function(){var t=$(this),n=t.attr("name"),a=parseInt(t.next("span").text()),i=k(n);!isNaN(a)&&i&&e.set(i,a)}),e},k=function(e){switch(e){case"s1":return"力量";case"s2":return"体质";case"d1":return"敏捷";case"d2":return"灵活";case"i1":return"智力";case"i2":return"意志";case"p":return"耐力";case"l":return"幸运";default:return""}},C=function(e){var t=e.attr("name"),n=k(t),a=parseInt(e.val());(isNaN(a)||a<0)&&(a=0);var i=parseInt(e.get(0).defaultValue),o=w(n,a),r=0;switch(n){case"力量":r=o-f.get("攻击力");break;case"体质":r=o-f.get("最大生命值");break;case"敏捷":r=o-f.get("攻击速度");break;case"灵活":r=o-f.get("暴击几率");break;case"智力":r=o-f.get("技能释放概率");break;case"意志":r=o-f.get("防御")}$("#pdPro_"+t).text(o).css("color",a!==i?"#00f":"#000"),a!==i?$("#pdNew_"+t).text("("+((r>=0?"+":"")+r)+")").css("color",r>=0?"#ff0033":"#339933"):$("#pdNew_"+t).text("")},w=function(e,t){var n=u.get(e);n||(n=0);var a=0;switch(e){case"力量":a=5*(t+n);break;case"体质":a=20*(t+n)+(50===h.get("蕾米莉亚同人漫画")?700:0);break;case"敏捷":a=2*(t+n)+(50===h.get("十六夜同人漫画")?100:0);break;case"灵活":a=t+n,a=Math.round(a/(a+100)*100);break;case"智力":a=t+n,a=Math.round(a/(a+90)*100);break;case"意志":a=t+n,a=Math.round(a/(a+150)*100)}return a},I=function(e,t){var n=0;switch(e){case"力量":n=Math.round(t/5)-u.get("力量");break;case"体质":n=Math.round((50===h.get("蕾米莉亚同人漫画")?t-700:t)/20)-u.get("体质");break;case"敏捷":n=Math.round((50===h.get("十六夜同人漫画")?t-100:t)/2)-u.get("敏捷");break;case"灵活":n=Math.round(100*t/(100-t))-u.get("灵活");break;case"智力":n=Math.round(90*t/(100-t))-u.get("智力");break;case"意志":n=Math.round(150*t/(100-t))-u.get("意志")}return(!isFinite(n)||n<=0)&&(n=1),n},S=function(){var e="",t=!0,n=!1,a=void 0;try{for(var o,r=Object.keys(Config.lootLevelPointList)[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var l=o.value;e+='<option value="'+l+'">第'+l+"层</option>"}}catch(e){n=!0,a=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw a}}$('\n<select id="pdLevelPointListSelect" style="margin: 5px 0;" hidden>\n  <option>属性点分配方案</option>\n  <option value="0">默认</option>\n  <option class="pd_highlight" value="edit">编辑&hellip;</option>\n  '+e+"\n</select><br hidden>\n").prependTo(p).change(function(){var e=$(this).val();if("0"===e)p.find('[type="number"]').each(function(){$(this).val(this.defaultValue)}).trigger("change");else if("edit"===e)this.selectedIndex=0;else if($.isNumeric(e)){var t=function(){var t=Config.lootLevelPointList[parseInt(e)];return"object"!==("undefined"==typeof t?"undefined":i(t))?{v:void 0}:void p.find('[type="number"]').each(function(){var e=$(this);e.val(t[k(e.attr("name"))])}).trigger("change")}();if("object"===("undefined"==typeof t?"undefined":i(t)))return t.v}})},T=function(){var e=d.find("> tbody > tr:nth-child(5) > td"),t=e.html().match(/获得\d+经验和\d+KFB/g),n=0,a=0;for(var i in t){var o=/获得(\d+)经验和(\d+)KFB/.exec(t[i]);n+=parseInt(o[1]),a+=parseInt(o[2])}(n||a)&&e.prepend('<b class="pd_stat">你总共获得了<em>'+n.toLocaleString()+"</em>经验和<em>"+a.toLocaleString()+"</em>KFB</b><br>")};n.addUserLinkInPkListPage=function(){$(".kf_fw_ig1 > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>")})}},{"./Config":4,"./Dialog":7,"./Item":11,"./Util":22}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=n.show=function(e,t){var n={msg:"",duration:Config.defShowMsgDuration,clickable:!0,preventable:!1};"object"===$.type(e)?$.extend(n,e):(n.msg=e,n.duration="undefined"==typeof t?Config.defShowMsgDuration:t),$(".pd_msg").length>20&&o();var a=$(".pd_msg_container"),r=0===a.length;if(!r&&!$(".pd_mask").length){var l=$(".pd_msg:last");if(l.length>0){var s=l.offset().top,d=$(window).scrollTop();(s<d||s>=d+$(window).height()-l.outerHeight()-10)&&(o(),r=!0)}}n.preventable&&!$(".pd_mask").length&&$('<div class="pd_mask"></div>').appendTo("body"),r&&(a=$('<div class="pd_msg_container"></div>').appendTo("body"));var c=$('<div class="pd_msg">'+n.msg+"</div>").appendTo(a);c.on("click",".pd_stop_action",function(e){e.preventDefault(),$(this).html("正在停止&hellip;").closest(".pd_msg").data("stop",!0)}),n.clickable&&c.css("cursor","pointer").click(function(){$(this).stop(!0,!0).fadeOut("slow",function(){i($(this))})}).find("a").click(function(e){e.stopPropagation()});var p=$(window).width(),f=c.outerWidth(),u=c.outerHeight(),h=p/2-f/2;h+f>p&&(h=p-f-20),h<0&&(h=0),r?a.css("top",$(window).height()/2-u/2):a.stop(!1,!0).animate({top:"-="+u/1.75});var m=c.prev(".pd_msg");return c.css({top:m.length>0?parseInt(m.css("top"))+m.outerHeight()+5:0,left:h}).fadeIn("slow"),n.duration!==-1&&c.delay(1e3*n.duration).fadeOut("slow",function(){i($(this))}),c},i=(n.wait=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return a({msg:e,duration:-1,clickable:!1,preventable:t})},n.remove=function(e){var t=e.parent();e.remove(),$(".pd_msg").length?$(".pd_countdown").length||$(".pd_mask").remove():(t.remove(),$(".pd_mask").remove())}),o=n.destroy=function(){$(".pd_msg_container").remove(),$(".pd_mask").remove()}},{}],16:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.modifyFaq=n.addUserNameLinkInRankPage=n.showSelfRatingErrorSizeSubmitWarning=n.highlightRatingErrorSize=n.addAvatarChangeAlert=n.syncModifyPerPageFloorNum=n.addAutoChangeIdColorButton=n.addMsgSelectButton=n.modifyMyPostLink=n.addFollowAndBlockAndMemoUserLink=n.addFastDrawMoneyLink=n.highlightUnReadAtTipsMsg=n.addFastGotoThreadPageLink=n.highlightNewPost=void 0;var o=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e("./Info"),l=i(r),s=e("./Util"),d=a(s),c=e("./Msg"),p=a(c),f=e("./Const"),u=i(f),h=e("./Config"),m=e("./ConfigDialog"),g=e("./TmpLog"),v=a(g),_=e("./Public"),b=a(_),y=e("./Bank"),x=a(y);n.highlightNewPost=function(){$(".thread1 > tbody > tr > td:last-child").has("a.bl").each(function(){var e=$(this).html();/\|\s*\d{2}:\d{2}<br>\n.*\d{2}:\d{2}/.test(e)&&(e=e.replace(/(\d{2}:\d{2})<br>/,'<span class="pd_highlight">$1</span><br>'),$(this).html(e))})},n.addFastGotoThreadPageLink=function(){$('.threadtit1 > a[href^="read.php"]').each(function(){var e=$(this),t=e.closest("td").next().find("ul > li > a").contents().eq(0).text();if(t&&!(t<Config.perPageFloorNum)){for(var n=e.attr("href"),a=Math.floor(t/Config.perPageFloorNum)+1,i="",o=1;o<a;o++){if(o>Config.maxFastGotoThreadPageNum){o+1<=a&&(i+='..<a href="'+n+"&page="+a+'">'+a+"</a>");break}i+='<a href="'+n+"&page="+(o+1)+'">'+(o+1)+"</a>"}i='<span class="pd_thread_page">&hellip;'+i+"</span>",e.after(i).parent().css("white-space","normal")}})},n.highlightUnReadAtTipsMsg=function(){if($(".kf_share1:first").text().trim()==="含有关键词 “"+l.default.userName+"” 的内容"){var e=d.getCookie(u.default.prevReadAtTipsCookieName);if(e&&/^\d+日\d+时\d+分$/.test(e)){var t="";$(".kf_share1:eq(1) > tbody > tr:gt(0) > td:first-child").each(function(n){var a=$(this),i=a.text().trim();return 0===n&&(t=i),e<i&&t>=i&&(a.addClass("pd_highlight"),void(t=i))}),$(".kf_share1").on("click","td > a",function(){d.deleteCookie(u.default.prevReadAtTipsCookieName)})}}},n.addFastDrawMoneyLink=function(){if($('td:contains("SYSTEM")').length&&$('td:contains("收到了他人转账的KFB")').length){var e=$(".thread2 > tbody > tr:eq(-2) > td:last"),t=e.html(),n=/给你转帐(\d+)KFB/i.exec(t);n&&!function(){var a=parseInt(n[1]);e.html(t.replace(/会员\[(.+?)\]通过论坛银行/,'会员[<a target="_blank" href="profile.php?action=show&username=$1">$1</a>]通过论坛银行').replace(n[0],'给你转帐<span class="pd_stat"><em>'+a.toLocaleString()+"</em></span>KFB")),$('<br><a title="从活期存款中取出当前转账的金额" href="#">快速取款</a> | <a title="取出银行账户中的所有活期存款" href="#">取出所有存款</a>').appendTo(e).filter("a:eq(0)").click(function(e){e.preventDefault(),p.destroy(),x.drawCurrentDeposit(a)}).end().filter("a:eq(1)").click(function(e){e.preventDefault(),p.destroy(),p.wait("<strong>正在获取当前活期存款金额&hellip;</strong>"),$.get("hack.php?H_name=bank&t="+(new Date).getTime(),function(e){p.destroy();var t=/活期存款：(\d+)KFB<br/.exec(e);if(!t)return void alert("获取当前活期存款金额失败");var n=parseInt(t[1]);return n<=0?void p.show("当前活期存款余额为零",-1):void x.drawCurrentDeposit(n)})}),$('a[href^="message.php?action=write&remid="]').attr("href","#").addClass("pd_disabled_link").click(function(e){e.preventDefault(),alert("本短消息由系统发送，请勿直接回复；如需回复，请点击给你转账的用户链接，向其发送短消息")})}()}},n.addFollowAndBlockAndMemoUserLink=function(){var e=/(.+?)\s*详细信息/.exec($('td:contains("详细信息")').text());if(e){var t=$.trim(e[1]);$('<span>[<a href="#">关注用户</a>] [<a href="#">屏蔽用户</a>]</span><br><span>[<a href="#">添加备注</a>]</span><br>').appendTo($('a[href^="message.php?action=write&touid="]').parent()).find("a").each(function(){var e=$(this);if(e.is('a:contains("备注")')){var n="",a=!0,i=!1,r=void 0;try{for(var l,s=d.entries(Config.userMemoList)[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var c=o(l.value,2),p=c[0],f=c[1];if(p===t){n=f;break}}}catch(e){i=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(i)throw r}}if(""!==n){e.text("修改备注").data("memo",n);var u=$(".log1 > tbody > tr:last-child > td:last-child");u.html("备注："+n+"<br>"+u.html())}}else{var h="关注",m=Config.followUserList;e.text().indexOf("屏蔽")>-1&&(h="屏蔽",m=Config.blockUserList),d.inFollowOrBlockUserList(t,m)>-1&&e.addClass("pd_highlight").text("解除"+h)}}).click(function(e){e.preventDefault(),(0,h.read)();var n=$(this);if(n.is('a:contains("备注")')){var a=n.data("memo");a||(a="");var i=prompt("为此用户添加备注（要删除备注请留空）：",a);if(null===i)return;Config.userMemoEnabled||(Config.userMemoEnabled=!0),i=$.trim(i),i?(Config.userMemoList[t]=i,n.text("修改备注")):(delete Config.userMemoList[t],n.text("添加备注")),n.data("memo",i),(0,h.write)()}else{var o="关注",r=Config.followUserList;if(n.text().includes("屏蔽")?(o="屏蔽",r=Config.blockUserList,Config.blockUserEnabled||(Config.blockUserEnabled=!0)):Config.followUserEnabled||(Config.followUserEnabled=!0),n.text()==="解除"+o){var l=d.inFollowOrBlockUserList(t,r);l>-1&&(r.splice(l,1),(0,h.write)()),n.removeClass("pd_highlight").text(o+"用户"),alert("该用户已被解除"+o)}else{if(d.inFollowOrBlockUserList(t,r)===-1){if("屏蔽"===o){var s=Config.blockUserDefaultType;if(s=prompt("请填写屏蔽类型，0：屏蔽主题和回帖；1：仅屏蔽主题；2：仅屏蔽回帖",s),null===s)return;s=parseInt(s),(isNaN(s)||s<0||s>2)&&(s=Config.blockUserDefaultType),r.push({name:t,type:s})}else r.push({name:t});(0,h.write)()}n.addClass("pd_highlight").text("解除"+o),alert("该用户已被"+o)}}})}},n.modifyMyPostLink=function(){$('.t a[href^="read.php?tid="]').each(function(){var e=$(this);e.attr("href",e.attr("href").replace(/&uid=\d+#(\d+)/,"&spid=$1"))})},n.addMsgSelectButton=function(){var e=$('.thread1 > tbody > tr > td:last-child > [type="checkbox"]');$('<input value="自定义" type="button" style="margin-right: 3px;">').insertBefore('[type="button"][value="全选"]').click(function(t){t.preventDefault();var n=$.trim(prompt("请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）","收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除"));""!==n&&!function(){e.prop("checked",!1);var t=n.split("|");$(".thread1 > tbody > tr > td:nth-child(2) > a").each(function(){var e=$(this),n=!0,a=!1,i=void 0;try{for(var o,r=t[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;e.text().toLowerCase().includes(l.toLowerCase())&&e.closest("tr").find('td:last-child > input[type="checkbox"]').prop("checked",!0)}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}})}()}).parent().attr("colspan",4).prev("td").attr("colspan",3),$('<input value="反选" type="button" style="margin-left: 5px; margin-right: 1px;">').insertAfter('[type="button"][value="全选"]').click(function(t){t.preventDefault(),e.each(function(){var e=$(this);e.prop("checked",!e.prop("checked"))})})},n.addAutoChangeIdColorButton=function(){var e=$('table div > table > tbody > tr > td:contains("自定义ID颜色")');$('<span class="pd_highlight">低等级没人权？没有自己喜欢的颜色？快来试试助手的<a href="#">自定义本人神秘颜色</a>的功能吧！（虽然仅限自己可见 ╮(╯▽╰)╭）</span><br>').appendTo(e).find("a").click(function(e){e.preventDefault(),(0,m.show)()});var t=e.parent("tr").nextAll("tr").not("tr:last");if(!(t.find("a").length<=1)){var n=$('\n<form>\n<div data-name="autoChangeIdColorBtns" style="margin-top: 5px;">\n  <label><input name="autoChangeIdColorEnabled" class="pd_input" type="checkbox"> 自动更换ID颜色</label>\n</div>\n</form>\n').appendTo(e);n.find('[name="autoChangeIdColorEnabled"]').click(function(){var e=$(this),a=e.prop("checked");if(a!==Config.autoChangeIdColorEnabled&&((0,h.read)(),Config.autoChangeIdColorEnabled=a,(0,h.write)()),a){t.addClass("pd_id_color_select").find("td:not(:has(a))").css("cursor","not-allowed"),$('\n<label class="pd_cfg_ml">\n  更换顺序\n  <select name="autoChangeIdColorType" style="font-size: 12px;">\n    <option value="random">随机</option><option value="sequence">顺序</option>\n  </select>\n</label>&nbsp;\n<label>每隔 <input name="autoChangeIdColorInterval" class="pd_input" style="width: 25px;" type="text" maxlength="5"> 小时</label>\n<button>保存</button> <button style="margin-left: 3px;">重置</button><br>\n<a class="pd_btn_link" href="#">全选</a> <a class="pd_btn_link" href="#">反选</a>\n<label><input name="changeAllAvailableIdColorEnabled" class="pd_input" type="checkbox"> 选择当前所有可用的ID颜色</label>\n').insertAfter(e.parent()).filter("button:first").click(function(e){e.preventDefault();var a=n.find('[name="autoChangeIdColorInterval"]'),i=parseInt(a.val());if(isNaN(i)||i<=0)return alert("ID颜色更换时间间隔格式不正确"),a.select(),void a.focus();var o=n.find('[name="changeAllAvailableIdColorEnabled"]').prop("checked"),r=[];if(t.find('[type="checkbox"]:checked').each(function(){r.push(parseInt($(this).val()))}),!o&&r.length<=1)return void alert("必须选择2种或以上的ID颜色");r.length<=1&&(r=[]);var l=Config.autoChangeIdColorInterval;(0,h.read)(),Config.autoChangeIdColorType=n.find('[name="autoChangeIdColorType"]').val().toLowerCase(),Config.autoChangeIdColorInterval=i,Config.changeAllAvailableIdColorEnabled=o,Config.customAutoChangeIdColorList=r,(0,h.write)(),l!==Config.autoChangeIdColorInterval&&d.deleteCookie(u.default.autoChangeIdColorCookieName),alert("设置保存成功")}).end().filter("button:eq(1)").click(function(e){e.preventDefault(),(0,h.read)(),Config.autoChangeIdColorEnabled=h.Config.autoChangeIdColorEnabled,Config.autoChangeIdColorType=h.Config.autoChangeIdColorType,Config.autoChangeIdColorInterval=h.Config.autoChangeIdColorInterval,Config.changeAllAvailableIdColorEnabled=h.Config.changeAllAvailableIdColorEnabled,Config.customAutoChangeIdColorList=h.Config.customAutoChangeIdColorList,(0,h.write)(),d.deleteCookie(u.default.autoChangeIdColorCookieName),v.deleteValue(u.default.prevAutoChangeIdColorTmpLogName),alert("设置已重置"),location.reload()}).end().filter("a").click(function(e){return e.preventDefault(),t.find("input[disabled]").length>0?(alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),void n.find('[name="changeAllAvailableIdColorEnabled"]').focus()):void($(this).is('[data-name="autoChangeIdColorBtns"] > a:first')?t.find('[type="checkbox"]').prop("checked",!0):t.find('[type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))}))}),t.find("td:has(a)").each(function(){var e=$(this),t=/&color=(\d+)/i.exec(e.find("a").attr("href"));t&&e.append('<input type="checkbox" class="pd_input" value="'+t[1]+'">')}),n.find('[name="autoChangeIdColorType"]').val(Config.autoChangeIdColorType),n.find('[name="autoChangeIdColorInterval"]').val(Config.autoChangeIdColorInterval),n.find('[name="changeAllAvailableIdColorEnabled"]').click(function(){t.find("input").prop("disabled",$(this).prop("checked"))}).prop("checked",Config.changeAllAvailableIdColorEnabled).triggerHandler("click");var i=!0,o=!1,r=void 0;try{for(var l,s=Config.customAutoChangeIdColorList[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value;t.find('input[value="'+c+'"]').prop("checked",!0)}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}}else e.parent().nextAll().remove(),t.removeClass("pd_id_color_select").find("input").remove()}),t.on("click","td",function(e){if(!$(e.target).is("a")){var t=$(this);t.find("input[disabled]").length>0?(alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),n.find('[name="changeAllAvailableIdColorEnabled"]').focus()):$(e.target).is("input")||t.find("input").click()}}),Config.autoChangeIdColorEnabled&&n.find('[name="autoChangeIdColorEnabled"]').prop("checked",!0).triggerHandler("click"),$('div[style="float:right;color:#8080C0"]:contains("每天捐款附送100经验值")').html("每天捐款附送50经验值"),$('div[style="border-bottom:#8000FF 1px dashed;"] > div:contains("帖子被奖励KFB")').html("帖子被奖励KFB(被协管评分)")}},n.syncModifyPerPageFloorNum=function(){var e=function(){var e=parseInt($('select[name="p_num"]').val());isNaN(e)||(e||(e=10),e!==Config.perPageFloorNum&&(Config.perPageFloorNum=e,(0,h.write)()))};$("form#creator").submit(function(){(0,h.read)(),e()}),e()},n.addAvatarChangeAlert=function(){$('input[name="uploadurl[2]"]').parent().append('<div class="pd_highlight">本反向代理服务器为了提高性能对图片设置了缓存，更换头像后可能需等待<b>最多30分钟</b>才能看到效果</div>')},n.highlightRatingErrorSize=function(){$('.adp1 a[href^="read.php?tid="]').each(function(){var e=$(this),t=e.text(),n=0,a=e.parent("td").next("td"),i=/认定\[(\d+)\]/i.exec(a.text());i&&(n=parseInt(i[1]));var o=b.checkRatingSize(t,n),r=o.type,l=o.titleSize;r===-1?a.css("color","#ff9933").attr("title","标题文件大小无法解析").addClass("pd_custom_tips"):1===r&&a.addClass("pd_highlight pd_custom_tips").attr("title","标题文件大小("+l.toLocaleString()+"M)与认定文件大小("+n.toLocaleString()+"M)不一致")})},n.showSelfRatingErrorSizeSubmitWarning=function(){$('form[name="mail1"]').submit(function(){var e=parseFloat($('[name="psize"]').val());if(!(isNaN(e)||e<=0)){2===parseInt($('[name="psizegb"]').val())&&(e*=1024);var t=$('.adp1 a[href^="read.php?tid="]').text(),n=b.checkRatingSize(t,e),a=n.type,i=n.titleSize;return 1===a?confirm("标题文件大小("+i.toLocaleString()+"M)与认定文件大小("+e.toLocaleString()+"M)不一致，是否继续？"):void 0}})},n.addUserNameLinkInRankPage=function(){$(".kf_no11:eq(2) > tbody > tr:gt(0) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===l.default.userName&&e.find("a").addClass("pd_highlight")})},n.modifyFaq=function(){var e=parseInt(d.getUrlParam("id")),t=$(".kf_share1 > tbody > tr:nth-child(2) > td:last-child > div:last-child");if(1===e){if(848!==t.html().length)return;t.html('\n你可以通过发帖/回贴、参与<a href="kf_fw_ig_index.php" target="_blank">争夺奖励</a>等方式获取KFB（论坛货币）和经验。<br><br>\n发帖/回贴时会获得基本的KFB奖励，每天第一次发帖/回贴还可获得额外经验奖励。<br>\n发帖请先阅读规定避免违规，在你还没有时间阅读全部规定之前，请至少注意以下几点：<br>\n不要发表纯水帖；不要纯复制发帖；不要发表政治、广告、恶心的内容；不要攻击、讽刺、挑衅他人；<br>\n不要发表成人图片、视频、小说等内容；不要伪造原创、盗取他人原创。<br><br>\n升级（神秘系数）可以获得不同的等级权限，你可以在<a href="kf_growup.php" target="_blank">等级经验页面</a>进行KFB捐款，\n根据不同的捐款数额获得相应的经验来提升神秘系数。<br>\n注册初始神秘系数为0，为“通常版”等级，拥有大部分的日常权限；提升为神秘系数4时，升级为“初回限定版”等级，拥有部分追加的权限。<br>\n部分板块需要一定神秘系数以上才可进入，如打开帖子时出现“error&hellip;”的提示，说明你当前的神秘系数无法进入该板块。<br><br>\n神秘等级的值以神秘系数为基础，基本上是装饰用的属性，可见于帖子页面各楼层用户名称旁，还可用于选择自定义ID颜色。\n')}}},{"./Bank":2,"./Config":4,"./ConfigDialog":5,"./Const":6,"./Info":10,"./Msg":15,"./Public":18,"./TmpLog":21,"./Util":22}],17:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.addAttachChangeAlert=n.modifyPostPreviewPage=n.addExtraOptionInPostPage=n.addExtraPostEditorButton=n.removeUnpairedBBCodeInQuoteContent=n.handleMultiQuote=void 0;var r=e("./Util"),l=i(r),s=e("./Msg"),d=i(s),c=e("./Func"),p=i(c),f=e("./Const"),u=a(f);n.handleMultiQuote=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;p.run("Post.handleMultiQuote_before_",e),$("#pdClearMultiQuoteData").length||$('<a id="pdClearMultiQuoteData" style="margin-left: 7px;" title="清除在浏览器中保存的多重引用数据" href="#">清除引用数据</a>').insertAfter('input[name="diy_guanjianci"]').click(function(t){t.preventDefault(),localStorage.removeItem(u.default.multiQuoteStorageName),$('input[name="diy_guanjianci"]').val(""),2===e?$("#textarea").val(""):$('textarea[name="atc_content"]').val(""),alert("多重引用数据已被清除")});var t=localStorage[u.default.multiQuoteStorageName];if(t){try{t=JSON.parse(t)}catch(e){return}if(t&&"object"===$.type(t)&&!$.isEmptyObject(t)){var n=parseInt(l.getUrlParam("tid")),a=parseInt(l.getUrlParam("fid"));if(n&&"undefined"!=typeof t.tid&&t.tid===n&&Array.isArray(t.quoteList)&&(2!==e||a)){var i=[],r=!0,s=!1,c=void 0;try{for(var f,h=t.quoteList[Symbol.iterator]();!(r=(f=h.next()).done);r=!0){var m=f.value;if(Array.isArray(m)){var g=!0,v=!1,_=void 0;try{for(var b,y=m[Symbol.iterator]();!(g=(b=y.next()).done);g=!0){var x=b.value;i.push(x)}}catch(e){v=!0,_=e}finally{try{!g&&y.return&&y.return()}finally{if(v)throw _}}}}}catch(e){s=!0,c=e}finally{try{!r&&h.return&&h.return()}finally{if(s)throw c}}if(!i.length)return void localStorage.removeItem(u.default.multiQuoteStorageName);var k=new Set,C="";2===e&&(d.wait('<strong>正在获取引用内容中&hellip;</strong><i>剩余：<em class="pd_countdown">'+i.length+"</em></i>"),$(document).clearQueue("MultiQuote")),$.each(i,function(t,o){"undefined"!=typeof o.floor&&"undefined"!=typeof o.pid&&(k.add(o.userName),2===e?$(document).queue("MultiQuote",function(){$.get("post.php?action=quote&fid="+a+"&tid="+n+"&pid="+o.pid+"&article="+o.floor+"&t="+(new Date).getTime(),function(e){var n=/<textarea id="textarea".*?>((.|\n)+?)<\/textarea>/i.exec(e);n&&(C+=l.removeUnpairedBBCodeContent(l.htmlDecode(n[1]).replace(/\n{2,}/g,"\n"))+(t===i.length-1?"":"\n"));var a=$(".pd_countdown:last");a.text(parseInt(a.text())-1),t===i.length-1?(d.destroy(),
$("#textarea").val(C).focus()):setTimeout(function(){$(document).dequeue("MultiQuote")},100)})}):C+="[quote]回 "+o.floor+"楼("+o.userName+") 的帖子[/quote]\n")}),$('input[name="diy_guanjianci"]').val([].concat(o(k)).join(",")),$('form[name="FORM"]').submit(function(){localStorage.removeItem(u.default.multiQuoteStorageName)}),2===e?$(document).dequeue("MultiQuote"):$('textarea[name="atc_content"]').val(C).focus(),p.run("Post.handleMultiQuote_after_",e)}}}},n.removeUnpairedBBCodeInQuoteContent=function(){var e=$("#textarea"),t=e.val(),n=/\[quote\](.|\r|\n)+?\[\/quote\]/.exec(t);if(n){var a=l.removeUnpairedBBCodeContent(n[0]);n[0]!==a&&e.val(t.replace(n[0],a))}},n.addExtraPostEditorButton=function(){var e=$('textarea[name="atc_content"]').get(0);e&&$('\n<span id="wy_post" title="插入隐藏内容" data-type="hide" style="background-position: 0 -280px;">插入隐藏内容</span>\n<span id="wy_justifyleft" title="左对齐" data-type="left" style="background-position: 0 -360px;">左对齐</span>\n<span id="wy_justifycenter" title="居中" data-type="center" style="background-position: 0 -380px;">居中</span>\n<span id="wy_justifyright" title="右对齐" data-type="right" style="background-position: 0 -400px;">右对齐</span>\n<span id="wy_subscript" title="下标" data-type="sub" style="background-position: 0 -80px;">下标</span>\n<span id="wy_superscript" title="上标" data-type="sup" style="background-position: 0 -100px;">上标</span>\n<span class="pd_editor_btn" title="插入飞行文字" data-type="fly">F</span>\n<span class="pd_editor_btn" title="插入HTML5音频" data-type="audio">A</span>\n<span class="pd_editor_btn" title="插入HTML5视频" data-type="video">V</span>\n').appendTo("#editor-button .editor-button").click(function(){var t=$(this),n=t.data("type"),a="";switch(n){case"hide":a=prompt("请输入神秘等级：",5);break;case"audio":a=prompt("请输入HTML5音频实际地址：\n（可直接输入网易云音乐或虾米的单曲地址，将自动转换为外链地址）","http://");var i=/^https?:\/\/music\.163\.com\/(?:#\/)?song\?id=(\d+)/i.exec(a);i&&(a="http://music.miaola.info/163/"+i[1]+".mp3"),i=/^https?:\/\/www\.xiami\.com\/song\/(\d+)/i.exec(a),i&&(a="http://music.miaola.info/xiami/"+i[1]+".mp3");break;case"video":a=prompt("请输入HTML5视频实际地址：\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）","http://");var o=/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w\-]+)/i.exec(a);o&&(a="http://video.miaola.info/youtube/"+o[1]),o=/^https?:\/\/youtu\.be\/([\w\-]+)$/i.exec(a),o&&(a="http://video.miaola.info/youtube/"+o[1])}if(null!==a){var r="",s="";switch(n){case"hide":r=l.getSelText(e),s="[hide="+a+"]"+r+"[/hide]";break;case"left":r=l.getSelText(e),s="[align=left]"+r+"[/align]";break;case"center":r=l.getSelText(e),s="[align=center]"+r+"[/align]";break;case"right":r=l.getSelText(e),s="[align=right]"+r+"[/align]";break;case"fly":r=l.getSelText(e),s="[fly]"+r+"[/fly]";break;case"sub":r=l.getSelText(e),s="[sub]"+r+"[/sub]";break;case"sup":r=l.getSelText(e),s="[sup]"+r+"[/sup]";break;case"audio":s="[audio]"+a+"[/audio]";break;case"video":s="[video]"+a+"[/video]"}s&&(l.addCode(e,s,r),e.focus())}}).mouseenter(function(){$(this).addClass("buttonHover")}).mouseleave(function(){$(this).removeClass("buttonHover")})},n.addExtraOptionInPostPage=function(){$('\n<div class="pd_post_extra_option">\n  <label><input type="checkbox" name="autoAnalyzeUrl" checked> 自动分析url</label><br>\n  <label><input type="checkbox" name="windCodeAutoConvert" checked> Wind Code自动转换</label>\n</div>\n').appendTo($("#menu_show").closest("td")).on("click",'[type="checkbox"]',function(){var e=$(this),t=e.is('[name="autoAnalyzeUrl"]')?"atc_autourl":"atc_convert";$('form[name="FORM"]').find('[name="'+t+'"]').val(e.prop("checked")?1:0)}),$('<input type="button" value="预览帖子" style="margin-left: 7px;">').insertAfter('[type="submit"][name="Submit"]').click(function(e){e.preventDefault();var t=$('form[name="preview"]');t.find('input[name="atc_content"]').val($("#textarea").val()),t.submit()})},n.modifyPostPreviewPage=function(){$("table > tbody > tr.tr1 > th").css({"text-align":"left","font-weight":"normal",border:"1px solid #9191ff",padding:"10px"})},n.addAttachChangeAlert=function(){$(document).on("click",'.abtn[id^="md_"]',function(){$(document).data("attachUpdateAlert")||(alert("本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果"),$(document).data("attachUpdateAlert",!0))})}},{"./Const":6,"./Func":8,"./Msg":15,"./Util":22}],18:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.importKfSmileEnhanceExtension=exports.checkRatingSize=exports.turnPageViaKeyboard=exports.repairBbsErrorCode=exports.addSearchDialogLink=exports.makeSearchByBelowTwoKeyWordAvailable=exports.bindSearchTypeSelectMenuClick=exports.bindElementTitleClick=exports.showElementTitleTips=exports.changeIdColor=exports.autoSaveCurrentDeposit=exports.addFastNavForSideBar=exports.modifySideBar=exports.blockThread=exports.blockUsers=exports.followUsers=exports.startAutoRefreshMode=exports.getMinRefreshInterval=exports.donation=exports.addPolyfill=exports.showFormatLog=exports.preventCloseWindowWhenActioning=exports.addConfigAndLogDialogLink=exports.appendCss=exports.checkBrowserType=exports.getSafeId=exports.getUidAndUserName=void 0;var _slicedToArray=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Msg=require("./Msg"),Msg=_interopRequireWildcard(_Msg),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Func=require("./Func"),Func=_interopRequireWildcard(_Func),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_ConfigDialog=require("./ConfigDialog"),_Log=require("./Log"),Log=_interopRequireWildcard(_Log),_LogDialog=require("./LogDialog"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_Read=require("./Read"),Read=_interopRequireWildcard(_Read),getUidAndUserName=exports.getUidAndUserName=function(){var e=$('.topright a[href^="profile.php?action=show&uid="]').eq(0);if(!e.length)return!1;if(_Info2.default.userName=e.text(),!_Info2.default.userName)return!1;var t=/&uid=(\d+)/.exec(e.attr("href"));return!!t&&(_Info2.default.uid=parseInt(t[1]),!0)},getSafeId=exports.getSafeId=function(){var e=$("input#safeid").val();if(!e){var t=/safeid=(\w+)/i.exec($('a[href*="safeid="]:first').attr("href"));t&&(e=t[1])}return e?e:""},checkBrowserType=exports.checkBrowserType=function(){"auto"===Config.browseType?_Info2.default.isMobile=/(Mobile|MIDP)/i.test(navigator.userAgent):_Info2.default.isMobile="mobile"===Config.browseType},appendCss=exports.appendCss=function(){$("head").append('\n<style>\n  /* 公共 */\n  .pd_highlight { color: #f00 !important; }\n  .pd_notice, .pd_msg .pd_notice { font-style: italic; color: #666; }\n  .pd_input, .pd_cfg_main input, .pd_cfg_main select {\n    vertical-align: middle; height: auto; margin-right: 0; line-height: 22px; font-size: 12px;\n  }\n  .pd_input[type="text"], .pd_cfg_main input[type="text"] { height: 22px; line-height: 22px; }\n  .pd_input:focus, .pd_cfg_main input[type="text"]:focus, .pd_cfg_main textarea:focus, .pd_textarea:focus { border-color: #7eb4ea; }\n  .pd_textarea, .pd_cfg_main textarea { border: 1px solid #ccc; font-size: 12px; }\n  .pd_btn_link { margin-left: 4px; margin-right: 4px; }\n  .pd_custom_tips { cursor: help; }\n  .pd_disabled_link { color: #999 !important; text-decoration: none !important; cursor: default; }\n  hr {\n    box-sizing: content-box; height: 0; margin-top: 7px; margin-bottom: 7px; border: 0;\n    border-top: 1px solid rgba(0, 0, 0, .2); overflow: visible;\n  }\n  .pd_overflow { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n  .pd_stat i { display: inline-block; font-style: normal; margin-right: 3px; }\n  .pd_stat_extra em, .pd_stat_extra ins { padding: 0 2px; cursor: help; }\n  .pd_panel { position: absolute; overflow-y: auto; background-color: #fff; border: 1px solid #9191ff; opacity: 0.9; }\n  .pd_title_tips {\n    position: absolute; max-width: 470px; font-size: 12px; line-height: 1.5em;\n    padding: 2px 5px; background-color: #fcfcfc; border: 1px solid #767676; z-index: 9999;\n  }\n  .pd_search_type {\n    float: left; height: 26px; line-height: 26px; width: 65px; text-align: center; border: 1px solid #ccc; border-left: none; cursor: pointer;\n  }\n  .pd_search_type i { font-style: normal; margin-left: 5px; font-family: sans-serif; }\n  .pd_search_type_list {\n    position: absolute; width: 63px; background-color: #fcfcfc; border: 1px solid #ccc; border-top: none; line-height: 26px;\n    text-indent: 13px; cursor: pointer; z-index: 1003;\n  }\n  .pd_search_type_list li:hover { color: #fff; background-color: #87c3cf; }\n  \n  /* 消息框 */\n  .pd_mask { position: fixed; width: 100%; height: 100%; left: 0; top: 0; z-index: 1000; }\n  .pd_msg_container { position: '+(_Info2.default.isMobile?"absolute":"fixed")+"; width: 100%; z-index: 1001; }\n  .pd_msg {\n    border: 1px solid #6ca7c0; text-shadow: 0 0 3px rgba(0, 0, 0, 0.1); border-radius: 3px; padding: 12px 40px; text-align: center;\n    font-size: 14px; position: absolute; display: none; color: #333; background: #f8fcfe; background-repeat: no-repeat;\n    background-image: -webkit-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -moz-linear-gradient(top, #f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -o-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -ms-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n  }\n  .pd_msg strong { margin-right: 5px; }\n  .pd_msg i { font-style: normal; padding-left: 10px; }\n  .pd_msg em, .pd_stat em, .pd_msg ins, .pd_stat ins { font-weight: 700; font-style: normal; color:#ff6600; padding: 0 3px; }\n  .pd_msg ins, .pd_stat ins { text-decoration: none; color: #339933; }\n  .pd_msg a { font-weight: bold; margin-left: 15px; }\n  \n  /* 帖子页面 */\n  .readlou .pd_goto_link { color: #000; }\n  .readlou .pd_goto_link:hover { color: #51d; }\n  .pd_fast_goto_floor, .pd_multi_quote_chk { margin-right: 2px; }\n  .pages .pd_fast_goto_page { margin-left: 8px; }\n  .pd_fast_goto_floor span:hover, .pd_fast_goto_page span:hover { color: #51d; cursor: pointer; text-decoration: underline; }\n  .pd_user_memo { font-size: 12px; color: #999; line-height: 14px; }\n  .pd_user_memo_tips { font-size: 12px; color: #fff; margin-left: 3px; cursor: help; }\n  .pd_user_memo_tips:hover { color: #ddd; }\n  .readtext img[onclick] { max-width: 550px; }\n  .read_fds { text-align: left !important; font-weight: normal !important; font-style: normal !important; }\n  .pd_code_area { max-height: 550px; overflow-y: auto; font-size: 12px; }\n  \n  /* 道具页面 */\n  .pd_item_btns { text-align: right; margin-top: 5px;  }\n  .pd_item_btns button, .pd_item_btns input { margin-bottom: 2px; vertical-align: middle; }\n  .pd_my_items > tbody > tr > td > a + a { margin-left: 15px; }\n  .pd_result { border: 1px solid #99f; padding: 5px; margin-top: 10px; line-height: 2em; }\n  .pd_result_sep { border-bottom: 1px solid #999; margin: 7px 0; }\n  .pd_result_sep_inner { border-bottom: 1px dashed #999; margin: 5px 0; }\n  .pd_usable_num { color: #669933; }\n  .pd_used_num { color: #ff0033; }\n  .pd_used_item_info { color: #666; float: right; cursor: help; margin-right: 5px; }\n  .pd_item_type_chk { margin-right: 5px; }\n  \n  /* 发帖页面 */\n  #pdSmilePanel img { margin: 3px; cursor: pointer; }\n  .editor-button .pd_editor_btn { background: none; text-indent: 0; line-height: 18px; cursor: default; }\n  .pd_post_extra_option { text-align: left; margin-top: 5px; margin-left: 5px; }\n  .pd_post_extra_option input { vertical-align: middle; height: auto; margin-right: 0; }\n  \n  /* 其它页面 */\n  .pd_thread_page { margin-left: 5px; }\n  .pd_thread_page a { color: #444; padding: 0 3px; }\n  .pd_thread_page a:hover { color: #51d; }\n  .pd_card_chk { position: absolute; bottom: -8px; left: 1px; }\n  .b_tit4 .pd_thread_goto, .b_tit4_1 .pd_thread_goto { position: absolute; top: 0; right: 0; padding: 0 15px; }\n  .b_tit4 .pd_thread_goto:hover, .b_tit4_1 .pd_thread_goto:hover { padding-left: 15px; }\n  .pd_id_color_select > td { position: relative; cursor: pointer; }\n  .pd_id_color_select > td > input { position: absolute; top: 18px; left: 10px; }\n\n  /* 设置对话框 */\n  .pd_cfg_ml { margin-left: 10px; }\n  .pd_cfg_box {\n    position: "+(_Info2.default.isMobile?"absolute":"fixed")+'; border: 1px solid #9191ff; display: none; z-index: 1002;\n    -webkit-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); -moz-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);\n    -o-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);\n  }\n  .pd_cfg_box h1 {\n    text-align: center; font-size: 14px; background-color: #9191ff; color: #fff; line-height: 2em; margin: 0; padding-left: 20px;\n  }\n  .pd_cfg_box h1 span { float: right; cursor: pointer; padding: 0 10px; }\n  .pd_cfg_nav { text-align: right; margin-top: 5px; margin-bottom: -5px; }\n  .pd_cfg_main { background-color: #fcfcfc; padding: 0 10px; font-size: 12px; line-height: 22px; min-height: 50px; overflow: auto; }\n  .pd_cfg_main fieldset { border: 1px solid #ccccff; padding: 0 6px 6px; }\n  .pd_cfg_main legend { font-weight: bold; }\n  .pd_cfg_main input[type="color"] { height: 18px; width: 30px; padding: 0; }\n  .pd_cfg_main button { vertical-align: middle; }\n  .pd_cfg_tips { color: #51d; text-decoration: none; cursor: help; }\n  .pd_cfg_tips:hover { color: #ff0000; }\n  #pdConfigDialog .pd_cfg_main { overflow-x: hidden; white-space: nowrap; }\n  .pd_cfg_panel { display: inline-block; width: 380px; vertical-align: top; }\n  .pd_cfg_panel + .pd_cfg_panel { margin-left: 5px; }\n  .pd_cfg_btns { background-color: #fcfcfc; text-align: right; padding: 5px; }\n  .pd_cfg_btns button { min-width: 80px; }\n  .pd_cfg_about { float: left; line-height: 24px; margin-left: 5px; }\n  .pd_custom_script_header { margin: 7px 0; padding: 5px; background-color: #e8e8e8; border-radius: 5px; }\n  .pd_custom_script_content { display: none; width: 750px; height: 350px; white-space: pre; }\n\n  /* 日志对话框 */\n  .pd_log_nav { text-align: center; margin: -5px 0 -12px; font-size: 14px; line-height: 44px; }\n  .pd_log_nav a { display: inline-block; }\n  .pd_log_nav h2 { display: inline; font-size: 14px; margin-left: 7px; margin-right: 7px; }\n  .pd_log_content { height: 308px; overflow: auto; }\n  .pd_log_content h3 { display: inline-block; font-size: 12px; line-height: 22px; margin: 0; }\n  .pd_log_content h3:not(:first-child) { margin-top: 5px; }\n  .pd_log_content p { line-height: 22px; margin: 0; }\n</style>\n'),Config.customCssEnabled&&$("head").append("<style>"+Config.customCssContent+"</style>")},addConfigAndLogDialogLink=exports.addConfigAndLogDialogLink=function(){$('<a data-name="openConfigDialog" href="#">助手设置</a><span> | </span><a data-name="openLogDialog" href="#">助手日志</a><span> | </span>').insertBefore($('a[href^="login.php?action=quit"]:first')).filter('[data-name="openConfigDialog"]').click(function(e){e.preventDefault(),(0,_ConfigDialog.show)()}).end().filter('[data-name="openLogDialog"]').click(function(e){e.preventDefault(),(0,_LogDialog.show)()})},preventCloseWindowWhenActioning=exports.preventCloseWindowWhenActioning=function(e){if($(".pd_mask").length>0){var t="操作正在进行中，确定要关闭页面吗？";return e.returnValue=t,t}},showFormatLog=exports.showFormatLog=function(e,t){var n=Util.getResponseMsg(t),a=n.msg,i=n.url;console.log("【"+e+"】回应："+a+(i?"；跳转地址："+Util.getHostNameUrl()+i:""))},addPolyfill=exports.addPolyfill=function(){Array.prototype.includes||(Array.prototype.includes=function(e){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),n=parseInt(t.length)||0;if(0===n)return!1;var a=parseInt(arguments[1])||0,i=void 0;a>=0?i=a:(i=n+a,i<0&&(i=0));for(var o=void 0;i<n;){if(o=t[i],e===o||e!==e&&o!==o)return!0;i++}return!1}),String.prototype.padStart||(String.prototype.padStart=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",n=Object(this),a=String(n),i=parseInt(e)||0,o=parseInt(a.length)||0;if(i<=o)return a;var r="undefined"==typeof t?" ":String(t);if(""===r)return a;for(var l=i-o;r.length<l;){var s=r.length,d=l-s;r+=s>d?r.slice(0,d):r}var c=r.slice(0,l);return c+a}),String.prototype.padEnd||(String.prototype.padEnd=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",n=Object(this),a=String(n),i=parseInt(e)||0,o=parseInt(a.length)||0;if(i<=o)return a;var r="undefined"==typeof t?" ":String(t);if(""===r)return a;for(var l=i-o;r.length<l;){var s=r.length,d=l-s;r+=s>d?r.slice(0,d):r}var c=r.slice(0,l);return a+c})},donation=exports.donation=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Date,n=Util.getDateByTime(Config.donationAfterTime);if(t<n)return void(e&&autoSaveCurrentDeposit());Func.run("Public.donation_before_"),console.log("KFB捐款Start");var a=Msg.wait("<strong>正在进行捐款，请稍候&hellip;</strong>"),i=function(){var e=new Date,t=Util.getTimezoneDateByTime("02:00:00");return e>t&&(t=Util.getTimezoneDateByTime("00:00:00"),t.setDate(t.getDate()+1)),e>t&&t.setDate(t.getDate()+1),t},o=function(t){$.post("kf_growup.php?ok=1",{kfb:t},function(n){Util.setCookie(_Const2.default.donationCookieName,1,i()),showFormatLog("捐款"+t+"KFB",n);var o=Util.getResponseMsg(n),r=o.msg;Msg.remove(a);var l="<strong>捐款<em>"+t+"</em>KFB</strong>",s=/捐款获得(\d+)经验值(?:.*?补偿期(?:.*?\+(\d+)KFB)?(?:.*?(\d+)成长经验)?)?/i.exec(r);if(s){l+="<i>经验值<em>+"+s[1]+"</em></i>";var d={"经验值":parseInt(s[1])};"undefined"==typeof s[2]&&"undefined"==typeof s[3]||(l+='<i style="margin-left: 5px;">(补偿期:</i>'+("undefined"!=typeof s[2]?"<i>KFB<em>+"+s[2]+"</em>"+("undefined"!=typeof s[3]?"":")")+"</i>":"")+("undefined"!=typeof s[3]?"<i>经验值<em>+"+s[3]+"</em>)</i>":""),"undefined"!=typeof s[2]&&(d.KFB=parseInt(s[2])),"undefined"!=typeof s[3]&&(d["经验值"]+=parseInt(s[3]))),Log.push("捐款","捐款`"+t+"`KFB",{gain:d,pay:{KFB:-t}})}else{if(!/KFB不足。/.test(r))return;l+='<i class="pd_notice">KFB不足</i><a target="_blank" href="kf_growup.php">手动捐款</a>'}Msg.show(l),e&&autoSaveCurrentDeposit(!0),Func.run("Public.donation_after_",r)})};/%$/.test(Config.donationKfb)?$.get("profile.php?action=show&uid="+_Info2.default.uid+"&t="+(new Date).getTime(),function(e){var t=/论坛货币：(-?\d+)\s*KFB/i.exec(e),n=1;t?n=parseInt(t[1]):console.log("当前持有KFB获取失败");var a=parseInt(Config.donationKfb);a=Math.floor(n*a/100),a=a>0?a:1,a=a<=_Const2.default.maxDonationKfb?a:_Const2.default.maxDonationKfb,o(a)}):$.get("kf_growup.php?t="+(new Date).getTime(),function(t){/>今天已经捐款</.test(t)?(Msg.remove(a),Util.setCookie(_Const2.default.donationCookieName,1,i()),e&&autoSaveCurrentDeposit()):o(parseInt(Config.donationKfb))})},getMinRefreshInterval=exports.getMinRefreshInterval=function(){var e=-1;if(Config.autoDonationEnabled){var t=Util.getDateByTime(Config.donationAfterTime),n=new Date;!Util.getCookie(_Const2.default.donationCookieName)&&n<=t?e=Math.floor((t-n)/1e3):(t.setDate(t.getDate()+1),e=Math.floor((t-n)/1e3))}var a=-1;if(Config.autoChangeIdColorEnabled){var i=parseInt(Util.getCookie(_Const2.default.autoChangeIdColorCookieName));!isNaN(i)&&i>0?(a=Math.floor((i-(new Date).getTime())/1e3),a<0&&(a=0),!Config.changeAllAvailableIdColorEnabled&&Config.customAutoChangeIdColorList.length<=1&&(a=-1)):a=0}var o=[e,a].filter(function(e){return e>=0});if(o.length>0){var r=Math.min.apply(Math,_toConsumableArray(o));return r>0?r+1:0}return-1},startAutoRefreshMode=exports.startAutoRefreshMode=function(){var e=getMinRefreshInterval();if(e!==-1){var t=document.title,n=null,a=-1,i=0,o=function(e,t){var n="",a=Util.getTimeDiffInfo(Util.getDate("+"+t+"s").getTime());return n=a.hours>0?a.hours+"时":"",n+=1===e?(a.minutes>0?a.minutes+"分":"")+a.seconds+"秒":a.minutes+"分"},r=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n&&window.clearInterval(n);var i=e;if(console.log("【定时模式】倒计时："+o(1,i)),"never"!==Config.showRefreshModeTipsType.toLowerCase()){var r=function(){document.title=t+" (定时: "+o(e<60?1:2,i)+")",i=e<60?i-1:i-60};a||"always"===Config.showRefreshModeTipsType.toLowerCase()||e<60?r():i=e<60?i-1:i-60,n=setInterval(r,60*_Const2.default.showRefreshModeTipsInterval*1e3)}},l=function e(){var t=0,n="";$.ajax({type:"GET",url:"index.php?t="+(new Date).getTime(),timeout:_Const2.default.defAjaxTimeout,success:function(e){/"kf_fw_ig_index.php"/.test(e)||(t=10,n="论坛维护或其它未知情况")},error:function(){t=_Const2.default.errorRefreshInterval,n="连接超时"},complete:function(){t>0?(console.log("定时操作失败（原因："+n+"），将在"+t+"分钟后重试..."),Msg.remove($(".pd_refresh_notice").parent()),Msg.show('<strong class="pd_refresh_notice">定时操作失败（原因：'+n+"），将在<em>"+t+"</em>分钟后重试&hellip;</strong>",-1),setTimeout(e,60*t*1e3),r(60*t,!0)):i>6?(i=0,t=15,setTimeout(s,60*t*1e3),r(60*t,!0)):(i++,s())}})},s=function e(){Msg.remove($(".pd_refresh_notice").parent()),Config.autoDonationEnabled&&!Util.getCookie(_Const2.default.donationCookieName)&&donation(),Config.autoChangeIdColorEnabled&&!Util.getCookie(_Const2.default.autoChangeIdColorCookieName)&&changeIdColor();var t=getMinRefreshInterval();return t>0&&(i=0),0===t&&0===a?(a=-1,void l()):(a=t,t===-1?void(n&&clearInterval(n)):(0===t&&(t=_Const2.default.actionFinishRetryInterval),setTimeout(e,1e3*t),void r(t,!0)))};setTimeout(s,e<60?6e4:1e3*e),r(e<60?60:e)}},followUsers=exports.followUsers=function(){Config.followUserList.length&&(_Info2.default.isInHomePage&&Config.highlightFollowUserThreadInHPEnabled?$(".b_tit4 > a, .b_tit4_1 > a").each(function(){var e=$(this),t=/》by：(.+)/.exec(e.attr("title"));t&&Util.inFollowOrBlockUserList(t[1],Config.followUserList)>-1&&e.addClass("pd_highlight")}):"/thread.php"===location.pathname?$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&(e.addClass("pd_highlight"),Config.highlightFollowUserThreadLinkEnabled&&e.parent("td").prev("td").prev("td").find('div > a[href^="read.php?tid="]').addClass("pd_highlight"))}):"/read.php"===location.pathname?$(".readidmsbottom > a, .readidmleft > a").each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.closest(".readtext").prev(".readlou").find("div:nth-child(2) > span:first-child").find("a").addBack().addClass("pd_highlight")}):"/guanjianci.php"===location.pathname||"/kf_share.php"===location.pathname?$(".kf_share1 > tbody > tr > td:last-child").each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.addClass("pd_highlight")}):"/search.php"===location.pathname&&$('.thread1 a[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.addClass("pd_highlight")}))},blockUsers=exports.blockUsers=function(){if(0!==Config.blockUserList.length){var e=0;if(_Info2.default.isInHomePage)$(".b_tit4 > a, .b_tit4_1 > a").each(function(){var t=$(this),n=/》by：(.+)/.exec(t.attr("title"));if(n){var a=Util.inFollowOrBlockUserList(n[1],Config.blockUserList);a>-1&&Config.blockUserList[a].type<2&&(e++,t.parent("li").remove())}});else if("/thread.php"===location.pathname){var t=parseInt($('input[name="f_fid"]:first').val());if(!t)return;if(1===Config.blockUserForumType&&$.inArray(t,Config.blockUserFidList)===-1)return;if(2===Config.blockUserForumType&&$.inArray(t,Config.blockUserFidList)>-1)return;$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var t=$(this),n=Util.inFollowOrBlockUserList(t.text(),Config.blockUserList);n>-1&&Config.blockUserList[n].type<2&&(e++,t.closest("tr").remove())})}else if("/read.php"===location.pathname){var n=function(){if(Config.blockUserForumType>0){var t=parseInt($('input[name="fid"]:first').val());if(!t)return{v:void 0};if(1===Config.blockUserForumType&&$.inArray(t,Config.blockUserFidList)===-1)return{v:void 0};if(2===Config.blockUserForumType&&$.inArray(t,Config.blockUserFidList)>-1)return{v:void 0}}var n=Util.getCurrentThreadPage();$(".readidmsbottom > a, .readidmleft > a").each(function(t){var a=$(this),i=Util.inFollowOrBlockUserList(a.text(),Config.blockUserList);if(i>-1){var o=Config.blockUserList[i].type;if(0===t&&1===n&&o>1)return;if((0===t&&1!==n||t>0)&&1===o)return;e++;var r=a.closest(".readtext");r.prev(".readlou").remove().end().next(".readlou").remove().end().remove()}}),$('.readtext fieldset:has(legend:contains("Quote:"))').each(function(){var e=$(this),t=e.text(),n=!0,a=!1,i=void 0;try{for(var o,r=Config.blockUserList[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;if(1!==l.type)try{var s=new RegExp("^Quote:引用(第\\d+楼|楼主)"+l.name+"于","i"),d=new RegExp("^Quote:回\\s*\\d+楼\\("+l.name+"\\)\\s*的帖子","i");(s.test(t)||d.test(t))&&e.html('<legend>Quote:</legend><mark class="pd_custom_tips" title="被屏蔽用户：'+l.name+'">该用户已被屏蔽</mark>')}catch(e){}}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}})}();if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}else"/guanjianci.php"===location.pathname&&Config.blockUserAtTipsEnabled&&$(".kf_share1 > tbody > tr > td:last-child").each(function(){var t=$(this);Util.inFollowOrBlockUserList(t.text(),Config.blockUserList)>-1&&(e++,t.closest("tr").remove())});e>0&&console.log("【屏蔽用户】共有"+e+"个帖子被屏蔽")}},blockThread=exports.blockThread=function blockThread(){if(Config.blockThreadList.length){var isBlock=function isBlock(title,userName){var fid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=Config.blockThreadList[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var _step2$value=_step2.value,keyWord=_step2$value.keyWord,includeUser=_step2$value.includeUser,excludeUser=_step2$value.excludeUser,includeFid=_step2$value.includeFid,excludeFid=_step2$value.excludeFid,regex=null;if(/^\/.+\/[gimuy]*$/.test(keyWord))try{regex=eval(keyWord)}catch(e){console.log(e);continue}if(userName)if(includeUser){if(!includeUser.includes(userName))continue}else if(excludeUser&&excludeUser.includes(userName))continue;if(fid)if(includeFid){if(!includeFid.includes(fid))continue}else if(excludeFid&&excludeFid.includes(fid))continue;if(regex){if(regex.test(title))return!0}else if(title.toLowerCase().includes(keyWord.toLowerCase()))return!0}}catch(e){_didIteratorError2=!0,_iteratorError2=e}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return!1},num=0;if(_Info2.default.isInHomePage)$(".b_tit4 a, .b_tit4_1 a").each(function(){var e=$(this),t=/》by：(.+)/.exec(e.attr("title")),n="";t&&(n=t[1]),isBlock(e.text(),n)&&(num++,e.parent("li").remove())});else if("/thread.php"===location.pathname){var _ret2=function(){var e=parseInt($('input[name="f_fid"]:first').val());return e?void $('.threadtit1 a[href^="read.php"]').each(function(){var t=$(this);isBlock(t.text(),t.closest("tr").find("td:last-child > a.bl").text(),e)&&(num++,t.closest("tr").remove())}):{v:void 0}}();if("object"===("undefined"==typeof _ret2?"undefined":_typeof(_ret2)))return _ret2.v}else if("/read.php"===location.pathname){if(1!==Util.getCurrentThreadPage())return;var title=Read.getThreadTitle();if(!title)return;var $userName=$(".readidmsbottom > a, .readidmleft > a").eq(0);if("楼主"!==$userName.closest(".readtext").prev(".readlou").find("div:nth-child(2) > span:first-child").text().trim())return;var userName=$userName.text();if(!userName)return;var _fid2=parseInt($('input[name="fid"]:first').val());if(!_fid2)return;if(isBlock(title,userName,_fid2)){num++;var $lou=$userName.closest(".readtext");$lou.prev(".readlou").remove().end().next(".readlou").remove().end().remove()}}num>0&&console.log("【屏蔽帖子】共有"+num+"个帖子被屏蔽")}},modifySideBar=exports.modifySideBar=function(){$("#r_menu").replaceWith('\n<div id="r_menu" style="width: 140px; color: #9999ff; font-size: 14px; line-height: 24px; text-align: center; border: 1px #ddddff solid; padding: 5px; overflow: hidden;">\n  <span style="color: #ff9999;">游戏</span><br>\n  <a href="thread.php?fid=102">游戏推荐</a> | <a href="thread.php?fid=106">新作动态</a><br>\n  <a href="thread.php?fid=52">游戏讨论</a> | <a href="thread.php?fid=24">疑难互助</a><br>\n  <a href="thread.php?fid=16">种子下载</a> | <a href="thread.php?fid=41">网盘下载</a><br>\n  <a href="thread.php?fid=67">图片共享</a> | <a href="thread.php?fid=57">同人漫本</a><br>\n  <span style="color: #ff9999;">动漫音乐</span><br>\n  <a href="thread.php?fid=84">动漫讨论</a> | <a href="thread.php?fid=92">动画共享</a><br>\n  <a href="thread.php?fid=127">漫画小说</a> | <a href="thread.php?fid=68">音乐共享</a><br>\n  <a href="thread.php?fid=163">LIVE共享</a>  | <a href="thread.php?fid=182">转载资源</a><br>\n  <span style="color: #ff9999;">综合</span><br>\n  <a href="thread.php?fid=94">原创美图</a> | <a href="thread.php?fid=87">宅物交流</a><br>\n  <a href="thread.php?fid=86">电子产品</a> | <a href="thread.php?fid=115">文字作品</a><br>\n  <a href="thread.php?fid=96">出处讨论</a>  | <a href="thread.php?fid=36">寻求资源</a><br>\n  <span style="color: #ff9999;">交流</span><br>\n  <a href="thread.php?fid=5">自由讨论</a> | <a href="thread.php?fid=56">个人日记</a><br>\n  <a href="thread.php?fid=98">日本语版</a>  | <a href="thread.php?fid=9">我的关注</a><br>\n  <a href="thread.php?fid=4">站务管理</a><br>\n  <span style="color: #ff9999;">专用</span><br>\n  <a href="thread.php?fid=93">管理组区</a> | <a href="thread.php?fid=59">原创组区</a><br>\n  <a href="/">论坛首页</a><br>\n</div>\n')},addFastNavForSideBar=exports.addFastNavForSideBar=function(){var e=$("#r_menu");e.hasClass("r_cmenu")?e.find("> ul > li:last-child").before('\n<li class="r_cmenuho">\n  <a href="javascript:;">快捷导航</a>\n  <ul class="r_cmenu2">\n    <li><a href="guanjianci.php?gjc='+_Info2.default.userName+'">@提醒</a></li>\n    <li><a href="kf_growup.php">等级经验</a></li>\n    <li><a href="kf_fw_ig_index.php">争夺奖励</a></li>\n    <li><a href="kf_fw_ig_my.php">我的道具</a></li>\n    <li><a href="kf_fw_ig_shop.php">道具商店</a></li>\n    <li><a href="profile.php?action=modify">设置</a></li>\n    <li><a href="hack.php?H_name=bank">银行</a></li>\n    <li><a href="profile.php?action=favor">收藏</a></li>\n    <li><a href="personal.php?action=post">我的回复</a></li>\n    '+_Const2.default.customSideBarContent+"\n  </ul>\n</li>\n"):(Config.modifySideBarEnabled||e.append('<a href="/">论坛首页</a><br>'),e.find("> a:last").before('\n<span style="color: #ff9999;">快捷导航</span><br>\n<a href="guanjianci.php?gjc='+_Info2.default.userName+'">@提醒</a> | <a href="personal.php?action=post">回复</a> | <a href="kf_growup.php">等级</a><br>\n<a href="kf_fw_ig_index.php">争夺</a> | <a href="kf_fw_ig_my.php">道具</a> | <a href="kf_fw_ig_shop.php">商店</a><br>\n<a href="profile.php?action=modify">设置</a> | <a href="hack.php?H_name=bank">银行</a> | <a href="profile.php?action=favor">收藏</a><br>\n'+_Const2.default.customTileSideBarContent+"\n"))},autoSaveCurrentDeposit=exports.autoSaveCurrentDeposit=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Config.saveCurrentDepositAfterKfb>0&&Config.saveCurrentDepositKfb>0&&Config.saveCurrentDepositKfb<=Config.saveCurrentDepositAfterKfb){
var t=$('a[href="kf_givemekfb.php"]'),n=function(e){if(!(e<Config.saveCurrentDepositAfterKfb)){var n=Math.floor((e-Config.saveCurrentDepositAfterKfb)/Config.saveCurrentDepositKfb);e-Config.saveCurrentDepositKfb*n>=Config.saveCurrentDepositAfterKfb&&n++;var a=Config.saveCurrentDepositKfb*n;a<=0||a>e||(console.log("自动活期存款Start"),$.post("hack.php?H_name=bank",{action:"save",btype:1,savemoney:a},function(n){showFormatLog("自动存款",n);var i=Util.getResponseMsg(n),o=i.msg;/完成存款/.test(o)&&(Log.push("自动存款","共有`"+a+"`KFB已自动存入活期存款"),console.log("共有"+a+"KFB已自动存入活期存款"),Msg.show("共有<em>"+a+"</em>KFB已自动存入活期存款"),_Info2.default.isInHomePage&&t.text("拥有"+(e-a)+"KFB"))}))}};if(e)console.log("获取当前持有KFB Start"),$.get("profile.php?action=show&uid="+_Info2.default.uid+"&t="+(new Date).getTime(),function(e){var t=/论坛货币：(\d+)\s*KFB<br/i.exec(e);t&&n(parseInt(t[1]))});else{var a=/拥有(\d+)KFB/.exec(t.text());a&&n(parseInt(a[1]))}}},changeIdColor=exports.changeIdColor=function(){if(Config.changeAllAvailableIdColorEnabled||!(Config.customAutoChangeIdColorList.length<=1)){var e=function(){var e=Util.getDate("+"+Config.autoChangeIdColorInterval+"h");Util.setCookie(_Const2.default.autoChangeIdColorCookieName,e.getTime(),e)};console.log("自动更换ID颜色Start"),$.get("kf_growup.php?t="+(new Date).getTime(),function(t){if(!Util.getCookie(_Const2.default.autoChangeIdColorCookieName)){var n=t.match(/href="kf_growup\.php\?ok=2&safeid=\w+&color=\d+"/g);if(n){var a=function(){var t="",a=/safeid=(\w+)&/i.exec(n[0]);if(a&&(t=a[1]),!t)return e(),{v:void 0};var i=[];for(var o in n){var r=/color=(\d+)/i.exec(n[o]);r&&i.push(parseInt(r[1]))}var l=i;if(!Config.changeAllAvailableIdColorEnabled){l=[];var s=!0,d=!1,c=void 0;try{for(var p,f=Config.customAutoChangeIdColorList[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var u=p.value;i.includes(u)&&l.push(u)}}catch(e){d=!0,c=e}finally{try{!s&&f.return&&f.return()}finally{if(d)throw c}}}if(l.length<=1)return e(),{v:void 0};var h=parseInt(TmpLog.getValue(_Const2.default.prevAutoChangeIdColorTmpLogName));(isNaN(h)||h<0)&&(h=0);var m=0;if("sequence"===Config.autoChangeIdColorType.toLowerCase()){var g=!0,v=!1,_=void 0;try{for(var b,y=l.entries()[Symbol.iterator]();!(g=(b=y.next()).done);g=!0){var x=_slicedToArray(b.value,2),k=(x[0],x[1]);if(k>h){m=k;break}}}catch(e){v=!0,_=e}finally{try{!g&&y.return&&y.return()}finally{if(v)throw _}}0===m&&(m=l[0])}else{var C=!0,w=!1,I=void 0;try{for(var S,T=l.entries()[Symbol.iterator]();!(C=(S=T.next()).done);C=!0){var L=_slicedToArray(S.value,2),D=L[0],U=L[1];if(U===h){l.splice(D,1);break}}}catch(e){w=!0,I=e}finally{try{!C&&T.return&&T.return()}finally{if(w)throw I}}m=l[Math.floor(Math.random()*l.length)]}$.get("kf_growup.php?ok=2&safeid="+t+"&color="+m+"&t="+(new Date).getTime(),function(t){e(),showFormatLog("自动更换ID颜色",t);var n=Util.getResponseMsg(t),a=n.msg;/等级颜色修改完毕/.test(a)&&(console.log("ID颜色更换为："+m),TmpLog.setValue(_Const2.default.prevAutoChangeIdColorTmpLogName,m))})}();if("object"===("undefined"==typeof a?"undefined":_typeof(a)))return a.v}else e()}})}},showElementTitleTips=exports.showElementTitleTips=function(e,t){$(".pd_title_tips").remove(),t&&e.originalEvent&&$('<div class="pd_title_tips">'+t+"</div>").appendTo("body").css("left",e.originalEvent.pageX-20).css("top",e.originalEvent.pageY+15)},bindElementTitleClick=exports.bindElementTitleClick=function(){var e=["A","IMG","INPUT","BUTTON","TEXTAREA","SELECT"];$(document).click(function(t){var n=t.target;!n.title&&!e.includes(n.nodeName)&&n.parentNode&&n.parentNode.title&&(n=n.parentNode),!n.title||e.includes(n.nodeName)||n.id&&n.id.startsWith("wy_")||$(n).is(".pd_editor_btn")?$(".pd_title_tips").remove():showElementTitleTips(t,n.title)})},bindSearchTypeSelectMenuClick=exports.bindSearchTypeSelectMenuClick=function(){$(document).on("click",".pd_search_type",function(){var e=$(this),t=$(".pd_search_type_list");if(t.length>0)return void t.remove();var n=e.data("type");t=$('<ul class="pd_search_type_list"><li>标题</li><li>作者</li><li>关键词</li><li>用户名</li></ul>').appendTo("body");var a=e.offset();t.css("top",a.top+e.height()+2).css("left",a.left+1),"dialog"===n&&t.css({width:"65px",left:a.left-1}),t.on("click","li",function(){var n=$(this),a=n.text().trim(),i=e.closest("form"),o=i.find('input[name="keyword"], input[name="pwuser"]');e.find("span").text(a),"关键词"!==a&&"用户名"!==a&&i.attr("action","search.php?"),"作者"===a?o.attr("name","pwuser"):o.attr("name","keyword");var r=i.find('[name="searchRange"][value="current"]');r.length>0&&r.prop("disabled","关键词"===a||"用户名"===a||!r.data("enabled")),t.remove(),o.focus()})}),$(document).on("submit",'form[name="pdSearchForm"]',function(){var e=$(this),t=$.trim(e.find(".pd_search_type > span").text());"关键词"===t?e.attr("action","guanjianci.php?gjc="+e.find('input[name="keyword"]').val()):"用户名"===t&&e.attr("action","profile.php?action=show&username="+e.find('input[name="keyword"]').val())})},makeSearchByBelowTwoKeyWordAvailable=exports.makeSearchByBelowTwoKeyWordAvailable=function(){$(document).on("submit",'form[action="search.php?"]',function(){var e=$(this),t=e.find('input[name="keyword"]'),n=e.find('input[name="method"]');if(t.length&&n.length){var a=$.trim(t.val());!a||Util.getStrByteLen(a)>2||(t.val(a+" "+Math.floor((new Date).getTime()/1e3)),n.val("OR"),setTimeout(function(){t.val(a),n.val("AND")},200))}})},addSearchDialogLink=exports.addSearchDialogLink=function(){$('<span> | </span><a href="#">搜索</a>').insertAfter('.topright > a[href="message.php"]').filter("a").click(function(e){e.preventDefault();var t="pdSearchDialog";if(!($("#"+t).length>0)){var n='\n<div class="pd_cfg_main">\n  <input name="step" value="2" type="hidden">\n  <input name="method" value="AND" type="hidden">\n  <input name="sch_area" value="0" type="hidden">\n  <input name="s_type" value="forum" type="hidden">\n  <input name="f_fid" value="all" type="hidden">\n  <input name="orderway" value="lastpost" type="hidden">\n  <input name="asc" value="DESC" type="hidden">\n  <div style="margin-top: 15px;">\n    <input class="pd_input" name="keyword" type="search" style="float: left; width: 175px; line-height: 26px;" placeholder="关键字">\n    <div class="pd_search_type" data-type="dialog"><span>标题</span><i>∨</i></div>\n    <button class="indloginm" name="submit" type="submit">搜索</button>\n  </div>\n  <div style="margin-bottom: 8px; line-height: 35px;">\n    <label><input name="searchRange" type="radio" value="all" checked> 全站 </label>\n    <label><input name="searchRange" type="radio" value="current" disabled> 本版</label>\n  </div>\n</div>',a=Dialog.create(t,"搜索",n);a.closest("form").attr({name:t,action:"search.php?",method:"post",target:"_blank"}).off("submit");var i=parseInt($('input[name="f_fid"]:first, input[name="fid"]:first').val());i&&(a.find('[name="searchRange"]').click(function(){var e=$(this);a.find('input[name="f_fid"]').val("current"===e.val()?i:"all")}),a.find('[name="searchRange"][value="current"]').prop("disabled",!1).data("enabled",!0).click()),a.keydown(function(e){27===e.keyCode&&$(".pd_search_type_list").remove()}).find("h1 > span").click(function(){$(".pd_search_type_list").remove()}),Dialog.show(t),a.find('[name="keyword"]').focus()}})},repairBbsErrorCode=exports.repairBbsErrorCode=function(){_Info2.default.w.is_ie=!1,"/read.php"===location.pathname&&(_Info2.default.w.strlen=Util.getStrByteLen)},turnPageViaKeyboard=exports.turnPageViaKeyboard=function(){$(document).keydown(function(e){if((37===e.keyCode||39===e.keyCode)&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){var t=$(".pages:first"),n=t.find('li > a[href="javascript:;"]');if(n.length){var a=Util.getCurrentThreadPage(),i="";if(37===e.keyCode){if(a<=1)return;i=t.find('li > a:contains("上一页")').attr("href")}else{var o=/&page=(\d+)/.exec(t.find("li:last-child > a").attr("href"));if(!o)return;if(a>=parseInt(o[1]))return;i=t.find('li > a:contains("下一页")').attr("href")}"/read.php"===location.pathname&&$.trim($('textarea[name="atc_content"]').val())&&!confirm("发帖框尚有文字，是否继续翻页？")||(location.href=i)}}})},checkRatingSize=exports.checkRatingSize=function(e,t){var n=0,a=e.match(/\D(\d+(?:\.\d+)?)\s?(M|G)/gi);if(a)for(var i=0;i<a.length;i++){var o=/(\d+(?:\.\d+)?)\s?(M|G)/i.exec(a[i]);if(o){var r=parseFloat(o[1]);"G"===o[2].toUpperCase()&&(r*=1024),n+=r}}return n&&t?n>t*(100+_Const2.default.ratingErrorSizePercent)/100+1||n<t*(100-_Const2.default.ratingErrorSizePercent)/100-1?{type:1,titleSize:n,ratingSize:t}:{type:0}:{type:-1}},importKfSmileEnhanceExtension=exports.importKfSmileEnhanceExtension=function(){var e=document.createElement("script");e.type="text/javascript",e.charset="utf-8",e.src="https://kf.miaola.info/kfe.min.user.js?"+Util.getDateString(new Date,""),document.body.appendChild(e)}},{"./ConfigDialog":5,"./Const":6,"./Dialog":7,"./Func":8,"./Info":10,"./Log":12,"./LogDialog":13,"./Msg":15,"./Read":19,"./TmpLog":21,"./Util":22}],19:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.getThreadTitle=n.addSelfRatingLink=n.showAttachImageOutsideSellBox=n.parseMediaTag=n.addMoreSmileLink=n.addCopyCodeLink=n.addUserMemo=n.buyThreads=n.addBatchBuyThreadButton=n.handleBuyThreadBtn=n.modifyKFOtherDomainLink=n.addMultiQuoteButton=n.getMultiQuoteData=n.addStatRepliersLink=n.showStatRepliersDialog=n.addCopyBuyersListLink=n.adjustThreadContentFontSize=n.adjustThreadContentWidth=n.modifySmColor=n.modifyMySmColor=n.modifyFloorSmColor=n.fastGotoFloor=n.addFastGotoFloorInput=n.addFloorGotoLink=void 0;var r=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=e("./Info"),s=i(l),d=e("./Util"),c=a(d),p=e("./Msg"),f=a(p),u=e("./Dialog"),h=a(u),m=e("./Func"),g=a(m),v=e("./Const"),_=i(v),b=e("./Log"),y=a(b),x=e("./Public"),k=a(x),C=e("./Post"),w=a(C),I=(n.addFloorGotoLink=function(){$(".readlou > div:nth-child(2) > span").each(function(){var e=$(this),t=e.text();if(/^\d+楼$/.test(t)){var n=e.closest(".readlou").prev().attr("name");if(n&&/^\d+$/.test(n)){var a=c.getHostNameUrl()+"read.php?tid="+c.getUrlParam("tid")+"&spid="+n;e.html('<a class="pd_goto_link" href="'+a+'" title="复制楼层链接">'+t+"</a>"),e.find("a").click(function(e){e.preventDefault();var t=$(this),n=t.attr("href");t.data("copy-text",n),c.copyText(t,"楼层链接已复制")||prompt("本楼的跳转链接（请按Ctrl+C复制）：",n)})}}})},n.addFastGotoFloorInput=function(){$('<form><li class="pd_fast_goto_floor">电梯直达 <input class="pd_input" style="width:30px" type="text" maxlength="8"> <span>楼</span></li></form>').prependTo($(".readtext:first").prev(".readlou").find("> div:first-child > ul")).submit(function(e){e.preventDefault();var t=parseInt($(this).find("input").val());!t||t<0||(location.href=c.getHostNameUrl+"read.php?tid="+c.getUrlParam("tid")+"&page="+(parseInt(t/Config.perPageFloorNum)+1)+"&floor="+t)}).find("span").click(function(){$(this).closest("form").submit()}).end().closest("div").next().css({"max-width":"505px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"})},n.fastGotoFloor=function(){var e=parseInt(c.getUrlParam("floor"));if(e&&!(e<0)){var t=$('.readlou > div:nth-child(2) > span:contains("'+e+'楼")');if(t.length){var n=t.closest(".readlou").prev().attr("name");n&&/^\d+$/.test(n)&&(location.hash="#"+n)}}},n.modifyFloorSmColor=function(e,t){e.is(".readidmsbottom > a")&&e.css("color",t),e.closest(".readtext").css("border-color",t).prev(".readlou").css("border-color",t).next().next(".readlou").css("border-color",t)}),S=(n.modifyMySmColor=function(){var e=$('.readidmsbottom > a[href="profile.php?action=show&uid='+s.default.uid+'"]');e.length||(e=$('.readidmleft > a[href="profile.php?action=show&uid='+s.default.uid+'"]')),e.length>0&&I(e,Config.customMySmColor)},n.modifySmColor=function(){Config.customSmColorConfigList.length&&$('.readidmsbottom > a[href^="profile.php?action=show&uid="], .readidmleft > a').each(function(){var e=$(this),t="";if(e.is(".readidmleft > a")){if(t=e.parent().next(".readidmright").text().toUpperCase(),!/(-?\d+|MAX)/i.test(t))return}else{var n=/(-?\d+|MAX)级神秘/i.exec(e.parent().contents().last().text());if(!n)return;t=n[1].toUpperCase()}var a=!0,i=!1,o=void 0;try{for(var r,l=Config.customSmColorConfigList[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var s=r.value,d=s.min,p=s.max,f=s.color;if(c.compareSmLevel(t,d)>=0&&c.compareSmLevel(t,p)<=0){I(e,f);break}}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}})},n.adjustThreadContentWidth=function(){$("head").append("\n<style>\n  .readtext > table > tbody > tr > td { padding-left: 192px; }\n  .readidms, .readidm { margin-left: -192px !important; }\n</style>\n")},n.adjustThreadContentFontSize=function(){Config.threadContentFontSize>0&&12!==Config.threadContentFontSize&&$("head").append("\n<style>\n  .readtext td { font-size: "+Config.threadContentFontSize+"px; line-height: 1.6em; }\n  .readtext td > div, .readtext td > .read_fds { font-size: 12px; }\n</style>\n")},n.addCopyBuyersListLink=function(){$('<a style="margin:0 2px 0 5px;" href="#">复制名单</a>').insertAfter('.readtext select[name="buyers"]').click(function(e){e.preventDefault();var t=[];if($(this).prev("select").children("option").each(function(e){var n=$(this).text();e&&n!=="-".repeat(11)&&t.push(n)}),!t.length)return void alert("暂时无人购买");var n="pdCopyBuyerListDialog";if(!($("#"+n).length>0)){var a='\n<div class="pd_cfg_main">\n  <textarea style="width: 200px; height: 300px; margin: 5px 0;" readonly></textarea>\n</div>',i=h.create(n,"购买人名单",a);h.show(n),i.find("textarea").val(t.join("\n")).select().focus()}})},n.showStatRepliersDialog=function(e){var t="pdReplierListDialog",n='\n<div class="pd_cfg_main">\n  <div id="pdReplierListFilter" style="margin-top: 5px;">\n    <label><input type="checkbox" checked> 显示楼层号</label>\n    <label><input type="checkbox"> 去除重复</label>\n    <label><input type="checkbox"> 去除楼主</label>\n  </div>\n  <div style="color: #f00;" id="pdReplierListStat"></div>\n  <textarea style="width: 250px; height: 300px; margin: 5px 0;" readonly></textarea>\n</div>',a=h.create(t,"回帖者名单",n),i=a.find("#pdReplierListFilter input");i.click(function(){var t=[].concat(o(e)),n=i.eq(0).prop("checked"),l=i.eq(1).prop("checked"),s=i.eq(2).prop("checked");l&&(t=t.map(function(e,t,n){return n.indexOf(e)===t?e:null})),s&&!function(){var e=$(".readtext:first").find(".readidmsbottom, .readidmleft").find("a").text();t=t.map(function(t){return t!==e?t:null})}();var d="",c=0,p=!0,f=!1,u=void 0;try{for(var h,m=t.entries()[Symbol.iterator]();!(p=(h=m.next()).done);p=!0){var g=r(h.value,2),v=g[0],_=g[1];_&&(d+=(n?v+"L：":"")+_+"\n",c++)}}catch(e){f=!0,u=e}finally{try{!p&&m.return&&m.return()}finally{if(f)throw u}}a.find("textarea").val(d),a.find("#pdReplierListStat").html("共有<b>"+c+"</b>条项目")}),a.find("#pdReplierListFilter input:first").triggerHandler("click"),h.show(t),a.find("input:first").focus()}),T=(n.addStatRepliersLink=function(){1===c.getCurrentThreadPage()&&$('<li><a href="#" title="统计回帖者名单">[统计回帖]</a></li>').prependTo(".readtext:first + .readlou > div > .pages").find("a").click(function(e){if(e.preventDefault(),!($("#pdReplierListDialog").length>0)){var t=c.getUrlParam("tid");if(t){var n=$.trim(prompt("统计到第几楼？（0表示统计所有楼层，可用m-n的方式来设定统计楼层的区间范围）",0));if(""!==n){if(!/^\d+(-\d+)?$/.test(n))return void alert("统计楼层格式不正确");var a=0,i=0,o=n.split("-");if(2===o.length?(a=parseInt(o[0]),i=parseInt(o[1])):i=parseInt(o[0]),i<a)return void alert("统计楼层格式不正确");var r=/(\d+)页/.exec($(".pages:eq(0) > li:last-child > a").text()),l=r?parseInt(r[1]):1;0===a&&(a=1),0===i&&(i=l*Config.perPageFloorNum-1);var s=Math.floor(a/Config.perPageFloorNum)+1,d=Math.floor(i/Config.perPageFloorNum)+1;if(d>l&&(d=l),d-s>_.default.statRepliersMaxPage)return void alert("需访问的总页数不可超过"+_.default.statRepliersMaxPage);f.wait('<strong>正在统计回帖名单中&hellip;</strong><i>剩余页数：<em class="pd_countdown">'+(d-s+1)+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');var p=!1;$(document).clearQueue("StatRepliers");var u=[];$.each(new Array(d),function(e){e+1<s||$(document).queue("StatRepliers",function(){$.ajax({type:"GET",url:"read.php?tid="+t+"&page="+(e+1)+"&t="+(new Date).getTime(),timeout:_.default.defAjaxTimeout,success:function(e){var t=e.match(/<span style=".+?">\d+楼<\/span> <span style=".+?">(.|\n|\r\n)+?<a href="profile\.php\?action=show&uid=\d+" target="_blank" style=".+?">.+?<\/a>/gi);for(var n in t){var o=/<span style=".+?">(\d+)楼<\/span>(?:.|\n|\r\n)+?<a href="profile\.php\?action=show&uid=\d+".+?>(.+?)<\/a>/i.exec(t[n]);if(o){var r=parseInt(o[1]);if(!(r<a)){if(r>i){p=!0;break}u[r]=o[2]}}}},error:function(){p=!0,alert("因连接超时，统计回帖名单操作中止")},complete:function(){var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1),p=p||t.closest(".pd_msg").data("stop"),p&&$(document).clearQueue("StatRepliers"),p||e===d-1?(f.destroy(),S(u)):setTimeout(function(){return $(document).dequeue("StatRepliers")},_.default.defAjaxInterval)}})})}),$(document).dequeue("StatRepliers")}}}})},n.getMultiQuoteData=function(){var e=[];return $(".pd_multi_quote_chk input:checked").each(function(){var t=$(this).closest(".readlou"),n=/(\d+)楼/.exec(t.find(".pd_goto_link").text()),a=n?parseInt(n[1]):0,i=t.prev("a").attr("name"),o=t.next(".readtext").find(".readidmsbottom > a, .readidmleft > a").text();o&&e.push({floor:a,pid:i,userName:o})}),e}),L=(n.addMultiQuoteButton=function(){var e=$('a[href^="post.php?action=reply"].b_tit2').attr("href");e&&($('<li class="pd_multi_quote_chk"><label title="多重引用"><input type="checkbox"> 引</label></li>').prependTo($(".readlou > div:first-child > ul").has('a[title="引用回复这个帖子"]')).find("input").click(function(){var e=parseInt(c.getUrlParam("tid")),t=localStorage[_.default.multiQuoteStorageName];if(t)try{t=JSON.parse(t),!t||"object"!==$.type(t)||$.isEmptyObject(t)?t=null:"undefined"!=typeof t.tid&&t.tid===e&&Array.isArray(t.quoteList)||(t=null)}catch(e){t=null}else t=null;var n=T();t||(localStorage.removeItem(_.default.multiQuoteStorageName),t={tid:e,quoteList:[]});var a=c.getCurrentThreadPage();n.length>0?t.quoteList[a]=n:delete t.quoteList[a],localStorage[_.default.multiQuoteStorageName]=JSON.stringify(t)}),$(".readlou:last").next("div").find("table > tbody > tr > td:last-child").css({"text-align":"right",width:"320px"}).append('<span class="b_tit2" style="margin-left: 5px;"><a style="display: inline-block;" href="#" title="多重回复">回复</a> '+('<a style="display: inline-block;" href="'+e+'&multiquote=1" title="多重引用">引用</a></span>')).find(".b_tit2 > a:eq(0)").click(function(e){e.preventDefault(),w.handleMultiQuote(1)}))},n.modifyKFOtherDomainLink=function(){$(".readtext a, .thread2 a").each(function(){var e=$(this),t=e.attr("href");if(!/m\.miaola\.info\//i.test(t)){var n=/^(https?:\/\/(?:[\w\.]+?\.)?(?:2dgal|ddgal|9gal|9baka|9moe|kfgal|2dkf|miaola|kfer)\.\w+?\/).+/i.exec(t);n&&e.attr("href",t.replace(n[1],c.getHostNameUrl()))}})},n.handleBuyThreadBtn=function(){$('.readtext input[type="button"][value="愿意购买,支付KFB"]').each(function(){var e=$(this),t=/此帖售价\s*(\d+)\s*KFB/i.exec(e.closest("legend").contents().eq(0).text());if(t){var n=parseInt(t[1]);t=/location\.href="(.+?)"/i.exec(e.attr("onclick")),t&&e.data("sell",n).data("url",t[1]).removeAttr("onclick").click(function(e){e.preventDefault();var t=$(this),n=t.data("sell"),a=t.data("url");n&&a&&(n>=_.default.minBuyThreadWarningSell&&!confirm("此贴售价"+n+"KFB，是否购买？")||(Config.buyThreadViaAjaxEnabled?!function(){var e=f.wait("正在购买帖子&hellip;");$.get(a,function(t){k.showFormatLog("购买帖子",t);var n=c.getResponseMsg(t),a=n.msg;f.remove(e),/操作完成/.test(a)?location.reload():/您已经购买此帖/.test(a)?(alert("你已经购买过此帖"),location.reload()):alert("帖子购买失败")})}():location.href=a))})}})},n.addBatchBuyThreadButton=function(){var e=$('.readtext input[type="button"][value="愿意购买,支付KFB"]');0!==e.length&&(e.each(function(){var e=$(this),t=e.data("sell"),n=e.data("url");t&&n&&e.after('<input class="pd_buy_thread" style="margin-left: 10px; vertical-align: middle;" type="checkbox" data-sell="'+t+'" data-url="'+n+'">')}),$('<span style="margin: 0 5px;">|</span><a class="pd_buy_thread_btn" title="批量购买所选帖子" href="#">批量购买</a>').insertAfter('td > a[href^="kf_tidfavor.php?action=favor&tid="]').filter("a").click(function(e){e.preventDefault(),f.destroy();var t=[],n=0;return $(".pd_buy_thread:checked").each(function(){var e=$(this),a=e.data("url"),i=parseInt(e.data("sell"));a&&!isNaN(i)&&(t.push({url:a,sell:i}),n+=i)}),t.length?void(confirm("你共选择了"+t.length+"个帖子，总售价"+n.toLocaleString()+"KFB，"+("均价"+c.getFixedNumLocStr(n/t.length,2)+"KFB，是否批量购买？"))&&(f.wait('<strong>正在购买帖子中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),L(t))):void alert("请选择要购买的帖子")}).parent().mouseenter(function(){$('<span style="margin-left: 5px;">[<a class="pd_btn_link" href="#">全选</a><a class="pd_btn_link" href="#">反选</a>]</span>').insertAfter($(this).find(".pd_buy_thread_btn")).find("a:first").click(function(e){e.preventDefault();var t=$(".pd_buy_thread");t.prop("checked",!0),alert("共选择了"+t.length+"项")}).next("a").click(function(e){e.preventDefault();var t=0;$(".pd_buy_thread").each(function(){var e=$(this);e.prop("checked",!e.prop("checked")),e.prop("checked")&&t++}),alert("共选择了"+t+"项")})}).mouseleave(function(){$(this).find(".pd_buy_thread_btn").next("span").remove()}))},n.buyThreads=function(e){var t=0,n=0,a=0;$(document).clearQueue("BuyThreads"),$.each(e,function(i,o){var r=o.url,l=o.sell;$(document).queue("BuyThreads",function(){$.ajax({type:"GET",url:r+"&t="+(new Date).getTime(),timeout:_.default.defAjaxTimeout,success:function(e){k.showFormatLog("购买帖子",e);var i=c.getResponseMsg(e),o=i.msg;/操作完成/.test(o)?(t++,a+=l):n++},error:function(){n++},complete:function(){var o=$(".pd_countdown:last");o.text(parseInt(o.text())-1);var r=o.closest(".pd_msg").data("stop");r&&$(document).clearQueue("BuyThreads"),r||i===e.length-1?(f.destroy(),t>0&&y.push("购买帖子","共有`"+t+"`个帖子购买成功",{pay:{KFB:-a}}),console.log("共有"+t+"个帖子购买成功，共有"+n+"个帖子购买失败，KFB-"+a),f.show("<strong>共有<em>"+t+"</em>个帖子购买成功"+(n>0?"，共有<em>"+n+"</em>个帖子购买失败":"")+"</strong>"+("<i>KFB<ins>-"+a+"</ins></i>"),-1),g.run("Read.buyThreads_after_",e)):setTimeout(function(){return $(document).dequeue("BuyThreads")},_.default.defAjaxInterval)}})})}),$(document).dequeue("BuyThreads")});n.addUserMemo=function(){$.isEmptyObject(Config.userMemoList)||$('.readidmsbottom > a[href^="profile.php?action=show&uid="], .readidmleft > a').each(function(){var e=$(this),t=e.text().trim(),n="",a=!0,i=!1,o=void 0;try{for(var r,l=Object.keys(Config.userMemoList)[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var s=r.value;if(s===t){n=Config.userMemoList[s];break}}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}if(n)if(e.is(".readidmleft > a"))e.after('<span class="pd_user_memo_tips" title="备注：'+n+'">[?]</span>');else{var d=n,c=24;n.length>c&&(d=d.substring(0,c)+"&hellip;"),e.after('<br><span class="pd_user_memo" title="备注：'+n+'">('+d+")</span>")}})},n.addCopyCodeLink=function(){$('.readtext fieldset > legend:contains("Copy code")').html('<a class="pd_copy_code" href="#">复制代码</a>').parent("fieldset").addClass("pd_code_area"),$(".pd_copy_code").length&&$("#alldiv").on("click","a.pd_copy_code",function(e){e.preventDefault();var t=$(this),n=t.closest("fieldset");if(!c.copyText(n,"代码已复制",t.parent())){var a=n.data("content");if(a)n.html('<legend><a class="pd_copy_code" href="#">复制代码</a></legend>'+a).removeData("content");else{var i=n.html();i=i.replace(/<legend>.+?<\/legend>/i,""),n.data("content",i),i=c.htmlDecode(i);var o=n.height();o-=17,o<50&&(o=50),o>540&&(o=540),n.html('\n<legend><a class="pd_copy_code" href="#">还原代码</a></legend>\n<textarea wrap="off" class="pd_textarea" style="width: 100%; height: '+o+'px; line-height: 1.4em; white-space: pre;">'+i+"</textarea>\n"),n.find("textarea").select().focus()}}})},n.addMoreSmileLink=function(){var e=function(e){var t=$('textarea[name="atc_content"]').get(0);if(t){var n="[s:"+e+"]";c.addCode(t,n),s.default.isMobile?t.blur():t.focus()}},t=$('input[name="diy_guanjianci"]').parent();t.on("click",'a[href="javascript:;"]',function(t){t.preventDefault();var n=$(this).data("id");n&&e(n)}).find('a[onclick^="javascript:addsmile"]').each(function(){var e=$(this),t=/addsmile\((\d+)\)/i.exec(e.attr("onclick"));t&&e.data("id",t[1]).removeAttr("onclick").attr("href","javascript:;")}),$('<a class="pd_highlight" href="#">[更多]</a>').appendTo(t).click(function(n){n.preventDefault();var a=$(this),i=$("#pdSmilePanel");if(i.length>0)return a.text("[更多]"),void i.remove();a.text("[关闭]");for(var o=["48","35","34","33","32","31","30","29","28","27","26","36","37","47","46","45","44","43","42","41","40","39","38","25","24","11","10","09","08","01","02","03","04","05","06","12","13","23","22","21","20","19","18","17","16","15","14","07"],r=[57,44,43,42,41,40,39,38,37,36,35,45,46,56,55,54,53,52,51,50,49,48,47,34,33,20,19,18,17,10,11,12,13,14,15,21,22,32,31,30,29,28,27,26,25,24,23,16],l="",d=0;d<o.length;d++)l+='<img src="'+s.default.w.imgpath+"/post/smile/em/em"+o[d]+'.gif" alt="[表情]" data-id="'+r[d]+'">';l='<div class="pd_panel" id="pdSmilePanel" style="width: 308px; height: 185px;">'+l+"</div>";var c=t.offset();i=$(l).appendTo("body"),i.css("top",c.top+t.height()+4).css("left",c.left+t.width()-i.width()+9).on("click","img",function(){var t=$(this).data("id");t&&e(t)}),g.run("Read.addMoreSmileLink_after_click_")})},n.parseMediaTag=function(){$(".readtext > table > tbody > tr > td").each(function(){var e=$(this),t=e.html();/\[(audio|video)\](http|ftp)[^<>]+\[\/(audio|video)\]/.test(t)&&e.html(t.replace(/\[audio\]((?:http|ftp)[^<>]+?)\[\/audio\](?!<\/fieldset>)/g,'<audio src="$1" controls preload="none" style="margin: 3px 0;">[你的浏览器不支持audio标签]</audio>').replace(/\[video\]((?:http|ftp)[^<>]+?)\[\/video\](?!<\/fieldset>)/g,'<video src="$1" controls preload="none" style="max-width: '+(Config.adjustThreadContentWidthEnabled?627:820)+'px; margin:3px 0;">[你的浏览器不支持video标签]</video>'))})},n.showAttachImageOutsideSellBox=function(){$(".readtext > table > tbody > tr > td").each(function(){var e=$(this),t=e.html();if(/\[attachment=\d+\]/.test(t)){var n=e.closest(".readtext").prev(".readlou").prev("a").attr("name"),a=c.getUrlParam("tid");e.html(t.replace(/\[attachment=(\d+)\]/g,'<img src="job.php?action=download&pid='+n+"&tid="+a+'&aid=$1" alt="[附件图片]" style="max-width:550px" '+("onclick=\"if(this.width>=550) window.open('job.php?action=download&pid="+n+"&tid="+a+"&aid=$1');\">")))}})},n.addSelfRatingLink=function(){var e=parseInt($('input[name="fid"]:first').val());if(e&&_.default.selfRatingFidList.includes(e)){var t=parseInt($('input[name="tid"]:first').val()),n=k.getSafeId();n&&t&&($('.readtext:first fieldset legend:contains("本帖最近评分记录")').length>0||$('a[href^="kf_tidfavor.php?action=favor"]').after('<span style="margin: 0 5px;">|</span><a href="kf_fw_1wkfb.php?do=1&safeid='+n+"&ptid="+t+'" title="仅限自助评分测试人员使用">自助评分</a>'))}},n.getThreadTitle=function(){return $('form[name="delatc"] > div:first > table > tbody > tr > td > span').text().trim()}},{"./Const":6,"./Dialog":7,"./Func":8,"./Info":10,"./Log":12,"./Msg":15,"./Post":17,"./Public":18,"./Util":22}],20:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleInstallScriptLink=exports.showDialog=exports.runCmd=exports.runCustomScript=void 0;var _Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Config=require("./Config"),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Func=require("./Func"),Func=_interopRequireWildcard(_Func),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Msg=require("./Msg"),Msg=_interopRequireWildcard(_Msg),_Log=require("./Log"),Log=_interopRequireWildcard(_Log),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_Public=require("./Public"),Public=_interopRequireWildcard(_Public),_Index=require("./Index"),Index=_interopRequireWildcard(_Index),_Read=require("./Read"),Read=_interopRequireWildcard(_Read),_Post=require("./Post"),Post=_interopRequireWildcard(_Post),_Other=require("./Other"),Other=_interopRequireWildcard(_Other),_Bank=require("./Bank"),Bank=_interopRequireWildcard(_Bank),_Card=require("./Card"),Card=_interopRequireWildcard(_Card),_Item=require("./Item"),Item=_interopRequireWildcard(_Item),_Loot=require("./Loot"),Loot=_interopRequireWildcard(_Loot),_ConfigDialog=require("./ConfigDialog"),ConfigDialog=_interopRequireWildcard(_ConfigDialog),defScriptName="未命名脚本",metaRegex=/\/\/\s*==UserScript==((?:.|\n)+?)\/\/\s*==\/UserScript==/i,runCustomScript=exports.runCustomScript=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"end",t=!0,n=!1,a=void 0;try{for(var i,o=Config.customScriptList[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var r=i.value,l=r.enabled,s=r.trigger,d=r.content;l&&s===e&&d&&runCmd(d)}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}},runCmd=exports.runCmd=function runCmd(cmd){var isOutput=arguments.length>1&&void 0!==arguments[1]&&arguments[1],result=!0,response="";try{response=eval(cmd),isOutput&&console.log(response)}catch(e){result=!1,response=e,console.log(e)}return{result:result,response:String(response)}},getScriptMeta=function(e){var t={name:defScriptName,version:"",trigger:"end",homepage:"",author:""},n=metaRegex.exec(e);if(!n)return t;var a=n[1];return n=/@name[ \t]+(.*)/i.exec(a),n&&(t.name=n[1]),n=/@version[ \t]+(.*)/i.exec(a),n&&(t.version=n[1]),n=/@trigger[ \t]+(.*)/i.exec(a),n&&(t.trigger="start"===n[1].toLowerCase()?"start":"end"),n=/@homepage[ \t]+(.*)/i.exec(a),n&&(t.homepage=n[1]),n=/@author[ \t]+(.*)/i.exec(a),n&&(t.author=n[1]),t},showDialog=exports.showDialog=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t="pdCustomScriptDialog";if(!($("#"+t).length>0)){(0,_Config.read)();var n='\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <a class="pd_highlight pd_btn_link" data-name="addNewScript" href="#">添加新脚本</a>\n    <a class="pd_btn_link" data-name="insertSample" href="#">插入范例</a>\n  </div>\n  <div data-name="customScriptList"></div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a class="pd_btn_link" href="read.php?tid=500968" target="_blank">自定义脚本收集贴</a>\n    <a class="pd_btn_link" data-name="openImOrExCustomScriptDialog" href="#">导入/导出自定义脚本</a>\n  </span>\n  <button name="ok">确定</button> <button name="cancel">取消</button> <button class="pd_highlight" name="clear">清空</button>\n</div>',a=Dialog.create(t,"自定义脚本",n,"min-width: 776px;"),i=a.find('[data-name="customScriptList"]');a.find('[name="ok"]').click(function(e){e.preventDefault(),Config.customScriptList=[],i.find(".pd_custom_script_content").each(function(){var e=$(this),t=e.val();if($.trim(t)){var n=e.prev().find('[type="checkbox"]').prop("checked");Config.customScriptList.push($.extend(getScriptMeta(t),{enabled:n,content:t}))}}),(0,_Config.write)(),Dialog.close(t)}).end().find('[name="clear"]').click(function(e){e.preventDefault(),confirm("是否清空所有脚本？")&&(i.html(""),Dialog.show(t))}).end().find('[name="cancel"]').click(function(){return Dialog.close(t)});var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.enabled,n=void 0===t||t,a=e.name,o=void 0===a?defScriptName:a,r=e.version,l=void 0===r?"":r,s=e.homepage,d=void 0===s?"":s,c=e.trigger,p=void 0===c?"end":c,f=e.content,u=void 0===f?"":f;
i.append('\n<div class="pd_custom_script_header">\n  <input type="checkbox" '+(n?"checked":"")+' title="是否启用此脚本">\n  <a class="pd_custom_script_name" href="#" style="margin-left: 5px;">['+o+']</a>\n  <span data-name="version" style="margin-left: 5px; color: #666;" '+(l?"":"hidden")+">"+l+'</span>\n  <span data-name="trigger" style="margin-left: 5px; color: '+("start"===p?"#f00":"#00f")+';" title="脚本执行时机">\n    ['+("start"===p?"开始时":"结束时")+']\n  </span>\n  <a data-name="homepage" href="'+d+'" target="_blank" style="margin-left: 5px;" '+(d?"":"hidden")+'>[主页]</a>\n  <a data-name="delete" href="#" style="margin-left: 5px; color: #666;">[删除]</a>\n</div>\n<textarea class="pd_custom_script_content" wrap="off">'+u+"</textarea>\n")},r=!0,l=!1,s=void 0;try{for(var d,c=Config.customScriptList[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){var p=d.value;o(p)}}catch(e){l=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw s}}a.find('[data-name="addNewScript"]').click(function(e){e.preventDefault(),i.find(".pd_custom_script_content").hide(),o(),i.find(".pd_custom_script_content:last").show().focus(),Dialog.show(t)}).end().find('[data-name="insertSample"]').click(function(e){e.preventDefault();var t=i.find(".pd_custom_script_content:visible");t.val(("\n// ==UserScript==\n// @name        "+defScriptName+"\n// @version     1.0\n// @author      "+_Info2.default.userName+"\n// @trigger     end\n// @homepage    read.php?tid=500968&spid=12318348\n// @description 这是一个未命名脚本\n// ==/UserScript==\n").trim()+"\n"+t.val()).focus()}).end().find('[data-name="openImOrExCustomScriptDialog"]').click(function(e){e.preventDefault(),ConfigDialog.showCommonImportOrExportConfigDialog("customScript")}),i.on("click",".pd_custom_script_name",function(e){e.preventDefault(),a.find(".pd_custom_script_content").hide(),$(this).parent().next().show().focus(),Dialog.show(t)}).on("click",'[data-name="delete"]',function(e){if(e.preventDefault(),confirm("是否删除此脚本？")){var n=$(this).closest(".pd_custom_script_header");n.next().remove(),n.remove(),Dialog.show(t)}}).on("change",".pd_custom_script_content",function(){var e=$(this),t=getScriptMeta(e.val()),n=t.name,a=t.version,i=t.homepage,o=t.trigger,r=e.prev();r.find(".pd_custom_script_name").text("["+(n?n:defScriptName)+"]"),r.find('[data-name="version"]').text(a).prop("hidden",!a),r.find('[data-name="homepage"]').attr("href",i?i:"").prop("hidden",!i),r.find('[data-name="trigger"]').html("["+("start"===o?"开始时":"结束时")+"]").css("color","start"===o?"#f00":"#00f")}),Dialog.show(t),"number"==typeof e?i.find(".pd_custom_script_name").eq(e).click():a.find("a:first").focus()}},handleInstallScriptLink=exports.handleInstallScriptLink=function(){$(document).on("click",'a[href$="#install-script"]',function(e){e.preventDefault();var t=$(this),n=t.nextAll(".pd_code_area").eq(0);if(n.length){var a=Util.htmlDecode(n.html().replace(/<legend>.+?<\/legend>/i,"")).trim();if(metaRegex.test(a)){(0,_Config.read)();var i=getScriptMeta(a),o=Config.customScriptList.findIndex(function(e){return e.name===i.name&&e.author===i.author}),r=o>-1?1:0;if(confirm("是否"+(1===r?"更新":"安装")+"此脚本？")){var l=$.extend(i,{enabled:!0,content:a});1===r?Config.customScriptList[o]=l:Config.customScriptList.push(l),(0,_Config.write)(),Dialog.close("pdCustomScriptDialog"),showDialog(o)}}}})}},{"./Bank":2,"./Card":3,"./Config":4,"./ConfigDialog":5,"./Const":6,"./Dialog":7,"./Func":8,"./Index":9,"./Info":10,"./Item":11,"./Log":12,"./Loot":14,"./Msg":15,"./Other":16,"./Post":17,"./Public":18,"./Read":19,"./TmpLog":21,"./Util":22}],21:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.deleteValue=n.setValue=n.getValue=n.clear=n.write=n.read=void 0;var i=e("./Info"),o=a(i),r=e("./Const"),l=a(r),s=l.default.storagePrefix+"tmp_log",d=n.read=function(){var e={},t=null;if(t="ByUid"===o.default.storageType||"Global"===o.default.storageType?GM_getValue(s+"_"+o.default.uid):localStorage.getItem(s+"_"+o.default.uid),!t)return e;try{t=JSON.parse(t)}catch(t){return e}if(!t||"object"!==$.type(t))return e;var n=[];for(var a in l.default)a.endsWith("TmpLogName")&&n.push(l.default[a]);var i=!0,r=!1,d=void 0;try{for(var c,p=Object.keys(t)[Symbol.iterator]();!(i=(c=p.next()).done);i=!0){var f=c.value;n.includes(f)||delete t[f]}}catch(e){r=!0,d=e}finally{try{!i&&p.return&&p.return()}finally{if(r)throw d}}return e=t},c=n.write=function(e){"ByUid"===o.default.storageType||"Global"===o.default.storageType?GM_setValue(s+"_"+o.default.uid,JSON.stringify(e)):localStorage.setItem(s+"_"+o.default.uid,JSON.stringify(e))};n.clear=function(){"ByUid"===o.default.storageType||"Global"===o.default.storageType?GM_deleteValue(s+"_"+o.default.uid):localStorage.removeItem(s+"_"+o.default.uid)},n.getValue=function(e){var t=d();return e in t?t[e]:null},n.setValue=function(e,t){var n=d();n[e]=t,c(n)},n.deleteValue=function(e){var t=d();e in t&&(delete t[e],c(t))}},{"./Const":6,"./Info":10}],22:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.selectInverse=n.selectAll=n.inFollowOrBlockUserList=n.entries=n.getResponseMsg=n.copyText=n.getSelText=n.addCode=n.getStrByteLen=n.removeUnpairedBBCodeContent=n.getFixedNumLocStr=n.getCurrentThreadPage=n.compareSmLevel=n.isEdge=n.isOpera=n.getStatFormatNumber=n.getSortedObjectKeyList=n.getObjectKeyList=n.htmlDecode=n.htmlEncode=n.getGBKEncodeString=n.getUrlParam=n.deepEqual=n.getDifferenceSetOfObject=n.getHostNameUrl=n.isBetweenInTimeRange=n.getTimeDiffInfo=n.getTimeString=n.getDateString=n.getDate=n.getMidnightHourDate=n.getTimezoneDateByTime=n.getDateByTime=n.deleteCookie=n.getCookie=n.setCookie=void 0;var i=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("./Info"),r=a(o),l=e("./Const"),s=a(l),d=(n.setCookie=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.default.uid+"_"+s.default.storagePrefix;document.cookie=""+a+e+"="+encodeURI(t)+(n?";expires="+n.toUTCString():"")+";path=/;"},n.getCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.uid+"_"+s.default.storagePrefix,n=new RegExp("(^| )"+t+e+"=([^;]*)(;|$)"),a=document.cookie.match(n);return a?decodeURI(a[2]):null},n.deleteCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.uid+"_"+s.default.storagePrefix;document.cookie=""+t+e+"=;expires="+c("-1d").toUTCString()+";path=/;"},n.getDateByTime=function(e){var t=new Date,n=e.split(":"),a=i(n,3),o=a[0],r=a[1],l=a[2];return"undefined"!=typeof o&&t.setHours(parseInt(o)),"undefined"!=typeof r&&t.setMinutes(parseInt(r)),"undefined"!=typeof l&&t.setSeconds(parseInt(l)),t.setMilliseconds(0),t}),c=(n.getTimezoneDateByTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.forumTimezoneOffset,n=new Date,a=e.split(":"),o=i(a,3),r=o[0],l=o[1],d=o[2];"undefined"!=typeof r&&n.setUTCHours(parseInt(r)+t),"undefined"!=typeof l&&n.setUTCMinutes(parseInt(l)),"undefined"!=typeof d&&n.setUTCSeconds(parseInt(d)),n.setUTCMilliseconds(0);var c=new Date;return(c.getDate()>n.getDate()||c.getMonth()>n.getMonth()||c.getFullYear()>n.getFullYear())&&n.setDate(n.getDate()+1),n},n.getMidnightHourDate=function(e){var t=d("00:00:00");return t.setDate(t.getDate()+e),t},n.getDate=function(e){var t=new Date,n=/^(-|\+)?(\d+)([a-zA-Z]{1,2})$/.exec(e);if(!n)return null;var a="undefined"==typeof n[1]?0:"+"===n[1]?1:-1,i=a===-1?-parseInt(n[2]):parseInt(n[2]),o=n[3];switch(o){case"Y":t.setFullYear(i);break;case"y":t.setFullYear(0===a?i:t.getFullYear()+i);break;case"M":t.setMonth(0===a?i:t.getMonth()+i);break;case"d":t.setDate(0===a?i:t.getDate()+i);break;case"h":t.setHours(0===a?i:t.getHours()+i);break;case"m":t.setMinutes(0===a?i:t.getMinutes()+i);break;case"s":t.setSeconds(0===a?i:t.getSeconds()+i);break;case"ms":t.setMilliseconds(0===a?i:t.getMilliseconds()+i);break;default:return null}return t}),p=(n.getDateString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";e=e?e:new Date;var n=(e.getMonth()+1).toString(),a=e.getDate().toString();return e.getFullYear()+t+n.padStart(2,"0")+t+a.padStart(2,"0")},n.getTimeString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.getHours().toString(),i=e.getMinutes().toString(),o=e.getSeconds().toString();return a.padStart(2,"0")+t+i.padStart(2,"0")+(n?t:"")+(n?o.padStart(2,"0"):"")},n.getTimeDiffInfo=function(e){var t=e-(new Date).getTime();if(t>0){t=Math.floor(t/1e3);var n=Math.floor(t/60/60);if(n>=0){var a=Math.floor((t-60*n*60)/60);a<0&&(a=0);var i=Math.floor(t-60*n*60-60*a);return i<0&&(i=0),{hours:n,minutes:a,seconds:i}}}return{hours:0,minutes:0,seconds:0}},n.isBetweenInTimeRange=function(e,t){var n=t.split("-"),a=i(n,2),o=a[0],r=a[1];if("undefined"==typeof r)return null;var l=d(o),s=d(r);return s<l&&(e>s?s.setDate(s.getDate()+1):l.setDate(l.getDate()-1)),e>=l&&e<=s},n.getHostNameUrl=function(){return location.protocol+"//"+location.host+"/"},n.getDifferenceSetOfObject=function(e,t){var n={};return"object"!==$.type(e)||"object"!==$.type(t)?n:($.each(t,function(t,a){t in e&&(p(e[t],a)||(n[t]=a))}),n)},n.deepEqual=function e(t,n){if(t===n)return!0;if($.type(t)!==$.type(n))return!1;if("number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n))return!0;if($.isArray(t)&&$.isArray(n)||"object"===$.type(t)&&"object"===$.type(n)){if(t.length!==n.length)return!1;for(var a in $.extend($.isArray(t)?[]:{},t,n)){if("undefined"==typeof t[a]||"undefined"==typeof n[a])return!1;if(!e(t[a],n[a]))return!1}return!0}return!1}),f=(n.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=location.search.substring(1).match(t);return n?decodeURI(n[2]):null},n.getGBKEncodeString=function(e){var t=$("<img>").appendTo("body").get(0);t.src="nothing?sp="+e;var n=t.src.split("nothing?sp=").pop();return $(t).remove(),n},n.htmlEncode=function(e){return e.length?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"<br>"):""},n.htmlDecode=function(e){return e.length?e.replace(/<br\s*\/?>/gi,"\n").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&nbsp;/gi," ").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&"):""},n.getObjectKeyList=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];if("object"!==$.type(e))return n;for(var a in e)n.push(a);return 0!==t&&n.sort(function(e,n){return t>0?e>n:e<n}),n});n.getSortedObjectKeyList=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=f(t,n);return a.sort(function(t,n){return e.indexOf(t)>e.indexOf(n)}),a},n.getStatFormatNumber=function(e){return e>=0?"<em>+"+e.toLocaleString()+"</em>":"<ins>"+e.toLocaleString()+"</ins>"},n.isOpera=function(){return"undefined"!=typeof window.opera},n.isEdge=function(){return navigator.appVersion&&navigator.appVersion.indexOf("Edge")>0},n.compareSmLevel=function(e,t){var n="MAX"===e.toUpperCase()?Number.MAX_VALUE:parseInt(e),a="MAX"===t.toUpperCase()?Number.MAX_VALUE:parseInt(t);return n>a?1:n<a?-1:0},n.getCurrentThreadPage=function(){var e=/- (\d+) -/.exec($('.pages:first > li > a[href="javascript:;"]').text());return e?parseInt(e[1]):1},n.getFixedNumLocStr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.toFixed(t).split("."),a=i(n,2),o=a[0],r=a[1],l=parseInt(o).toLocaleString(),s="";return"undefined"!=typeof r&&(s="."+r),l+s},n.removeUnpairedBBCodeContent=function(e){for(var t=[/\[color=.+?\]/g,/\[backcolor=.+?\]/g,/\[size=.+?\]/g,/\[font=.+?\]/g,/\[align=.+?\]/g,/\[b\]/g,/\[i\]/g,/\[u\]/g,/\[strike\]/g,/\[sup\]/g,/\[sub\]/g],n=[/\[\/color\]/g,/\[\/backcolor\]/g,/\[\/size\]/g,/\[\/font\]/g,/\[\/align\]/g,/\[\/b\]/g,/\[\/i\]/g,/\[\/u\]/g,/\[\/strike\]/g,/\[\/sup\]/g,/\[\/sub\]/g],a=0;a<t.length;a++){var i=e.match(t[a]),o=e.match(n[a]),r=i?i.length:0,l=o?o.length:0;r!==l&&(e=e.replace(t[a],"").replace(n[a],""))}return e},n.getStrByteLen=function(e){for(var t=0,n=2,a=0;a<e.length;a++)t+=e.charCodeAt(a)<0||e.charCodeAt(a)>255?n:1;return t},n.addCode=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=n?t.indexOf(n):t.indexOf("]")+1;if("undefined"!=typeof e.selectionStart){var i=e.selectionStart;e.value=e.value.substring(0,i)+t+e.value.substring(e.selectionEnd),e.selectionStart=i+a,e.selectionEnd=i+a+n.length}else e.value+=t},n.getSelText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},n.copyText=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!("execCommand"in document&&t.length))return!1;var e=t.data("copy-text");e&&(t=$('<span class="text-hide">'+e+"</span>").insertAfter(t)),a&&a.prop("hidden",!0);var i=window.getSelection();i.selectAllChildren(t.get(0));var o=document.execCommand("copy");return i.removeAllRanges(),e&&t.remove(),a&&a.removeProp("hidden"),o&&alert(n?n:"已复制"),o},n.getResponseMsg=function(e){var t=0,n="",a="",i=/<span style=".+?">(.+?)<\/span><br\s*\/?><a href="(.+?)">/i.exec(e);if(i)t=1,n=i[1],a=i[2];else{var o=/操作提示<br\s*\/?>\r\n(.+?)<br\s*\/?>\r\n<a href="javascript:history\.go\(-1\);">返回上一步操作<\/a>/i.exec(e);o&&(t=-1,n=o[1])}return{type:t,msg:n?n:"未能获得预期的回应",url:a}},n.entries=regeneratorRuntime.mark(function e(t){var n,a,i,o,r,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,a=!1,i=void 0,e.prev=3,o=Object.keys(t)[Symbol.iterator]();case 5:if(n=(r=o.next()).done){e.next=12;break}return l=r.value,e.next=9,[l,t[l]];case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),a=!0,i=e.t0;case 18:e.prev=18,e.prev=19,!n&&o.return&&o.return();case 21:if(e.prev=21,!a){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}),n.inFollowOrBlockUserList=function(e,t){return t.findIndex(function(t){return t.name&&t.name===e})},n.selectAll=function(e){return e.prop("checked",!0),!1},n.selectInverse=function(e){return e.each(function(){var e=$(this);e.prop("checked",!e.prop("checked"))}),!1}},{"./Const":6,"./Info":10}]},{},[1]);