!function e(t,n,a){function i(r,l){if(!n[r]){if(!t[r]){var d="function"==typeof require&&require;if(!l&&d)return d(r,!0);if(o)return o(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var p=n[r]={exports:{}};t[r][0].call(p.exports,function(e){var n=t[r][1][e];return i(n?n:e)},p,p.exports,e,t,n,a)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<a.length;r++)i(a[r]);return i}({1:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}var o=e("./module/Info"),r=i(o),l=e("./module/Util"),d=a(l),s=e("./module/Const"),p=i(s),c=e("./module/Config"),f=e("./module/Log"),u=e("./module/Public"),_=a(u),g=e("./module/Index"),h=a(g),m=e("./module/Read"),v=a(m),b=e("./module/Post"),y=a(b),k=e("./module/Other"),x=a(k),C=e("./module/Bank"),w=a(C),S=e("./module/Card"),T=a(S),L=e("./module/Item"),I=a(L),D=e("./module/Loot"),E=a(D),M="7.0";$(function(){if("undefined"!=typeof jQuery){var e=new Date;if(r.default.version=M,_.getUidAndUserName()){_.addPolyfill(),(0,c.init)(),(0,f.init)(),_.checkBrowserType(),_.appendCss(),_.addConfigAndLogDialogLink(),Config.animationEffectOffEnabled&&($.fx.off=!0),Config.customScriptEnabled&&_.runCustomScript(1),_.repairBbsErrorCode(),window.addEventListener("beforeunload",_.preventCloseWindowWhenActioning),Config.showSearchLinkEnabled&&_.addSearchDialogLink(),_.bindSearchTypeSelectMenuClick(),_.makeSearchByBelowTwoKeyWordAvailable(),Config.modifySideBarEnabled&&_.modifySideBar(),Config.addSideBarFastNavEnabled&&_.addFastNavForSideBar(),r.default.isInHomePage?(h.handleAtTips(),h.addSearchTypeSelectBoxInHomePage(),Config.smLevelUpAlertEnabled&&h.smLevelUpAlert(),Config.smRankChangeAlertEnabled&&h.smRankChangeAlert(),Config.showVipSurplusTimeEnabled&&h.showVipSurplusTime(),Config.homePageThreadFastGotoLinkEnabled&&h.addHomePageThreadFastGotoLink(),Config.fixedDepositDueAlertEnabled&&!d.getCookie(p.default.fixedDepositDueAlertCookieName)&&w.fixedDepositDueAlert()):"/read.php"===location.pathname?(Config.turnPageViaKeyboardEnabled&&_.turnPageViaKeyboard(),v.fastGotoFloor(),Config.adjustThreadContentWidthEnabled&&_.adjustThreadContentWidth(),v.adjustThreadContentFontSize(),v.showAttachImageOutsideSellBox(),Config.parseMediaTagEnabled&&v.parseMediaTag(),Config.modifyKFOtherDomainEnabled&&v.modifyKFOtherDomainLink(),Config.customSmColorEnabled&&v.modifySmColor(),Config.customMySmColor&&v.modifyMySmColor(),Config.multiQuoteEnabled&&v.addMultiQuoteButton(),v.addFastGotoFloorInput(),v.addFloorGotoLink(),v.addCopyBuyersListLink(),v.addStatRepliersLink(),v.handleBuyThreadBtn(),Config.batchBuyThreadEnabled&&v.addBatchBuyThreadButton(),Config.showSelfRatingLinkEnabled&&v.addSelfRatingLink(),Config.userMemoEnabled&&v.addUserMemo(),v.addCopyCodeLink(),v.addMoreSmileLink()):"/thread.php"===location.pathname?(Config.highlightNewPostEnabled&&x.highlightNewPost(),Config.showFastGotoThreadPageEnabled&&x.addFastGotoThreadPageLink()):/\/kf_fw_ig_my\.php$/i.test(location.href)?(I.enhanceMyItemsPage(),I.addBatchUseAndConvertItemTypesButton()):/\/kf_fw_ig_renew\.php$/i.test(location.href)?I.addBatchConvertEnergyAndRestoreItemsLink():/\/kf_fw_ig_renew\.php\?lv=\d+$/i.test(location.href)?I.addConvertEnergyAndRestoreItemsButton():/\/kf_fw_ig_my\.php\?lv=\d+$/i.test(location.href)?I.addSellAndUseItemsButton():/\/kf_fw_ig_my\.php\?pro=\d+/i.test(location.href)?(I.modifyItemDescription(),/\/kf_fw_ig_my\.php\?pro=\d+&display=1$/i.test(location.href)&&I.addSampleItemTips()):"/kf_fw_ig_shop.php"===location.pathname?I.addBatchBuyItemsLink():"/kf_fw_ig_index.php"===location.pathname?E.enhanceLootIndexPage():"/kf_fw_ig_pklist.php"===location.pathname?E.addUserLinkInPkListPage():/\/hack\.php\?H_name=bank$/i.test(location.href)?(w.addBatchTransferButton(),w.handleInBankPage()):/\/kf_fw_card_my\.php$/i.test(location.href)?T.addStartBatchModeButton():/\/post\.php\?action=reply&fid=\d+&tid=\d+&multiquote=1/i.test(location.href)?Config.multiQuoteEnabled&&y.handleMultiQuote(2):/\/post\.php\?action=quote/i.test(location.href)?y.removeUnpairedBBCodeInQuoteContent():/\/message\.php\?action=read&mid=\d+/i.test(location.href)?(x.addFastDrawMoneyLink(),Config.modifyKFOtherDomainEnabled&&v.modifyKFOtherDomainLink()):/\/message\.php($|\?action=receivebox)/i.test(location.href)?x.addMsgSelectButton():/\/profile\.php\?action=show/i.test(location.href)?x.addFollowAndBlockAndMemoUserLink():/\/personal\.php\?action=post/i.test(location.href)?10===Config.perPageFloorNum&&x.modifyMyPostLink():"/kf_growup.php"===location.pathname?x.addAutoChangeIdColorButton():"/guanjianci.php"===location.pathname?x.highlightUnReadAtTipsMsg():/\/profile\.php\?action=modify$/i.test(location.href)?x.syncModifyPerPageFloorNum():/\/job\.php\?action=preview$/i.test(location.href)?y.modifyPostPreviewPage():"/search.php"===location.pathname?Config.turnPageViaKeyboardEnabled&&_.turnPageViaKeyboard():/\/kf_fw_1wkfb\.php\?ping=(2|4)/i.test(location.href)?x.highlightRatingErrorSize():/\/kf_fw_1wkfb\.php\?do=1/i.test(location.href)?x.showSelfRatingErrorSizeSubmitWarning():"/kf_no1.php"===location.pathname?x.addUserNameLinkInRankPage():"/faq.php"===location.pathname&&x.modifyFaq(),"/post.php"===location.pathname&&(y.addExtraPostEditorButton(),y.addExtraOptionInPostPage()),Config.blockUserEnabled&&_.blockUsers(),Config.blockThreadEnabled&&_.blockThread(),Config.followUserEnabled&&_.followUsers(),r.default.isMobile&&_.bindElementTitleClick();var t=Config.autoSaveCurrentDepositEnabled&&r.default.isInHomePage,n=!1;Config.autoDonationEnabled&&!d.getCookie(p.default.donationCookieName)&&(n=!0,_.donation(t)),t&&!n&&_.autoSaveCurrentDeposit(),Config.autoChangeSMColorEnabled&&!d.getCookie(p.default.autoChangeSMColorCookieName)&&_.changeIdColor(),Config.autoRefreshEnabled&&r.default.isInHomePage&&_.startAutoRefreshMode(),Config.customScriptEnabled&&_.runCustomScript(2);var a=new Date;console.log("【KF Online助手】加载完毕，加载耗时："+(a-e)+"ms")}}})},{"./module/Bank":2,"./module/Card":3,"./module/Config":4,"./module/Const":6,"./module/Index":9,"./module/Info":10,"./module/Item":11,"./module/Log":12,"./module/Loot":14,"./module/Other":16,"./module/Post":17,"./module/Public":18,"./module/Read":19,"./module/Util":21}],2:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.fixedDepositDueAlert=n.handleInBankPage=n.addBatchTransferButton=n.drawCurrentDeposit=void 0;var o=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e("./Info"),l=(i(r),e("./Util")),d=a(l),s=e("./Msg"),p=a(s),c=e("./Const"),f=i(c),u=e("./Log"),_=e("./TmpLog"),g=a(_),h=e("./Public"),m=a(h),v=20,b=function(e,t,n){var a=p.wait("正在存款中&hellip;");$.post("hack.php?H_name=bank",{action:"save",btype:1,savemoney:e},function(i){if(/完成存款/.test(i)){m.showFormatLog("存款",i),p.remove(a),console.log("共有"+e+"KFB存入活期存款");var o=$('.bank1 > tbody > tr:nth-child(2) > td:contains("当前所持：")');o.html(o.html().replace(/当前所持：-?\d+KFB/,"当前所持："+(t-e)+"KFB").replace(/活期存款：-?\d+KFB/,"活期存款："+(n+e)+"KFB")),setTimeout(function(){$(document).dequeue("Bank")},5e3)}else $(document).clearQueue("Bank"),alert("存款失败")})},y=(n.drawCurrentDeposit=function(e){var t=p.wait("正在取款中&hellip;");$.post("hack.php?H_name=bank",{action:"draw",btype:1,drawmoney:e},function(n){p.remove(t),/完成取款/.test(n)?(m.showFormatLog("取款",n),console.log("从活期存款中取出了"+e+"KFB"),p.show("从活期存款中取出了<em>"+e+"</em>KFB",-1)):/取款金额大于您的存款金额/.test(n)?p.show("取款金额大于当前活期存款金额",-1):/\d+秒内不允许重新交易/.test(n)?p.show("提交速度过快",-1):p.show("取款失败",-1)})},function(e,t,n,a){var i=0,r=0,l=0;$.each(e,function(n,s){var c=o(s,2),_=c[0],g=c[1];$(document).queue("Bank",function(){$.ajax({type:"POST",url:"hack.php?H_name=bank",timeout:f.default.defAjaxTimeout,data:"&action=virement&pwuser="+d.getGBKEncodeString(_)+"&to_money="+g+"&memo="+d.getGBKEncodeString(t),success:function(e){m.showFormatLog("批量转账",e);var t="";if(/完成转帐!<\/span>/.test(e))i++,l+=g,t=_+" <em>+"+g+"</em>";else{r++;var n="";n=/用户<b>.+?<\/b>不存在<br \/>/.test(e)?"用户不存在":/您的存款不够支付转帐/.test(e)?"存款不足":/转账额度不足/.test(e)?"转账额度不足":/当前等级无法使用该功能/.test(e)?"当前等级无法使用转账功能":/转帐数目填写不正确/.test(e)?"转帐金额不正确":/自己无法给自己转帐/.test(e)?"无法给自己转帐":/\d+秒内不允许重新交易/.test(e)?"提交速度过快":"未能获得预期的回应",t=_+":"+g+' <span class="pd_notice">('+n+")</span>"}$(".pd_result:last").append("<li>"+t+"</li>")},error:function(){r++,$(".pd_result:last").append("<li>"+_+":"+g+' <span class="pd_notice">(连接超时，转账可能失败，请到<a target="_blank" href="hack.php?H_name=bank&action=log">银行日志</a>里进行确认)</span></li>')},complete:function(){var t=$("#pd_remaining_num");t.text(parseInt(t.text())-1);var o=t.closest(".pd_msg").data("stop");if(o&&$(document).clearQueue("Bank"),o||n===e.length-1){i>0&&(0,u.push)("批量转账","共有`"+i+"`名用户转账成功",{pay:{KFB:-l}}),p.destroy();var d=$('.bank1 > tbody > tr:nth-child(2) > td:contains("活期存款：")');d.html(d.html().replace(/活期存款：-?\d+KFB/,"活期存款："+(a-l)+"KFB")),console.log("共有"+i+"名用户转账成功，共有"+r+"名用户转账失败，KFB-"+l),$(".pd_result:last").append("<li><b>共有<em>"+i+"</em>名用户转账成功"+((r>0?"，共有<em>"+r+"</em>名用户转账失败":"")+"：</b>KFB <ins>-"+l+"</ins></li>")),p.show("<strong>共有<em>"+i+"</em>名用户转账成功"+((r>0?"，共有<em>"+r+"</em>名用户转账失败":"")+"</strong><i>KFB<ins>-"+l+"</ins></i>"),-1)}else setTimeout(function(){return $(document).dequeue("Bank")},5e3)}})})}),n||$(document).dequeue("Bank")}),k=function(){var e=$("#pd_bank_users"),t=e.val();if(!/^\s*\S+\s*$/m.test(t)||/^\s*:/m.test(t)||/:/.test(t)&&/:(\D|$)/m.test(t))return alert("用户列表格式不正确"),e.select(),e.focus(),!1;if(/^\s*\S+?:0*[0-1]?\d\s*$/m.test(t))return alert("转帐金额不能小于"+v+"KFB"),e.select(),e.focus(),!1;var n=$("#pd_bank_money"),a=parseInt($.trim(n.val()));if(/^\s*[^:]+\s*$/m.test(t)){if(!$.isNumeric(a))return alert("通用转账金额格式不正确"),n.select(),n.focus(),!1;if(a<v)return alert("转帐金额不能小于"+v+"KFB"),n.select(),n.focus(),!1}return!0};n.addBatchTransferButton=function(){var e='\n<tr id="pd_bank_transfer">\n  <td style="vertical-align: top;">使用说明：<br>每行一名用户，<br>如需单独设定金额，<br>可写为“用户名:金额”<br>（注意是<b>英文冒号</b>）<br>\n例子：<br><pre style="border: 1px solid #9999ff; padding: 5px;">张三\n李四:200\n王五:500\n信仰风</pre></td>\n  <td>\n  <form>\n    <div style="display: inline-block;">\n      <label>用户列表：<br>\n        <textarea class="pd_textarea" id="pd_bank_users" style="width: 270px; height: 250px;"></textarea>\n      </label>\n    </div>\n    <div style="display: inline-block; margin-left: 10px;">\n      <label>通用转帐金额（如所有用户都已设定单独金额则可留空）：<br>\n        <input class="pd_input" id="pd_bank_money" type="text" style="width: 217px;" maxlength="15">\n      </label><br>\n      <label style="margin-top: 5px;">转帐附言（可留空）：<br>\n        <textarea class="pd_textarea" id="pd_bank_msg" style="width: 225px; height: 206px;"></textarea>\n      </label>\n    </div>\n    <div>\n      <label><input class="pd_input" type="submit" value="批量转账"></label>\n      <label style="margin-left: 3px;"><input class="pd_input" type="reset" value="重置"></label>\n      <label style="margin-left: 3px;">\n        <input class="pd_input" type="button" value="随机金额" title="为用户列表上的每个用户设定指定范围内的随机金额">\n      </label>\n      （活期存款不足时，将自动进行存款；批量转账金额不会从定期存款中扣除）\n    </div>\n  </form>\n  </td>\n</tr>';$(e).appendTo(".bank1 > tbody").find("form").submit(function(e){if(e.preventDefault(),p.destroy(),k()){var t=parseInt($.trim($("#pd_bank_money").val()));t||(t=0);var n=$("#pd_bank_msg").val(),a=[],i=!0,r=!1,l=void 0;try{for(var d,s=$("#pd_bank_users").val().split("\n")[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var c=d.value;if(c=$.trim(c))if(c.includes(":")){var f=c.split(":"),u=o(f,2),_=u[0],g=u[1];if("undefined"==typeof g)continue;a.push([$.trim(_),parseInt(g)])}else a.push([c,t])}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}if(a.length){var h=/\(手续费(\d+)%\)/.exec($('td:contains("(手续费")').text());if(h){var m=parseInt(h[1])/100,v=0,x=!0,C=!1,w=void 0;try{for(var S,T=a[Symbol.iterator]();!(x=(S=T.next()).done);x=!0){var L=o(S.value,2),I=(L[0],L[1]);v+=I}}catch(e){C=!0,w=e}finally{try{!x&&T.return&&T.return()}finally{if(C)throw w}}if(v=Math.floor(v*(1+m)),confirm("共计"+a.length+"名用户，总额"+v.toLocaleString()+"KFB，是否转账？")){var D=p.wait("正在获取存款信息中&hellip;");$.get("hack.php?H_name=bank&t="+(new Date).getTime(),function(e){p.remove(D);var t=0,i=0,o=/当前所持：(-?\d+)KFB<br/i.exec(e);if(o&&(t=parseInt(o[1]),o=/活期存款：(-?\d+)KFB<br/i.exec(e))){if(i=parseInt(o[1]),v>t+i)return void alert("资金不足");$(document).clearQueue("Bank");var r=!1,l=v-i;l>0&&(r=!0,$(document).queue("Bank",function(){b(l,t,i),t-=l,i+=l}),$(document).dequeue("Bank")),p.wait('<strong>正在批量转账中，请耐心等待&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+a.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),$("#pd_bank_transfer > td:last-child").append('<ul class="pd_result pd_stat"><li><strong>转账结果：</strong></li></ul>'),y(a,n,r,i)}})}}}}}).end().find('.pd_input[type="button"]').click(function(e){e.preventDefault();var t=[],n=!0,a=!1,i=void 0;try{for(var o,r=$("#pd_bank_users").val().split("\n")[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;l=$.trim(l),l&&t.push($.trim(l.split(":")[0]))}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}if(t.length){var d=prompt("设定随机金额的范围（注：最低转账金额为20KFB）","20-100");if(null!==d){if(d=$.trim(d),!/^\d+-\d+$/.test(d))return void alert("随机金额范围格式不正确");var s=d.split("-"),p=parseInt(s[0]),c=parseInt(s[1]);if(c<p)return void alert("最大值不能低于最小值");var f="",u=!0,_=!1,g=void 0;try{for(var h,m=t[Symbol.iterator]();!(u=(h=m.next()).done);u=!0){var v=h.value;f+=v+":"+Math.floor(Math.random()*(c-p+1)+p)+"\n"}}catch(e){_=!0,g=e}finally{try{!u&&m.return&&m.return()}finally{if(_)throw g}}$("#pd_bank_users").val(f)}}})},n.handleInBankPage=function(){var e=$('.bank1 > tbody > tr:nth-child(2) > td:contains("可获利息：")'),t=e.html(),n=/可获利息：(\d+)\(/i.exec(t),a=0;n&&(a=parseInt(n[1]),a>0&&e.html(t.replace(/可获利息：\d+\(/i,'可获利息：<b class="pd_highlight">'+a+"</b>(")));var i=e.html();if(n=/定期存款：(\d+)KFB/i.exec(i)){var o=parseInt(n[1]);if(o>0&&0===a){var r=parseInt(g.getValue(f.default.fixedDepositDueTmpLogName));if(!isNaN(r)&&r>(new Date).getTime()&&(i=i.replace("期间不存取定期，才可以获得利息）",'期间不存取定期，才可以获得利息）<span style="color: #339933;"> (到期时间：'+d.getDateString(new Date(r))+" "+(d.getTimeString(new Date(r),":",!1)+")</span>")),e.html(i)),n=/定期利息：([\d\.]+)%/.exec(i)){var l=parseFloat(n[1])/100,s=Math.round(o*l*f.default.fixedDepositDueTime);i=i.replace("取出定期将获得该数额的KFB利息)",'取出定期将获得该数额的KFB利息)<span style="color: #339933;"> (预期利息：'+s+" KFB)</span>"),e.html(i)}}}$('form[name="form1"], form[name="form2"]').submit(function(){var e=$(this),t=0;t=e.is('[name="form2"]')?parseInt(e.find('input[name="drawmoney"]').val()):parseInt(e.find('input[name="savemoney"]').val()),2===parseInt(e.find('input[name="btype"]:checked').val())&&t>0&&g.setValue(f.default.fixedDepositDueTmpLogName,d.getDate("+"+f.default.fixedDepositDueTime+"d").getTime())}),$('form[name="form3"]').submit(function(){var e=/活期存款：(-?\d+)KFB/.exec($('td:contains("活期存款：")').text());if(e){var t=parseInt(e[1]);if(e=/定期存款：(\d+)KFB/.exec($('td:contains("定期存款：")').text())){var n=parseInt(e[1]),a=parseInt($('input[name="to_money"]').val());return!isNaN(a)&&n>0&&a>t&&!confirm("你的活期存款不足，转账金额将从定期存款里扣除，是否继续？")?($(this).find('input[type="submit"]').prop("disabled",!1),!1):void 0}}})},n.fixedDepositDueAlert=function(){console.log("定期存款到期提醒Start"),$.get("hack.php?H_name=bank&t="+(new Date).getTime(),function(e){d.setCookie(f.default.fixedDepositDueAlertCookieName,1,d.getMidnightHourDate(1));var t=/可获利息：(\d+)\(/.exec(e);if(t){var n=parseInt(t[1]);n>0&&(d.setCookie(f.default.fixedDepositDueAlertCookieName,1,d.getMidnightHourDate(7)),confirm("您的定期存款已到期，共产生利息"+n+"KFB，是否前往银行取款？")&&(location.href="hack.php?H_name=bank"))}})}},{"./Const":6,"./Info":10,"./Log":12,"./Msg":15,"./Public":18,"./TmpLog":20,"./Util":21}],3:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.addStartBatchModeButton=void 0;var o=e("./Const"),r=i(o),l=e("./Msg"),d=a(l),s=e("./Log"),p=e("./Public"),c=a(p),f=function(e,t){var n=0,a=0,i=0,o=0;$(document).clearQueue("ConvertCardsToVipTime"),$.each(e,function(l,p){$(document).queue("ConvertCardsToVipTime",function(){$.ajax({type:"GET",url:"kf_fw_card_doit.php?do=recard&id="+p+"&safeid="+t+"&t="+(new Date).getTime(),timeout:r.default.defAjaxTimeout,success:function(e){c.showFormatLog("将卡片转换为VIP时间",e);var t=/增加(\d+)小时VIP时间(?:.*?获得(\d+)点恢复能量)?/.exec(e);t?(n++,i+=parseInt(t[1]),"undefined"!=typeof t[2]&&(o+=parseInt(t[2]))):a++},error:function(){a++},complete:function(){var t=$("#pd_remaining_num");t.text(parseInt(t.text())-1);var p=t.closest(".pd_msg").data("stop");p&&$(document).clearQueue("ConvertCardsToVipTime"),p||l===e.length-1?(n>0&&(0,s.push)("将卡片转换为VIP时间","共有`"+n+"`张卡片成功为VIP时间",{gain:{"VIP小时":i,"能量":o},pay:{"卡片":-n}}),d.destroy(),console.log("共有"+n+"张卡片转换成功，共有"+a+"张卡片转换失败，VIP小时+"+i+"，能量+"+o),d.show("<strong>共有<em>"+n+"</em>张卡片转换成功"+(a>0?"，共有<em>"+a+"</em>张卡片转换失败":"")+"</strong>"+("<i>VIP小时<em>+"+i+"</em></i><i>能量<em>+"+o+"</em></i>"),-1),$(".kf_fw_ig2 .pd_card_chk:checked").closest("td").fadeOut("normal",function(){var e=$(this).parent();$(this).remove(),e.children().length||e.remove()})):setTimeout(function(){$(document).dequeue("ConvertCardsToVipTime")},r.default.defAjaxInterval)}})})}),$(document).dequeue("ConvertCardsToVipTime")};n.addStartBatchModeButton=function(){var e=c.getSafeId();e&&$('.kf_fw_ig2 a[href^="kf_fw_card_my.php?id="]').length&&$('<div class="pd_item_btns"><button>开启批量模式</button></div>').insertAfter(".kf_fw_ig2").find("button").click(function(){var t=$(this),n=$(".kf_fw_ig2 > tbody > tr:gt(2)");"开启批量模式"===t.text()?!function(){t.text("关闭批量模式"),n.on("click","a",function(e){e.preventDefault(),$(this).next(".pd_card_chk").click()}).find("td").has("a").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&$(this).css("position","relative").append('<input class="pd_card_chk" type="checkbox" value="'+e[1]+'">')});var a=[];$(".kf_fw_ig2 > tbody > tr:nth-child(2) > td").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&a.push(parseInt(e[1]))});var i=function(){var e=!0,t=!1,i=void 0;try{for(var o,r=a[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var l=o.value;n.find("td").has('a[href="kf_fw_card_my.php?id='+l+'"]').find("input:checked").prop("checked",!1)}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}};t.before('<label><input id="uncheckPlayedCard" type="checkbox" checked> 不选已出战的卡片</label><button>每类只保留一张</button><button>全选</button><button>反选</button><br><button>转换为VIP时间</button>').prev().click(function(){d.destroy();var t=[];n.find("input:checked").each(function(){t.push(parseInt($(this).val()))}),t.length&&confirm("共选择了"+t.length+"张卡片，是否将卡片批量转换为VIP时间？")&&(d.wait('<strong>正在批量转换中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),f(t,e))}).prev().prev().click(function(){n.find("input").each(function(){$(this).prop("checked",!$(this).prop("checked"))}),$("#uncheckPlayedCard").prop("checked")&&i()}).prev().click(function(){n.find("input").prop("checked",!0),$("#uncheckPlayedCard").prop("checked")&&i()}).prev().click(function(){n.find("input").prop("checked",!0),$("#uncheckPlayedCard").prop("checked")&&i();var e=new Set;n.find("a > img").each(function(){e.add($(this).attr("src"))});var t=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(t=(r=l.next()).done);t=!0){var d=r.value,s=n.find("td").has('img[src="'+d+'"]'),p=s.length,c=s.has("input:checked").length;p>1?p===c&&s.eq(0).find("input:checked").prop("checked",!1):s.find("input:checked").prop("checked",!1)}}catch(e){a=!0,o=e}finally{try{!t&&l.return&&l.return()}finally{if(a)throw o}}})}():(t.text("开启批量模式"),n.off("click").find(".pd_card_chk").remove(),t.prevAll().remove())})}},{"./Const":6,"./Log":12,"./Msg":15,"./Public":18}],4:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.normalize=n.changeStorageType=n.clear=n.write=n.read=n.init=n.Config=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),d=a(l),s=e("./Const"),p=i(s),c=e("./Log"),f=e("./TmpLog"),u=a(f),_="pd_config",g=n.Config={autoRefreshEnabled:!1,showRefreshModeTipsType:"auto",autoDonationEnabled:!1,donationKfb:"1",donationAfterTime:"00:05:00",atTipsHandleType:"no_highlight",smLevelUpAlertEnabled:!1,fixedDepositDueAlertEnabled:!1,smRankChangeAlertEnabled:!1,homePageThreadFastGotoLinkEnabled:!0,showVipSurplusTimeEnabled:!1,showFastGotoThreadPageEnabled:!1,maxFastGotoThreadPageNum:5,perPageFloorNum:10,highlightNewPostEnabled:!0,adjustThreadContentWidthEnabled:!1,threadContentFontSize:0,customMySmColor:"",customSmColorEnabled:!1,customSmColorConfigList:[],modifyKFOtherDomainEnabled:!0,multiQuoteEnabled:!0,batchBuyThreadEnabled:!0,userMemoEnabled:!1,userMemoList:{},parseMediaTagEnabled:!0,turnPageViaKeyboardEnabled:!1,showSelfRatingLinkEnabled:!1,buyThreadViaAjaxEnabled:!0,defShowMsgDuration:-1,animationEffectOffEnabled:!1,logSaveDays:30,showLogLinkEnabled:!0,showSearchLinkEnabled:!0,logSortType:"time",logStatType:"cur",logStatDays:7,addSideBarFastNavEnabled:!0,modifySideBarEnabled:!1,customCssEnabled:!1,customCssContent:"",customScriptEnabled:!1,customScriptStartContent:"",customScriptEndContent:"",browseType:"auto",followUserEnabled:!1,followUserList:[],highlightFollowUserThreadInHPEnabled:!0,highlightFollowUserThreadLinkEnabled:!0,blockUserEnabled:!1,blockUserDefaultType:0,blockUserAtTipsEnabled:!0,blockUserForumType:0,blockUserFidList:[],blockUserList:[],blockThreadEnabled:!1,blockThreadDefForumType:0,blockThreadDefFidList:[],blockThreadList:[],autoSaveCurrentDepositEnabled:!1,saveCurrentDepositAfterKfb:0,saveCurrentDepositKfb:0,autoChangeSMColorEnabled:!1,autoChangeSMColorType:"random",autoChangeSMColorInterval:24,changeAllAvailableSMColorEnabled:!0,customAutoChangeSMColorList:[]},h=(n.init=function(){var e=$.extend(!0,{},g);"undefined"==typeof unsafeWindow?window.Config=e:unsafeWindow.Config=e,"undefined"!=typeof GM_getValue&&(r.default.storageType=GM_getValue("StorageType"),"ByUid"!==r.default.storageType&&"Global"!==r.default.storageType&&(r.default.storageType="Default")),h()},n.read=function(){var e=null;if(e="ByUid"===r.default.storageType?GM_getValue(_+"_"+r.default.uid):"Global"===r.default.storageType?GM_getValue(_):localStorage.getItem(_)){try{e=JSON.parse(e)}catch(e){return}e&&"object"===$.type(e)&&!$.isEmptyObject(e)&&(e=v(e),r.default.w.Config=$.extend(!0,{},g,e))}}),m=n.write=function(){var e=d.getDifferenceSetOfObject(g,r.default.w.Config);"ByUid"===r.default.storageType?GM_setValue(_+"_"+r.default.uid,JSON.stringify(e)):"Global"===r.default.storageType?GM_setValue(_,JSON.stringify(e)):localStorage.setItem(_,JSON.stringify(e))},v=(n.clear=function(){"ByUid"===r.default.storageType?GM_deleteValue(_+"_"+r.default.uid):"Global"===r.default.storageType?GM_deleteValue(_):localStorage.removeItem(_)},n.changeStorageType=function(e){(0,c.read)(),u.read(),r.default.storageType=e,"undefined"!=typeof GM_setValue&&GM_setValue("StorageType",r.default.storageType),d.deepEqual(g,r.default.w.Config)&&$.isEmptyObject(r.default.w.Log)||confirm("是否将助手设置和日志转移到对应存储类型中？（对应存储类型中的数据将被覆盖）")&&(m(),(0,c.write)(),u.write())},n.normalize=function(e){var t={};if("object"!==$.type(e))return t;if("undefined"!=typeof e.autoRefreshEnabled&&(t.autoRefreshEnabled="boolean"==typeof e.autoRefreshEnabled?e.autoRefreshEnabled:g.autoRefreshEnabled),"undefined"!=typeof e.showRefreshModeTipsType){var n=$.trim(e.showRefreshModeTipsType).toLowerCase(),a=["auto","always","never"];""!==n&&$.inArray(n,a)>-1?t.showRefreshModeTipsType=n:t.showRefreshModeTipsType=g.showRefreshModeTipsType}if("undefined"!=typeof e.autoDonationEnabled&&(t.autoDonationEnabled="boolean"==typeof e.autoDonationEnabled?e.autoDonationEnabled:g.autoDonationEnabled),"undefined"!=typeof e.donationKfb){var i=e.donationKfb;$.isNumeric(i)&&i>0&&i<=p.default.maxDonationKfb?t.donationKfb=parseInt(i).toString():/^1?\d?\d%$/.test(i)&&parseInt(i)>0&&parseInt(i)<=100?t.donationKfb=parseInt(i)+"%":t.donationKfb=g.donationKfb}if("undefined"!=typeof e.donationAfterTime){var o=e.donationAfterTime;/^(2[0-3]|[0-1][0-9]):[0-5][0-9]:[0-5][0-9]$/.test(o)?t.donationAfterTime=o:t.donationAfterTime=g.donationAfterTime}if("undefined"!=typeof e.atTipsHandleType){var r=$.trim(e.atTipsHandleType).toLowerCase(),l=["no_highlight","no_highlight_extra","hide_box_1","hide_box_2","default","at_change_to_cao"];""!==r&&$.inArray(r,l)>-1?t.atTipsHandleType=r:t.atTipsHandleType=g.atTipsHandleType}if("undefined"!=typeof e.smLevelUpAlertEnabled&&(t.smLevelUpAlertEnabled="boolean"==typeof e.smLevelUpAlertEnabled?e.smLevelUpAlertEnabled:g.smLevelUpAlertEnabled),"undefined"!=typeof e.fixedDepositDueAlertEnabled&&(t.fixedDepositDueAlertEnabled="boolean"==typeof e.fixedDepositDueAlertEnabled?e.fixedDepositDueAlertEnabled:g.fixedDepositDueAlertEnabled),"undefined"!=typeof e.smRankChangeAlertEnabled&&(t.smRankChangeAlertEnabled="boolean"==typeof e.smRankChangeAlertEnabled?e.smRankChangeAlertEnabled:g.smRankChangeAlertEnabled),"undefined"!=typeof e.homePageThreadFastGotoLinkEnabled&&(t.homePageThreadFastGotoLinkEnabled="boolean"==typeof e.homePageThreadFastGotoLinkEnabled?e.homePageThreadFastGotoLinkEnabled:g.homePageThreadFastGotoLinkEnabled),"undefined"!=typeof e.showVipSurplusTimeEnabled&&(t.showVipSurplusTimeEnabled="boolean"==typeof e.showVipSurplusTimeEnabled?e.showVipSurplusTimeEnabled:g.showVipSurplusTimeEnabled),"undefined"!=typeof e.showFastGotoThreadPageEnabled&&(t.showFastGotoThreadPageEnabled="boolean"==typeof e.showFastGotoThreadPageEnabled?e.showFastGotoThreadPageEnabled:g.showFastGotoThreadPageEnabled),"undefined"!=typeof e.maxFastGotoThreadPageNum){var s=parseInt(e.maxFastGotoThreadPageNum);!isNaN(s)&&s>0?t.maxFastGotoThreadPageNum=s:t.maxFastGotoThreadPageNum=g.maxFastGotoThreadPageNum}if("undefined"!=typeof e.highlightNewPostEnabled&&(t.highlightNewPostEnabled="boolean"==typeof e.highlightNewPostEnabled?e.highlightNewPostEnabled:g.highlightNewPostEnabled),"undefined"!=typeof e.perPageFloorNum){var c=parseInt(e.perPageFloorNum);$.inArray(c,[10,20,30])>-1?t.perPageFloorNum=c:t.perPageFloorNum=g.perPageFloorNum}if("undefined"!=typeof e.threadContentFontSize){var f=parseInt(e.threadContentFontSize);f>0?t.threadContentFontSize=f:t.threadContentFontSize=g.threadContentFontSize}if("undefined"!=typeof e.adjustThreadContentWidthEnabled&&(t.adjustThreadContentWidthEnabled="boolean"==typeof e.adjustThreadContentWidthEnabled?e.adjustThreadContentWidthEnabled:g.adjustThreadContentWidthEnabled),"undefined"!=typeof e.turnPageViaKeyboardEnabled&&(t.turnPageViaKeyboardEnabled="boolean"==typeof e.turnPageViaKeyboardEnabled?e.turnPageViaKeyboardEnabled:g.turnPageViaKeyboardEnabled),"undefined"!=typeof e.customMySmColor){var u=e.customMySmColor;/^#[0-9a-fA-F]{6}$/.test(u)?t.customMySmColor=u:t.customMySmColor=g.customMySmColor}if("undefined"!=typeof e.customSmColorEnabled&&(t.customSmColorEnabled="boolean"==typeof e.customSmColorEnabled?e.customSmColorEnabled:g.customSmColorEnabled),"undefined"!=typeof e.customSmColorConfigList){var _=e.customSmColorConfigList;$.isArray(_)?(t.customSmColorConfigList=[],$.each(_,function(e,n){"object"===$.type(n)&&"string"===$.type(n.min)&&"string"===$.type(n.max)&&"string"===$.type(n.color)&&/^(-?\d+|MAX)$/i.test(n.min)&&/^(-?\d+|MAX)$/i.test(n.max)&&/^#[0-9a-fA-F]{6}$/.test(n.color)&&d.compareSmLevel(n.min,n.max)<=0&&t.customSmColorConfigList.push(n)})):t.customSmColorConfigList=g.customSmColorConfigList}if("undefined"!=typeof e.modifyKFOtherDomainEnabled&&(t.modifyKFOtherDomainEnabled="boolean"==typeof e.modifyKFOtherDomainEnabled?e.modifyKFOtherDomainEnabled:g.modifyKFOtherDomainEnabled),"undefined"!=typeof e.multiQuoteEnabled&&(t.multiQuoteEnabled="boolean"==typeof e.multiQuoteEnabled?e.multiQuoteEnabled:g.multiQuoteEnabled),"undefined"!=typeof e.batchBuyThreadEnabled&&(t.batchBuyThreadEnabled="boolean"==typeof e.batchBuyThreadEnabled?e.batchBuyThreadEnabled:g.batchBuyThreadEnabled),"undefined"!=typeof e.userMemoEnabled&&(t.userMemoEnabled="boolean"==typeof e.userMemoEnabled?e.userMemoEnabled:g.userMemoEnabled),"undefined"!=typeof e.userMemoList)if("object"===$.type(e.userMemoList)){t.userMemoList={};for(var h in e.userMemoList){var m=$.trim(e.userMemoList[h]);m&&(t.userMemoList[h]=m)}}else t.userMemoList=g.userMemoList;if("undefined"!=typeof e.parseMediaTagEnabled&&(t.parseMediaTagEnabled="boolean"==typeof e.parseMediaTagEnabled?e.parseMediaTagEnabled:g.parseMediaTagEnabled),"undefined"!=typeof e.showSelfRatingLinkEnabled&&(t.showSelfRatingLinkEnabled="boolean"==typeof e.showSelfRatingLinkEnabled?e.showSelfRatingLinkEnabled:g.showSelfRatingLinkEnabled),"undefined"!=typeof e.buyThreadViaAjaxEnabled&&(t.buyThreadViaAjaxEnabled="boolean"==typeof e.buyThreadViaAjaxEnabled?e.buyThreadViaAjaxEnabled:g.buyThreadViaAjaxEnabled),"undefined"!=typeof e.defShowMsgDuration){var v=parseInt(e.defShowMsgDuration);!isNaN(v)&&v>=-1?t.defShowMsgDuration=v:t.defShowMsgDuration=g.defShowMsgDuration}if("undefined"!=typeof e.animationEffectOffEnabled&&(t.animationEffectOffEnabled="boolean"==typeof e.animationEffectOffEnabled?e.animationEffectOffEnabled:g.animationEffectOffEnabled),"undefined"!=typeof e.logSaveDays){var b=parseInt(e.logSaveDays);b>0?t.logSaveDays=b:t.logSaveDays=g.logSaveDays}if("undefined"!=typeof e.browseType&&($.inArray(e.browseType.toLowerCase(),["auto","desktop","mobile"])>-1?t.browseType=e.browseType.toLowerCase():t.browseType=g.options.browseType),"undefined"!=typeof e.showLogLinkEnabled&&(t.showLogLinkEnabled="boolean"==typeof e.showLogLinkEnabled?e.showLogLinkEnabled:g.showLogLinkEnabled),"undefined"!=typeof e.showSearchLinkEnabled&&(t.showSearchLinkEnabled="boolean"==typeof e.showSearchLinkEnabled?e.showSearchLinkEnabled:g.showSearchLinkEnabled),"undefined"!=typeof e.logSortType){var y=$.trim(e.logSortType).toLowerCase(),k=["time","type"];""!==y&&$.inArray(y,k)>-1?t.logSortType=y:t.logSortType=g.logSortType}if("undefined"!=typeof e.logStatType){var x=$.trim(e.logStatType).toLowerCase(),C=["cur","custom","all"];""!==x&&$.inArray(x,C)>-1?t.logStatType=x:t.logStatType=g.logStatType}if("undefined"!=typeof e.logStatDays){var w=parseInt(e.logStatDays);w>0?t.logStatDays=w:t.logStatDays=g.logStatDays}if("undefined"!=typeof e.addSideBarFastNavEnabled&&(t.addSideBarFastNavEnabled="boolean"==typeof e.addSideBarFastNavEnabled?e.addSideBarFastNavEnabled:g.addSideBarFastNavEnabled),"undefined"!=typeof e.modifySideBarEnabled&&(t.modifySideBarEnabled="boolean"==typeof e.modifySideBarEnabled?e.modifySideBarEnabled:g.modifySideBarEnabled),"undefined"!=typeof e.customCssEnabled&&(t.customCssEnabled="boolean"==typeof e.customCssEnabled?e.customCssEnabled:g.customCssEnabled),"undefined"!=typeof e.customCssContent){var S=$.trim(e.customCssContent);""!==S?t.customCssContent=S:t.customCssContent=g.customCssContent}if("undefined"!=typeof e.customScriptEnabled&&(t.customScriptEnabled="boolean"==typeof e.customScriptEnabled?e.customScriptEnabled:g.customScriptEnabled),
"undefined"!=typeof e.customScriptStartContent&&("string"==typeof e.customScriptStartContent?t.customScriptStartContent=e.customScriptStartContent:t.customScriptStartContent=g.customScriptStartContent),"undefined"!=typeof e.customScriptEndContent&&("string"==typeof e.customScriptEndContent?t.customScriptEndContent=e.customScriptEndContent:t.customScriptEndContent=g.customScriptEndContent),"undefined"!=typeof e.followUserEnabled&&(t.followUserEnabled="boolean"==typeof e.followUserEnabled?e.followUserEnabled:g.followUserEnabled),"undefined"!=typeof e.highlightFollowUserThreadInHPEnabled&&(t.highlightFollowUserThreadInHPEnabled="boolean"==typeof e.highlightFollowUserThreadInHPEnabled?e.highlightFollowUserThreadInHPEnabled:g.highlightFollowUserThreadInHPEnabled),"undefined"!=typeof e.highlightFollowUserThreadLinkEnabled&&(t.highlightFollowUserThreadLinkEnabled="boolean"==typeof e.highlightFollowUserThreadLinkEnabled?e.highlightFollowUserThreadLinkEnabled:g.highlightFollowUserThreadLinkEnabled),"undefined"!=typeof e.followUserList)if($.isArray(e.followUserList)){t.followUserList=[];for(var T in e.followUserList){var L=e.followUserList[T];if("object"===$.type(L)&&"string"===$.type(L.name)){var I=$.trim(L.name);I&&t.followUserList.push({name:I})}else if("string"===$.type(L)){var D=$.trim(L);D&&t.followUserList.push({name:D})}}}else t.followUserList=g.followUserList;if("undefined"!=typeof e.blockUserEnabled&&(t.blockUserEnabled="boolean"==typeof e.blockUserEnabled?e.blockUserEnabled:g.blockUserEnabled),"undefined"!=typeof e.blockUserDefaultType){var E=parseInt(e.blockUserDefaultType);!isNaN(E)&&E>=0&&E<=2?t.blockUserDefaultType=E:t.blockUserDefaultType=g.blockUserDefaultType}if("undefined"!=typeof e.blockUserAtTipsEnabled&&(t.blockUserAtTipsEnabled="boolean"==typeof e.blockUserAtTipsEnabled?e.blockUserAtTipsEnabled:g.blockUserAtTipsEnabled),"undefined"!=typeof e.blockUserForumType){var M=parseInt(e.blockUserForumType);!isNaN(M)&&M>=0&&M<=2?t.blockUserForumType=M:t.blockUserForumType=g.blockUserForumType}if("undefined"!=typeof e.blockUserFidList)if($.isArray(e.blockUserFidList)){t.blockUserFidList=[];for(var F in e.blockUserFidList){var U=parseInt(e.blockUserFidList[F]);!isNaN(U)&&U>0&&t.blockUserFidList.push(U)}}else t.blockUserFidList=g.blockUserFidList;if("undefined"!=typeof e.blockUserList)if($.isArray(e.blockUserList)){t.blockUserList=[];for(var A in e.blockUserList){var B=e.blockUserList[A];if("object"===$.type(B)&&"string"===$.type(B.name)&&"number"===$.type(B.type)){var N=B.type;(N<0||N>2)&&(N=g.blockUserDefaultType);var P=$.trim(B.name);P&&t.blockUserList.push({name:P,type:N})}else if("string"===$.type(B)){var j=$.trim(B);j&&t.blockUserList.push({name:j,type:g.blockUserDefaultType})}}}else t.blockUserList=g.blockUserList;if("undefined"!=typeof e.blockThreadEnabled&&(t.blockThreadEnabled="boolean"==typeof e.blockThreadEnabled?e.blockThreadEnabled:g.blockThreadEnabled),"undefined"!=typeof e.blockThreadDefForumType){var O=parseInt(e.blockThreadDefForumType);!isNaN(O)&&O>=0&&O<=2?t.blockThreadDefForumType=O:t.blockThreadDefForumType=g.blockThreadDefForumType}if("undefined"!=typeof e.blockThreadDefFidList)if($.isArray(e.blockThreadDefFidList)){t.blockThreadDefFidList=[];for(var K in e.blockThreadDefFidList){var R=parseInt(e.blockThreadDefFidList[K]);!isNaN(R)&&R>0&&t.blockThreadDefFidList.push(R)}}else t.blockThreadDefFidList=g.blockThreadDefFidList;if("undefined"!=typeof e.blockThreadList)if($.isArray(e.blockThreadList)){t.blockThreadList=[];for(var q in e.blockThreadList){var V=e.blockThreadList[q];if("object"===$.type(V)&&"string"===$.type(V.keyWord)&&""!==$.trim(V.keyWord)){var G={keyWord:V.keyWord};$.isArray(V.includeUser)&&V.includeUser.length>0?G.includeUser=V.includeUser:$.isArray(V.excludeUser)&&V.excludeUser.length>0?G.excludeUser=V.excludeUser:$.isArray(V.userName)&&V.userName.length>0&&(G.includeUser=V.userName),$.isArray(V.includeFid)&&V.includeFid.length>0?G.includeFid=V.includeFid:$.isArray(V.excludeFid)&&V.excludeFid.length>0&&(G.excludeFid=V.excludeFid),t.blockThreadList.push(G)}}}else t.blockThreadList=g.blockThreadList;if("undefined"!=typeof e.autoSaveCurrentDepositEnabled&&(t.autoSaveCurrentDepositEnabled="boolean"==typeof e.autoSaveCurrentDepositEnabled?e.autoSaveCurrentDepositEnabled:g.autoSaveCurrentDepositEnabled),"undefined"!=typeof e.saveCurrentDepositAfterKfb){var z=parseInt(e.saveCurrentDepositAfterKfb);z>0?t.saveCurrentDepositAfterKfb=z:t.saveCurrentDepositAfterKfb=g.saveCurrentDepositAfterKfb}if("undefined"!=typeof e.saveCurrentDepositKfb){var H=parseInt(e.saveCurrentDepositKfb);H>0&&H<=t.saveCurrentDepositAfterKfb?t.saveCurrentDepositKfb=H:t.saveCurrentDepositKfb=g.saveCurrentDepositKfb}if("undefined"!=typeof e.autoChangeSMColorEnabled&&(t.autoChangeSMColorEnabled="boolean"==typeof e.autoChangeSMColorEnabled?e.autoChangeSMColorEnabled:g.autoChangeSMColorEnabled),"undefined"!=typeof e.autoChangeSMColorType){var Q=$.trim(e.autoChangeSMColorType).toLowerCase(),W=["random","sequence"];""!==Q&&$.inArray(Q,W)>-1?t.autoChangeSMColorType=Q:t.autoChangeSMColorType=g.autoChangeSMColorType}if("undefined"!=typeof e.autoChangeSMColorInterval){var J=parseInt(e.autoChangeSMColorInterval);!isNaN(J)&&J>0?t.autoChangeSMColorInterval=J:t.autoChangeSMColorInterval=g.autoChangeSMColorInterval}if("undefined"!=typeof e.changeAllAvailableSMColorEnabled&&(t.changeAllAvailableSMColorEnabled="boolean"==typeof e.changeAllAvailableSMColorEnabled?e.changeAllAvailableSMColorEnabled:g.changeAllAvailableSMColorEnabled),"undefined"!=typeof e.customAutoChangeSMColorList)if($.isArray(e.customAutoChangeSMColorList)){t.customAutoChangeSMColorList=[];for(var X in e.customAutoChangeSMColorList){var Y=parseInt(e.customAutoChangeSMColorList[X]);!isNaN(Y)&&Y>=1&&Y<=20&&t.customAutoChangeSMColorList.push(Y)}}else t.customAutoChangeSMColorList=g.customAutoChangeSMColorList;return t})},{"./Const":6,"./Info":10,"./Log":12,"./TmpLog":20,"./Util":21}],5:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.show=void 0;var _slicedToArray=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Func=require("./Func"),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Config=require("./Config"),_LogDialog=require("./LogDialog"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),show=exports.show=function(){if(!($("#pd_config").length>0)){(0,_Config.read)(),(0,_Func.run)("ConfigDialog.show_before_");var e='\n<div class="pd_cfg_main">\n  <div class="pd_cfg_nav">\n    <a title="清除与助手有关的Cookies和本地存储数据（不包括助手设置和日志）" href="#">清除临时数据</a>\n    <a href="#">运行命令</a>\n    <a href="#">查看日志</a>\n    <a href="#">导入/导出设置</a>\n  </div>\n\n  <div class="pd_cfg_panel" style="margin-bottom: 5px;">\n    <fieldset>\n      <legend><label><input id="pd_cfg_auto_refresh_enabled" type="checkbox">定时模式 \n<span class="pd_cfg_tips" title="可按时进行自动操作（包括捐款、自动更换ID颜色，需开启相关功能），\n只在论坛首页生效（不开启此模式的话只能在刷新页面后才会进行操作）">[?]</span></label></legend>\n      <label>标题提示方案<select id="pd_cfg_show_refresh_mode_tips_type"><option value="auto">停留一分钟后显示</option>\n<option value="always">总是显示</option><option value="never">不显示</option></select>\n<span class="pd_cfg_tips" title="在首页的网页标题上显示定时模式提示的方案">[?]</span></label>\n    </fieldset>\n    <fieldset>\n      <legend><label><input id="pd_cfg_auto_donation_enabled" type="checkbox">自动KFB捐款</label></legend>\n      <label>KFB捐款额度<input id="pd_cfg_donation_kfb" maxlength="4" style="width:32px" type="text">\n<span class="pd_cfg_tips" title="取值范围在1-5000的整数之间；可设置为百分比，表示捐款额度为当前所持现金的百分比（最多不超过5000KFB），例：80%">[?]</span></label>\n      <label class="pd_cfg_ml">在<input id="pd_cfg_donation_after_time" maxlength="8" style="width:55px" type="text">\n之后捐款 <span class="pd_cfg_tips" title="在当天的指定时间之后捐款（24小时制），例：22:30:00（注意不要设置得太接近零点，以免错过捐款）">[?]</span></label>\n    </fieldset>\n    <fieldset>\n      <legend>首页相关</legend>\n      <label>@提醒<select id="pd_cfg_at_tips_handle_type" style="width:130px"><option value="no_highlight">取消已读提醒高亮</option>\n<option value="no_highlight_extra">取消已读提醒高亮，并在无提醒时补上消息框</option><option value="hide_box_1">不显示已读提醒的消息框</option>\n<option value="hide_box_2">永不显示消息框</option><option value="default">保持默认</option>\n<option value="at_change_to_cao">将@改为艹(其他和方式2相同)</option></select>\n<span class="pd_cfg_tips" title="对首页上的有人@你的消息框进行处理的方案">[?]</span></label>\n      <label class="pd_cfg_ml"><input id="pd_cfg_sm_level_up_alert_enabled" type="checkbox">神秘等级升级提醒 \n<span class="pd_cfg_tips" title="在神秘等级升级后进行提醒，只在首页生效">[?]</span></label><br>\n      <label><input id="pd_cfg_fixed_deposit_due_alert_enabled" type="checkbox">定期存款到期提醒 \n<span class="pd_cfg_tips" title="在定时存款到期时进行提醒，只在首页生效">[?]</span></label>\n      <label class="pd_cfg_ml"><input id="pd_cfg_sm_rank_change_alert_enabled" type="checkbox">系数排名变化提醒 \n<span class="pd_cfg_tips" title="在神秘系数排名发生变化时进行提醒，只在首页生效">[?]</span></label><br>\n      <label><input id="pd_cfg_home_page_thread_fast_goto_link_enabled" type="checkbox">在首页帖子旁显示跳转链接 \n<span class="pd_cfg_tips" title="在首页帖子链接旁显示快速跳转至页末的链接">[?]</span></label>\n      <label class="pd_cfg_ml"><input id="pd_cfg_show_vip_surplus_time_enabled" type="checkbox">显示VIP剩余时间 \n<span class="pd_cfg_tips" title="在首页显示VIP剩余时间">[?]</span></label>\n    </fieldset>\n    <fieldset>\n      <legend>帖子页面相关</legend>\n      <label>帖子每页楼层数量<select id="pd_cfg_per_page_floor_num"><option value="10">10</option>\n<option value="20">20</option><option value="30">30</option></select>\n<span class="pd_cfg_tips" title="用于电梯直达和帖子页数快捷链接功能，如果修改了KF设置里的“文章列表每页个数”，请在此修改成相同的数目">[?]</span></label>\n      <label class="pd_cfg_ml">帖子内容字体大小<input id="pd_cfg_thread_content_font_size" maxlength="2" style="width: 20px;" type="text">px \n<span class="pd_cfg_tips" title="帖子内容字体大小，留空表示使用默认大小，推荐值：14">[?]</span></label><br>\n      <label><input id="pd_cfg_adjust_thread_content_width_enabled" type="checkbox">调整帖子内容宽度 \n<span class="pd_cfg_tips" title="调整帖子内容宽度，使其保持一致">[?]</span></label>\n      <label class="pd_cfg_ml"><input id="pd_cfg_turn_page_via_keyboard_enabled" type="checkbox">通过左右键翻页 \n<span class="pd_cfg_tips" title="在帖子和搜索页面通过左右键进行翻页">[?]</span></label><br>\n      <label><input id="pd_cfg_auto_change_sm_color_enabled_2" type="checkbox" data-disabled="#pd_cfg_auto_change_sm_color_page">自动更换ID颜色 \n<span class="pd_cfg_tips" title="可自动更换ID颜色，请点击详细设置前往相应页面进行自定义设置">[?]</span></label>\n<a id="pd_cfg_auto_change_sm_color_page" class="pd_cfg_ml" target="_blank" href="kf_growup.php">详细设置&raquo;</a><br>\n      <label>自定义本人的神秘颜色<input id="pd_cfg_custom_my_sm_color" maxlength="7" style="width: 50px;" type="text">\n<input style="margin-left:0" type="color" id="pd_cfg_custom_my_sm_color_select">\n<span class="pd_cfg_tips" title="自定义本人的神秘颜色（包括帖子页面的ID显示颜色和楼层边框颜色，仅自己可见），例：#009CFF，如无需求可留空">[?]</span></label><br>\n      <label><input id="pd_cfg_custom_sm_color_enabled" type="checkbox" data-disabled="#pd_cfg_custom_sm_color_dialog">自定义各等级神秘颜色 \n<span class="pd_cfg_tips" title="自定义各等级神秘颜色（包括帖子页面的ID显示颜色和楼层边框颜色，仅自己可见），请点击详细设置自定义各等级颜色">[?]</span></label>\n<a class="pd_cfg_ml" id="pd_cfg_custom_sm_color_dialog" href="#">详细设置&raquo;</a><br>\n      <label><input id="pd_cfg_modify_kf_other_domain_enabled" type="checkbox">将绯月其它域名的链接修改为当前域名 \n<span class="pd_cfg_tips" title="将帖子和短消息中的绯月其它域名的链接修改为当前域名">[?]</span></label><br>\n      <label><input id="pd_cfg_multi_quote_enabled" type="checkbox">开启多重引用功能 \n<span class="pd_cfg_tips" title="在帖子页面开启多重回复和多重引用功能">[?]</span></label>\n      <label class="pd_cfg_ml"><input id="pd_cfg_show_self_rating_link_enabled" type="checkbox">显示自助评分链接 \n<span class="pd_cfg_tips" title="在符合条件的帖子页面显示自助评分的链接（仅限自助评分测试人员使用）">[?]</span></label><br>\n      <label><input id="pd_cfg_user_memo_enabled" type="checkbox" data-disabled="#pd_cfg_user_memo_dialog">显示用户备注 \n<span class="pd_cfg_tips" title="显示用户的自定义备注，请点击详细设置自定义用户备注">[?]</span></label>\n<a class="pd_cfg_ml" id="pd_cfg_user_memo_dialog" href="#">详细设置&raquo;</a>\n      <label class="pd_cfg_ml"><input id="pd_cfg_parse_media_tag_enabled" type="checkbox">解析多媒体标签 \n<span class="pd_cfg_tips" title="在帖子页面解析HTML5多媒体标签，详见【常见问题11】">[?]</span></label><br>\n      <label><input id="pd_cfg_batch_buy_thread_enabled" type="checkbox">开启批量购买帖子功能 \n<span class="pd_cfg_tips" title="在帖子页面开启批量购买帖子的功能">[?]</span></label>\n      <label class="pd_cfg_ml"><input id="pd_cfg_buy_thread_via_ajax_enabled" type="checkbox">使用Ajax购买帖子 \n<span class="pd_cfg_tips" title="使用Ajax的方式购买帖子，购买时页面不会跳转">[?]</span></label><br>\n    </fieldset>\n  </div>\n\n  <div class="pd_cfg_panel">\n    <fieldset>\n      <legend>版块页面相关</legend>\n      <label><input id="pd_cfg_show_fast_goto_thread_page_enabled" type="checkbox" data-disabled="#pd_cfg_max_fast_goto_thread_page_num">\n显示帖子页数快捷链接 <span class="pd_cfg_tips" title="在版块页面中显示帖子页数快捷链接">[?]</span></label>\n      <label class="pd_cfg_ml">页数链接最大数量<input id="pd_cfg_max_fast_goto_thread_page_num" style="width:25px" maxlength="4" type="text">\n<span class="pd_cfg_tips" title="在帖子页数快捷链接中显示页数链接的最大数量">[?]</span></label><br>\n      <label><input id="pd_cfg_highlight_new_post_enabled" type="checkbox">高亮今日的新帖 \n<span class="pd_cfg_tips" title="在版块页面中高亮今日新发表帖子的发表时间">[?]</span></label>\n    </fieldset>\n    <fieldset>\n      <legend>其它设置</legend>\n      <label class="pd_highlight">存储类型<select id="pd_cfg_storage_type"><option value="Default">默认</option>\n<option value="ByUid">按uid</option><option value="Global">全局</option></select>\n<span class="pd_cfg_tips" title="助手设置和日志的存储方式，详情参见【常见问题1】">[?]</span></label>\n      <label class="pd_cfg_ml">浏览器类型<select id="pd_cfg_browse_type"><option value="auto">自动检测</option>\n<option value="desktop">桌面版</option><option value="mobile">移动版</option></select>\n<span class="pd_cfg_tips" title="用于在KFOL助手上判断浏览器的类型，一般使用自动检测即可；\n如果当前浏览器与自动检测的类型不相符（移动版会在设置界面标题上显示“For Mobile”的字样），请手动设置为正确的类型">[?]</span></label><br>\n      <label><input id="pd_cfg_animation_effect_off_enabled" type="checkbox">禁用动画效果 \n<span class="pd_cfg_tips" title="禁用jQuery的动画效果（推荐在配置较差的机器上使用）">[?]</span></label><br>\n      <label>默认的消息显示时间<input id="pd_cfg_def_show_msg_duration" maxlength="5" style="width: 30px;" type="text">秒 \n<span class="pd_cfg_tips" title="默认的消息显示时间（秒），设置为-1表示永久显示，例：15">[?]</span></label>\n      <label class="pd_cfg_ml">日志保存天数<input id="pd_cfg_log_save_days" maxlength="3" style="width:25px" type="text">\n<span class="pd_cfg_tips" title="默认值：'+_Config.Config.logSaveDays+'">[?]</span></label><br>\n      <label><input id="pd_cfg_show_log_link_enabled" type="checkbox">显示日志链接 \n<span class="pd_cfg_tips" title="在页面上方显示助手日志的链接">[?]</span></label>\n      <label class="pd_cfg_ml"><input id="pd_cfg_show_search_link_enabled" type="checkbox">显示搜索链接 \n<span class="pd_cfg_tips" title="在页面上方显示搜索对话框的链接">[?]</span></label><br>\n      <label><input id="pd_cfg_add_side_bar_fast_nav_enabled" type="checkbox">为侧边栏添加快捷导航 \n<span class="pd_cfg_tips" title="为侧边栏添加快捷导航的链接">[?]</span></label>\n      <label class="pd_cfg_ml"><input id="pd_cfg_modify_side_bar_enabled" type="checkbox">将侧边栏修改为平铺样式 \n<span class="pd_cfg_tips" title="将侧边栏修改为和手机相同的平铺样式">[?]</span></label><br>\n      <label><input id="pd_cfg_custom_css_enabled" type="checkbox" data-disabled="#pd_cfg_custom_css_dialog">添加自定义CSS \n<span class="pd_cfg_tips" title="为页面添加自定义的CSS内容，请点击详细设置填入自定义的CSS内容">[?]</span></label>\n<a class="pd_cfg_ml" id="pd_cfg_custom_css_dialog" href="#">详细设置&raquo;</a><br>\n      <label><input id="pd_cfg_custom_script_enabled" type="checkbox" data-disabled="#pd_cfg_custom_script_dialog">执行自定义脚本 \n<span class="pd_cfg_tips" title="执行自定义的javascript脚本，请点击详细设置填入自定义的脚本内容">[?]</span></label>\n<a class="pd_cfg_ml" id="pd_cfg_custom_script_dialog" href="#">详细设置&raquo;</a>\n    </fieldset>\n    <fieldset>\n      <legend>关注和屏蔽</legend>\n      <label><input id="pd_cfg_follow_user_enabled" type="checkbox" data-disabled="#pd_cfg_follow_user_dialog">关注用户 \n<span class="pd_cfg_tips" title="开启关注用户的功能，所关注的用户将被加注记号，请点击详细设置管理关注用户">[?]</span></label>\n<a class="pd_cfg_ml" id="pd_cfg_follow_user_dialog" href="#">详细设置&raquo;</a><br>\n      <label><input id="pd_cfg_block_user_enabled" type="checkbox" data-disabled="#pd_cfg_block_user_dialog">屏蔽用户 \n<span class="pd_cfg_tips" title="开启屏蔽用户的功能，你将看不见所屏蔽用户的发言，请点击详细设置管理屏蔽用户">[?]</span></label>\n<a class="pd_cfg_ml" id="pd_cfg_block_user_dialog" href="#">详细设置&raquo;</a><br>\n      <label><input id="pd_cfg_block_thread_enabled" type="checkbox" data-disabled="#pd_cfg_block_thread_dialog">屏蔽帖子 \n<span class="pd_cfg_tips" title="开启屏蔽标题包含指定关键字的帖子的功能，请点击详细设置管理屏蔽关键字">[?]</span></label>\n<a class="pd_cfg_ml" id="pd_cfg_block_thread_dialog" href="#">详细设置&raquo;</a><br>\n    </fieldset>\n    <fieldset>\n      <legend><label><input id="pd_cfg_auto_save_current_deposit_enabled" type="checkbox">自动活期存款 \n<span class="pd_cfg_tips" title="在当前收入满足指定额度之后自动将指定数额存入活期存款中，只会在首页触发">[?]</span></label></legend>\n      <label>在当前收入已满<input id="pd_cfg_save_current_deposit_after_kfb" maxlength="10" style="width:45px" type="text">KFB之后 \n<span class="pd_cfg_tips" title="在当前收入已满指定KFB额度之后自动进行活期存款，例：1000">[?]</span></label><br>\n      <label>将<input id="pd_cfg_save_current_deposit_kfb" maxlength="10" style="width:45px" type="text">KFB存入活期存款 \n<span class="pd_cfg_tips" title="将指定额度的KFB存入活期存款中，例：900；举例：设定已满1000存900，当前收入为2000，则自动存入金额为1800">[?]</span></label>\n    </fieldset>\n  </div>\n</div>\n\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a target="_blank" href="read.php?tid=508450">By 喵拉布丁</a>\n    <i style="color:#666;font-style:normal">(V'+_Info2.default.version+')</i>\n    <a target="_blank" href="https://git.oschina.net/miaolapd/KF_Online_Assistant/wikis/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">[常见问题]</a>\n  </span>\n  <button>确定</button><button>取消</button><button>默认值</button>\n</div>',t=Dialog.create("pd_config","KF Online助手设置"+(_Info2.default.isMobile?" (For Mobile)":""),e);t.find(".pd_cfg_btns > button:eq(1)").click(function(){return Dialog.close("pd_config")}).end().find(".pd_cfg_btns > button:eq(2)").click(function(e){e.preventDefault(),confirm("是否重置所有设置？")&&((0,_Config.clear)(),alert("设置已重置"),location.reload())}).end().find(".pd_cfg_nav > a:first-child").click(function(e){e.preventDefault();var t=prompt("可清除与助手有关的Cookies和本地临时数据（不包括助手设置和日志）\n请填写清除类型，0：全部清除；1：清除Cookies；2：清除本地临时数据",0);null!==t&&(t=parseInt($.trim(t)),!isNaN(t)&&t>=0&&(clearTmpData(t),alert("缓存已清除")))}).next("a").click(function(e){e.preventDefault(),showRunCommandDialog()}).next("a").click(function(e){e.preventDefault(),(0,_LogDialog.show)()}).next("a").click(function(e){e.preventDefault(),showImportOrExportSettingDialog()}),t.on("click",'a[id^="pd_cfg_"][href="#"]',function(e){e.preventDefault(),$(this).hasClass("pd_disabled_link")||("pd_cfg_custom_sm_color_dialog"===this.id?showCustomSmColorDialog():"pd_cfg_user_memo_dialog"===this.id?showUserMemoDialog():"pd_cfg_custom_css_dialog"===this.id?showCustomCssDialog():"pd_cfg_custom_script_dialog"===this.id?showCustomScriptDialog():"pd_cfg_follow_user_dialog"===this.id?showFollowUserDialog():"pd_cfg_block_user_dialog"===this.id?showBlockUserDialog():"pd_cfg_block_thread_dialog"===this.id&&showBlockThreadDialog())}).end().find("#pd_cfg_custom_my_sm_color_select").change(function(){$("#pd_cfg_custom_my_sm_color").val($(this).val().toString().toUpperCase())}).end().find("pd_cfg_custom_my_sm_color").keyup(function(){var e=$.trim($(this).val());/^#[0-9a-fA-F]{6}$/.test(e)&&$("pd_cfg_custom_my_sm_color_select").val(e.toUpperCase())}),setValue(),t.submit(function(e){e.preventDefault(),$(".pd_cfg_btns > button:first").click()}).end().find(".pd_cfg_btns > button:first").click(function(e){if(e.preventDefault(),verify()){var t=Config.autoRefreshEnabled;(0,_Config.read)();var n=getValue();n=(0,_Config.normalize)(n),$.extend(Config,n),(0,_Config.write)();var a=$("#pd_cfg_storage_type").val();if(a!==_Info2.default.storageType)return(0,_Config.changeStorageType)(a),alert("存储类型已修改"),Dialog.close("pd_config"),void location.reload();Dialog.close("pd_config"),t!==n.autoRefreshEnabled&&confirm("你已修改了定时模式的设置，需要刷新页面才能生效，是否立即刷新？")&&location.reload()}}),Dialog.show("pd_config"),t.find("a:first").focus(),(0,_Func.run)("ConfigDialog.show_after_")}},setValue=function(){$("#pd_cfg_auto_refresh_enabled").prop("checked",Config.autoRefreshEnabled),$("#pd_cfg_show_refresh_mode_tips_type").val(Config.showRefreshModeTipsType.toLowerCase()),$("#pd_cfg_auto_donation_enabled").prop("checked",Config.autoDonationEnabled),$("#pd_cfg_donation_kfb").val(Config.donationKfb),$("#pd_cfg_donation_after_time").val(Config.donationAfterTime),$("#pd_cfg_at_tips_handle_type").val(Config.atTipsHandleType.toLowerCase()),$("#pd_cfg_sm_level_up_alert_enabled").prop("checked",Config.smLevelUpAlertEnabled),$("#pd_cfg_fixed_deposit_due_alert_enabled").prop("checked",Config.fixedDepositDueAlertEnabled),$("#pd_cfg_sm_rank_change_alert_enabled").prop("checked",Config.smRankChangeAlertEnabled),$("#pd_cfg_home_page_thread_fast_goto_link_enabled").prop("checked",Config.homePageThreadFastGotoLinkEnabled),$("#pd_cfg_show_vip_surplus_time_enabled").prop("checked",Config.showVipSurplusTimeEnabled),$("#pd_cfg_show_fast_goto_thread_page_enabled").prop("checked",Config.showFastGotoThreadPageEnabled),$("#pd_cfg_max_fast_goto_thread_page_num").val(Config.maxFastGotoThreadPageNum),$("#pd_cfg_highlight_new_post_enabled").prop("checked",Config.highlightNewPostEnabled),$("#pd_cfg_per_page_floor_num").val(Config.perPageFloorNum),$("#pd_cfg_thread_content_font_size").val(Config.threadContentFontSize>0?Config.threadContentFontSize:""),$("#pd_cfg_adjust_thread_content_width_enabled").prop("checked",Config.adjustThreadContentWidthEnabled),$("#pd_cfg_turn_page_via_keyboard_enabled").prop("checked",Config.turnPageViaKeyboardEnabled),$("#pd_cfg_auto_change_sm_color_enabled_2").prop("checked",Config.autoChangeSMColorEnabled),$("#pd_cfg_custom_my_sm_color").val(Config.customMySmColor),Config.customMySmColor&&$("#pd_cfg_custom_my_sm_color_select").val(Config.customMySmColor),$("#pd_cfg_custom_sm_color_enabled").prop("checked",Config.customSmColorEnabled),$("#pd_cfg_modify_kf_other_domain_enabled").prop("checked",Config.modifyKFOtherDomainEnabled),$("#pd_cfg_multi_quote_enabled").prop("checked",Config.multiQuoteEnabled),$("#pd_cfg_batch_buy_thread_enabled").prop("checked",Config.batchBuyThreadEnabled),$("#pd_cfg_user_memo_enabled").prop("checked",Config.userMemoEnabled),$("#pd_cfg_parse_media_tag_enabled").prop("checked",Config.parseMediaTagEnabled),$("#pd_cfg_show_self_rating_link_enabled").prop("checked",Config.showSelfRatingLinkEnabled),$("#pd_cfg_buy_thread_via_ajax_enabled").prop("checked",Config.buyThreadViaAjaxEnabled),$("#pd_cfg_def_show_msg_duration").val(Config.defShowMsgDuration),$("#pd_cfg_animation_effect_off_enabled").prop("checked",Config.animationEffectOffEnabled),$("#pd_cfg_log_save_days").val(Config.logSaveDays),$("#pd_cfg_browse_type").val(Config.browseType),$("#pd_cfg_show_log_link_enabled").prop("checked",Config.showLogLinkEnabled),$("#pd_cfg_show_search_link_enabled").prop("checked",Config.showSearchLinkEnabled),$("#pd_cfg_add_side_bar_fast_nav_enabled").prop("checked",Config.addSideBarFastNavEnabled),$("#pd_cfg_modify_side_bar_enabled").prop("checked",Config.modifySideBarEnabled),$("#pd_cfg_custom_css_enabled").prop("checked",Config.customCssEnabled),$("#pd_cfg_custom_script_enabled").prop("checked",Config.customScriptEnabled),$("#pd_cfg_follow_user_enabled").prop("checked",Config.followUserEnabled),$("#pd_cfg_block_user_enabled").prop("checked",Config.blockUserEnabled),$("#pd_cfg_block_thread_enabled").prop("checked",Config.blockThreadEnabled),$("#pd_cfg_auto_save_current_deposit_enabled").prop("checked",Config.autoSaveCurrentDepositEnabled),Config.saveCurrentDepositAfterKfb>0&&$("#pd_cfg_save_current_deposit_after_kfb").val(Config.saveCurrentDepositAfterKfb),Config.saveCurrentDepositKfb>0&&$("#pd_cfg_save_current_deposit_kfb").val(Config.saveCurrentDepositKfb),$("#pd_cfg_storage_type").val(_Info2.default.storageType),"undefined"==typeof GM_getValue&&$("#pd_cfg_storage_type > option:gt(0)").prop("disabled",!0)},getValue=function(){var e={};return e.autoRefreshEnabled=$("#pd_cfg_auto_refresh_enabled").prop("checked"),e.showRefreshModeTipsType=$("#pd_cfg_show_refresh_mode_tips_type").val(),e.autoDonationEnabled=$("#pd_cfg_auto_donation_enabled").prop("checked"),e.donationKfb=$.trim($("#pd_cfg_donation_kfb").val()),e.donationAfterTime=$("#pd_cfg_donation_after_time").val(),e.atTipsHandleType=$("#pd_cfg_at_tips_handle_type").val(),e.smLevelUpAlertEnabled=$("#pd_cfg_sm_level_up_alert_enabled").prop("checked"),e.fixedDepositDueAlertEnabled=$("#pd_cfg_fixed_deposit_due_alert_enabled").prop("checked"),e.smRankChangeAlertEnabled=$("#pd_cfg_sm_rank_change_alert_enabled").prop("checked"),e.homePageThreadFastGotoLinkEnabled=$("#pd_cfg_home_page_thread_fast_goto_link_enabled").prop("checked"),e.showVipSurplusTimeEnabled=$("#pd_cfg_show_vip_surplus_time_enabled").prop("checked"),e.showFastGotoThreadPageEnabled=$("#pd_cfg_show_fast_goto_thread_page_enabled").prop("checked"),e.maxFastGotoThreadPageNum=parseInt($.trim($("#pd_cfg_max_fast_goto_thread_page_num").val())),e.highlightNewPostEnabled=$("#pd_cfg_highlight_new_post_enabled").prop("checked"),e.perPageFloorNum=$("#pd_cfg_per_page_floor_num").val(),e.threadContentFontSize=parseInt($.trim($("#pd_cfg_thread_content_font_size").val())),e.adjustThreadContentWidthEnabled=$("#pd_cfg_adjust_thread_content_width_enabled").prop("checked"),e.turnPageViaKeyboardEnabled=$("#pd_cfg_turn_page_via_keyboard_enabled").prop("checked"),e.autoChangeSMColorEnabled=$("#pd_cfg_auto_change_sm_color_enabled_2").prop("checked"),e.customMySmColor=$.trim($("#pd_cfg_custom_my_sm_color").val()).toUpperCase(),e.customSmColorEnabled=$("#pd_cfg_custom_sm_color_enabled").prop("checked"),e.modifyKFOtherDomainEnabled=$("#pd_cfg_modify_kf_other_domain_enabled").prop("checked"),e.multiQuoteEnabled=$("#pd_cfg_multi_quote_enabled").prop("checked"),e.batchBuyThreadEnabled=$("#pd_cfg_batch_buy_thread_enabled").prop("checked"),e.userMemoEnabled=$("#pd_cfg_user_memo_enabled").prop("checked"),e.parseMediaTagEnabled=$("#pd_cfg_parse_media_tag_enabled").prop("checked"),e.showSelfRatingLinkEnabled=$("#pd_cfg_show_self_rating_link_enabled").prop("checked"),e.buyThreadViaAjaxEnabled=$("#pd_cfg_buy_thread_via_ajax_enabled").prop("checked"),e.defShowMsgDuration=parseInt($.trim($("#pd_cfg_def_show_msg_duration").val())),e.animationEffectOffEnabled=$("#pd_cfg_animation_effect_off_enabled").prop("checked"),e.logSaveDays=parseInt($.trim($("#pd_cfg_log_save_days").val())),e.browseType=$("#pd_cfg_browse_type").val(),e.showLogLinkEnabled=$("#pd_cfg_show_log_link_enabled").prop("checked"),e.showSearchLinkEnabled=$("#pd_cfg_show_search_link_enabled").prop("checked"),e.addSideBarFastNavEnabled=$("#pd_cfg_add_side_bar_fast_nav_enabled").prop("checked"),e.modifySideBarEnabled=$("#pd_cfg_modify_side_bar_enabled").prop("checked"),e.customCssEnabled=$("#pd_cfg_custom_css_enabled").prop("checked"),e.customScriptEnabled=$("#pd_cfg_custom_script_enabled").prop("checked"),e.followUserEnabled=$("#pd_cfg_follow_user_enabled").prop("checked"),e.blockUserEnabled=$("#pd_cfg_block_user_enabled").prop("checked"),e.blockThreadEnabled=$("#pd_cfg_block_thread_enabled").prop("checked"),e.autoSaveCurrentDepositEnabled=$("#pd_cfg_auto_save_current_deposit_enabled").prop("checked"),e.saveCurrentDepositAfterKfb=parseInt($.trim($("#pd_cfg_save_current_deposit_after_kfb").val())),e.saveCurrentDepositKfb=parseInt($.trim($("#pd_cfg_save_current_deposit_kfb").val())),e},verify=function(){var e=$("#pd_cfg_donation_kfb"),t=$.trim(e.val());if(/%$/.test(t)){if(!/^1?\d?\d%$/.test(t))return alert("KFB捐款额度格式不正确"),e.select(),e.focus(),!1;if(parseInt(t)<=0||parseInt(t)>100)return alert("KFB捐款额度百分比的取值范围在1-100之间"),e.select(),e.focus(),!1}else{if(!$.isNumeric(t))return alert("KFB捐款额度格式不正确"),e.select(),e.focus(),!1;if(parseInt(t)<=0||parseInt(t)>_Const2.default.maxDonationKfb)return alert("KFB捐款额度的取值范围在1-{0}之间".replace("{0}",_Const2.default.maxDonationKfb)),e.select(),e.focus(),!1}var n=$("#pd_cfg_donation_after_time"),a=$.trim(n.val());if(!/^(2[0-3]|[0-1][0-9]):[0-5][0-9]:[0-5][0-9]$/.test(a))return alert("在指定时间之后捐款格式不正确"),n.select(),n.focus(),!1;var i=$("#pd_cfg_max_fast_goto_thread_page_num"),o=$.trim(i.val());if(!$.isNumeric(o)||parseInt(o)<=0)return alert("页数链接最大数量格式不正确"),i.select(),i.focus(),!1;var r=$("#pd_cfg_thread_content_font_size"),l=$.trim(r.val());if(l&&(isNaN(parseInt(l))||parseInt(l)<0))return alert("帖子内容字体大小格式不正确"),r.select(),r.focus(),!1;var d=$("#pd_cfg_custom_my_sm_color"),s=$.trim(d.val());if(s&&!/^#[0-9a-fA-F]{6}$/.test(s))return alert("自定义本人的神秘颜色格式不正确，例：#009CFF"),d.select(),d.focus(),!1;var p=$("#pd_cfg_def_show_msg_duration"),c=$.trim(p.val());if(!$.isNumeric(c)||parseInt(c)<-1)return alert("默认的消息显示时间格式不正确"),p.select(),p.focus(),!1;var f=$("#pd_cfg_log_save_days"),u=$.trim(f.val());if(!$.isNumeric(u)||parseInt(u)<1)return alert("日志保存天数格式不正确"),f.select(),f.focus(),!1;var _=$("#pd_cfg_save_current_deposit_after_kfb"),g=$("#pd_cfg_save_current_deposit_kfb"),h=parseInt(_.val()),m=parseInt(g.val());if(h||m){if(!h||h<=0)return alert("自动活期存款满足额度格式不正确"),_.select(),_.focus(),!1;if(!m||m<=0||m>h)return alert("想要存款的金额格式不正确"),g.select(),g.focus(),!1}return!0},clearTmpData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e||1===e)for(var t in _Const2.default)/CookieName$/.test(t)&&Util.deleteCookie(_Const2.default[t]);0!==e&&2!==e||(TmpLog.clear(),localStorage.removeItem(_Const2.default.multiQuoteStorageName))},showRunCommandDialog=function showRunCommandDialog(){if(!($("#pd_run_command").length>0)){Dialog.close("pd_config");var html='\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">运行命令快捷键：<b>Ctrl+Enter</b>；清除命令快捷键：<b>Ctrl+退格键</b><br>\n按<b>F12键</b>可打开浏览器控制台查看消息（需切换至控制台或Console标签）</div>\n  <textarea wrap="off" style="width: 750px; height: 300px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button>运行</button><button>清除</button><button>关闭</button>\n</div>',$dialog=Dialog.create("pd_run_command","运行命令",html),$textArea=$dialog.find("textarea");$dialog.find(".pd_cfg_btns > button:first").click(function(e){e.preventDefault();var content=$textArea.val();if(content)try{console.log(eval(content))}catch(e){console.log(e)}}).next("button").click(function(e){e.preventDefault(),$textArea.val("").focus()}).next("button").click(function(){return Dialog.close("pd_run_command")}),Dialog.show("pd_run_command"),$textArea.keyup(function(e){e.ctrlKey&&13===e.keyCode?$dialog.find(".pd_cfg_btns > button:first").click():e.ctrlKey&&8===e.keyCode&&$dialog.find(".pd_cfg_btns > button:eq(1)").click()}).focus()}},showImportOrExportSettingDialog=function(){if(!($("#pd_im_or_ex_setting").length>0)){(0,_Config.read)();var e='\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到文本文件里即可\n  </div>\n  <textarea id="pd_cfg_setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button>保存</button><button>取消</button>\n</div>',t=Dialog.create("pd_im_or_ex_setting","导入或导出设置",e);t.find(".pd_cfg_btns > button:first").click(function(e){
if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim($("#pd_cfg_setting").val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("设置有错误")}if(!t||"object"!==$.type(t))return void alert("设置有错误");t=(0,_Config.normalize)(t),_Info2.default.w.Config=$.extend(!0,{},_Config.Config,t),(0,_Config.write)(),alert("设置已导入"),location.reload()}}}).next("button").click(function(){return Dialog.close("pd_im_or_ex_setting")}),Dialog.show("pd_im_or_ex_setting"),$("#pd_cfg_setting").val(JSON.stringify(Util.getDifferenceSetOfObject(_Config.Config,Config))).select()}},showCustomSmColorDialog=function(){if(!($("#pd_custom_sm_color").length>0)){var e='\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    <strong>\n      示例（<a target="_blank" href="http://www.35ui.cn/jsnote/peise.html">常用配色表</a> /\n      <a target="_blank" href="read.php?tid=488016">其他人分享的配色方案</a>）：\n    </strong><br>\n    <b>等级范围：</b>4-4 <b>颜色：</b><span style="color: #0000ff;">#0000ff</span><br>\n    <b>等级范围：</b>10-99 <b>颜色：</b><span style="color: #5ad465;">#5ad465</span><br>\n    <b>等级范围：</b>5000-MAX <b>颜色：</b><span style="color: #ff0000;">#ff0000</span>\n  </div>\n  <ul id="pd_cfg_custom_sm_color_list"></ul>\n  <div style="margin-top: 5px;" id="pd_cfg_custom_sm_color_add_btns">\n    <a href="#">增加1个</a><a href="#" style="margin-left: 7px;">增加5个</a><a href="#" style="margin-left: 7px;">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a href="#">导入/导出配色方案</a></span>\n  <button>确定</button><button>取消</button>\n</div>',t=Dialog.create("pd_custom_sm_color","自定义各等级神秘颜色",e),n=t.find("#pd_cfg_custom_sm_color_list");t.find(".pd_cfg_btns > button:last").click(function(){return Dialog.close("pd_custom_sm_color")}),n.on("keyup",".pd_cfg_sm_color",function(){var e=$(this),t=$.trim(e.val());/^#[0-9a-fA-F]{6}$/.test(t)&&e.next('input[type="color"]').val(t.toLowerCase())}).on("change",'input[type="color"]',function(){var e=$(this);e.prev("input").val(e.val().toString().toLowerCase())}).on("click","a",function(e){e.preventDefault(),$(this).closest("li").remove()});var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.min,n=void 0===t?"":t,a=e.max,i=void 0===a?"":a,o=e.color,r=void 0===o?"":o;return'\n<li>\n  <label>等级范围<input class="pd_cfg_sm_min" type="text" maxlength="5" style="width: 30px;" value="'+n+'"></label>\n  <label>-<input class="pd_cfg_sm_max" type="text" maxlength="5" style="width: 30px;" value="'+i+'"></label>\n  <label>颜色<input class="pd_cfg_sm_color" type="text" maxlength="7" style="width: 50px;" value="'+r+'">\n  <input style="margin-left: 0;" type="color" value="'+r+'"></label>\n  <a href="#">删除</a>\n</li>'};t.find("#pd_cfg_custom_sm_color_add_btns").find("a:lt(2)").click(function(e){e.preventDefault();var t=1;$(this).is("#pd_cfg_custom_sm_color_add_btns > a:eq(1)")&&(t=5);for(var i=1;i<=t;i++)n.append(a());Dialog.show("pd_custom_sm_color")}).end().find("a:last").click(function(e){e.preventDefault(),confirm("是否清除所有设置？")&&(n.empty(),Dialog.show("pd_custom_sm_color"))}),t.find(".pd_cfg_about > a").click(function(e){e.preventDefault(),showImportOrExportSmColorConfigDialog()});var i="",o=!0,r=!1,l=void 0;try{for(var d,s=Config.customSmColorConfigList[Symbol.iterator]();!(o=(d=s.next()).done);o=!0){var p=d.value;i+=a(p)}}catch(e){r=!0,l=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw l}}n.html(i),t.submit(function(e){e.preventDefault();var t=[],a=!0;n.find("li").each(function(){var e=$(this),n=e.find(".pd_cfg_sm_min"),i=$.trim(n.val()).toUpperCase();if(""!==i){if(!/^(-?\d+|MAX)$/i.test(i))return a=!1,n.select(),n.focus(),alert("等级范围格式不正确"),!1;var o=e.find(".pd_cfg_sm_max"),r=$.trim(o.val()).toUpperCase();if(""!==r){if(!/^(-?\d+|MAX)$/i.test(r))return a=!1,o.select(),o.focus(),alert("等级范围格式不正确"),!1;if(Util.compareSmLevel(r,i)<0)return a=!1,n.select(),n.focus(),alert("等级范围格式不正确"),!1;var l=e.find(".pd_cfg_sm_color"),d=$.trim(l.val()).toLowerCase();if(""!==d)return/^#[0-9a-fA-F]{6}$/.test(d)?void t.push({min:i,max:r,color:d}):(a=!1,l.select(),l.focus(),alert("颜色格式不正确"),!1)}}}),a&&(t.sort(function(e,t){return Util.compareSmLevel(e.min,t.min)>0}),Config.customSmColorConfigList=t,(0,_Config.write)(),Dialog.close("pd_custom_sm_color"))}),Dialog.show("pd_custom_sm_color"),n.find("input").length>0?n.find("input:first").focus():$("#pd_cfg_custom_sm_color_add_btns > a:first").focus()}},showImportOrExportSmColorConfigDialog=function(){if(!($("#pd_im_or_ex_sm_color_config").length>0)){(0,_Config.read)();var e='\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入配色方案：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出配色方案：</strong>复制文本框里的内容并粘贴到文本文件里即可\n  </div>\n  <textarea id="pd_cfg_sm_color_config" style="width: 420px; height: 200px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a target="_blank" href="read.php?tid=488016">其他人分享的配色方案</a></span>\n  <button>保存</button><button>取消</button>\n</div>',t=Dialog.create("pd_im_or_ex_sm_color_config","导入或导出配色方案",e);t.find(".pd_cfg_btns > button:first").click(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim($("#pd_cfg_sm_color_config").val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("配色方案有错误")}if(!t||!Array.isArray(t))return void alert("配色方案有错误");Config.customSmColorConfigList=t,(0,_Config.write)(),alert("配色方案已导入"),location.reload()}}}).next("button").click(function(){return Dialog.close("pd_im_or_ex_sm_color_config")}),Dialog.show("pd_im_or_ex_sm_color_config"),t.find("#pd_cfg_sm_color_config").val(JSON.stringify(Config.customSmColorConfigList)).select()}},showCustomCssDialog=function(){if(!($("#pd_custom_css").length>0)){var e='\n<div class="pd_cfg_main">\n  <strong>自定义CSS内容：</strong><br>\n  <textarea wrap="off" style="width: 750px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a target="_blank" href="read.php?tid=500969">其他人分享的CSS规则</a></span>\n  <button>确定</button><button>取消</button>\n</div>\';',t=Dialog.create("pd_custom_css","自定义CSS",e),n=t.find("textarea");t.find(".pd_cfg_btns > button:first").click(function(e){e.preventDefault(),Config.customCssContent=$.trim(n.val()),(0,_Config.write)(),Dialog.close("pd_custom_css")}).next("button").click(function(){return Dialog.close("pd_custom_css")}),n.val(Config.customCssContent),Dialog.show("pd_custom_css"),n.focus()}},showCustomScriptDialog=function(){if(!($("#pd_custom_script").length>0)){var e='\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">\n    <label style="color: #f00;"><input type="radio" name="pd_custom_script_type" value="start" checked> 在脚本开始时执行的内容</label>\n    <label style="color: #00f;"><input type="radio" name="pd_custom_script_type" value="end"> 在脚本结束时执行的内容</label>\n  </div>\n  <textarea wrap="off" id="pd_custom_script_start_content" style="width: 750px; height: 500px; white-space: pre;"></textarea>\n  <textarea wrap="off" id="pd_custom_script_end_content" style="width: 750px; height: 500px; white-space: pre; display: none;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a target="_blank" href="read.php?tid=500968">其他人分享的自定义脚本</a></span>\n  <button>确定</button><button>取消</button>\n</div>',t=Dialog.create("pd_custom_script","自定义脚本",e);t.find(".pd_cfg_btns > button:first").click(function(e){e.preventDefault(),Config.customScriptStartContent=$("#pd_custom_script_start_content").val(),Config.customScriptEndContent=$("#pd_custom_script_end_content").val(),(0,_Config.write)(),Dialog.close("pd_custom_script")}).next("button").click(function(){return Dialog.close("pd_custom_script")}),t.find("#pd_custom_script_start_content").val(Config.customScriptStartContent).end().find("#pd_custom_script_end_content").val(Config.customScriptEndContent).end().find('input[name="pd_custom_script_type"]').click(function(){var e=$(this).val();$("#pd_custom_script_"+("end"===e?"start":"end")+"_content").hide(),$("#pd_custom_script_"+("end"===e?"end":"start")+"_content").show()}),Dialog.show("pd_custom_script"),t.find("#pd_custom_script_start_content").focus()}},showUserMemoDialog=function(){if(!($("#pd_user_memo").length>0)){var e='\n<div class="pd_cfg_main">\n  按照“用户名:备注”的格式（注意是英文冒号），每行一个<br>\n  <textarea wrap="off" style="width: 320px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button>确定</button><button>取消</button>\n</div>',t=Dialog.create("pd_user_memo","用户备注",e),n=t.find("textarea");t.find(".pd_cfg_btns > button:first").click(function(e){e.preventDefault();var t=$.trim(n.val());Config.userMemoList={};var a=!0,i=!1,o=void 0;try{for(var r,l=t.split("\n")[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var d=r.value;if(d=$.trim(d)){if(!/.+?:.+/.test(d))return alert("用户备注格式不正确"),void n.focus();var s=d.split(":"),p=_slicedToArray(s,2),c=p[0],f=p[1],u=void 0===f?"":f;u&&(Config.userMemoList[c.trim()]=u.trim())}}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}(0,_Config.write)(),Dialog.close("pd_user_memo")}).next("button").click(function(){return Dialog.close("pd_user_memo")});var a="",i=!0,o=!1,r=void 0;try{for(var l,d=Util.entries(Config.userMemoList)[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var s=_slicedToArray(l.value,2),p=s[0],c=s[1];a+=p+":"+c+"\n"}}catch(e){o=!0,r=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw r}}n.val(a),Dialog.show("pd_user_memo"),n.focus()}},showFollowUserDialog=function(){if(!($("#pd_follow_user").length>0)){var e='\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label><input id="pd_cfg_highlight_follow_user_thread_in_hp_enabled" type="checkbox">高亮所关注用户的首页帖子链接 \n<span class="pd_cfg_tips" title="高亮所关注用户在首页下的帖子链接">[?]</span></label><br>\n    <label><input id="pd_cfg_highlight_follow_user_thread_link_enabled" type="checkbox">高亮所关注用户的帖子链接 \n<span class="pd_cfg_tips" title="高亮所关注用户在版块页面下的帖子链接">[?]</span></label><br>\n  </div>\n  <ul id="pd_cfg_follow_user_list" style="margin-top: 5px; width: 274px; line-height: 24px;"></ul>\n  <div id="pd_cfg_follow_user_btns" style="margin-top: 5px;">\n    <div style="display: inline-block;"><a href="#">全选</a><a style="margin-left: 7px;" href="#">反选</a></div>\n    <div style="float: right;"><a style="margin-left: 7px;" href="#">删除</a></div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input id="pd_cfg_add_follow_user" style="width: 200px;" type="text">\n    <a style="margin-left: 7px;" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a href="#">导入/导出关注用户</a></span>\n  <button>确定</button><button>取消</button>\n</div>',t=Dialog.create("pd_follow_user","关注用户",e),n=t.find("#pd_cfg_follow_user_list");t.submit(function(e){e.preventDefault(),t.find(".pd_cfg_btns > button:first").click()}).find(".pd_cfg_btns > button:first").click(function(e){e.preventDefault(),Config.highlightFollowUserThreadInHPEnabled=$("#pd_cfg_highlight_follow_user_thread_in_hp_enabled").prop("checked"),Config.highlightFollowUserThreadLinkEnabled=$("#pd_cfg_highlight_follow_user_thread_link_enabled").prop("checked"),Config.followUserList=[],n.find("li").each(function(){var e=$(this),t=$.trim(e.find('[type="text"]').val());""!==t&&Util.inFollowOrBlockUserList(t,Config.followUserList)===-1&&Config.followUserList.push({name:t})}),(0,_Config.write)(),Dialog.close("pd_follow_user")}).end().find(".pd_cfg_btns > button:last").click(function(){return Dialog.close("pd_follow_user")}),$("#pd_cfg_highlight_follow_user_thread_in_hp_enabled").prop("checked",Config.highlightFollowUserThreadInHPEnabled),$("#pd_cfg_highlight_follow_user_thread_link_enabled").prop("checked",Config.highlightFollowUserThreadLinkEnabled);var a=function(e){$('<li><input type="checkbox"><input type="text" style="width: 178px; margin-left: 5px;" maxlength="15" value="'+e+'"><a style="margin-left: 7px;" href="#">删除</a></li>').appendTo(n)},i=!0,o=!1,r=void 0;try{for(var l,d=Config.followUserList[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var s=l.value;a(s.name)}}catch(e){o=!0,r=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw r}}n.on("click","a",function(e){e.preventDefault(),$(this).parent().remove()}),$("#pd_cfg_follow_user_btns").find("a:first").click(function(e){e.preventDefault(),n.find('input[type="checkbox"]').prop("checked",!0)}).end().find("a:eq(1)").click(function(e){e.preventDefault(),n.find('input[type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))})}).end().find("a:last").click(function(e){e.preventDefault();var t=n.find('li:has(input[type="checkbox"]:checked)');t.length&&confirm("是否删除所选用户？")&&(t.remove(),Dialog.show("pd_follow_user"))}),t.find("#pd_cfg_add_follow_user").keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).next("a").click(function(e){e.preventDefault();var t=!0,n=!1,i=void 0;try{for(var o,r=$.trim($("#pd_cfg_add_follow_user").val()).split(",")[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var l=o.value;l=$.trim(l),l&&Util.inFollowOrBlockUserList(l,Config.followUserList)===-1&&a(l)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}$("#pd_cfg_add_follow_user").val(""),Dialog.show("pd_follow_user")}),t.find(".pd_cfg_about > a").click(function(e){e.preventDefault(),showCommonImportOrExportConfigDialog(1)}),Dialog.show("pd_follow_user"),$("#pd_cfg_highlight_follow_user_thread_in_hp_enabled").focus()}},showBlockUserDialog=function(){if(!($("#pd_block_user").length>0)){var e='\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px; line-height: 24px;">\n    <label>默认屏蔽类型\n      <select id="pd_cfg_block_user_default_type">\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n    </label>\n    <label class="pd_cfg_ml">\n      <input id="pd_cfg_block_user_at_tips_enabled" type="checkbox">屏蔽@提醒 <span class="pd_cfg_tips" title="屏蔽被屏蔽用户的@提醒">[?]</span>\n    </label><br>\n    <label>版块屏蔽范围\n      <select id="pd_cfg_block_user_forum_type">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label><br>\n    <label>版块ID列表\n      <input id="pd_cfg_block_user_fid_list" type="text" style="width: 220px;"> \n      <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span>\n    </label>\n  </div>\n  <ul id="pd_cfg_block_user_list" style="margin-top: 5px; width: 362px; line-height: 24px;"></ul>\n  <div id="pd_cfg_block_user_btns" style="margin-top: 5px;">\n    <div style="display: inline-block;"><a href="#">全选</a><a style="margin-left: 7px;" href="#">反选</a></div>\n    <div style="float: right;">\n      <a href="#">修改为</a>\n      <select style="margin-left: 7px;">\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n      <a style="margin-left: 7px;" href="#">删除</a>\n    </div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input id="pd_cfg_add_block_user" style="width: 200px;" type="text">\n    <a style="margin-left: 7px;" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a href="#">导入/导出屏蔽用户</a></span>\n  <button>确定</button><button>取消</button>\n</div>',t=Dialog.create("pd_block_user","屏蔽用户",e),n=t.find("#pd_cfg_block_user_list");t.submit(function(e){e.preventDefault(),t.find(".pd_cfg_btns > button:first").click()}).find(".pd_cfg_btns > button:first").click(function(e){e.preventDefault(),Config.blockUserDefaultType=$("#pd_cfg_block_user_default_type").val(),Config.blockUserAtTipsEnabled=$("#pd_cfg_block_user_at_tips_enabled").prop("checked"),Config.blockUserForumType=parseInt($("#pd_cfg_block_user_forum_type").val()),Config.blockUserFidList=[];var t=!0,a=!1,i=void 0;try{for(var o,r=$.trim($("#pd_cfg_block_user_fid_list").val()).split(",")[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var l=o.value;l=parseInt(l),!isNaN(l)&&l>0&&Config.blockUserFidList.push(l)}}catch(e){a=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(a)throw i}}Config.blockUserList=[],n.find("li").each(function(){var e=$(this),t=$.trim(e.find('input[type="text"]').val());if(""!==t&&Util.inFollowOrBlockUserList(t,Config.blockUserList)===-1){var n=parseInt(e.find("select").val());Config.blockUserList.push({name:t,type:n})}}),(0,_Config.write)(),Dialog.close("pd_block_user")}).end().find(".pd_cfg_btns > button:last").click(function(){return Dialog.close("pd_block_user")}),$("#pd_cfg_block_user_default_type").val(Config.blockUserDefaultType),$("#pd_cfg_block_user_at_tips_enabled").prop("checked",Config.blockUserAtTipsEnabled),$("#pd_cfg_block_user_forum_type").val(Config.blockUserForumType),$("#pd_cfg_block_user_fid_list").val(Config.blockUserFidList.join(","));var a=function(e,t){$('\n<li>\n  <input type="checkbox">\n  <input type="text" style="width: 150px; margin-left: 5px;" maxlength="15" value="'+e+'">\n  <select style="margin-left: 5px;">\n    <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n  </select>\n  <a style="margin-left: 7px;" href="#">删除</a>\n</li>').appendTo(n).find("select").val(t)},i=!0,o=!1,r=void 0;try{for(var l,d=Config.blockUserList[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var s=l.value;a(s.name,s.type)}}catch(e){o=!0,r=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw r}}n.on("click","a",function(e){e.preventDefault(),$(this).parent().remove()}),$("#pd_cfg_block_user_btns").find("a:first").click(function(e){e.preventDefault(),n.find('input[type="checkbox"]').prop("checked",!0)}).end().find("a:eq(1)").click(function(e){e.preventDefault(),n.find('input[type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))})}).end().find("a:eq(2)").click(function(e){e.preventDefault();var t=$(this).next("select").val();n.find('li:has(input[type="checkbox"]:checked) > select').val(t)}).end().find("a:last").click(function(e){e.preventDefault();var t=n.find('li:has(input[type="checkbox"]:checked)');t.length&&confirm("是否删除所选用户？")&&(t.remove(),Dialog.show("pd_block_user"))}),t.find("#pd_cfg_add_block_user").keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).next("a").click(function(e){e.preventDefault();var t=parseInt($("#pd_cfg_block_user_default_type").val()),n=!0,i=!1,o=void 0;try{for(var r,l=$.trim($("#pd_cfg_add_block_user").val()).split(",")[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var d=r.value;d=$.trim(d),d&&Util.inFollowOrBlockUserList(d,Config.blockUserList)===-1&&a(d,t)}}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}$("#pd_cfg_add_block_user").val(""),Dialog.show("pd_block_user")}),t.find("#pd_cfg_block_user_forum_type").change(function(){$("#pd_cfg_block_user_fid_list").prop("disabled",0===parseInt($(this).val()))}).end().find(".pd_cfg_about > a").click(function(e){e.preventDefault(),showCommonImportOrExportConfigDialog(2)}),Dialog.show("pd_block_user"),$("#pd_cfg_block_user_forum_type").triggerHandler("change"),$("#pd_cfg_block_user_default_type").focus()}},showBlockThreadDialog=function showBlockThreadDialog(){if(!($("#pd_block_thread").length>0)){var html='\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    标题关键字可使用普通字符串或正则表达式，正则表达式请使用/abc/的格式，例：/关键字A.*关键字B/i<br>\n    用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\n    <label>默认版块屏蔽范围\n      <select id="pd_cfg_block_thread_def_forum_type">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label>\n    <label style="margin-left: 5px;">默认版块ID列表<input id="pd_cfg_block_thread_def_fid_list" type="text" style="width: 150px;"></label>\n  </div>\n  <table id="pd_cfg_block_thread_list" style="line-height: 22px; text-align: center;">\n    <tbody>\n      <tr>\n        <th style="width: 220px;">标题关键字(必填)</th>\n        <th style="width: 62px;">屏蔽用户</th>\n        <th style="width: 200px;">用户名 <span class="pd_cfg_tips" title="多个用户名请用英文逗号分隔">[?]</span></th>\n        <th style="width: 62px;">屏蔽范围</th>\n        <th style="width: 132px;">版块ID <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span></th>\n        <th style="width: 35px;"></th>\n      </tr>\n    </tbody>\n  </table>\n  <div style="margin-top: 5px;" id="pd_cfg_block_thread_add_btns">\n    <a href="#">增加1个</a><a href="#" style="margin-left: 7px;">增加5个</a><a href="#" style="margin-left: 7px;">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a href="#">导入/导出屏蔽帖子</a></span>\n  <button>确定</button><button>取消</button>\n</div>',$dialog=Dialog.create("pd_block_thread","屏蔽帖子",html,"width: 768px;"),$blockThreadList=$dialog.find("#pd_cfg_block_thread_list"),verify=function verify(){var flag=!0;return $blockThreadList.find("tr:gt(0)").each(function(){var $this=$(this),$txtKeyWord=$this.find("td:first-child > input"),keyWord=$txtKeyWord.val();if(""!==$.trim(keyWord)&&/^\/.+\/[gimy]*$/.test(keyWord))try{eval(keyWord)}catch(e){return alert("正则表达式不正确"),$txtKeyWord.select(),$txtKeyWord.focus(),flag=!1,!1}}),flag};$dialog.submit(function(e){e.preventDefault(),$dialog.find(".pd_cfg_btns > button:first").click()}).find(".pd_cfg_btns > button:first").click(function(e){if(e.preventDefault(),verify()){Config.blockThreadDefForumType=parseInt($("#pd_cfg_block_thread_def_forum_type").val()),Config.blockThreadDefFidList=[];var t=!0,n=!1,a=void 0;try{for(var i,o=$.trim($("#pd_cfg_block_thread_def_fid_list").val()).split(",")[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var r=i.value;r=parseInt(r),!isNaN(r)&&r>0&&Config.blockThreadDefFidList.push(r)}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}Config.blockThreadList=[],$blockThreadList.find("tr:gt(0)").each(function(){var e=$(this),t=e.find("td:first-child > input").val();if(""!==$.trim(t)){var n={keyWord:t},a=parseInt(e.find("td:nth-child(2) > select").val());if(a>0){var i=[],o=!0,r=!1,l=void 0;try{for(var d,s=$.trim(e.find("td:nth-child(3) > input").val()).split(",")[Symbol.iterator]();!(o=(d=s.next()).done);o=!0){var p=d.value;p=$.trim(p),p&&i.push(p)}}catch(e){r=!0,l=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw l}}i.length>0&&(n[2===a?"excludeUser":"includeUser"]=i)}var c=parseInt(e.find("td:nth-child(4) > select").val());if(c>0){var f=[],u=!0,_=!1,g=void 0;try{for(var h,m=$.trim(e.find("td:nth-child(5) > input").val()).split(",")[Symbol.iterator]();!(u=(h=m.next()).done);u=!0){var v=h.value;v=parseInt(v),!isNaN(v)&&v>0&&f.push(v)}}catch(e){_=!0,g=e}finally{try{!u&&m.return&&m.return()}finally{if(_)throw g}}f.length>0&&(n[2===c?"excludeFid":"includeFid"]=f)}Config.blockThreadList.push(n)}}),(0,_Config.write)(),Dialog.close("pd_block_thread")}}).end().find(".pd_cfg_btns > button:last").click(function(){return Dialog.close("pd_block_thread")}),$blockThreadList.on("change","select",function(){var e=$(this);e.parent("td").next("td").find("input").prop("disabled",0===parseInt(e.val()))}).on("click","td > a",function(e){e.preventDefault(),$(this).closest("tr").remove()});var addBlockThread=function(e,t,n,a,i){$('\n<tr>\n  <td><input type="text" style="width: 208px;" value="'+e+'"></td>\n  <td><select><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input type="text" style="width: 188px;" value="'+n.join(",")+'" '+(0===t?"disabled":"")+'></td>\n  <td><select><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input type="text" style="width: 120px;" value="'+i.join(",")+'" '+(0===a?"disabled":"")+'></td>\n  <td><a href="#">删除</a></td>\n</tr>\n').appendTo($blockThreadList).find("td:nth-child(2) > select").val(t).end().find("td:nth-child(4) > select").val(a)},_iteratorNormalCompletion12=!0,_didIteratorError12=!1,_iteratorError12=void 0;try{for(var _iterator12=Config.blockThreadList[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=!0){var data=_step12.value,keyWord=data.keyWord,includeUser=data.includeUser,excludeUser=data.excludeUser,includeFid=data.includeFid,excludeFid=data.excludeFid,userType=0,userList=[];"undefined"!=typeof includeUser?(userType=1,userList=includeUser):"undefined"!=typeof excludeUser&&(userType=2,userList=excludeUser);var fidType=0,fidList=[];"undefined"!=typeof includeFid?(fidType=1,fidList=includeFid):"undefined"!=typeof excludeFid&&(fidType=2,fidList=excludeFid),addBlockThread(keyWord,userType,userList,fidType,fidList)}}catch(e){_didIteratorError12=!0,_iteratorError12=e}finally{try{!_iteratorNormalCompletion12&&_iterator12.return&&_iterator12.return()}finally{if(_didIteratorError12)throw _iteratorError12}}$("#pd_cfg_block_thread_add_btns").find("a:lt(2)").click(function(e){e.preventDefault();var t=1;$(this).is("#pd_cfg_block_thread_add_btns > a:eq(1)")&&(t=5);for(var n=1;n<=t;n++)addBlockThread("",0,[],parseInt($("#pd_cfg_block_thread_def_forum_type").val()),$.trim($("#pd_cfg_block_thread_def_fid_list").val()).split(","));Dialog.show("pd_block_thread")}).end().find("a:last").click(function(e){e.preventDefault(),confirm("是否清除所有屏蔽关键字？")&&($blockThreadList.find("tbody > tr:gt(0)").remove(),Dialog.show("pd_block_thread"))}),$dialog.find("#pd_cfg_block_thread_def_forum_type").change(function(){$("#pd_cfg_block_thread_def_fid_list").prop("disabled",0===parseInt($(this).val()))}).end().find(".pd_cfg_about > a").click(function(e){e.preventDefault(),showCommonImportOrExportConfigDialog(3)}),Dialog.show("pd_block_thread"),$("#pd_cfg_block_thread_def_forum_type").val(Config.blockThreadDefForumType).focus().triggerHandler("change"),$("#pd_cfg_block_thread_def_fid_list").val(Config.blockThreadDefFidList.join(","))}},showCommonImportOrExportConfigDialog=function(e){if(!($("#pd_common_im_or_ex_config").length>0)){(0,_Config.read)();var t='\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到文本文件里即可\n  </div>\n  <textarea id="pd_cfg_common_config" style="width: 420px; height: 200px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button>保存</button><button>取消</button>\n</div>',n="关注用户";2===e?n="屏蔽用户":3===e&&(n="屏蔽帖子");var a=Dialog.create("pd_common_im_or_ex_config","导入或导出"+n,t);a.find(".pd_cfg_btns > button:first").click(function(t){if(t.preventDefault(),confirm("是否导入文本框中的设置？")){var n=$.trim($("#pd_cfg_common_config").val());if(n){try{n=JSON.parse(n)}catch(e){return void alert("设置有错误")}if(!n||!Array.isArray(n))return void alert("设置有错误");2===e?Config.blockUserList=n:3===e?Config.blockThreadList=n:Config.followUserList=n,(0,_Config.write)(),alert("设置已导入"),location.reload()}}}).next("button").click(function(){return Dialog.close("pd_common_im_or_ex_config")}),Dialog.show("pd_common_im_or_ex_config");var i=Config.followUserList;2===e?i=Config.blockUserList:3===e&&(i=Config.blockThreadList),a.find("#pd_cfg_common_config").val(JSON.stringify(i)).select()}}},{"./Config":4,"./Const":6,"./Dialog":7,"./Func":8,"./Info":10,"./LogDialog":13,"./TmpLog":20,"./Util":21}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={debug:!1,forumTimezoneOffset:-8,maxDonationKfb:5e3,actionFinishRetryInterval:30,errorRefreshInterval:1,showRefreshModeTipsInterval:1,hideMarkReadAtTipsExpires:3,smLevelUpAlertInterval:3,smRankChangeAlertInterval:22,vipSurplusTimeExpires:60,defAjaxTimeout:3e4,defAjaxInterval:200,specialAjaxInterval:function(){return Math.floor(150*Math.random())+200},cycleUseItemsFirstAjaxInterval:function(){return Math.floor(250*Math.random())+2e3},minBuyThreadWarningSell:6,statRepliersMaxPage:300,sampleItemIdList:{"零时迷子的碎片":2257935,"被遗弃的告白信":2005272,"学校天台的钥匙":2001303,"TMA最新作压缩包":1990834,"LOLI的钱包":1836588,"棒棒糖":1942370,"蕾米莉亚同人漫画":1000888,"十六夜同人漫画":1002668,"档案室钥匙":1013984,"傲娇LOLI娇蛮音CD":4621,"整形优惠卷":1003993,"消逝之药":1000306},fixedDepositDueTime:90,ratingErrorSizePercent:3,customSideBarContent:"",customTileSideBarContent:"",selfRatingFidList:[41,67,92,127,68],multiQuoteStorageName:"pd_multi_quote",smLevelUpTmpLogName:"SmLevelUp",smRankChangeTmpLogName:"SmRankChange",fixedDepositDueTmpLogName:"FixedDepositDue",prevAutoChangeSMColorIdTmpLogName:"PrevAutoChangeSMColorId",donationCookieName:"pd_donation",hideMarkReadAtTipsCookieName:"pd_hide_mark_read_at_tips",prevReadAtTipsCookieName:"pd_prev_read_at_tips",fixedDepositDueAlertCookieName:"pd_fixed_deposit_due_alert",vipSurplusTimeCookieName:"pd_vip_surplus_time",autoChangeSMColorCookieName:"pd_auto_change_sm_color",checkOverdueLogCookieName:"pd_check_overdue_log"};n.default=a},{}],7:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.close=n.show=n.create=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),d=a(l),s=e("./Public"),p=a(s),c=(n.create=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i='\n<form>\n<div class="pd_cfg_box" id="'+e+'" style="'+a+'">\n  <h1>'+t+"<span>&times;</span></h1>\n  "+n+"\n</div>\n</form>",o=$(i).appendTo("body");return o.on("click",".pd_cfg_tips",function(e){return r.default.isMobile&&p.showElementTitleTips(e,this.title),!1}).on("click","a.pd_disabled_link",function(){return!1}).keydown(function(t){if(27===t.keyCode)return f(e)}).find("h1 > span").click(function(){return f(e)}).end().find('legend input[type="checkbox"]').click(function(){var e=$(this),t=e.prop("checked");d.isOpera()||d.isEdge()?e.closest("fieldset").find("input, select, textarea, button").not("legend input").prop("disabled",!t):e.closest("fieldset").prop("disabled",!t)}).end().find("input[data-disabled]").click(function(){var e=$(this),t=e.prop("checked");$(e.data("disabled")).each(function(){var e=$(this);e.is("a")?t?e.removeClass("pd_disabled_link"):e.addClass("pd_disabled_link"):e.prop("disabled",!t)})}),r.default.isMobile||$(window).on("resize."+e,function(){c(e)}),o},n.show=function(e){var t=$("#"+e);if(t.length){t.find(".pd_cfg_main").css("max-height",$(window).height()-80).end().find('legend input[type="checkbox"]').each(function(){$(this).triggerHandler("click")}).end().find("input[data-disabled]").each(function(){$(this).triggerHandler("click")});var n=t.width(),a=$(window).width(),i=$(window).height();r.default.isMobile&&i>1e3&&(i/=2);var o=$(window).scrollTop();o<i/2&&(o=0);var l=a/2+(r.default.isMobile?$(window).scrollLeft()/3:0)-n/2;l+n>a&&(l=a-n-20),l<0&&(l=0);var d=i/2+(r.default.isMobile?o:0)-t.height()/2;d<0&&(d=0),t.css({top:d,left:l}).fadeIn("fast")}}),f=n.close=function(e){return $("#"+e).fadeOut("fast",function(){$(this).parent("form").remove()}),r.default.isMobile||$(window).off("resize."+e),!1}},{"./Info":10,"./Public":18,"./Util":21}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=new Map;n.add=function(e,t){a.has(e)||(a[e]=[]),a[e].push(t)},n.run=function(e,t){if(a.has(e)){var n=!0,i=!1,o=void 0;try{for(var r,l=a.get(e)[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var d=r.value;if("function"==typeof d)try{d(t)}catch(e){return console.log(e),!1}}}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}return!0}return!1}},{}],9:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.addSearchTypeSelectBoxInHomePage=n.showVipSurplusTime=n.addHomePageThreadFastGotoLink=n.smRankChangeAlert=n.smLevelUpAlert=n.handleAtTips=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),d=a(l),s=e("./Msg"),p=a(s),c=e("./Const"),f=i(c),u=e("./Log"),_=e("./TmpLog"),g=a(_);
n.handleAtTips=function(){var e=Config.atTipsHandleType;if("default"!==e){var t=$('a[href^="guanjianci.php?gjc="]'),n=function(){t.removeClass("indbox5").addClass("indbox6")},a=function(){t.parent().next("div.line").addBack().remove()},i=n;if("hide_box_1"!==e&&"hide_box_2"!==e||(i=a),["no_highlight","no_highlight_extra","hide_box_1","at_change_to_cao"].includes(e)){if(t.length>0)!function(){var n=d.getCookie(f.default.hideMarkReadAtTipsCookieName),a=$.trim(t.text()),o=/\d+日\d+时\d+分/.exec(a);o&&(a=o[0]),n&&n===a?i():t.click(function(){var e=$(this);if(!e.data("disabled")){var t=d.getCookie(f.default.hideMarkReadAtTipsCookieName);if(t)t!==a&&d.setCookie(f.default.prevReadAtTipsCookieName,t);else{var n=(new Date).getDate();d.setCookie(f.default.prevReadAtTipsCookieName,(n<10?"0"+n:n)+"日00时00分")}d.setCookie(f.default.hideMarkReadAtTipsCookieName,a,d.getDate("+"+f.default.hideMarkReadAtTipsExpires+"d")),e.data("disabled",!0),i()}}),"at_change_to_cao"===e&&t.text(t.text().replace("@","艹"))}();else if(!t.length&&("no_highlight_extra"===e||"at_change_to_cao"===e)){var o='<div style="width: 300px;"><a class="indbox6" href="guanjianci.php?gjc='+r.default.userName+'" target="_blank">\n最近无人'+("at_change_to_cao"===e?"艹":"@")+'你</a><br><div class="line"></div><div class="c"></div></div><div class="line"></div>';$('a[href="kf_givemekfb.php"][title="网站虚拟货币"]').parent().before(o)}}else"hide_box_2"===e&&t.length>0&&i()}},n.smLevelUpAlert=function(){var e=/神秘(\d+)级/.exec($('a[href="kf_growup.php"]').text());if(e){var t=parseInt(e[1]),n=function(e){g.setValue(f.default.smLevelUpTmpLogName,{time:(new Date).getTime(),smLevel:e})},a=g.getValue(f.default.smLevelUpTmpLogName);if(a&&"number"===$.type(a.time)&&"number"===$.type(a.smLevel))if(t>a.smLevel){var i=Math.floor(((new Date).getTime()-a.time)/60/60/1e3);if(i>=f.default.smLevelUpAlertInterval){var o=new Date(a.time);n(t),(0,u.push)("神秘等级升级","自`"+d.getDateString(o)+"`以来，你的神秘等级共上升了`"+(t-a.smLevel)+"`级 (Lv.`"+a.smLevel+"`->Lv.`"+t+"`)"),p.show("自<em>"+d.getDateString(o)+"</em>以来，你的神秘等级共上升了<em>"+(t-a.smLevel)+"</em>级")}else i<0&&n(t)}else t<a.smLevel&&n(t);else n(t)}},n.smRankChangeAlert=function(){var e=/系数排名第\s*(\d+)\s*位/.exec($('a[href="kf_growup.php"]').text());if(e){var t=parseInt(e[1]),n=function(e){g.setValue(f.default.smRankChangeTmpLogName,{time:(new Date).getTime(),smRank:e})},a=g.getValue(f.default.smRankChangeTmpLogName);if(a&&"number"===$.type(a.time)&&"number"===$.type(a.smRank)){if(t!==a.smRank){var i=Math.floor(((new Date).getTime()-a.time)/60/60/1e3);if(i>=f.default.smRankChangeAlertInterval){var o=new Date(a.time),r=t<a.smRank;n(t),(0,u.push)("神秘系数排名变化","自`"+d.getDateString(o)+"`以来，你的神秘系数排名共`"+(r?"上升":"下降")+"`了`"+Math.abs(t-a.smRank)+"`名 "+("(No.`"+a.smRank+"`->No.`"+t+"`)")),p.show("自<em>"+d.getDateString(o)+'</em>以来，你的神秘系数排名共<b style="color: '+(r?"#F00":"#393")+'">'+(r?"上升":"下降")+"</b>了"+("<em>"+Math.abs(t-a.smRank)+"</em>名"))}else i<0&&n(t)}}else n(t)}},n.addHomePageThreadFastGotoLink=function(){$(".index1").on("mouseenter",'li.b_tit4:has("a"), li.b_tit4_1:has("a")',function(){var e=$(this);e.css("position","relative").prepend('<a class="pd_thread_goto" href="{0}&page=e#a">&raquo;</a>'.replace("{0}",e.find("a").attr("href")))}).on("mouseleave",'li.b_tit4:has("a"), li.b_tit4_1:has("a")',function(){$(this).css("position","static").find(".pd_thread_goto").remove()})},n.showVipSurplusTime=function(){var e=function(e){$('a[href="kf_growup.php"][title="用户等级和权限"]').parent().after('<div class="line"></div><div style="width:300px;"><a href="kf_vmember.php" class="indbox'+(e>0?5:6)+'">VIP会员 '+("("+(e>0?"剩余"+e+"小时":"参与论坛获得的额外权限")+')</a><div class="c"></div></div>'))},t=parseInt(d.getCookie(f.default.vipSurplusTimeCookieName));isNaN(t)||t<0?(console.log("检查VIP剩余时间Start"),$.get("kf_vmember.php?t="+(new Date).getTime(),function(t){var n=0,a=/我的VIP剩余时间\s*<b>(\d+)<\/b>\s*小时/i.exec(t);a&&(n=parseInt(a[1])),d.setCookie(f.default.vipSurplusTimeCookieName,n,d.getDate("+"+f.default.vipSurplusTimeExpires+"m")),e(n)})):e(t)},n.addSearchTypeSelectBoxInHomePage=function(){var e=$('form[action="search.php?"]');e.attr("name","pd_search");var t=e.find('[type="text"][name="keyword"]');t.css("width","116px"),$('<div class="pd_search_type"><span>标题</span><i>&#8744;</i></div>').insertAfter(t)}},{"./Const":6,"./Info":10,"./Log":12,"./Msg":15,"./TmpLog":20,"./Util":21}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={uid:0,userName:"",isInHomePage:"/"===location.pathname||"/index.php"===location.pathname,isMobile:!1,version:"",w:"undefined"!=typeof unsafeWindow?unsafeWindow:window,storageType:"Default"};n.default=a},{}],11:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.modifyItemDescription=n.addBatchBuyItemsLink=n.addSampleItemTips=n.getItemUsedInfo=n.enhanceMyItemsPage=n.addBatchUseAndConvertItemTypesButton=n.addBatchConvertEnergyAndRestoreItemsLink=n.addConvertEnergyAndRestoreItemsButton=n.addSellAndUseItemsButton=n.getLevelByName=n.getTypeIdByName=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=e("./Info"),l=i(r),d=e("./Util"),s=a(d),p=e("./Msg"),c=a(p),f=e("./Const"),u=i(f),_=e("./Log"),g=e("./Public"),h=a(g),m=function(e){switch(e){case 1:return 2;case 2:return 10;case 3:return 50;case 4:return 300;case 5:return 2e3;default:return 0}},v=function(e){switch(e){case 1:return 10;case 2:return 50;case 3:return 300;case 4:return 2e3;case 5:return 1e4;default:return 0}},b=function(e){switch(e){case 3:return 300;case 4:return 2e3;case 5:return 1e4;default:return 0}},y=(n.getTypeIdByName=function(e){switch(e){case"零时迷子的碎片":return 1;case"被遗弃的告白信":return 2;case"学校天台的钥匙":return 3;case"TMA最新作压缩包":return 4;case"LOLI的钱包":return 5;case"棒棒糖":return 6;case"蕾米莉亚同人漫画":return 11;case"十六夜同人漫画":return 7;case"档案室钥匙":return 8;case"傲娇LOLI娇蛮音CD":return 12;case"整形优惠卷":return 9;case"消逝之药":return 10;default:return 0}},n.getLevelByName=function(e){switch(e){case"零时迷子的碎片":case"被遗弃的告白信":case"学校天台的钥匙":case"TMA最新作压缩包":return 1;case"LOLI的钱包":case"棒棒糖":return 2;case"蕾米莉亚同人漫画":case"十六夜同人漫画":return 3;case"档案室钥匙":case"傲娇LOLI娇蛮音CD":return 4;case"整形优惠卷":case"消逝之药":return 5;default:return 0}}),k=function(e){switch(e){case"蕾米莉亚同人漫画":case"十六夜同人漫画":return 50;case"档案室钥匙":case"傲娇LOLI娇蛮音CD":return 30;case"整形优惠卷":case"消逝之药":return 10;default:return-1}},x=function(e,t){if(/(错误的物品编号|无法再使用|该道具已经被使用)/.test(e))return-1;if(t>=7&&t<=12){if(/成功！/.test(e))return{"效果":1}}else{var n=null;if(n=/恢复能量增加了\s*(\d+)\s*点/i.exec(e))return{"能量":parseInt(n[1])};if(n=/(\d+)KFB/i.exec(e))return{KFB:parseInt(n[1])};if(n=/(\d+)点?贡献/i.exec(e))return{"贡献":parseInt(n[1])};if(n=/贡献\+(\d+)/i.exec(e))return{"贡献":parseInt(n[1])}}return{}},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[],a=e.match(/kf_fw_ig_my\.php\?pro=\d+/g);if(a)for(var i=0;i<a.length&&!(t>0&&i+1>t);i++){var o=/pro=(\d+)/i.exec(a[i]);o&&n.push(parseInt(o[1]))}return n},w=function(e,t){var n={type:1,itemIdList:[],safeId:"",itemLevel:0,itemTypeId:0,itemName:"",$itemLine:null,isTypeBatch:!1};$.extend(n,e),t&&(1===t.round?(console.log("循环使用道具Start，使用道具数量："+t.itemNum+"，有效道具使用次数上限："+(t.maxEffectiveItemCount?t.maxEffectiveItemCount:"无限制")+"，恢复道具成功次数上限："+(t.maxSuccessRestoreItemCount?t.maxSuccessRestoreItemCount:"无限制")),$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li class="pd_stat"><strong>对<em>'+t.itemNum+"</em>个【Lv."+n.itemLevel+"："+n.itemName+"】"+("道具的循环使用开始（当前道具恢复能量<em>"+t.totalEnergyNum+"</em>点）<br>")+("（有效道具使用次数上限：<em>"+(t.maxEffectiveItemCount?t.maxEffectiveItemCount:"无限制")+"</em>，")+("恢复道具成功次数上限：<em>"+(t.maxSuccessRestoreItemCount?t.maxSuccessRestoreItemCount:"无限制")+"</em>）</strong></li></ul>"))):$(".pd_result:last").append('<div class="pd_result_sep"></div>'),$(".pd_result:last").append('<li class="pd_stat" style="color: #ff3399;"><strong>第'+t.round+"轮循环开始：</strong></li>")),t?$(".pd_result:last").append("<li><strong>使用结果：</strong></li>"):$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+n.itemLevel+"："+n.itemName+"】使用结果：</strong></li></ul>");var a=0,i=0,o={"有效道具":0,"无效道具":0},r=[],l=!1;$(document).clearQueue("UseItems"),$.each(n.itemIdList,function(e,d){$(document).queue("UseItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_doit.php?id="+d+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(s){h.showFormatLog("使用道具",s);var p=/<span style=".+?">(.+?)<\/span><br\s*\/?><a href=".+?">/i.exec(s);if(p&&!/(错误的物品编号|无法再使用|该道具已经被使用)/.test(s)){a++,r.push(d);var c=x(p[1],n.itemTypeId);if(c!==-1&&($.isEmptyObject(c)?o["无效道具"]++:o["有效道具"]++,n.itemTypeId<=6)){var f=!0,u=!1,_=void 0;try{for(var g,m=Object.keys(c)[Symbol.iterator]();!(f=(g=m.next()).done);f=!0){var v=g.value;"undefined"==typeof o[v]?o[v]=c[v]:o[v]+=c[v]}}catch(e){u=!0,_=e}finally{try{!f&&m.return&&m.return()}finally{if(u)throw _}}}}else i++,/无法再使用/.test(s)&&(r=[]);$(".pd_result:last").append("<li><b>第"+(e+1)+"次：</b>"+(p?p[1]:"未能获得预期的回应")+"</li>"),t&&t.maxEffectiveItemCount&&t.stat["有效道具"]+o["有效道具"]>=t.maxEffectiveItemCount&&(l=!0,console.log("有效道具使用次数到达设定上限，循环使用操作停止"),$(".pd_result:last").append('<li><span class="pd_notice">（有效道具使用次数到达设定上限，循环操作中止）</span></li>'))},error:function(){i++},complete:function(){var d=$("#pd_remaining_num");if(d.text(parseInt(d.text())-1),l=l||d.closest(".pd_msg").data("stop"),l&&($(document).clearQueue("UseItems"),n.isTypeBatch&&$(document).clearQueue("UseItemTypes")),l||e===n.itemIdList.length-1){c.remove(d.closest(".pd_msg")),0===o["有效道具"]&&delete o["有效道具"],0===o["无效道具"]&&delete o["无效道具"],!t&&a>0&&(0,_.push)("使用道具","共有`"+a+"`个【`Lv."+n.itemLevel+"："+n.itemName+"`】道具被使用",{gain:$.extend({},o,{"已使用道具":a}),pay:{"道具":-a}});var s="",p="",f="",g=!0,h=!1,m=void 0;try{for(var v,b=Object.keys(o)[Symbol.iterator]();!(g=(v=b.next()).done);g=!0){var y=v.value;s+="，"+y+"+"+o[y],p+="<i>"+y+"<em>+"+o[y]+"</em></i>",f+="<i>"+y+"<em>+"+o[y]+"</em></i> ",t&&("undefined"==typeof t.stat[y]?t.stat[y]=o[y]:t.stat[y]+=o[y])}}catch(e){h=!0,m=e}finally{try{!g&&b.return&&b.return()}finally{if(h)throw m}}console.log("共有"+a+"个道具被使用"+(i>0?"，共有"+i+"个道具未能使用":"")+s),c.show("<strong>共有<em>"+a+"</em>个道具被使用"+(i>0?"，共有<em>"+i+"</em>个道具未能使用":"")+"</strong>"+p,-1),""===f&&(f='<span class="pd_notice">无</span>'),$(".pd_result:last").append('<li class="pd_stat"><b>统计结果（共有<em>'+a+"</em>个道具被使用）：</b><br>"+f+"</li>"),2===n.type?$('.kf_fw_ig1 input[type="checkbox"]:checked').closest("tr").fadeOut("normal",function(){$(this).remove()}):(E(n.$itemLine,a,-a),N(n.$itemLine.closest("tbody").find("tr:gt(1) > td:nth-child(2) > a"))),"零时迷子的碎片"===n.itemName&&U(),t?(n.itemIdList=r,n.itemIdList.length||(l=!0),t.countStat["被使用次数"]+=a,t.stat["道具"]-=a,t.stat["已使用道具"]+=a,T(l?0:2,n,t)):n.isTypeBatch&&$(document).dequeue("UseItemTypes")}else setTimeout(function(){return $(document).dequeue("UseItems")},"function"==typeof u.default.specialAjaxInterval?u.default.specialAjaxInterval():u.default.specialAjaxInterval)}})})}),$(document).dequeue("UseItems")},S=function(e,t){var n={type:1,itemIdList:[],safeId:"",itemLevel:0,itemTypeId:0,itemName:"",$itemLine:null};$.extend(n,e),t?$(".pd_result:last").append('<li class="pd_result_sep_inner"></li><li><strong>恢复结果：</strong></li>'):$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+n.itemLevel+"："+n.itemName+"】恢复结果：</strong></li></ul>");var a=0,i=0,o=0,r=v(n.itemLevel),l=!1,d=[];$(document).clearQueue("RestoreItems"),$.each(n.itemIdList,function(e,s){$(document).queue("RestoreItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_doit.php?renew="+n.safeId+"&id="+s+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(n){h.showFormatLog("恢复道具",n);var p="",c=/<span style=".+?">(.+?)<\/span><br\s*\/?><a href=".+?">/i.exec(n);c?/该道具已经被恢复/.test(n)?(p="该道具已经被恢复",a++,o+=r,d.push(s),t&&t.maxSuccessRestoreItemCount&&t.countStat["恢复成功次数"]+a>=t.maxSuccessRestoreItemCount&&(l=!0,p+='<span class="pd_notice">（恢复道具成功次数已达到设定上限，恢复操作中止）</span>')):/恢复失败/.test(n)?(p="该道具恢复失败",i++):/你的能量不足以恢复本道具/.test(n)?(l=!0,p='你的能量不足以恢复本道具<span class="pd_notice">（恢复操作中止）</span>'):p=c[1]:p="未能获得预期的回应",$(".pd_result:last").append("<li><b>第"+(e+1)+"次：</b>"+p+"</li>")},complete:function(){var r=$("#pd_remaining_num");r.text(parseInt(r.text())-1),l=l||r.closest(".pd_msg").data("stop"),l&&$(document).clearQueue("RestoreItems"),l||e===n.itemIdList.length-1?(c.remove(r.closest(".pd_msg")),!t&&(a>0||i>0)&&(0,_.push)("恢复道具","共有`"+a+"`个【`Lv."+n.itemLevel+"："+n.itemName+"`】道具恢复成功，共有`"+i+"`个道具恢复失败",{gain:{"道具":a},pay:{"已使用道具":-(a+i),"能量":-o}}),console.log("共有"+a+"个道具恢复成功，共有"+i+"个道具恢复失败，能量-"+o),c.show("<strong>共有<em>"+a+"</em>个道具恢复成功，共有<em>"+i+"</em>个道具恢复失败</strong>"+("<i>能量<ins>-"+o+"</ins></i>"),-1),$(".pd_result:last").append('<li class="pd_stat">共有<em>'+a+"</em>个道具恢复成功，共有<em>"+i+"</em>个道具恢复失败，"+("<i>能量<ins>-"+o+"</ins></i></li>")),2===n.type&&$('.kf_fw_ig1:eq(1) input[type="checkbox"]:checked').closest("tr").fadeOut("normal",function(){$(this).remove()}),E(n.$itemLine,-(a+i),a,-o),t&&(n.itemIdList=d,n.itemIdList.length||(l=!0),l||t.round++,t.totalEnergyNum-=o,t.countStat["恢复成功次数"]+=a,t.countStat["恢复失败次数"]+=i,t.stat["能量"]-=o,t.stat["道具"]+=a,t.stat["已使用道具"]-=a+i,T(l?0:1,n,t))):setTimeout(function(){return $(document).dequeue("RestoreItems")},"function"==typeof u.default.specialAjaxInterval?u.default.specialAjaxInterval():u.default.specialAjaxInterval)}})})}),$(document).dequeue("RestoreItems")},T=function(e,t,n){n.countStat&&!$.isEmptyObject(n.countStat)||(n.countStat={"被使用次数":0,"恢复成功次数":0,"恢复失败次数":0}),n.stat&&!$.isEmptyObject(n.stat)||(n.stat={"能量":0,"道具":0,"已使用道具":0,"有效道具":0,"无效道具":0}),$(".pd_msg").length>=5&&c.remove($(".pd_msg:first"));var a=function(e,a){var i="",o=!0,r=!1,l=void 0;try{for(var d,p=Object.keys(a)[Symbol.iterator]();!(o=(d=p.next()).done);o=!0){var c=d.value;e>0&&("道具"===c||"已使用道具"===c)||(i+="<i>"+c+s.getStatFormatNumber(n.stat[c])+"</i> ")}}catch(e){r=!0,l=e}finally{try{!o&&p.return&&p.return()}finally{if(r)throw l}}$(".pd_result:last").append('\n<li class="pd_result_sep'+(e>0?"_inner":"")+'"></li>\n<li class="pd_stat">\n  <strong>'+(e>0?"截至目前为止的统计":"【Lv."+t.itemLevel+"："+t.itemName+"】循环使用最终统计")+"\n(当前道具恢复能量<em>"+n.totalEnergyNum+'</em>点)：</strong>\n</li>\n<li class="pd_stat">\n  '+(e>0?"":"共进行了<em>"+n.round+"</em>轮循环：")+"\n  <i>被使用次数<em>+"+n.countStat["被使用次数"]+"</em></i>\n  <i>恢复成功次数<em>+"+n.countStat["恢复成功次数"]+"</em></i>\n  <i>恢复失败次数<em>+"+n.countStat["恢复失败次数"]+'</em></i>\n</li>\n<li class="pd_stat">'+i+"</li>\n")};if(1===e)a(e,n.stat),c.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+t.itemIdList.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),setTimeout(function(){w(t,n)},1===n.round?500:"function"==typeof u.default.cycleUseItemsFirstAjaxInterval?u.default.cycleUseItemsFirstAjaxInterval():u.default.cycleUseItemsFirstAjaxInterval);else if(2===e)c.wait('<strong>正在恢复道具中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+t.itemIdList.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),setTimeout(function(){return S(t,n)},"function"==typeof u.default.cycleUseItemsFirstAjaxInterval?u.default.cycleUseItemsFirstAjaxInterval():u.default.cycleUseItemsFirstAjaxInterval);else{0===n.stat["道具"]&&delete n.stat["道具"],0===n.stat["已使用道具"]&&delete n.stat["已使用道具"],0===n.stat["有效道具"]&&delete n.stat["有效道具"],0===n.stat["无效道具"]&&delete n.stat["无效道具"];var i={},o={};for(var r in n.stat)n.stat[r]>0?i[r]=n.stat[r]:o[r]=n.stat[r];n.countStat["被使用次数"]>0&&(0,_.push)("循环使用道具","对`"+n.itemNum+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具进行了`"+n.round+"`轮循环使用"+("(被使用次数`+"+n.countStat["被使用次数"]+"`，恢复成功次数`+"+n.countStat["恢复成功次数"]+"`，")+("恢复失败次数`+"+n.countStat["恢复失败次数"]+"`)"),{gain:i,pay:o}),console.log("共进行了"+n.round+"轮循环，被使用次数+"+n.countStat["被使用次数"]+"，恢复成功次数+"+n.countStat["恢复成功次数"]+"，"+("恢复失败次数+"+n.countStat["恢复失败次数"]+"，能量"+n.stat["能量"])),c.show("<strong>共进行了<em>"+n.round+"</em>轮循环</strong><i>被使用次数<em>+"+n.countStat["被使用次数"]+"</em></i>"+("<i>恢复成功次数<em>+"+n.countStat["恢复成功次数"]+"</em></i><i>恢复失败次数<em>+"+n.countStat["恢复失败次数"]+"</em></i>")+("<i>能量<ins>"+n.stat["能量"]+'</ins></i><a href="#">清除消息框</a>'),-1).find("a").click(function(e){e.preventDefault(),c.destroy()}),a(e,n.stat)}},L=function(e){var t={type:1,itemIdList:[],safeId:"",itemLevel:0,itemName:"",$itemLine:null,isTypeBatch:!1};$.extend(t,e),$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+t.itemLevel+"："+t.itemName+"】转换结果：</strong></li></ul>");var n=0,a=0,i=m(t.itemLevel);$(document).clearQueue("ConvertItemsToEnergy"),$.each(t.itemIdList,function(e,o){$(document).queue("ConvertItemsToEnergy",function(){$.ajax({type:"GET",url:"kf_fw_ig_doit.php?tomp="+t.safeId+"&id="+o+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(e){h.showFormatLog("将道具转换为能量",e),/转换为了\s*\d+\s*点能量/.test(e)?n++:a++},error:function(){a++},complete:function(){var o=$("#pd_remaining_num");o.text(parseInt(o.text())-1);var r=o.closest(".pd_msg").data("stop");if(r&&($(document).clearQueue("ConvertItemsToEnergy"),t.isTypeBatch&&$(document).clearQueue("ConvertItemTypesToEnergy")),r||e===t.itemIdList.length-1){c.remove(o.closest(".pd_msg"));var l=n*i;n>0&&(0,_.push)("将道具转换为能量","共有`"+n+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具成功转换为能量",{gain:{"能量":l},pay:{"已使用道具":-n}}),console.log("共有"+n+"个道具成功转换为能量"+(a>0?"，共有"+a+"个道具转换失败":"")+"，能量+"+l),c.show("<strong>共有<em>"+n+"</em>个道具成功转换为能量"+(a>0?"，共有<em>"+a+"</em>个道具转换失败":"")+"</strong>"+("<i>能量<em>+"+l+"</em></i>"),-1),$(".pd_result:last").append('<li class="pd_stat">共有<em>'+n+"</em>个道具成功转换为能量"+(a>0?"，共有<em>"+a+"</em>个道具转换失败":"")+"，"+("<i>能量<em>+"+l+"</em></i></li>")),2===t.type&&$('.kf_fw_ig1:eq(1) input[type="checkbox"]:checked').closest("tr").fadeOut("normal",function(){$(this).remove()}),E(t.$itemLine,-n,null,l),t.isTypeBatch&&$(document).dequeue("ConvertItemTypesToEnergy")}else setTimeout(function(){return $(document).dequeue("ConvertItemsToEnergy")},u.default.defAjaxInterval)}})})}),$(document).dequeue("ConvertItemsToEnergy")},I=function(e){var t={itemIdList:[],itemLevel:0,itemName:""};$.extend(t,e),$(".kf_fw_ig1:last").parent().append('<ul class="pd_result"><li><strong>【Lv.'+t.itemLevel+"："+t.itemName+"】出售结果：</strong></li></ul>");var n=0,a=0,i=0;$(document).clearQueue("SellItems"),$.each(t.itemIdList,function(e,o){$(document).queue("SellItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_shop.php?sell=yes&id="+o+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(e){h.showFormatLog("出售道具",e),/出售成功/.test(e)?(n++,i+=b(t.itemLevel)):a++},error:function(){a++},complete:function(){var o=$("#pd_remaining_num");o.text(parseInt(o.text())-1);var r=o.closest(".pd_msg").data("stop");r&&$(document).clearQueue("SellItems"),r||e===t.itemIdList.length-1?(c.remove(o.closest(".pd_msg")),n>0&&(0,_.push)("出售道具","共有`"+n+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具出售成功",{gain:{KFB:i},pay:{"道具":-n}}),$('.kf_fw_ig1 input[type="checkbox"]:checked').closest("tr").fadeOut("normal",function(){$(this).remove()}),console.log("共有"+n+"个道具出售成功，共有"+a+"个道具出售失败，KFB+"+i),c.show("<strong>共有<em>"+n+"</em>个道具出售成功"+(a>0?"，共有<em>"+a+"</em>个道具出售失败":"")+"</strong>"+("<i>KFB<em>+"+i+"</em></i>"),-1),$(".pd_result:last").append('<li class="pd_stat">共有<em>'+n+"</em>个道具出售成功"+(a>0?"，共有<em>"+a+"</em>个道具出售失败":"")+"，"+("<i>KFB<em>+"+i+"</em></i></li>"))):setTimeout(function(){return $(document).dequeue("SellItems")},u.default.defAjaxInterval)}})})}),$(document).dequeue("SellItems")},D=(n.addSellAndUseItemsButton=function(){var e=h.getSafeId();if(e){var t=$(".kf_fw_ig1 > tbody > tr:last-child"),n=t.find("td:first-child").text();if(n){var a=/(\d+)级道具/.exec(t.find("td:nth-child(2)").text());if(a){var i=parseInt(a[1]),o=parseInt(s.getUrlParam("lv"));o&&($(".kf_fw_ig1 > tbody > tr > td:last-child").each(function(){var e=/kf_fw_ig_my\.php\?pro=(\d+)/.exec($(this).find("a").attr("href"));e&&$(this).css("width","163").parent().append('<td style="width: 20px; padding-right: 5px;"><input class="pd_input" type="checkbox" value="'+e[1]+'"></td>')}),$(".kf_fw_ig1 > tbody > tr:lt(2)").find("td").attr("colspan",5),$('<div class="pd_item_btns"><button title="批量使用指定道具">使用道具</button><button>全选</button><button>反选</button></div>').insertAfter(".kf_fw_ig1").find("button:first-child").click(function(){c.destroy();var t=[];$('.kf_fw_ig1 input[type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length&&confirm("共选择了"+t.length+"个道具，是否批量使用道具？")&&(c.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),w({type:2,itemIdList:t,safeId:e,itemLevel:i,itemTypeId:o,itemName:n}))}).next().click(function(){$('.kf_fw_ig1 input[type="checkbox"]').prop("checked",!0)}).next().click(function(){$('.kf_fw_ig1 input[type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))})}),o>1&&$('<button style="color: #00f;" title="循环使用和恢复指定数量的道具，直至停止操作或没有道具可以恢复">循环使用</button>').prependTo(".pd_item_btns").click(function(){c.destroy();var t=[];if($('.kf_fw_ig1 input[type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length){var a=prompt("你要循环使用多少个道具？\n（可直接填写道具数量，也可使用“道具数量|有效道具使用次数上限|恢复道具成功次数上限”的格式[设为0表示不限制]，例一：7；例二：5|3；例三：3|0|6）",t.length);if(null!==a){if(a=$.trim(a),!/\d+(\|\d+)?(\|\d+)?/.test(a))return void alert("格式不正确");var r=a.split("|"),l=parseInt(r[0]),d=0,s=0;if(l){"undefined"!=typeof r[1]&&(d=parseInt(r[1])),"undefined"!=typeof r[2]&&(s=parseInt(r[2])),c.destroy(),l>t.length&&(l=t.length);for(var p=[],f=0;f<l;f++)p.push(t[f]);t=p,c.wait("正在获取当前道具相关信息，请稍后&hellip;"),$.get("kf_fw_ig_renew.php?t="+(new Date).getTime(),function(a){c.destroy();var r=M(a);U(a),T(1,{type:2,itemIdList:t,safeId:e,itemLevel:i,itemTypeId:o,itemName:n},{itemNum:t.length,round:1,totalEnergyNum:r,countStat:{},stat:{},maxEffectiveItemCount:d,maxSuccessRestoreItemCount:s})})}}}}),o>=7&&o<=12&&$('<button style="color: #f00;" title="批量出售指定道具">出售道具</button>').prependTo(".pd_item_btns").click(function(){c.destroy();var e=[];$('.kf_fw_ig1 input[type="checkbox"]:checked').each(function(){e.push(parseInt($(this).val()))}),e.length&&confirm("共选择了{0}个道具，是否批量出售道具？".replace("{0}",e.length))&&(c.wait('<strong>正在出售道具中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+e.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),I({itemIdList:e,itemLevel:i,itemName:n}))}),U())}}}},n.addConvertEnergyAndRestoreItemsButton=function(){var e=h.getSafeId();if(e){var t=$(".kf_fw_ig1:eq(1) > tbody > tr:last-child"),n=t.find("td:first-child").text();if(n){var a=/(\d+)级道具/.exec(t.find("td:nth-child(2)").text());if(a){var i=parseInt(a[1]),o=parseInt(s.getUrlParam("lv"));o&&($(".kf_fw_ig1:eq(1) > tbody > tr > td:last-child").each(function(){var e=/kf_fw_ig_my\.php\?pro=(\d+)/.exec($(this).find("a").attr("href"));e&&$(this).css("width","500").parent().append('<td style="width: 20px; padding-right: 5px;"><input class="pd_input" type="checkbox" value="'+e[1]+'"></td>')}),$('<div class="pd_item_btns"><button class="pd_highlight" title="批量将指定道具转换为能量">转换能量</button><button title="批量恢复指定道具">恢复道具</button><button>全选</button><button>反选</button></div>').insertAfter(".kf_fw_ig1:eq(1)").find("button:first-child").click(function(){c.destroy();var t=[];$('.kf_fw_ig1:eq(1) input[type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length&&confirm("共选择了"+t.length+"个道具，是否转换为能量？")&&(c.wait('<strong>正在转换能量中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),L({type:2,itemIdList:t,safeId:e,itemLevel:i,itemName:n}))}).next().click(function(){c.destroy();var t=[];if($('.kf_fw_ig1:eq(1) input[type="checkbox"]:checked').each(function(){t.push(parseInt($(this).val()))}),t.length){var a=t.length*v(i);if(confirm("共选择了"+t.length+"个道具，共需要"+a+"点恢复能量，是否恢复道具？")){var r=parseInt($('.kf_fw_ig1 td:contains("道具恢复能量")').find("span").text());if(!r||r<a)return void alert("所需恢复能量不足");c.wait('<strong>正在恢复道具中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),S({type:2,itemIdList:t,safeId:e,itemLevel:i,itemTypeId:o,itemName:n})}}}).next().click(function(){$('.kf_fw_ig1:eq(1) input[type="checkbox"]').prop("checked",!0)}).next().click(function(){$('.kf_fw_ig1:eq(1) input[type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))})}))}}}},n.addBatchConvertEnergyAndRestoreItemsLink=function(){var e=$(".kf_fw_ig1:last");e.find("tbody > tr").each(function(e){var t=$(this);if(0===e)t.find("td").attr("colspan",6);else if(1===e)t.find("td:nth-child(2)").attr("width",200).next("td").attr("width",100).wrapInner('<span class="pd_used_num pd_custom_tips" style="color: #000;"></span>').next("td").attr("width",130).text("批量恢复").next("td").attr("width",160).before('<td width="160">批量转换</td>');else{t.find("td:nth-child(3)").wrapInner('<span class="pd_used_num pd_custom_tips"></span>').end().find("td:nth-child(4)").html('<a class="pd_items_batch_restore '+(2===e?"pd_disabled_link":"")+'" href="#" title="批量恢复指定数量的道具">批量恢复道具</a>').after('<td><a class="pd_items_batch_convert pd_highlight '+(2===e?"pd_disabled_link":"")+'" href="#" title="批量将指定数量的道具转换为能量">批量转换道具为能量</a></td>');var n=/lv=(\d+)/i.exec(t.find("td:last-child").find("a").attr("href"));n&&t.data("itemTypeId",parseInt(n[1]))}}),D(e);var t=e.find("tbody > tr:gt(1) > td:nth-child(2)");P(t),N(t.find("a")),F()},n.addBatchUseAndConvertItemTypesButton=function(){var e=h.getSafeId();e&&$('<div class="pd_item_btns"><button title="批量使用指定种类的道具" data-action="useItemTypes">批量使用</button><button class="pd_highlight" title="批量将指定种类的道具转换为能量" data-action="convertItemTypes">批量转换</button><button data-action="selectAll">全选</button><button data-action="selectInverse">反选</button></div>').insertAfter(".pd_my_items").on("click","button",function(){var t=$(this).data("action");if("useItemTypes"===t||"convertItemTypes"===t){var n=function(){var n=[];if($(".pd_item_type_chk:checked").each(function(){var e=$(this).closest("tr"),a=parseInt(e.find("td:first-child").text()),i=parseInt(e.data("itemTypeId")),o=e.find("td:nth-child(2) > a").text();if(!(isNaN(i)||i<=0||"convertItemTypes"===t&&1===i)){var r=e.find("td:last-child").find("useItemTypes"===t?"a:first-child":"a:last-child").attr("href")+"&t="+(new Date).getTime();n.push({itemTypeId:i,itemLevel:a,itemName:o,$itemLine:e,itemListUrl:r})}}),!n.length)return{v:void 0};var a=parseInt(prompt("在指定种类道具中你要"+("useItemTypes"===t?"使用":"转换")+"多少个道具？（0表示不限制）",0));if(isNaN(a)||a<0)return{v:void 0};c.destroy();var i="useItemTypes"===t?"UseItemTypes":"ConvertItemTypesToEnergy";$(document).clearQueue(i),$.each(n,function(n,o){$(document).queue(i,function(){var n=c.wait("正在获取本种类"+("useItemTypes"===t?"未":"已")+"使用道具列表，请稍后&hellip;");$.ajax({type:"GET",url:o.itemListUrl,timeout:u.default.defAjaxTimeout,success:function(r){c.remove(n);var l=C(r,a);return l.length?void("useItemTypes"===t?(console.log("批量使用道具Start，使用道具数量："+l.length),c.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+l.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),w({type:1,itemIdList:l,safeId:e,itemLevel:o.itemLevel,itemTypeId:o.itemTypeId,itemName:o.itemName,$itemLine:o.$itemLine,isTypeBatch:!0})):(console.log("批量转换道具为能量Start，转换道具数量："+l.length),c.wait('<strong>正在转换能量中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+l.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),L({type:1,itemIdList:l,safeId:e,itemLevel:o.itemLevel,itemName:o.itemName,$itemLine:o.$itemLine,isTypeBatch:!0}))):void $(document).dequeue(i)},error:function(){c.remove(n),$(document).dequeue(i)}})})}),$(document).dequeue(i)}();if("object"===("undefined"==typeof n?"undefined":o(n)))return n.v}else"selectAll"===t?$(".pd_item_type_chk").prop("checked",!0):"selectInverse"===t&&$(".pd_item_type_chk").each(function(){$(this).prop("checked",!$(this).prop("checked"))})})},function(e){var t=h.getSafeId();t&&e.on("click",'a[href="#"]',function(e){e.preventDefault();var n=$(this);if(!n.is(".pd_disabled_link")){var a=n.closest("tr"),i=parseInt(a.find("td:first-child").text()),r=parseInt(a.data("itemTypeId")),l=a.find("td:nth-child(2) > a").text(),d=parseInt(a.find("td:nth-child(3) > .pd_usable_num").text()),s=parseInt(a.find("td:nth-child(3) > .pd_used_num").text()),p="";if(!(isNaN(r)||r<=0))if(n.is(".pd_items_batch_use")){var f=function(){var e=parseInt(prompt("你要使用多少个【Lv."+i+"："+l+"】道具？（0表示不限制）",d?d:0));return isNaN(e)||e<0?{v:void 0}:(c.destroy(),c.wait("正在获取本种类未使用道具列表，请稍后&hellip;"),p=a.find("td:last-child").find("a:first-child").attr("href")+"&t="+(new Date).getTime(),void $.get(p,function(n){c.destroy();var o=C(n,e);return o.length?(console.log("批量使用道具Start，使用道具数量："+o.length),c.wait('<strong>正在使用道具中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+o.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),void w({type:1,itemIdList:o,safeId:t,itemLevel:i,itemTypeId:r,itemName:l,$itemLine:a})):void alert("本种类没有未使用的道具")}))}();if("object"===("undefined"==typeof f?"undefined":o(f)))return f.v}else if(n.is(".pd_items_cycle_use")){var u=function(){var e=prompt("你要循环使用多少个【Lv."+i+"："+l+"】道具？\n（可直接填写道具数量，也可使用“道具数量|有效道具使用次数上限|恢复道具成功次数上限”的格式[设为0表示不限制]，例一：7；例二：5|3；例三：3|0|6）",d?d:0);if(null===e)return{v:void 0};if(e=$.trim(e),!/\d+(\|\d+)?(\|\d+)?/.test(e))return alert("格式不正确"),{v:void 0};var n=e.split("|"),o=0,s=0,f=0;return o=parseInt(n[0]),isNaN(o)||o<0?{v:void 0}:("undefined"!=typeof n[1]&&(s=parseInt(n[1])),"undefined"!=typeof n[2]&&(f=parseInt(n[2])),c.destroy(),c.wait("正在获取本种类未使用道具列表，请稍后&hellip;"),p=a.find("td:last-child").find("a:first-child").attr("href")+"&t="+(new Date).getTime(),void $.get(p,function(e){c.destroy();var n=C(e,o);return n.length?(c.wait("正在获取当前道具相关信息，请稍后&hellip;"),void $.get("kf_fw_ig_my.php?t="+(new Date).getTime(),function(e){A(e),$.get("kf_fw_ig_renew.php?t="+(new Date).getTime(),function(e){c.destroy();var o=M(e);U(e),T(1,{type:1,itemIdList:n,safeId:t,itemLevel:i,itemTypeId:r,itemName:l,$itemLine:a},{itemNum:n.length,round:1,totalEnergyNum:o,countStat:{},stat:{},maxEffectiveItemCount:s,maxSuccessRestoreItemCount:f})})})):void alert("本种类没有未使用的道具")}))}();if("object"===("undefined"==typeof u?"undefined":o(u)))return u.v}else if(n.is(".pd_items_batch_restore")){var _=function(){var e=parseInt(prompt("你要恢复多少个【Lv."+i+"："+l+"】道具？（0表示不限制）",s?s:0));return isNaN(e)||e<0?{v:void 0}:(c.destroy(),p=a.find("td:last-child").find("a:last-child").attr("href")+"&t="+(new Date).getTime(),c.wait("正在获取本种类已使用道具列表，请稍后&hellip;"),void $.get(p,function(n){c.destroy();var o=C(n,e);return o.length?(console.log("批量恢复道具Start，恢复道具数量："+o.length),c.wait('<strong>正在恢复道具中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+o.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),void S({type:1,itemIdList:o,safeId:t,itemLevel:i,itemTypeId:r,itemName:l,$itemLine:a})):void alert("本种类没有已使用的道具")}))}();if("object"===("undefined"==typeof _?"undefined":o(_)))return _.v}else if(n.is(".pd_items_batch_convert")){var g=function(){var e=parseInt(prompt("你要将多少个【Lv."+i+"："+l+"】道具转换为能量？（0表示不限制）",s?s:0));return isNaN(e)||e<0?{v:void 0}:(c.destroy(),p=a.find("td:last-child").find("a:last-child").attr("href")+"&t="+(new Date).getTime(),c.wait("正在获取本种类已使用道具列表，请稍后&hellip;"),void $.get(p,function(n){c.destroy();var o=C(n,e);return o.length?(console.log("批量转换道具为能量Start，转换道具数量："+o.length),c.wait('<strong>正在转换能量中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+o.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),void L({type:1,itemIdList:o,safeId:t,itemLevel:i,itemName:l,$itemLine:a})):void alert("本种类没有已使用的道具")}))}();if("object"===("undefined"==typeof g?"undefined":o(g)))return g.v;
}}})}),E=(n.enhanceMyItemsPage=function(){var e=$(".kf_fw_ig1:last");e.addClass("pd_my_items").find("tbody > tr").each(function(e){var t=$(this);if(0===e)t.find("td").attr("colspan",6);else if(1===e)t.find("td:first-child").css("width","75px").end().find("td:nth-child(2)").css("width","185px").end().find("td:nth-child(3)").css("width","105px").html('<span class="pd_usable_num">可用数</span> / <span class="pd_used_num pd_custom_tips">已用数</span>').end().find("td:last-child").css("width","165px").before('<td style="width: 135px;">使用道具</td><td style="width: 135px;">恢复道具 和 转换能量</td>');else{t.find("td:first-child").prepend('<input class="pd_input pd_item_type_chk" type="checkbox">');var n=2===e?"pd_disabled_link":"";t.find("td:nth-child(3)").wrapInner('<span class="pd_usable_num" style="margin-left: 5px;"></span>').append(' / <span class="pd_used_num pd_custom_tips">?</span>').after('\n<td>\n  <a class="pd_items_batch_use" href="#" title="批量使用指定数量的道具">批量使用</a>\n  <a class="pd_items_cycle_use pd_highlight '+n+'" href="#" title="循环使用和恢复指定数量的道具，直至停止操作或没有道具可以恢复">循环使用</a>\n</td>\n<td>\n  <a class="pd_items_batch_restore '+n+'" href="#" title="批量恢复指定数量的道具">批量恢复</a>\n  <a class="pd_items_batch_convert pd_highlight '+n+'" href="#" title="批量将指定数量的道具转换为能量">批量转换</a>\n</td>\n');var a=t.find("td:last-child"),i=/lv=(\d+)/i.exec(a.find("a").attr("href"));if(i){var o=parseInt(i[1]);t.data("itemTypeId",o),a.find("a").text("未使用列表").after('<a class="pd_highlight" href="kf_fw_ig_renew.php?lv='+o+'">已使用列表</a>')}}}),D(e);var t=e.find("tbody > tr:gt(1) > td:nth-child(2)");P(t),N(t.find("a")),U()},function(e,t,n,a){var i=!1;if(e){var o=e.find("td:nth-child(3) > .pd_used_num"),r=e.find("td:nth-child(2) > a").text();if(o.length>0&&"零时迷子的碎片"!==r){var l=parseInt(o.text());isNaN(l)||l+t<0?i=!0:(o.text(l+t),F())}if(n){var d=e.find("td:nth-child(3) > .pd_usable_num");if(d.length>0){var p=parseInt(d.text());isNaN(p)||p+n<0?i=!0:d.text(p+n)}}}if(a){var c=$(".pd_total_energy_num");if("/kf_fw_ig_renew.php"===location.pathname&&(c=$('.kf_fw_ig1:first > tbody > tr:nth-child(2) > td:contains("道具恢复能量") > span')),c.length>0){var f=parseInt(c.text());isNaN(f)||f+a<0?i=!0:c.text(f+a)}else i=!0}i&&(U(),"/kf_fw_ig_my.php"!==location.pathname||s.getUrlParam("lv")||A())}),M=function(e){var t=0,n=/道具恢复能量<br\s*\/?><span.+?>(\d+)<\/span><br\s*\/?>点/i.exec(e);return n&&(t=parseInt(n[1])),t},F=function(){var e=0,t=0;$(".kf_fw_ig1:last > tbody > tr:gt(1) > td:nth-child(3) > .pd_used_num").each(function(){var n=$(this),a=parseInt(n.text());if(!(isNaN(a)||a<0)){var i=parseInt(n.closest("tr").find("td:first-child").text());if(i){var o=v(i),r=m(i);e+=o*a,t+=r*a,n.attr("title","全部恢复需要"+o*a+"点能量，全部转换可得"+r*a+"点能量")}}}),$(".kf_fw_ig1:last > tbody > tr:nth-child(2) > td:nth-child(3) > .pd_used_num").attr("title","全部恢复需要"+e+"点能量，全部转换可得"+t+"点能量")},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=function(e){var t=M(e),n=/(1级道具转换得.+?点能量)。<br/.exec(e);if("/kf_fw_ig_my.php"===location.pathname?$(".kf_fw_ig_title1:last").find("span:has(.pd_total_energy_num)").remove().end().append('<span class="pd_custom_tips" style="margin-left: 7px;" title="'+(n?n[1]:"")+'">'+('(道具恢复能量 <b class="pd_total_energy_num" style="font-size: 14px;">'+t+"</b> 点)</span>")):$('.kf_fw_ig1:first > tbody > tr:nth-child(2) > td:contains("道具恢复能量") > span').text(t),$(".pd_used_num").length>0){var a=e.match(/">\d+<\/td><td>全部转换本级已使用道具为能量<\/td>/g);a&&!function(){var e=[];for(var t in a){var n=/">(\d+)<\/td>/i.exec(a[t]);n&&e.push(n[1])}var i=$(".kf_fw_ig1:last > tbody > tr:gt(1) > td:nth-child(3) > .pd_used_num");i.length===a.length&&(i.each(function(t){$(this).text(e[t])}),F())}()}};e?t(e):$.get("kf_fw_ig_renew.php?t="+(new Date).getTime(),function(e){return t(e)})},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=function(e){var t=e.match(/">\d+<\/td><td><a href="kf_fw_ig_my\.php\?lv=/gi);if(t){var n=[];for(var a in t){var i=/">(\d+)<\/td>/i.exec(t[a]);i&&n.push(i[1])}$(".kf_fw_ig1:last > tbody > tr:gt(1) > td:nth-child(3) > .pd_usable_num").each(function(e){$(this).text(n[e]?n[e]:0)})}};e?t(e):$.get("kf_fw_ig_my.php?t="+(new Date).getTime(),function(e){return t(e)})},B=n.getItemUsedInfo=function(e){var t={"蕾米莉亚同人漫画":0,"十六夜同人漫画":0,"档案室钥匙":0,"傲娇LOLI娇蛮音CD":0,"消逝之药":0,"整形优惠卷":0},n=/道具：\[(蕾米莉亚同人漫画)：(\d+)]\[(十六夜同人漫画)：(\d+)]\[(档案室钥匙)：(\d+)]\[(傲娇LOLI娇蛮音CD)：(\d+)]\[(消逝之药)：(\d+)]\[(整形优惠卷)：(\d+)]/.exec(e);if(n)for(var a=1;a<n.length;a+=2)t[n[a]]=parseInt(n[a+1]);return t},N=function(e){var t=["仅供参考","←谁信谁傻逼","←不管你信不信，反正我是信了","要是失败了出门左转找XX风","退KFOL保一生平安","←这一切都是XX风的阴谋","这样的几率大丈夫？大丈夫，萌大奶！","玄不救非，氪不改命","严重警告：此地的概率学已死","←概率对非洲人是不适用的","要相信RP守恒定律"];$.get("kf_fw_ig_index.php?t="+(new Date).getTime(),function(n){var a=B(n);e.next(".pd_used_item_info").remove(),e.each(function(){var e=$(this),n=e.text();if("undefined"!=typeof a[n]){var i=a[n],o=k(n),r=0;r=i>o?0:100*(1-i/o);var l="";i<o&&i>0&&(l="（"+t[Math.floor(Math.random()*t.length)]+"）"),e.after('<span class="pd_used_item_info" title="下个道具使用成功几率：'+(i>=o?"无":r.toFixed(2)+"%")+l+'">'+('(<span style="'+(i>=o?"color: #f00;":"")+'">'+i+'</span>/<span style="color: #f00;">'+o+"</span>)</span>"))}})})},P=function(e){e.each(function(){var e=$(this),t=e.text().trim(),n=y(t);if(t&&"undefined"!=typeof u.default.sampleItemIdList[t]){var a="";a="零时迷子的碎片"!==t?"恢复此道具需"+v(n)+"点能量，转换此道具可得"+m(n)+"点能量":"此道具不可恢复和转换",e.html('<a href="kf_fw_ig_my.php?pro='+u.default.sampleItemIdList[t]+'&display=1" title="'+a+'">'+t+"</a>")}})},j=(n.addSampleItemTips=function(){var e=parseInt(s.getUrlParam("pro"));if(!(isNaN(e)||e<=0)){var t=!0,n=!1,a=void 0;try{for(var i,o=Object.keys(u.default.sampleItemIdList)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var r=i.value;if(e===u.default.sampleItemIdList[r]){$(".kf_fw_ig1 > tbody > tr:nth-child(3) > td:last-child").find("span:first").after('<span class="pd_notice" style="margin-left: 5px;">(展示用样品)</span>');break}}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}}},function(e){var t={itemTypeId:0,num:0,safeId:"",itemLevel:0,itemName:""};$.extend(t,e),$(".kf_fw_ig1").parent().append('<ul class="pd_result"><li><strong>【Lv.'+t.itemLevel+"："+t.itemName+"】购买结果：</strong></li></ul>");var n=0,a=0,i=!1;$(document).clearQueue("BatchBuyItems"),$.each(new Array(t.num),function(e){$(document).queue("BatchBuyItems",function(){$.ajax({type:"GET",url:"kf_fw_ig_shop.php?lvid="+t.itemTypeId+"&safeid="+t.safeId+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(t){h.showFormatLog("购买道具",t);var a="",o=/<a href="kf_fw_ig_my\.php\?pro=(\d+)">/i.exec(t);o?(n++,a='获得了<a target="_blank" href="kf_fw_ig_my.php?pro='+o[1]+'" data-id="'+o[1]+'">一个道具</a>'):/你需要持有该道具两倍市场价的KFB/i.test(t)?(a='你需要持有该道具两倍市场价的KFB<span class="pd_notice">（购买操作中止）</span>',i=!0):a="未能获得预期的回应",$(".pd_result:last").append("<li><b>第"+(e+1)+"次：</b>"+a+"</li>")},error:function(){a++},complete:function(){var o=$("#pd_remaining_num");o.text(parseInt(o.text())-1),i=i||o.closest(".pd_msg").data("stop"),i&&$(document).clearQueue("BatchBuyItems"),i||e===t.num-1?(c.remove(o.closest(".pd_msg")),n>0&&(0,_.push)("购买道具","共有`"+n+"`个【`Lv."+t.itemLevel+"："+t.itemName+"`】道具购买成功",{gain:{"道具":n}}),console.log("共有"+n+"个【Lv."+t.itemLevel+"："+t.itemName+"】道具购买成功"+(a>0?"，共有"+a+"个道具购买失败":"")),c.show("<strong>共有<em>"+n+"</em>个【<em>Lv."+t.itemLevel+"</em>"+t.itemName+"】道具购买成功"+((a>0?"，共有<em>"+a+"</em>个道具购买失败":"")+"</strong>"),-1),n>0&&($('<li><a href="#">统计购买价格</a></li>').appendTo(".pd_result:last").find("a").click(function(e){e.preventDefault();var n=$(this).closest(".pd_result");$(this).parent().remove(),c.destroy(),O(n,t.itemLevel,t.itemName)}),K())):setTimeout(function(){return $(document).dequeue("BatchBuyItems")},"function"==typeof u.default.specialAjaxInterval?u.default.specialAjaxInterval():u.default.specialAjaxInterval)}})})}),$(document).dequeue("BatchBuyItems")}),O=function(e,t,n){var a=0,i=0,o=0,r=0,l=0,d=0,p=e.find("li > a").length;$(".kf_fw_ig1:first > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this);if(e.find("a").text()===n)return d=parseInt(e.next("td").find(".pd_item_price").text()),!1}),d||(d=1),c.wait('<strong>正在统计购买价格中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+p+"</em></i>"),$(document).clearQueue("StatBuyItemsPrice"),e.find("li > a").each(function(f){var g=$(this),h=g.data("id");h&&$(document).queue("StatBuyItemsPrice",function(){$.ajax({type:"GET",url:"kf_fw_ig_my.php?pro="+h+"&t="+(new Date).getTime(),timeout:u.default.defAjaxTimeout,success:function(e){var t=$("#pd_remaining_num");t.text(parseInt(t.text())-1);var n=/从商店购买，购买价(\d+)KFB。<br/.exec(e);if(n){a++;var d=parseInt(n[1]);o+=d,0===r?r=d:d<r&&(r=d),d>l&&(l=d),g.after('（购买价：<b class="pd_highlight">'+d+"</b>KFB）")}else i++,g.after('<span class="pd_notice">（未能获得预期的回应）</span>')},error:function(){i++,g.after('<span class="pd_notice">（连接超时）</span>')},complete:function(){f===p-1?(c.destroy(),a>0&&(0,_.push)("统计道具购买价格","共有`"+a+"`个【`Lv."+t+"："+n+"`】道具统计成功"+((i>0?"（共有`"+i+"`个道具未能统计成功）":"")+"，总计价格：`"+o.toLocaleString()+"`，")+("平均价格：`"+(a>0?s.getFixedNumberLocaleString(o/a,2):0)+"`")+("(`"+(a>0?Math.round(o/a/d*100):0)+"%`)，")+("最低价格：`"+r.toLocaleString()+"`(`"+Math.round(r/d*100)+"%`)，")+("最高价格：`"+l.toLocaleString()+"`(`"+Math.round(l/d*100)+"%`)"),{pay:{KFB:-o}}),console.log("统计道具购买价格（KFB）（共有"+i+"个道具未能统计成功），统计成功数量："+a+"，总计价格："+o.toLocaleString()+"，"+("平均价格："+(a>0?s.getFixedNumberLocaleString(o/a,2):0)+" ")+("("+(a>0?Math.round(o/a/d*100):0)+"%)，最低价格："+r.toLocaleString()+" ")+("("+Math.round(r/d*100)+"%)，最高价格："+l.toLocaleString()+" ("+Math.round(l/d*100)+"%)")),e.append('\n<li class="pd_stat">\n  <b>统计结果'+(i>0?'<span class="pd_notice">（共有'+i+"个道具未能统计成功）</span>":"")+"：</b><br>\n  <i>统计成功数量：<em>"+a+"</em></i>\n  <i>总计价格：<em>"+o.toLocaleString()+"</em></i>\n  <i>平均价格：<em>"+(a>0?s.getFixedNumberLocaleString(o/a,2):0)+" \n("+(a>0?Math.round(o/a/d*100):0)+"%)</em></i>\n  <i>最低价格：<em>"+r.toLocaleString()+" ("+Math.round(r/d*100)+"%)</em></i>\n  <i>最高价格：<em>"+l.toLocaleString()+" ("+Math.round(l/d*100)+"%)</em></i>\n</li>\n")):setTimeout(function(){return $(document).dequeue("StatBuyItemsPrice")},u.default.defAjaxInterval)}})})}),$(document).dequeue("StatBuyItemsPrice")},K=(n.addBatchBuyItemsLink=function(){var e=$(".kf_fw_ig1:first");e.find("tbody > tr:nth-child(2)").find("td:nth-child(2)").css("width","243px").end().find("td:nth-child(3)").css("width","155px").end().find("td:last-child").css("width","110px"),e.find("tbody > tr:gt(1)").each(function(){$(this).find("td:nth-child(3)").wrapInner('<span class="pd_item_price"></span>').end().find("td:last-child").append('<a class="pd_batch_buy_items" style="margin-left: 15px;" href="#">批量购买</a>')}),e.on("click",'a[href^="kf_fw_ig_shop.php?lvid="]',function(){var e=$(this),t=parseInt(e.closest("tr").find("td:first-child").text());if(t){var n=e.closest("tr").find("td:nth-child(2) > a").text();if(n)return!!confirm("是否购买【Lv."+t+"："+n+"】道具？")&&void 0}}).on("click","a.pd_batch_buy_items",function(e){e.preventDefault(),c.destroy();var t=$(this),n=parseInt(t.closest("tr").find("td:first-child").text());if(n){var a=t.closest("tr").find("td:nth-child(2) > a").text();if(a){var i=/lvid=(\d+)&safeid=(\w+)/i.exec(t.prev("a").attr("href"));if(i){var o=parseInt(i[1]),r=i[2],l=parseInt(prompt("你要批量购买多少个【Lv."+n+"："+a+"】道具？",0));!l||l<0||(c.wait('<strong>正在购买道具中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+l+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),j({itemTypeId:o,num:l,safeId:r,itemLevel:n,itemName:a}))}}}}),e.find("tbody > tr:gt(1) > td:nth-child(4)").each(function(){var e=$(this),t=parseInt($.trim(e.prev("td").text()));isNaN(t)||e.addClass("pd_custom_tips").attr("title",Math.floor(.5*t)+"~"+2*t+"（均价："+Math.floor(1.25*t)+"）")});var t=e.find("tbody > tr:gt(1) > td:nth-child(2)");P(t),N(t.find("a")),K(),e.find("tbody > tr:first-child > td").append('<br><span class="pd_highlight">想买道具却害怕使用失败？快来试试<a href="read.php?tid=526110" target="_blank" title="喵拉布丁：我绝对没收广告费~">道具使用险</a>吧！</span>')},function(){$.get("profile.php?action=show&uid="+l.default.uid+"&t="+(new Date).getTime(),function(e){var t=/论坛货币：(\d+)\s*KFB<br/i.exec(e);if(t){var n=parseInt(t[1]);$(".kf_fw_ig_title1:last").find("span:last").remove().end().append('<span style="margin-left: 7px;">(当前持有 <b style="font-size: 14px;">'+n+"</b> KFB)</span>"),$(".kf_fw_ig1:first > tbody > tr:gt(1) > td:nth-child(3) > .pd_item_price").each(function(){var e=$(this);e.next(".pd_verify_tips").remove();var t=parseInt(e.text());if(!isNaN(t)){var a="",i="";2*t<=n?(a='<span style="color: #669933;">可买</span>',i="有足够KFB购买此道具"):(a='<span style="color: #ff0033;">差'+(2*t-n)+"</span>",i="还差"+(2*t-n)+"KFB才可购买此道具"),e.after('<span class="pd_verify_tips" title="'+i+'" style="font-size: 12px; margin-left: 3px;">('+a+")</span>")}})}})});n.modifyItemDescription=function(){var e=$(".kf_fw_ig1 > tbody > tr:nth-child(3) > td:last-child"),t=/道具名称：(.+)/.exec(e.find("span:first").text().trim());if(t){var n=t[1],a={"蕾米莉亚同人漫画":["燃烧伤害+1。上限50。","力量+1，体质+1；满50本时，追加+700生命值。"],"十六夜同人漫画":["命中+3，闪避+1。上限50。","敏捷+1，灵活+1；满50本时，追加+100攻击速度。"],"档案室钥匙":["暴击伤害加成+10%。上限30。","增加5%盒子获得概率[原概率*(100%+追加概率)]；满30枚时，增加50点可分配点数。"],"傲娇LOLI娇蛮音CD":["闪避+3，命中+1。上限30。","降低对手生命值上限的0.5%；满30张时，追加降低对手10%攻击力。"],"整形优惠卷":["暴击几率+3%。上限10。","在获得盒子时，增加3%的几率直接获得高一级的盒子；<br>满10张时，这个概率直接提升为50%(无法将传奇盒子升级为神秘盒子)。"],"消逝之药":["消除伤害。<br>防御效果+7%。上限10。","所有属性+5(不含耐力、幸运)；满10瓶时，追加200点可分配点数。"]};a[n]&&e.html(e.html().replace(a[n][0],a[n][1]))}}},{"./Const":6,"./Info":10,"./Log":12,"./Msg":15,"./Public":18,"./Util":21}],12:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.getMergeLog=n.push=n.clear=n.write=n.read=n.init=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),d=a(l),s=e("./Const"),p=i(s),c="pd_log",f=(n.init=function(){"undefined"==typeof unsafeWindow?window.Log={}:unsafeWindow.Log={}},n.read=function(){r.default.w.Log={};var e=null;if(e="ByUid"===r.default.storageType||"Global"===r.default.storageType?GM_getValue(c+"_"+r.default.uid):localStorage.getItem(c+"_"+r.default.uid)){try{e=JSON.parse(e)}catch(e){return}e&&"object"===$.type(e)&&(r.default.w.Log=e,d.getCookie(p.default.checkOverdueLogCookieName)||_())}}),u=n.write=function(){"ByUid"===r.default.storageType||"Global"===r.default.storageType?GM_setValue(c+"_"+r.default.uid,JSON.stringify(r.default.w.Log)):localStorage.setItem(c+"_"+r.default.uid,JSON.stringify(r.default.w.Log))},_=(n.clear=function(){"ByUid"===r.default.storageType||"Global"===r.default.storageType?GM_deleteValue(c+"_"+r.default.uid):localStorage.removeItem(c+"_"+r.default.uid)},function(){var e=d.getObjectKeyList(Log,1),t=d.getDateString(d.getDate("-"+Config.logSaveDays+"d")),n=!1,a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var s=r.value;if(!(s<=t))break;delete Log[s],n=!0}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}n&&u(),d.setCookie(p.default.checkOverdueLogCookieName,1,d.getMidnightHourDate(1))});n.push=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.gain,i=void 0===a?null:a,o=n.pay,l=void 0===o?null:o,s=new Date,p=s.getTime(),c=d.getDateString(s),_={time:p,type:e,action:t};i&&(_.gain=i),l&&(_.pay=l),f(),Array.isArray(r.default.w.Log[c])||(r.default.w.Log[c]=[]),r.default.w.Log[c].push(_),u()},n.getMergeLog=function(e,t){for(var n in t)if(Array.isArray(e[n])){var a=!0,i=!1,o=void 0;try{for(var r,l=function(){var t=r.value;if("number"!=typeof t.time||"string"!=typeof t.type)return"continue";var a=e[n].findIndex(function(e){return t.time===e.time&&t.type===e.type});a>-1?e[n][a]=t:e[n].push(t)},d=t[n][Symbol.iterator]();!(a=(r=d.next()).done);a=!0){l()}}catch(e){i=!0,o=e}finally{try{!a&&d.return&&d.return()}finally{if(i)throw o}}e[n].sort(function(e,t){return e.time>t.time})}else e[n]=t[n];return e}},{"./Const":6,"./Info":10,"./Util":21}],13:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.show=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),d=a(l),s=e("./Dialog"),p=a(s),c=e("./Func"),f=e("./Config"),u=e("./Log"),_=e("./Item"),g=a(_),h=(n.show=function(){if(!($("#pd_log").length>0)){p.close("pd_config"),(0,f.read)(),(0,c.run)("LogDialog.show_before_");var e='\n<div class="pd_cfg_main">\n  <div class="pd_log_nav">\n    <a class="pd_disabled_link" href="#">&lt;&lt;</a>\n    <a style="padding: 0 7px;" class="pd_disabled_link" href="#">&lt;</a>\n    <h2 class="pd_custom_tips">暂无日志</h2>\n    <a style="padding: 0 7px;" class="pd_disabled_link" href="#">&gt;</a>\n    <a class="pd_disabled_link" href="#">&gt;&gt;</a>\n  </div>\n  <fieldset>\n    <legend>日志内容</legend>\n    <div>\n      <strong>排序方式：</strong>\n      <label title="按时间顺序排序"><input type="radio" name="pd_log_sort_type" value="time" checked>按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="pd_log_sort_type" value="type">按类别</label>\n    </div>\n    <div class="pd_stat" id="pd_log_content">暂无日志</div>\n  </fieldset>\n  <fieldset>\n    <legend>统计结果</legend>\n    <div>\n      <strong>统计范围：</strong>\n      <label title="显示当天的统计结果"><input type="radio" name="pd_log_stat_type" value="cur" checked>当天</label>\n      <label title="显示距该日N天内的统计结果"><input type="radio" name="pd_log_stat_type" value="custom"></label>\n      <label title="显示距该日N天内的统计结果"><input id="pd_log_stat_days" type="text" style="width: 22px;" maxlength="3">天内</label>\n      <label title="显示全部统计结果"><input type="radio" name="pd_log_stat_type" value="all">全部</label>\n    </div>\n    <div class="pd_stat" id="pd_log_stat">暂无日志</div>\n  </fieldset>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a id="pd_log_im_or_ex_log_dialog" href="#">导入/导出日志</a></span>\n  <button>关闭</button><button>清除日志</button>\n</div>',t=p.create("pd_log","KF Online助手日志",e);(0,u.read)();var n=[],a=0;$.isEmptyObject(Log)||(n=d.getObjectKeyList(Log,1),a=n.length-1,t.find(".pd_log_nav h2").attr("title","总共记录了"+n.length+"天的日志").text(n[a]),n.length>1&&(t.find(".pd_log_nav > a:eq(0)").attr("title",n[0]).removeClass("pd_disabled_link"),t.find(".pd_log_nav > a:eq(1)").attr("title",n[a-1]).removeClass("pd_disabled_link"))),t.find(".pd_log_nav a").click(function(e){if(e.preventDefault(),$(this).is(".pd_log_nav a:eq(0)"))a=0;else if($(this).is(".pd_log_nav a:eq(1)")){if(!(a>0))return;a--}else if($(this).is(".pd_log_nav a:eq(2)")){if(!(a<n.length-1))return;a++}else $(this).is(".pd_log_nav a:eq(3)")&&(a=n.length-1);t.find(".pd_log_nav h2").text(n[a]),h(n[a]),v(n[a]),a>0?(t.find(".pd_log_nav > a:eq(0)").attr("title",n[0]).removeClass("pd_disabled_link"),t.find(".pd_log_nav > a:eq(1)").attr("title",n[a-1]).removeClass("pd_disabled_link")):t.find(".pd_log_nav > a:lt(2)").removeAttr("title").addClass("pd_disabled_link"),a<n.length-1?(t.find(".pd_log_nav > a:eq(2)").attr("title",n[a-1]).removeClass("pd_disabled_link"),t.find(".pd_log_nav > a:eq(3)").attr("title",n[n.length-1]).removeClass("pd_disabled_link")):t.find(".pd_log_nav > a:gt(1)").removeAttr("title").addClass("pd_disabled_link")}).end().find('input[name="pd_log_sort_type"]').click(function(){var e=$(this).val();Config.logSortType!==e&&(Config.logSortType=e,(0,f.write)(),h(n[a]))}).end().find('input[name="pd_log_stat_type"]').click(function(){var e=$(this).val();Config.logStatType!==e&&(Config.logStatType=e,(0,f.write)(),v(n[a]))}).end().find("#pd_log_stat_days").keyup(function(){var e=parseInt($.trim($(this).val()));e>0&&Config.logStatDays!==e&&(Config.logStatDays=e,(0,f.write)(),$('input[name="pd_log_stat_type"][value="custom"]:not(:checked)').click(),v(n[a]))}).end().find('input[name="pd_log_sort_type"][value="{0}"]'.replace("{0}",Config.logSortType)).click().end().find('input[name="pd_log_stat_type"][value="{0}"]'.replace("{0}",Config.logStatType)).click().end().find("#pd_log_stat_days").val(Config.logStatDays),t.find(".pd_cfg_btns > button:first").click(function(){return p.close("pd_log")}).next("button").click(function(e){e.preventDefault(),confirm("是否清除所有日志？")&&((0,u.clear)(),alert("日志已清除"),location.reload())}),$("#pd_log_im_or_ex_log_dialog").click(function(e){e.preventDefault(),y()}),h(n[a]),v(n[a]),$(window).height()<=750&&t.find("#pd_log_content").css("height","216px"),p.show("pd_log"),t.find("input:first").focus(),(0,c.run)("LogDialog.show_after_")}},function(e){Array.isArray(Log[e])&&$("#pd_log_content").html(m(e,Config.logSortType)).parent().find("legend:first-child").text("日志内容 (共"+Log[e].length+"项)")}),m=function(e,t){var n=Log[e];"type"===t?!function(){var e=["捐款","领取争夺奖励","批量攻击","试探攻击","抽取神秘盒子","抽取道具或卡片","使用道具","恢复道具","循环使用道具","将道具转换为能量","将卡片转换为VIP时间","购买道具","统计道具购买价格","出售道具","神秘抽奖","统计神秘抽奖结果","神秘等级升级","神秘系数排名变化","批量转账","购买帖子","自动存款"];n.sort(function(t,n){return e.indexOf(t.type)>e.indexOf(n.type)})}():n.sort(function(e,t){return e.time>t.time});var a="",i="",o=!0,r=!1,l=void 0;try{for(var s,p=n[Symbol.iterator]();!(o=(s=p.next()).done);o=!0){var c=s.value,f=c.time,u=c.type,_=c.action,g=c.gain,h=c.pay;if("undefined"!=typeof f&&"undefined"!=typeof u&&"undefined"!=typeof _){var m=new Date(f);"type"===t?(i!==u&&(a+="<h3>【"+u+"】</h3>",i=u),a+="<p><b>"+d.getTimeString(m)+"：</b>"+_.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>')):a+="<p><b>"+d.getTimeString(m)+" ("+u+")：</b>"+_.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>');var v="";if("object"===$.type(g)&&!$.isEmptyObject(g)){v+="，";var b=!0,y=!1,k=void 0;try{for(var x,C=Object.keys(g)[Symbol.iterator]();!(b=(x=C.next()).done);b=!0){var w=x.value;if("item"===w){var S=!0,T=!1,L=void 0;try{for(var I,D=Object.keys(g[w])[Symbol.iterator]();!(S=(I=D.next()).done);S=!0){var E=I.value;v+="<i>"+E+"<em>+"+g[w][E].toLocaleString()+"</em></i> "}}catch(e){T=!0,L=e}finally{try{!S&&D.return&&D.return()}finally{if(T)throw L}}}else v+="<i>"+w+"<em>+"+g[w].toLocaleString()+"</em></i> "}}catch(e){y=!0,k=e}finally{try{!b&&C.return&&C.return()}finally{if(y)throw k}}}if("object"===$.type(h)&&!$.isEmptyObject(h)){v||(v+="，");var M=!0,F=!1,U=void 0;try{for(var A,B=Object.keys(h)[Symbol.iterator]();!(M=(A=B.next()).done);M=!0){var N=A.value;if("item"===N){var P=!0,j=!1,O=void 0;try{for(var K,R=Object.keys(h[N])[Symbol.iterator]();!(P=(K=R.next()).done);P=!0){var q=K.value;v+="<i>"+q+"<ins>"+h[N][q].toLocaleString()+"</ins></i> "}}catch(e){j=!0,O=e}finally{try{!P&&R.return&&R.return()}finally{if(j)throw O}}}else v+="<i>"+N+"<ins>"+h[N].toLocaleString()+"</ins></i> "}}catch(e){F=!0,U=e}finally{try{!M&&B.return&&B.return()}finally{if(F)throw U}}}a+=v+"</p>"}}}catch(e){r=!0,l=e}finally{try{!o&&p.return&&p.return()}finally{if(r)throw l}}return a},v=function(e){Array.isArray(Log[e])&&$("#pd_log_stat").html(b(e,Config.logStatType))},b=function(e,t){var n={};if("custom"===t){var a=new Date(e);a.setDate(a.getDate()-Config.logStatDays+1),a=d.getDateString(a);var i=!0,o=!1,r=void 0;try{for(var l,s=d.getObjectKeyList(Log,1)[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var p=l.value;p>=a&&p<=e&&(n[p]=Log[p])}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}}else"all"===t?n=Log:n[e]=Log[e];var c={},f={},u={},_=0,h=0,m={},v=0,b=0,y={},k=0,x=0,C=0,w=0,S=0,T={},L=["item","夺取KFB","VIP小时","神秘","燃烧伤害","命中","闪避","暴击比例","暴击几率","防御","有效道具","无效道具"];for(var I in n){var D=!0,E=!1,M=void 0;try{for(var F,U=n[I][Symbol.iterator]();!(D=(F=U.next()).done);D=!0){var A=F.value,B=A.type,N=A.action,P=A.gain,j=A.pay,O=A.notStat;if("undefined"!=typeof B&&"undefined"==typeof O){if("object"===$.type(P)){var K=!0,R=!1,q=void 0;try{for(var V,G=Object.keys(P)[Symbol.iterator]();!(K=(V=G.next()).done);K=!0){var z=V.value;L.includes(z)||("undefined"==typeof c[z]?c[z]=P[z]:c[z]+=P[z])}}catch(e){R=!0,q=e}finally{try{!K&&G.return&&G.return()}finally{if(R)throw q}}}if("object"===$.type(j)){var H=!0,Q=!1,W=void 0;try{for(var J,X=Object.keys(j)[Symbol.iterator]();!(H=(J=X.next()).done);H=!0){var Y=J.value;L.includes(Y)||("undefined"==typeof f[Y]?f[Y]=j[Y]:f[Y]+=j[Y])}}catch(e){Q=!0,W=e}finally{try{!H&&X.return&&X.return()}finally{if(Q)throw W}}}if("使用道具"!==B&&"循环使用道具"!==B||"object"!==$.type(P)){if("统计道具购买价格"===B&&"object"===$.type(j)&&"undefined"!=typeof j.KFB){var Z=/共有`(\d+)`个【`Lv.\d+：(.+?)`】道具统计成功，总计价格：`[^`]+?`，平均价格：`[^`]+?`\(`(\d+)%`\)，最低价格：`[^`]+?`\(`(\d+)%`\)，最高价格：`[^`]+?`\(`(\d+)%`\)/.exec(N);if(Z){var ee=parseInt(Z[1]),te=Z[2];"undefined"==typeof T[te]&&(T[te]={"道具数量":0,"总计价格":0,"总计价格比例":0,"最低价格比例":0,"最高价格比例":0}),k+=ee,T[te]["道具数量"]+=ee,x+=Math.abs(j.KFB),T[te]["总计价格"]+=Math.abs(j.KFB),C+=parseInt(Z[3])*ee,T[te]["总计价格比例"]+=parseInt(Z[3])*ee,(w<=0||parseInt(Z[4])<w)&&(w=parseInt(Z[4])),parseInt(Z[5])>S&&(S=parseInt(Z[5])),(T[te]["最低价格比例"]<=0||parseInt(Z[4])<T[te]["最低价格比例"])&&(T[te]["最低价格比例"]=parseInt(Z[4])),parseInt(Z[5])>T[te]["最高价格比例"]&&(T[te]["最高价格比例"]=parseInt(Z[5]))}}}else{var ne=/【`Lv.(\d+)：(.+?)`】/.exec(N);if(ne){var ae=parseInt(ne[1]),ie=ne[2];P["有效道具"]>0&&(_+=P["有效道具"],ae>=3&&(h+=P["有效道具"]),"undefined"==typeof m[ie]&&(m[ie]=0),m[ie]+=P["有效道具"]),P["无效道具"]>0&&(v+=P["无效道具"],ae>=3&&(b+=P["无效道具"]),"undefined"==typeof y[ie]&&(y[ie]=0),y[ie]+=P["无效道具"])}}}}}catch(e){E=!0,M=e}finally{try{!D&&U.return&&U.return()}finally{if(E)throw M}}}var oe="",re=["KFB","经验值","能量","贡献","道具","已使用道具","卡片"];oe+="<strong>收获：</strong>";var le=!0,de=!1,se=void 0;try{for(var pe,ce=d.getSortedObjectKeyList(re,c)[Symbol.iterator]();!(le=(pe=ce.next()).done);le=!0){var fe=pe.value;u[fe]=c[fe],oe+="<i>"+fe+"<em>+"+c[fe].toLocaleString()+"</em></i> "}}catch(e){de=!0,se=e}finally{try{!le&&ce.return&&ce.return()}finally{if(de)throw se}}oe+="<br><strong>付出：</strong>";var ue=!0,_e=!1,ge=void 0;try{for(var he,me=d.getSortedObjectKeyList(re,f)[Symbol.iterator]();!(ue=(he=me.next()).done);ue=!0){var ve=he.value;"undefined"==typeof u[ve]?u[ve]=f[ve]:u[ve]+=f[ve],oe+="<i>"+ve+"<ins>"+f[ve].toLocaleString()+"</ins></i> "}}catch(e){_e=!0,ge=e}finally{try{!ue&&me.return&&me.return()}finally{if(_e)throw ge}}oe+="<br><strong>结余：</strong>";var be=!0,ye=!1,ke=void 0;try{for(var xe,Ce=d.getSortedObjectKeyList(re,u)[Symbol.iterator]();!(be=(xe=Ce.next()).done);be=!0){var we=xe.value;oe+="<i>"+we+d.getStatFormatNumber(u[we])+"</i> "}}catch(e){ye=!0,ke=e}finally{try{!be&&Ce.return&&Ce.return()}finally{if(ye)throw ke}}oe+='<div style="margin: 5px 0; border-bottom: 1px dashed #ccccff;"></div>';var $e=["零时迷子的碎片","被遗弃的告白信","学校天台的钥匙","TMA最新作压缩包","LOLI的钱包","棒棒糖","蕾米莉亚同人漫画","十六夜同人漫画","档案室钥匙","傲娇LOLI娇蛮音CD","整形优惠卷","消逝之药"];oe+='\n<strong>有效道具统计：</strong><i>有效道具<span class="pd_stat_extra"><em>+'+_.toLocaleString()+"</em>"+('(<em title="3级以上有效道具">+'+h.toLocaleString()+"</em>)</i></span> ");var Se=!0,Te=!1,Le=void 0;try{for(var Ie,De=d.getSortedObjectKeyList($e,m)[Symbol.iterator]();!(Se=(Ie=De.next()).done);Se=!0){var Ee=Ie.value;oe+="<i>"+Ee+"<em>+"+m[Ee].toLocaleString()+"</em></i> "}}catch(e){Te=!0,Le=e}finally{try{!Se&&De.return&&De.return()}finally{if(Te)throw Le}}oe+='<br><strong>无效道具统计：</strong><i>无效道具<span class="pd_stat_extra"><em>+'+v.toLocaleString()+"</em>"+('(<em title="3级以上无效道具">+'+b.toLocaleString()+"</em>)</i></span> ");var Me=!0,Fe=!1,Ue=void 0;try{for(var Ae,Be=d.getSortedObjectKeyList($e,y)[Symbol.iterator]();!(Me=(Ae=Be.next()).done);Me=!0){var Ne=Ae.value;oe+="<i>"+Ne+"<em>+"+y[Ne].toLocaleString()+"</em></i> "}}catch(e){Fe=!0,Ue=e}finally{try{!Me&&Be.return&&Be.return()}finally{if(Fe)throw Ue}}var Pe="",je=d.getObjectKeyList(T,0);je.sort(function(e,t){return g.getLevelByName(e)>g.getLevelByName(t)});var Oe=!0,Ke=!1,Re=void 0;try{for(var qe,Ve=je[Symbol.iterator]();!(Oe=(qe=Ve.next()).done);Oe=!0){var Ge=qe.value,ze=T[Ge];Pe+='<i class="pd_custom_tips" title="总价：'+ze["总计价格"].toLocaleString()+"，"+("平均价格比例："+(ze["道具数量"]>0?d.getFixedNumberLocaleString(ze["总计价格比例"]/ze["道具数量"],2):0)+"%，")+("最低价格比例："+ze["最低价格比例"]+"%，最高价格比例："+ze["最高价格比例"]+'%">'+Ge+"<em>+"+ze["道具数量"]+"</em></i> ")}}catch(e){Ke=!0,Re=e}finally{try{!Oe&&Ve.return&&Ve.return()}finally{if(Ke)throw Re}}return oe+="<br><strong>购买道具统计：</strong><i>道具<em>+"+k+"</em></i> "+('<i>道具价格<span class="pd_stat_extra"><em title="道具总价">+'+x.toLocaleString()+"</em>")+('(<em title="平均价格比例">'+(k>0?d.getFixedNumberLocaleString(C/k,2):0)+"%</em>|")+('<em title="最低价格比例">'+w+'%</em>|<em title="最高价格比例">'+S+"%</em>)</span></i> "+Pe)},y=function(){if(!($("#pd_im_or_ex_log").length>0)){(0,u.read)();var e='\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label style="color: #f00;"><input type="radio" name="pd_im_or_ex_log_type" value="setting" checked> 导入/导出日志</label>\n    <label style="color: #00f"><input type="radio" name="pd_im_or_ex_log_type" value="text"> 导出日志文本</label>\n  </div>\n  <div id="pd_im_or_ex_log_setting">\n    <strong>导入日志：</strong>将日志内容粘贴到文本框中并点击合并或覆盖按钮即可<br>\n    <strong>导出日志：</strong>复制文本框里的内容并粘贴到文本文件里即可<br>\n    <textarea id="pd_log_setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n  </div>\n  <div id="pd_im_or_ex_log_text" style="display: none;">\n    <strong>导出日志文本</strong>：复制文本框里的内容并粘贴到文本文件里即可\n    <div>\n      <label title="按时间顺序排序"><input type="radio" name="pd_log_sort_type_2" value="time" checked>按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="pd_log_sort_type_2" value="type">按类别</label>\n      <label title="在日志文本里显示每日以及全部数据的统计结果"><input type="checkbox" id="pd_log_show_stat" checked>显示统计</label>\n    </div>\n    <textarea id="pd_log_text" style="width: 600px; height: 400px;" readonly></textarea>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <button data-action="merge">合并日志</button><button data-action="overwrite" style="color: #f00;">覆盖日志</button><button>关闭</button>\n</div>',t=p.create("pd_im_or_ex_log","导入或导出日志",e);t.find('[name="pd_log_sort_type_2"], #pd_log_show_stat').click(function(){k(),$("#pd_log_text").select()}).end().find('[name="pd_im_or_ex_log_type"]').click(function(){var e=$(this).val();$("#pd_im_or_ex_log_"+("text"===e?"setting":"text")).hide(),$("#pd_im_or_ex_log_"+("text"===e?"text":"setting")).show(),$("#pd_log_"+("text"===e?"text":"setting")).select()}).end().find(".pd_cfg_btns > button").click(function(e){e.preventDefault();var t=$(this).data("action");if("merge"!==t&&"overwrite"!==t)return p.close("pd_im_or_ex_log");if(confirm("是否将文本框中的日志"+("overwrite"===t?"覆盖":"合并")+"到本地日志？")){var n=$.trim($("#pd_log_setting").val());if(n){try{n=JSON.parse(n)}catch(e){return void alert("日志有错误")}return n&&"object"===$.type(n)?("merge"===t&&(n=(0,u.getMergeLog)(Log,n)),r.default.w.Log=n,(0,u.write)(),alert("日志已导入"),location.reload(),void 0):void alert("日志有错误")}}}),p.show("pd_im_or_ex_log"),$("#pd_log_setting").val(JSON.stringify(Log)).select(),$('input[name="pd_log_sort_type_2"][value="'+Config.logSortType+'"]').prop("checked",!0).triggerHandler("click"),(0,c.run)("LogDialog.showImportOrExportLogDialog_after_")}},k=function(){var e=$('input[name="pd_log_sort_type_2"]:checked').val(),t=$("#pd_log_show_stat").prop("checked"),n="",a="",i=!0,o=!1,r=void 0;try{for(var l,d=Object.keys(Log)[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var s=l.value;Array.isArray(Log[s])&&(a>s&&(a=s),n+="【"+s+"】(共"+Log[s].length+"项)\n"+("type"===e?"":"\n")+m(s,e).replace(/<h3>/g,"\n").replace(/<\/h3>/g,"\n").replace(/<\/p>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"").replace(/`/g,""),t&&(n+="-".repeat(46)+"\n合计：\n"+b(s,"cur").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")+"\n"),n+="=".repeat(46)+"\n")}}catch(e){o=!0,r=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw r}}n&&t&&(n+="\n总计：\n"+b(a,"all").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")),$("#pd_log_text").val(n)}},{"./Config":4,"./Dialog":7,"./Func":8,"./Info":10,"./Item":11,"./Log":12,"./Util":21}],14:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};
if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.addUserLinkInPkListPage=n.enhanceLootIndexPage=void 0;var i=e("./Item"),o=a(i),r=(n.enhanceLootIndexPage=function(){var e=$(".kf_fw_ig1"),t=e.find("> tbody > tr:nth-child(3) > td:first-child"),n=t.next("td"),a=d(),i=o.getItemUsedInfo(e.find("> tbody > tr:nth-child(4) > td").html());t.html(t.html().replace("技能伤害：攻击伤害+(体质点数*4)",'技能伤害：<span class="pd_custom_tips" id="pd_skill_attack" title="攻击伤害+(体质点数*4)"></span>')),t.find("br").each(function(e){var t="";switch(e){case 1:t="s1";break;case 2:t="s2";break;case 3:t="d1";break;case 4:t="d2";break;case 6:t="i1";break;case 7:t="i2"}t&&$(this).before(' <span style="color:#777" id="pd_new_'+t+'"></span>')}),n.find('[type="text"]').attr("type","number").attr("min",1).attr("max",999).prop("required",!0).css("width","60px"),n.find("input[readonly]").attr("min",0).prop("disabled",!0).removeProp("required",!0),n.prepend('<span class="pd_highlight">剩余属性点：<span id="pd_surplus_point"></span></span><br>'),n.on("change",'[type="number"]',function(){var t=$(this);$("#pd_surplus_point").text(a["可分配属性点"]-r()),s(t,a,i),l(t);var n=0,o=/\d+/.exec(e.find('[name="s1"]').next("span").next(".pd_point_sum").text());o&&(n=5*parseInt(o[0])),n+=4*parseInt(e.find('[name="s2"]').val()),$("#pd_skill_attack").text(n)}).on("click",".pd_point_sum",function(){var e=a["可分配属性点"]-r();if(e){var t=$(this).prev("span").prev('[type="number"]'),n=parseInt(t.val());(isNaN(n)||n<0)&&(n=0),t.val(n+e).trigger("change")}}).find("form").submit(function(){var e=a["可分配属性点"]-r();return e<0?(alert("剩余属性点为负，请重新填写"),!1):e>0?confirm("你的可分配属性点尚未用完，是否提交？"):void 0}).find('[type="number"]').trigger("change"),p()},function(){var e=0;return $(".kf_fw_ig1").find('[type="number"]').each(function(){var t=parseInt($(this).val());t&&t>0&&(e+=t)}),e}),l=function(e){var t=parseInt(e.val());(isNaN(t)||t<0)&&(t=0);var n=parseInt(e.next("span").text()),a=e.next("span").next(".pd_point_sum");a.length||(a=$('<span class="pd_point_sum" style="color: #ff0033; cursor: pointer;" title="点击：给该项加上或减去剩余属性点"></span>').insertAfter(e.next("span"))),a.text("="+(t+n))},d=function(){var e={"攻击力":0,"最大生命值":0,"攻击速度":0,"暴击几率":0,"技能释放概率":0,"防御":0,"可分配属性点":0},t=$(".kf_fw_ig1 > tbody > tr:nth-child(3) > td:first-child").html(),n=/攻击力：(\d+)/.exec(t);return n&&(e["攻击力"]=parseInt(n[1])),n=/生命值：\d+\s*\(最大(\d+)\)/.exec(t),n&&(e["最大生命值"]=parseInt(n[1])),n=/攻击速度：(\d+)/.exec(t),n&&(e["攻击速度"]=parseInt(n[1])),n=/暴击几率：(\d+)%/.exec(t),n&&(e["暴击几率"]=parseInt(n[1])),n=/技能释放概率：(\d+)%/.exec(t),n&&(e["技能释放概率"]=parseInt(n[1])),n=/防御：(\d+)%/.exec(t),n&&(e["防御"]=parseInt(n[1])),n=/可分配属性点：(\d+)/.exec(t),n&&(e["可分配属性点"]=parseInt(n[1])),e},s=function(e,t,n){var a=e.attr("name"),i=parseInt(e.val());(isNaN(i)||i<0)&&(i=0);var o=parseInt(e.get(0).defaultValue),r=parseInt(e.next("span").text()),l=0,d=0,s="";switch(a){case"s1":l=5*(i+r),d=l-t["攻击力"];break;case"s2":l=20*(i+r)+(50===n["蕾米莉亚同人漫画"]?700:0),d=l-t["最大生命值"];break;case"d1":l=2*(i+r)+(50===n["十六夜同人漫画"]?100:0),d=l-t["攻击速度"];break;case"d2":l=i+r,l=Math.round(l/(l+100)*100),d=l-t["暴击几率"],s="%";break;case"i1":l=i+r,l=Math.round(l/(l+120)*100),d=l-t["技能释放概率"],s="%";break;case"i2":l=i+r,l=Math.round(l/(l+150)*100),d=l-t["防御"],s="%"}i!==o?$("#pd_new_"+a).html(' (<span style="color:#00F">'+l+s+'</span>|<span style="color:'+(d>=0?"#ff0033":"#339933")+'">'+((d>=0?"+":"")+d+"</span>)")):$("#pd_new_"+a).html("")},p=function(){var e=$(".kf_fw_ig1 > tbody > tr:nth-child(5) > td"),t=e.html().match(/获得\d+经验和\d+KFB/g),n=0,a=0,i=!0,o=!1,r=void 0;try{for(var l,d=t[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var s=l.value,p=/获得(\d+)经验和(\d+)KFB/.exec(s);n+=parseInt(p[1]),a+=parseInt(p[2])}}catch(e){o=!0,r=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw r}}(n||a)&&e.prepend('<b class="pd_stat">你总共获得了<em>'+n.toLocaleString()+"</em>经验和<em>"+a.toLocaleString()+"</em>KFB</b><br>")};n.addUserLinkInPkListPage=function(){$(".kf_fw_ig1 > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>")})}},{"./Item":11}],15:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.destroy=n.remove=n.wait=n.show=void 0;var i=e("./Info"),o=a(i),r=n.show=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.msg,n=void 0===t?"":t,a=e.duration,i=void 0===a?Config.defShowMsgDuration:a,r=e.clickable,s=void 0===r||r,p=e.preventable,c=void 0!==p&&p;arguments.length>0&&("string"==typeof arguments[0]&&(n=arguments[0]),"number"==typeof arguments[1]&&(i=arguments[1])),$(".pd_msg").length>20&&d();var f=$(".pd_msg_container"),u=0===f.length;if(!u&&!$(".pd_mask").length){var _=$(".pd_msg:last");if(_.length>0){var g=_.offset().top,h=$(window).scrollTop();(g<h||g>=h+$(window).height()-_.outerHeight()-10)&&(d(),u=!0)}}c&&!$(".pd_mask").length&&$('<div class="pd_mask"></div>').appendTo("body"),u&&(f=$('<div class="pd_msg_container"></div>').appendTo("body"));var m=$('<div class="pd_msg">'+n+"</div>").appendTo(f);m.on("click","a.pd_stop_action",function(e){e.preventDefault(),$(this).html("正在停止&hellip;").closest(".pd_msg").data("stop",!0)}),s&&m.css("cursor","pointer").click(function(){$(this).stop(!0,!0).fadeOut("slow",function(){l($(this))})}).find("a").click(function(e){e.stopPropagation()});var v=$(window).width(),b=$(window).height(),y=m.outerWidth(),k=m.outerHeight();o.default.isMobile&&b>1e3&&(b/=2);var x=$(window).scrollTop();x<b/2&&(x=0);var C=v/2+(o.default.isMobile?$(window).scrollLeft()/3:0)-y/2;C+y>v&&(C=v-y-20),C<0&&(C=0),u?f.css("top",b/2+(o.default.isMobile?x:0)-k/2):f.stop(!1,!0).animate({top:"-="+k/1.75});var w=m.prev(".pd_msg");return m.css({top:w.length>0?parseInt(w.css("top"))+w.outerHeight()+5:0,left:C}).fadeIn("slow"),i!==-1&&m.delay(1e3*i).fadeOut("slow",function(){l($(this))}),m},l=(n.wait=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return r({msg:e,duration:-1,clickable:!1,preventable:t})},n.remove=function(e){var t=e.parent();e.remove(),$(".pd_msg").length?$("#pd_remaining_num").length||$(".pd_mask").remove():(t.remove(),$(".pd_mask").remove())}),d=n.destroy=function(){$(".pd_msg_container").remove(),$(".pd_mask").remove()}},{"./Info":10}],16:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.modifyFaq=n.addUserNameLinkInRankPage=n.showSelfRatingErrorSizeSubmitWarning=n.highlightRatingErrorSize=n.syncModifyPerPageFloorNum=n.addAutoChangeIdColorButton=n.addMsgSelectButton=n.modifyMyPostLink=n.addFollowAndBlockAndMemoUserLink=n.addFastDrawMoneyLink=n.highlightUnReadAtTipsMsg=n.addFastGotoThreadPageLink=n.highlightNewPost=void 0;var o=e("./Info"),r=i(o),l=e("./Util"),d=a(l),s=e("./Msg"),p=a(s),c=e("./Const"),f=i(c),u=e("./Config"),_=e("./ConfigDialog"),g=e("./TmpLog"),h=a(g),m=e("./Public"),v=a(m),b=e("./Bank"),y=a(b);n.highlightNewPost=function(){$(".thread1 > tbody > tr > td:last-child").has("a.bl").each(function(){var e=$(this).html();/\|\s*\d{2}:\d{2}<br>\n.*\d{2}:\d{2}/.test(e)&&(e=e.replace(/(\d{2}:\d{2})<br>/,'<span class="pd_highlight">$1</span><br>'),$(this).html(e))})},n.addFastGotoThreadPageLink=function(){$('.threadtit1 > a[href^="read.php"]').each(function(){var e=$(this),t=e.closest("td").next().find("ul > li > a").contents().eq(0).text();if(t&&!(t<Config.perPageFloorNum)){for(var n=e.attr("href"),a=Math.floor(t/Config.perPageFloorNum)+1,i="",o=1;o<a;o++){if(o>Config.maxFastGotoThreadPageNum){o+1<=a&&(i+='..<a href="'+n+"&page="+a+'">'+a+"</a>");break}i+='<a href="'+n+"&page="+(o+1)+'">'+(o+1)+"</a>"}i='<span class="pd_thread_page">&hellip;'+i+"</span>",e.after(i).parent().css("white-space","normal")}})},n.highlightUnReadAtTipsMsg=function(){if($(".kf_share1:first").text().trim()==="含有关键词 “"+r.default.userName+"” 的内容"){var e=d.getCookie(f.default.prevReadAtTipsCookieName);if(e&&/^\d+日\d+时\d+分$/.test(e)){var t="";$(".kf_share1:eq(1) > tbody > tr:gt(0) > td:first-child").each(function(n){var a=$(this),i=a.text().trim();return 0===n&&(t=i),e<i&&t>=i&&(a.addClass("pd_highlight"),void(t=i))}),$(".kf_share1").on("click","td > a",function(){d.deleteCookie(f.default.prevReadAtTipsCookieName)})}}},n.addFastDrawMoneyLink=function(){if($('td:contains("SYSTEM")').length&&$('td:contains("收到了他人转账的KFB")').length){var e=$(".thread2 > tbody > tr:eq(-2) > td:last"),t=e.html(),n=/给你转帐(\d+)KFB/i.exec(t);n&&!function(){var a=parseInt(n[1]);e.html(t.replace(/会员\[(.+?)\]通过论坛银行/,'会员[<a target="_blank" href="profile.php?action=show&username=$1">$1</a>]通过论坛银行').replace(n[0],'给你转帐<span class="pd_stat"><em>'+a.toLocaleString()+"</em></span>KFB")),$('<br><a title="从活期存款中取出当前转账的金额" href="#">快速取款</a> | <a title="取出银行账户中的所有活期存款" href="#">取出所有存款</a>').appendTo(e).filter("a:eq(0)").click(function(e){e.preventDefault(),p.destroy(),y.drawCurrentDeposit(a)}).end().filter("a:eq(1)").click(function(e){e.preventDefault(),p.destroy(),p.wait("<strong>正在获取当前活期存款金额&hellip;</strong>"),$.get("hack.php?H_name=bank&t="+(new Date).getTime(),function(e){p.destroy();var t=/活期存款：(\d+)KFB<br/.exec(e);if(!t)return void alert("获取当前活期存款金额失败");var n=parseInt(t[1]);return n<=0?void p.show("当前活期存款余额为零",-1):void y.drawCurrentDeposit(n)})}),$('a[href^="message.php?action=write&remid="]').attr("href","#").addClass("pd_disabled_link").click(function(e){e.preventDefault(),alert("本短消息由系统发送，请勿直接回复；如需回复，请点击给你转账的用户链接，向其发送短消息")})}()}},n.addFollowAndBlockAndMemoUserLink=function(){var e=/(.+?)\s*详细信息/.exec($('td:contains("详细信息")').text());if(e){var t=$.trim(e[1]);$('<span>[<a href="#">关注用户</a>] [<a href="#">屏蔽用户</a>]</span><br><span>[<a href="#">添加备注</a>]</span><br>').appendTo($('a[href^="message.php?action=write&touid="]').parent()).find("a").each(function(){var e=$(this);if(e.is('a:contains("备注")')){var n="";for(var a in Config.userMemoList)if(a===t){n=Config.userMemoList[a];break}if(""!==n){e.text("修改备注").data("memo",n);var i=$(".log1 > tbody > tr:last-child > td:last-child");i.html("备注："+n+"<br>"+i.html())}}else{var o="关注",r=Config.followUserList;e.text().indexOf("屏蔽")>-1&&(o="屏蔽",r=Config.blockUserList),d.inFollowOrBlockUserList(t,r)>-1&&e.addClass("pd_highlight").text("解除"+o)}}).click(function(e){e.preventDefault(),(0,u.read)();var n=$(this);if(n.is('a:contains("备注")')){var a=n.data("memo");a||(a="");var i=prompt("为此用户添加备注（要删除备注请留空）：",a);if(null===i)return;Config.userMemoEnabled||(Config.userMemoEnabled=!0),i=$.trim(i),i?(Config.userMemoList[t]=i,n.text("修改备注")):(delete Config.userMemoList[t],n.text("添加备注")),n.data("memo",i),(0,u.write)()}else{var o="关注",r=Config.followUserList;if(n.text().includes("屏蔽")?(o="屏蔽",r=Config.blockUserList,Config.blockUserEnabled||(Config.blockUserEnabled=!0)):Config.followUserEnabled||(Config.followUserEnabled=!0),n.text()==="解除"+o){var l=d.inFollowOrBlockUserList(t,r);l>-1&&(r.splice(l,1),(0,u.write)()),n.removeClass("pd_highlight").text(o+"用户"),alert("该用户已被解除"+o)}else{if(d.inFollowOrBlockUserList(t,r)===-1){if("屏蔽"===o){var s=Config.blockUserDefaultType;if(s=prompt("请填写屏蔽类型，0：屏蔽主题和回帖；1：仅屏蔽主题；2：仅屏蔽回帖",s),null===s)return;s=parseInt(s),(isNaN(s)||s<0||s>2)&&(s=Config.blockUserDefaultType),r.push({name:t,type:s})}else r.push({name:t});(0,u.write)()}n.addClass("pd_highlight").text("解除"+o),alert("该用户已被"+o)}}})}},n.modifyMyPostLink=function(){$('.t a[href^="read.php?tid="]').each(function(){var e=$(this);e.attr("href",e.attr("href").replace(/&uid=\d+#(\d+)/,"&spid=$1"))})},n.addMsgSelectButton=function(){$('<input value="自定义" type="button" style="margin-right: 3px;">').insertBefore('input[type="button"][value="全选"]').click(function(e){e.preventDefault();var t=$.trim(prompt("请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）","收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除"));""!==t&&!function(){var e=t.split("|");$(".thread1 > tbody > tr > td:nth-child(2) > a").each(function(){var t=$(this),n=!0,a=!1,i=void 0;try{for(var o,r=e[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;t.text().toLowerCase().includes(l.toLowerCase())&&t.closest("tr").find('td:last-child > input[type="checkbox"]').prop("checked",!0)}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}})}()}).parent().attr("colspan",4).prev("td").attr("colspan",3),$('<input value="反选" type="button" style="margin-left: 5px; margin-right: 1px;">').insertAfter('input[type="button"][value="全选"]').click(function(e){e.preventDefault(),$('.thread1 > tbody > tr > td:last-child > input[type="checkbox"]').each(function(){var e=$(this);e.prop("checked",!e.prop("checked"))})})},n.addAutoChangeIdColorButton=function(){var e=$('table div > table > tbody > tr > td:contains("自定义ID颜色")');$('<span class="pd_highlight">低等级没人权？没有自己喜欢的颜色？快来试试助手的<a href="#">自定义本人神秘颜色</a>的功能吧！（虽然仅限自己可见 ╮(╯▽╰)╭）</span><br>').appendTo(e).find("a").click(function(e){e.preventDefault(),(0,_.show)()});var t=e.parent("tr").nextAll("tr").not("tr:last");t.find("a").length<=1||($('<form><div id="pd_auto_change_sm_color_btns" style="margin-top: 5px;">\n<label><input id="pd_cfg_auto_change_sm_color_enabled" class="pd_input" type="checkbox"> 自动更换ID颜色</label></div></form>').appendTo(e).find("#pd_cfg_auto_change_sm_color_enabled").click(function(){var e=$(this),n=e.prop("checked");if(n!==Config.autoChangeSMColorEnabled&&((0,u.read)(),Config.autoChangeSMColorEnabled=n,(0,u.write)()),n){t.addClass("pd_sm_color_select").find("td:not(:has(a))").css("cursor","not-allowed"),$('\n<label>更换顺序\n  <select id="pd_cfg_auto_change_sm_color_type" style="font-size: 12px;">\n    <option value="random">随机</option>\n    <option value="sequence">顺序</option>\n  </select>\n</label>\n<label>每隔 <input id="pd_cfg_auto_change_sm_color_interval" class="pd_input" style="width: 25px;" type="text" maxlength="5"> 小时</label>\n<button>保存</button><button style="margin-left: 3px;">重置</button><br>\n<a href="#">全选</a><a style="margin-left: 7px; margin-right: 10px;" href="#">反选</a>\n<label><input id="pd_cfg_change_all_available_sm_color_enabled" class="pd_input" type="checkbox"> 选择当前所有可用的ID颜色</label>\n').insertAfter(e.parent()).filter("button:first").click(function(e){e.preventDefault();var n=$("#pd_cfg_auto_change_sm_color_interval"),a=parseInt(n.val());if(isNaN(a)||a<=0)return alert("ID颜色更换时间间隔格式不正确"),n.select(),void n.focus();var i=$("#pd_cfg_change_all_available_sm_color_enabled").prop("checked"),o=[];if(t.find('input[type="checkbox"]:checked').each(function(){o.push(parseInt($(this).val()))}),!i&&o.length<=1)return void alert("必须选择2种或以上的ID颜色");o.length<=1&&(o=[]);var r=Config.autoChangeSMColorInterval;(0,u.read)(),Config.autoChangeSMColorType=$("#pd_cfg_auto_change_sm_color_type").val().toLowerCase(),Config.autoChangeSMColorInterval=a,Config.changeAllAvailableSMColorEnabled=i,Config.customAutoChangeSMColorList=o,(0,u.write)(),r!==Config.autoChangeSMColorInterval&&d.deleteCookie(f.default.autoChangeSMColorCookieName),alert("设置保存成功")}).end().filter("button:eq(1)").click(function(e){e.preventDefault(),(0,u.read)(),Config.autoChangeSMColorEnabled=u.Config.autoChangeSMColorEnabled,Config.autoChangeSMColorType=u.Config.autoChangeSMColorType,Config.autoChangeSMColorInterval=u.Config.autoChangeSMColorInterval,Config.changeAllAvailableSMColorEnabled=u.Config.changeAllAvailableSMColorEnabled,Config.customAutoChangeSMColorList=u.Config.customAutoChangeSMColorList,(0,u.write)(),d.deleteCookie(f.default.autoChangeSMColorCookieName),h.deleteValue(f.default.prevAutoChangeSMColorIdTmpLogName),alert("设置已重置"),location.reload()}).end().filter("a").click(function(e){return e.preventDefault(),t.find("input[disabled]").length>0?(alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),void $("#pd_cfg_change_all_available_sm_color_enabled").focus()):void($(this).is("#pd_auto_change_sm_color_btns > a:first")?t.find('input[type="checkbox"]').prop("checked",!0):t.find('input[type="checkbox"]').each(function(){$(this).prop("checked",!$(this).prop("checked"))}))}),t.find("td:has(a)").each(function(){var e=$(this),t=/&color=(\d+)/i.exec(e.find("a").attr("href"));t&&e.append('<input type="checkbox" class="pd_input" value="'+t[1]+'">')}),$("#pd_cfg_auto_change_sm_color_type").val(Config.autoChangeSMColorType),$("#pd_cfg_auto_change_sm_color_interval").val(Config.autoChangeSMColorInterval),$("#pd_cfg_change_all_available_sm_color_enabled").click(function(){t.find("input").prop("disabled",$(this).prop("checked"))}).prop("checked",Config.changeAllAvailableSMColorEnabled).triggerHandler("click");for(var a in Config.customAutoChangeSMColorList)t.find('input[value="'+Config.customAutoChangeSMColorList[a]+'"]').prop("checked",!0)}else e.parent().nextAll().remove(),t.removeClass("pd_sm_color_select").find("input").remove()}),t.on("click","td",function(e){if(!$(e.target).is("a")){var t=$(this);t.find("input[disabled]").length>0?(alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),$("#pd_cfg_change_all_available_sm_color_enabled").focus()):$(e.target).is("input")||t.find("input").click()}}),Config.autoChangeSMColorEnabled&&$("#pd_cfg_auto_change_sm_color_enabled").prop("checked",!0).triggerHandler("click"),$('div[style="float: right; color: #8080c0;"]:contains("每天捐款附送100经验值")').html("每天捐款附送50经验值"),$('div[style="border-bottom: #8000ff 1px dashed;"] > div:contains("帖子被奖励KFB")').html("帖子被奖励KFB(被协管评分)"))},n.syncModifyPerPageFloorNum=function(){var e=function(){var e=parseInt($('select[name="p_num"]').val());isNaN(e)||(e||(e=10),e!==Config.perPageFloorNum&&(Config.perPageFloorNum=e,(0,u.write)()))};$("form#creator").submit(function(){(0,u.read)(),e()}),e()},n.highlightRatingErrorSize=function(){$('.adp1 a[href^="read.php?tid="]').each(function(){var e=$(this),t=e.text(),n=0,a=e.parent("td").next("td"),i=/认定\[(\d+)\]/i.exec(a.text());i&&(n=parseInt(i[1]));var o=v.checkRatingSize(t,n),r=o.type,l=o.titleSize;r===-1?a.css("color","#ff9933").attr("title","标题文件大小无法解析").addClass("pd_custom_tips"):1===r&&a.addClass("pd_highlight pd_custom_tips").attr("title","标题文件大小("+l.toLocaleString()+"M)与认定文件大小("+n.toLocaleString()+"M)不一致")})},n.showSelfRatingErrorSizeSubmitWarning=function(){$('form[name="mail1"]').submit(function(){var e=parseFloat($('[name="psize"]').val());if(!(isNaN(e)||e<=0)){2===parseInt($('[name="psizegb"]').val())&&(e*=1024);var t=$('.adp1 a[href^="read.php?tid="]').text(),n=v.checkRatingSize(t,e),a=n.type,i=n.titleSize;return 1===a?confirm("标题文件大小("+i.toLocaleString()+"M)与认定文件大小("+e.toLocaleString()+"M)不一致，是否继续？"):void 0}})},n.addUserNameLinkInRankPage=function(){$(".kf_no11:eq(2) > tbody > tr:gt(0) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===r.default.userName&&e.find("a").addClass("pd_highlight")})},n.modifyFaq=function(){var e=parseInt(d.getUrlParam("id")),t=$(".kf_share1 > tbody > tr:nth-child(2) > td:last-child > div:last-child");if(1===e){if(848!==t.html().length)return;t.html('\n你可以通过发帖/回贴、参与<a href="kf_fw_ig_index.php" target="_blank">争夺奖励</a>等方式获取KFB（论坛货币）和经验。<br><br>\n发帖/回贴时会获得基本的KFB奖励，每天第一次发帖/回贴还可获得额外经验奖励。<br>\n发帖请先阅读规定避免违规，在你还没有时间阅读全部规定之前，请至少注意以下几点：<br>\n不要发表纯水帖；不要纯复制发帖；不要发表政治、广告、恶心的内容；不要攻击、讽刺、挑衅他人；<br>\n不要发表成人图片、视频、小说等内容；不要伪造原创、盗取他人原创。<br><br>\n升级（神秘系数）可以获得不同的等级权限，你可以在<a href="kf_growup.php" target="_blank">等级经验页面</a>进行KFB捐款，\n根据不同的捐款数额获得相应的经验来提升神秘系数。<br>\n注册初始神秘系数为0，为“通常版”等级，拥有大部分的日常权限；提升为神秘系数4时，升级为“初回限定版”等级，拥有部分追加的权限。<br>\n部分板块需要一定神秘系数以上才可进入，如打开帖子时出现“error&hellip;”的提示，说明你当前的神秘系数无法进入该板块。<br><br>\n神秘等级的值以神秘系数为基础，基本上是装饰用的属性，可见于帖子页面各楼层用户名称旁，还可用于选择自定义ID颜色。\n')}}},{"./Bank":2,"./Config":4,"./ConfigDialog":5,"./Const":6,"./Info":10,"./Msg":15,"./Public":18,"./TmpLog":20,"./Util":21}],17:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.modifyPostPreviewPage=n.addExtraOptionInPostPage=n.addExtraPostEditorButton=n.removeUnpairedBBCodeInQuoteContent=n.handleMultiQuote=void 0;var r=e("./Util"),l=i(r),d=e("./Msg"),s=i(d),p=e("./Func"),c=e("./Const"),f=a(c);n.handleMultiQuote=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;(0,p.run)("Post.handleMultiQuote_before_",e),$("#pd_clear_multi_quote_data").length||$('<a id="pd_clear_multi_quote_data" style="margin-left: 7px;" title="清除在浏览器中保存的多重引用数据" href="#">清除引用数据</a>').insertAfter('input[name="diy_guanjianci"]').click(function(t){t.preventDefault(),localStorage.removeItem(f.default.multiQuoteStorageName),$('input[name="diy_guanjianci"]').val(""),2===e?$("#textarea").val(""):$('textarea[name="atc_content"]').val(""),alert("多重引用数据已被清除")});var t=localStorage[f.default.multiQuoteStorageName];if(t){try{t=JSON.parse(t)}catch(e){return}if(t&&"object"===$.type(t)&&!$.isEmptyObject(t)){var n=parseInt(l.getUrlParam("tid")),a=parseInt(l.getUrlParam("fid"));if(n&&"undefined"!=typeof t.tid&&t.tid===n&&Array.isArray(t.quoteList)&&(2!==e||a)){var i=[],r=!0,d=!1,c=void 0;try{for(var u,_=t.quoteList[Symbol.iterator]();!(r=(u=_.next()).done);r=!0){var g=u.value;if(Array.isArray(g)){var h=!0,m=!1,v=void 0;try{for(var b,y=g[Symbol.iterator]();!(h=(b=y.next()).done);h=!0){var k=b.value;i.push(k)}}catch(e){m=!0,v=e}finally{try{!h&&y.return&&y.return()}finally{if(m)throw v}}}}}catch(e){d=!0,c=e}finally{try{!r&&_.return&&_.return()}finally{if(d)throw c}}if(!i.length)return void localStorage.removeItem(f.default.multiQuoteStorageName);var x=new Set,C="";2===e&&(s.wait('<strong>正在获取引用内容中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+i.length+"</em></i>"),$(document).clearQueue("MultiQuote")),$.each(i,function(t,o){"undefined"!=typeof o.floor&&"undefined"!=typeof o.pid&&(x.add(o.userName),2===e?$(document).queue("MultiQuote",function(){$.get("post.php?action=quote&fid="+a+"&tid="+n+"&pid="+o.pid+"&article="+o.floor+"&t="+(new Date).getTime(),function(e){var n=/<textarea id="textarea".*?>((.|\n)+?)<\/textarea>/i.exec(e);n&&(C+=l.getRemoveUnpairedBBCodeQuoteContent(l.htmlDecode(n[1]).replace(/\n{2,}/g,"\n"))+(t===i.length-1?"":"\n"));var a=$("#pd_remaining_num");a.text(parseInt(a.text())-1),t===i.length-1?(s.destroy(),$("#textarea").val(C).focus()):setTimeout(function(){$(document).dequeue("MultiQuote")},100)})}):C+="[quote]回 "+o.floor+"楼("+o.userName+") 的帖子[/quote]\n")}),$('input[name="diy_guanjianci"]').val([].concat(o(x)).join(",")),$('form[name="FORM"]').submit(function(){localStorage.removeItem(f.default.multiQuoteStorageName)}),2===e?$(document).dequeue("MultiQuote"):$('textarea[name="atc_content"]').val(C).focus(),(0,p.run)("Post.handleMultiQuote_after_",e)}}}},n.removeUnpairedBBCodeInQuoteContent=function(){var e=$("#textarea"),t=e.val(),n=/\[quote\](.|\r|\n)+?\[\/quote\]/.exec(t);if(n){var a=l.getRemoveUnpairedBBCodeQuoteContent(n[0]);n[0]!==a&&e.val(t.replace(n[0],a))}},n.addExtraPostEditorButton=function(){var e=$('textarea[name="atc_content"]').get(0);e&&$('\n<span id="wy_post" title="插入隐藏内容" data-type="hide" style="background-position:0 -280px">插入隐藏内容</span>\n<span id="wy_justifyleft" title="左对齐" data-type="left" style="background-position:0 -360px">左对齐</span>\n<span id="wy_justifycenter" title="居中" data-type="center" style="background-position:0 -380px">居中</span>\n<span id="wy_justifyright" title="右对齐" data-type="right" style="background-position:0 -400px">右对齐</span>\n<span id="wy_subscript" title="下标" data-type="sub" style="background-position:0 -80px">下标</span>\n<span id="wy_superscript" title="上标" data-type="sup" style="background-position:0 -100px">上标</span>\n<span class="pd_editor_btn" title="插入飞行文字" data-type="fly">F</span>\n<span class="pd_editor_btn" title="插入HTML5音频" data-type="audio">A</span>\n<span class="pd_editor_btn" title="插入HTML5视频" data-type="video">V</span>\n').appendTo("#editor-button .editor-button").click(function(){var t=$(this),n=t.data("type"),a="";switch(n){case"hide":a=prompt("请输入神秘等级：",5);break;case"audio":a=prompt("请输入HTML5音频实际地址：\n（可直接输入网易云音乐或虾米的单曲地址，将自动转换为外链地址）","http://");var i=/^https?:\/\/music\.163\.com\/(?:#\/)?song\?id=(\d+)/i.exec(a);i&&(a="http://music.miaola.info/163/{0}.mp3".replace("{0}",i[1])),i=/^https?:\/\/www\.xiami\.com\/song\/(\d+)/i.exec(a),i&&(a="http://music.miaola.info/xiami/{0}.mp3".replace("{0}",i[1]));break;case"video":a=prompt("请输入HTML5视频实际地址：\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）","http://");var o=/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w\-]+)/i.exec(a);o&&(a="http://video.miaola.info/youtube/{0}".replace("{0}",o[1])),o=/^https?:\/\/youtu\.be\/([\w\-]+)$/i.exec(a),o&&(a="http://video.miaola.info/youtube/{0}".replace("{0}",o[1]))}if(null!==a){var r="",d="";switch(n){case"hide":r=l.getSelText(e),d="[hide="+a+"]"+r+"[/hide]";break;case"left":r=l.getSelText(e),d="[align=left]"+r+"[/align]";break;case"center":r=l.getSelText(e),d="[align=center]"+r+"[/align]";break;case"right":r=l.getSelText(e),d="[align=right]"+r+"[/align]";break;case"fly":r=l.getSelText(e),d="[fly]"+r+"[/fly]";break;case"sub":r=l.getSelText(e),d="[sub]"+r+"[/sub]";break;case"sup":r=l.getSelText(e),d="[sup]"+r+"[/sup]";break;case"audio":d="[audio]"+a+"[/audio]";break;case"video":d="[video]"+a+"[/video]"}d&&(l.addCode(e,d,r),e.focus())}}).mouseenter(function(){$(this).addClass("buttonHover")}).mouseleave(function(){$(this).removeClass("buttonHover")})},n.addExtraOptionInPostPage=function(){$('\n<div class="pd_post_extra_option">\n  <label><input type="checkbox" id="pd_auto_analyze_url" checked> 自动分析url</label><br>\n  <label><input type="checkbox" name="pd_wind_code_auto_convert" checked> Wind Code自动转换</label>\n</div>\n').appendTo($("#menu_show").closest("td")).on("click",'input[type="checkbox"]',function(){var e=$(this),t=e.is("#pd_auto_analyze_url")?"atc_autourl":"atc_convert";$('form[name="FORM"]').find('input[name="'+t+'"]').val(e.prop("checked")?1:0)}),$('<input type="button" value="预览帖子" style="margin-left: 7px;">').insertAfter('input[type="submit"][name="Submit"]').click(function(e){e.preventDefault();var t=$('form[name="preview"]');t.find('input[name="atc_content"]').val($("#textarea").val()),t.submit()})},n.modifyPostPreviewPage=function(){$("table > tbody > tr.tr1 > th").css({"text-align":"left","font-weight":"normal",border:"1px solid #9191ff",padding:"10px"})}},{"./Const":6,"./Func":8,"./Msg":15,"./Util":21}],18:[function(require,module,exports){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkRatingSize=exports.turnPageViaKeyboard=exports.repairBbsErrorCode=exports.addSearchDialogLink=exports.makeSearchByBelowTwoKeyWordAvailable=exports.bindSearchTypeSelectMenuClick=exports.bindElementTitleClick=exports.showElementTitleTips=exports.changeIdColor=exports.runCustomScript=exports.autoSaveCurrentDeposit=exports.addFastNavForSideBar=exports.modifySideBar=exports.blockThread=exports.blockUsers=exports.followUsers=exports.addConfigAndLogDialogLink=exports.startAutoRefreshMode=exports.getMinRefreshInterval=exports.donation=exports.addPolyfill=exports.showFormatLog=exports.preventCloseWindowWhenActioning=exports.appendCss=exports.checkBrowserType=exports.getSafeId=exports.getUidAndUserName=void 0;var _slicedToArray=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Msg=require("./Msg"),Msg=_interopRequireWildcard(_Msg),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Func=require("./Func"),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_ConfigDialog=require("./ConfigDialog"),_Log=require("./Log"),_LogDialog=require("./LogDialog"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),getUidAndUserName=exports.getUidAndUserName=function(){var e=$('.topright a[href^="profile.php?action=show&uid="]').eq(0);if(!e.length)return!1;if(_Info2.default.userName=e.text(),!_Info2.default.userName)return!1;var t=/&uid=(\d+)/.exec(e.attr("href"));return!!t&&(_Info2.default.uid=parseInt(t[1]),!0)},getSafeId=exports.getSafeId=function(){var e=$("input#safeid").val();if(!e){var t=/safeid=(\w+)/i.exec($('a[href*="safeid="]:first').attr("href"));t&&(e=t[1])}return e?e:""},checkBrowserType=exports.checkBrowserType=function(){"auto"===Config.browseType?_Info2.default.isMobile=/(Mobile|MIDP)/i.test(navigator.userAgent):_Info2.default.isMobile="mobile"===Config.browseType},appendCss=exports.appendCss=function(){$("head").append("\n<style>\n  /* 通用 */\n  .pd_mask { position: fixed; width: 100%; height: 100%; left: 0; top: 0; z-index: 1000; }\n  .pd_msg_container { position: "+(_Info2.default.isMobile?"absolute":"fixed")+'; width: 100%; z-index: 1001; }\n  .pd_msg {\n    border: 1px solid #6ca7c0; text-shadow: 0 0 3px rgba(0, 0, 0, 0.1); border-radius: 3px; padding: 12px 40px; text-align: center;\n    font-size: 14px; position: absolute; display: none; color: #333; background: #f8fcfe; background-repeat: no-repeat;\n    background-image: -webkit-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -moz-linear-gradient(top, #f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -o-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -ms-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n  }\n  .pd_msg strong { margin-right: 5px; }\n  .pd_msg i { font-style: normal; padding-left: 10px; }\n  .pd_msg em, .pd_stat em, .pd_msg ins, .pd_stat ins { font-weight: 700; font-style: normal; color:#ff6600; padding: 0 3px; }\n  .pd_msg ins, .pd_stat ins { text-decoration: none; color: #339933; }\n  .pd_msg a { font-weight: bold; margin-left: 15px; }\n  .pd_stat i { font-style: normal; margin-right: 3px; }\n  .pd_stat .pd_notice { margin-left: 5px; }\n  .pd_stat_extra em, .pd_stat_extra ins { padding: 0 2px; cursor: help; }\n  .pd_highlight { color: #ff0000 !important; }\n  .pd_notice, .pd_msg .pd_notice { font-style: italic; color: #666; }\n  .pd_input, .pd_cfg_main input, .pd_cfg_main select { vertical-align: middle; height: auto; margin-right: 0; line-height: 22px; font-size: 12px; }\n  .pd_input[type="text"], .pd_cfg_main input[type="text"] { height: 18px; line-height: 18px; }\n  .pd_input:focus, .pd_cfg_main input[type="text"]:focus, .pd_cfg_main textarea:focus, .pd_textarea:focus { border-color: #7eb4ea; }\n  .pd_textarea, .pd_cfg_main textarea { border: 1px solid #ccc; font-size: 12px; }\n  .readlou .pd_goto_link { color: #000; }\n  .readlou .pd_goto_link:hover { color: #51d; }\n  .pd_fast_goto_floor, .pd_multi_quote_chk { margin-right: 2px; }\n  .pages .pd_fast_goto_page { margin-left: 8px; }\n  .pd_fast_goto_floor span:hover, .pd_fast_goto_page span:hover { color: #51d; cursor: pointer; text-decoration: underline; }\n  .pd_item_btns { text-align: right; margin-top: 5px;  }\n  .pd_item_btns button, .pd_item_btns input { margin-left: 3px; margin-bottom: 2px; vertical-align: middle; }\n  .pd_result { border: 1px solid #99f; padding: 5px; margin-top: 10px; line-height: 2em; }\n  .pd_result_sep { border-bottom: 1px solid #999; margin: 7px 0; }\n  .pd_result_sep_inner { border-bottom: 1px dashed #999; margin: 5px 0; }\n  .pd_thread_page { margin-left: 5px; }\n  .pd_thread_page a { color: #444; padding: 0 3px; }\n  .pd_thread_page a:hover { color: #51d; }\n  .pd_card_chk { position: absolute; bottom: -8px; left: 1px; }\n  .pd_disabled_link { color: #999 !important; text-decoration: none !important; cursor: default; }\n  .b_tit4 .pd_thread_goto, .b_tit4_1 .pd_thread_goto { position: absolute; top: 0; right: 0; padding: 0 15px; }\n  .b_tit4 .pd_thread_goto:hover, .b_tit4_1 .pd_thread_goto:hover { padding-left: 15px; }\n  .pd_custom_tips { cursor: help; }\n  .pd_user_memo { font-size: 12px; color: #999; line-height: 14px; }\n  .pd_user_memo_tips { font-size: 12px; color: #fff; margin-left: 3px; cursor: help; }\n  .pd_user_memo_tips:hover { color: #ddd; }\n  .pd_sm_color_select > td { position: relative; cursor: pointer; }\n  .pd_sm_color_select > td > input { position: absolute; top: 18px; left: 10px; }\n  .pd_used_item_info { color: #666; float: right; cursor: help; margin-right: 5px; }\n  .pd_panel { position: absolute; overflow-y: auto; background-color: #fff; border: 1px solid #9191ff; opacity: 0.9; }\n  #pd_smile_panel img { margin: 3px; cursor: pointer; }\n  .pd_verify_tips { cursor: help; color: #999; }\n  .pd_verify_tips_ok { color: #99cc66; }\n  .pd_verify_tips_conditional { color: #ff9900; }\n  .pd_verify_tips_unable { color: #ff0033; }\n  .pd_verify_tips_details { cursor: pointer; }\n  #pd_monster_loot_info_panel em { font-style: normal; cursor: help; }\n  #pd_attack_log_content {\n    width: 850px; min-height: 160px; max-height: 500px; margin: 5px 0; padding: 5px; border: 1px solid #9191ff; overflow: auto;\n    line-height: 1.6em; background-color: #fff;\n  }\n  .pd_my_items > tbody > tr > td > a + a { margin-left: 15px; }\n  .pd_usable_num { color: #669933; }\n  .pd_used_num { color: #ff0033; }\n  .pd_title_tips {\n    position: absolute; max-width: 470px; font-size: 12px; line-height: 1.5em;\n    padding: 2px 5px; background-color: #fcfcfc; border: 1px solid #767676; z-index: 9999;\n  }\n  .pd_search_type {\n    float: left; height: 26px; line-height: 26px; width: 65px; text-align: center; border: 1px solid #ccc; border-left: none; cursor: pointer;\n  }\n  .pd_search_type i { font-style: normal; margin-left: 5px; font-family: "Microsoft YaHei"; }\n  .pd_search_type_list {\n    position: absolute; width: 63px; background-color: #fcfcfc; border: 1px solid #ccc; border-top: none; line-height: 26px;\n    text-indent: 13px; cursor: pointer; z-index: 1003;\n  }\n  .pd_search_type_list li:hover { color: #fff; background-color: #87c3cf; }\n  .editor-button .pd_editor_btn { background: none; text-indent: 0; line-height: 18px; cursor: default; }\n  .readtext img[onclick] { max-width: 550px; }\n  .pd_post_extra_option { text-align:left; margin-top:5px; margin-left:5px; }\n  .pd_post_extra_option input { vertical-align:middle; height:auto; margin-right:0; }\n  .read_fds { text-align: left !important; font-weight: normal !important; font-style: normal !important; }\n  .pd_item_type_chk { margin-right: 5px; }\n\n  /* 设置对话框 */\n  .pd_cfg_box {\n    position: '+(_Info2.default.isMobile?"absolute":"fixed")+'; border: 1px solid #9191ff; display: none; z-index: 1002;\n    -webkit-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); -moz-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);\n    -o-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);\n  }\n  .pd_cfg_box h1 {text-align: center; font-size: 14px; background-color: #9191ff; color: #fff; line-height: 2em; margin: 0; padding-left: 20px; }\n  .pd_cfg_box h1 span { float: right; cursor: pointer; padding: 0 10px; }\n  #pd_custom_sm_color { width: 360px; }\n  .pd_cfg_nav { text-align: right; margin-top: 5px; margin-bottom: -5px; }\n  .pd_cfg_nav a { margin-left: 10px; }\n  .pd_cfg_main { background-color: #fcfcfc; padding: 0 10px; font-size: 12px; line-height: 22px; min-height: 50px; overflow: auto; }\n  .pd_cfg_main fieldset { border: 1px solid #ccccff; padding: 0 6px 6px; }\n  .pd_cfg_main legend { font-weight: bold; }\n  .pd_cfg_main label input, .pd_cfg_main legend input, .pd_cfg_main label select { margin: 0 5px; }\n  .pd_cfg_main input[type="color"] { height: 18px; width: 30px; padding: 0; }\n  .pd_cfg_main button { vertical-align: middle; }\n  .pd_cfg_main .pd_cfg_tips { color: #51d; text-decoration: none; cursor: help; }\n  .pd_cfg_main .pd_cfg_tips:hover { color: #ff0000; }\n  #pd_config .pd_cfg_main { overflow-x: hidden; white-space: nowrap; }\n  .pd_cfg_panel { display: inline-block; width: 380px; vertical-align: top; }\n  .pd_cfg_panel + .pd_cfg_panel { margin-left: 5px; }\n  .pd_cfg_btns { background-color: #fcfcfc; text-align: right; padding: 5px; }\n  .pd_cfg_btns button { width: 80px; margin-left: 5px; }\n  .pd_cfg_about { float: left; line-height: 24px; margin-left: 5px; }\n  #pd_cfg_custom_monster_name_list td input[type="text"] { width: 140px; }\n  #pd_cfg_follow_user_list, #pd_cfg_block_user_list { max-height: 480px; overflow: auto; }\n  #pd_auto_change_sm_color_btns label { margin-right: 10px; }\n  .pd_cfg_ml { margin-left: 10px; }\n\n  /* 日志对话框 */\n  #pd_log { width: 880px; }\n  .pd_log_nav { text-align: center; margin: -5px 0 -12px; font-size: 14px; line-height: 44px; }\n  .pd_log_nav a { display: inline-block; }\n  .pd_log_nav h2 { display: inline; font-size: 14px; margin-left: 7px; margin-right: 7px; }\n  #pd_log_content { height: 308px; overflow: auto; }\n  #pd_log_content h3 { display: inline-block; font-size: 12px; line-height: 22px; margin: 0; }\n  #pd_log_content h3:not(:first-child) { margin-top: 5px; }\n  #pd_log_content p { line-height: 22px; margin: 0; }\n  #pd_log .pd_stat i { display: inline-block; }\n</style>\n'),
Config.customCssEnabled&&$("head").append("<style>"+Config.customCssContent+"</style>")},preventCloseWindowWhenActioning=exports.preventCloseWindowWhenActioning=function(e){if($(".pd_mask").length>0){var t="操作正在进行中，确定要关闭页面吗？";return e.returnValue=t,t}},showFormatLog=exports.showFormatLog=function(e,t){var n=Util.getResponseMsg(t);n||(n="未能获得预期的回应"),console.log("【"+e+"】回应："+n)},addPolyfill=exports.addPolyfill=function(){Array.prototype.includes||(Array.prototype.includes=function(e){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),n=parseInt(t.length)||0;if(0===n)return!1;var a=parseInt(arguments[1])||0,i=void 0;a>=0?i=a:(i=n+a,i<0&&(i=0));for(var o=void 0;i<n;){if(o=t[i],e===o||e!==e&&o!==o)return!0;i++}return!1})},donation=exports.donation=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Date,n=Util.getDateByTime(Config.donationAfterTime);if(t<n)return void(e&&autoSaveCurrentDeposit());(0,_Func.run)("Public.donation_before_"),console.log("KFB捐款Start");var a=Msg.wait("<strong>正在进行捐款，请稍候&hellip;</strong>"),i=function(){var e=new Date,t=Util.getTimezoneDateByTime("02:00:00");return e>t&&(t=Util.getTimezoneDateByTime("00:00:00"),t.setDate(t.getDate()+1)),e>t&&t.setDate(t.getDate()+1),t},o=function(t){$.post("kf_growup.php?ok=1",{kfb:t},function(n){Util.setCookie(_Const2.default.donationCookieName,1,i()),showFormatLog("捐款"+t+"KFB",n),Msg.remove(a);var o="<strong>捐款<em>"+t+"</em>KFB</strong>",r=/捐款获得(\d+)经验值(?:.*?补偿期(?:.*?\+(\d+)KFB)?(?:.*?(\d+)成长经验)?)?/i.exec(n);if(r){o+="<i>经验值<em>+"+r[1]+"</em></i>";var l={"经验值":parseInt(r[1])};"undefined"==typeof r[2]&&"undefined"==typeof r[3]||(o+='<i style="margin-left: 5px;">(补偿期:</i>'+("undefined"!=typeof r[2]?"<i>KFB<em>+"+r[2]+"</em>"+("undefined"!=typeof r[3]?"":")")+"</i>":"")+("undefined"!=typeof r[3]?"<i>经验值<em>+"+r[3]+"</em>)</i>":""),"undefined"!=typeof r[2]&&(l.KFB=parseInt(r[2])),"undefined"!=typeof r[3]&&(l["经验值"]+=parseInt(r[3]))),(0,_Log.push)("捐款","捐款`"+t+"`KFB",{gain:l,pay:{KFB:-t}})}else{if(!/KFB不足。<br/i.test(n))return;o+='<i class="pd_notice">KFB不足</i><a target="_blank" href="kf_growup.php">手动捐款</a>'}Msg.show(o),e&&autoSaveCurrentDeposit(!0),(0,_Func.run)("Public.donation_after_",n)})};/%$/.test(Config.donationKfb)?$.get("profile.php?action=show&uid="+_Info2.default.uid+"&t="+(new Date).getTime(),function(e){var t=/论坛货币：(-?\d+)\s*KFB/i.exec(e),n=1;t?n=parseInt(t[1]):console.log("当前持有KFB获取失败");var a=parseInt(Config.donationKfb);a=Math.floor(n*a/100),a=a>0?a:1,a=a<=_Const2.default.maxDonationKfb?a:_Const2.default.maxDonationKfb,o(a)}):$.get("kf_growup.php?t="+(new Date).getTime(),function(t){/>今天已经捐款</.test(t)?(Msg.remove(a),Util.setCookie(_Const2.default.donationCookieName,1,i()),e&&autoSaveCurrentDeposit()):o(parseInt(Config.donationKfb))},"html")},getMinRefreshInterval=exports.getMinRefreshInterval=function(){var e=-1;if(Config.autoDonationEnabled){var t=Util.getDateByTime(Config.donationAfterTime),n=new Date;!Util.getCookie(_Const2.default.donationCookieName)&&n<=t?e=Math.floor((t-n)/1e3):(t.setDate(t.getDate()+1),e=Math.floor((t-n)/1e3))}var a=-1;if(Config.autoChangeSMColorEnabled){var i=parseInt(Util.getCookie(_Const2.default.autoChangeSMColorCookieName));!isNaN(i)&&i>0?(a=Math.floor((i-(new Date).getTime())/1e3),a<0&&(a=0),!Config.changeAllAvailableSMColorEnabled&&Config.customAutoChangeSMColorList.length<=1&&(a=-1)):a=0}var o=[e,a];o.sort(function(e,t){return e>t});var r=-1,l=!0,d=!1,s=void 0;try{for(var p,c=o[Symbol.iterator]();!(l=(p=c.next()).done);l=!0){var f=p.value;if(f>-1){r=f;break}}}catch(e){d=!0,s=e}finally{try{!l&&c.return&&c.return()}finally{if(d)throw s}}return r<=-1?-1:r>0?r+1:0},startAutoRefreshMode=exports.startAutoRefreshMode=function(){var e=getMinRefreshInterval();if(e!==-1){var t=document.title,n=null,a=-1,i=0,o=function(e,t){var n="",a=Util.getTimeDiffInfo(Util.getDate("+"+t+"s").getTime());return n=a.hours>0?a.hours+"时":"",n+=1===e?(a.minutes>0?a.minutes+"分":"")+a.seconds+"秒":a.minutes+"分"},r=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n&&window.clearInterval(n);var i=e;if(console.log("【定时模式】倒计时："+o(1,i)),"never"!==Config.showRefreshModeTipsType.toLowerCase()){var r=function(){document.title=t+" (定时: "+o(e<60?1:2,i)+")",i=e<60?i-1:i-60};a||"always"===Config.showRefreshModeTipsType.toLowerCase()||e<60?r():i=e<60?i-1:i-60,n=setInterval(r,60*_Const2.default.showRefreshModeTipsInterval*1e3)}},l=function e(){var t=0,n="";$.ajax({type:"GET",url:"index.php?t="+(new Date).getTime(),timeout:_Const2.default.defAjaxTimeout,success:function(e){/"kf_fw_ig_index.php"/.test(e)||(t=10,n="论坛维护或其它未知情况")},error:function(){t=_Const2.default.errorRefreshInterval,n="连接超时"},complete:function(){t>0?(console.log("定时操作失败（原因："+n+"），将在"+t+"分钟后重试..."),Msg.remove($(".pd_refresh_notice").parent()),Msg.show('<strong class="pd_refresh_notice">定时操作失败（原因：'+n+"），将在<em>"+t+"</em>分钟后重试&hellip;</strong>",-1),setTimeout(e,60*t*1e3),r(60*t,!0)):i>6?(i=0,t=15,setTimeout(d,60*t*1e3),r(60*t,!0)):(i++,d())}})},d=function e(){Msg.remove($(".pd_refresh_notice").parent()),Config.autoDonationEnabled&&!Util.getCookie(_Const2.default.donationCookieName)&&donation(),Config.autoChangeSMColorEnabled&&!Util.getCookie(_Const2.default.autoChangeSMColorCookieName)&&changeIdColor();var t=getMinRefreshInterval();return t>0&&(i=0),0===t&&0===a?(a=-1,void l()):(a=t,t===-1?void(n&&clearInterval(n)):(0===t&&(t=_Const2.default.actionFinishRetryInterval),setTimeout(e,1e3*t),void r(t,!0)))};setTimeout(d,e<60?6e4:1e3*e),r(e<60?60:e)}},addConfigAndLogDialogLink=exports.addConfigAndLogDialogLink=function(){var e=$('a[href^="login.php?action=quit"]:first');$('<a href="#">助手设置</a><span> | </span>').insertBefore(e).filter("a").click(function(e){e.preventDefault(),(0,_ConfigDialog.show)()}),Config.showLogLinkEnabled&&$('<a href="#">助手日志</a><span> | </span>').insertBefore(e).filter("a").click(function(e){e.preventDefault(),(0,_LogDialog.show)()})},followUsers=exports.followUsers=function(){Config.followUserList.length&&(_Info2.default.isInHomePage&&Config.highlightFollowUserThreadInHPEnabled?$(".b_tit4 > a, .b_tit4_1 > a").each(function(){var e=$(this),t=/》by：(.+)/.exec(e.attr("title"));t&&Util.inFollowOrBlockUserList(t[1],Config.followUserList)>-1&&e.addClass("pd_highlight")}):"/thread.php"===location.pathname?$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&(e.addClass("pd_highlight"),Config.highlightFollowUserThreadLinkEnabled&&e.parent("td").prev("td").prev("td").find('div > a[href^="read.php?tid="]').addClass("pd_highlight"))}):"/read.php"===location.pathname?$(".readidmsbottom > a, .readidmleft > a").each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.closest(".readtext").prev(".readlou").find("div:nth-child(2) > span:first-child").find("a").addBack().addClass("pd_highlight")}):"/guanjianci.php"===location.pathname||"/kf_share.php"===location.pathname?$(".kf_share1 > tbody > tr > td:last-child").each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.addClass("pd_highlight")}):"/search.php"===location.pathname&&$('.thread1 a[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);Util.inFollowOrBlockUserList(e.text(),Config.followUserList)>-1&&e.addClass("pd_highlight")}))},blockUsers=exports.blockUsers=function(){if(0!==Config.blockUserList.length){var e=0;if(_Info2.default.isInHomePage)$(".b_tit4 > a, .b_tit4_1 > a").each(function(){var t=$(this),n=/》by：(.+)/.exec(t.attr("title"));if(n){var a=Util.inFollowOrBlockUserList(n[1],Config.blockUserList);a>-1&&Config.blockUserList[a].type<2&&(e++,t.parent("li").remove())}});else if("/thread.php"===location.pathname){var t=parseInt($('input[name="f_fid"]:first').val());if(!t)return;if(1===Config.blockUserForumType&&$.inArray(t,Config.blockUserFidList)===-1)return;if(2===Config.blockUserForumType&&$.inArray(t,Config.blockUserFidList)>-1)return;$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var t=$(this),n=Util.inFollowOrBlockUserList(t.text(),Config.blockUserList);n>-1&&Config.blockUserList[n].type<2&&(e++,t.closest("tr").remove())})}else if("/read.php"===location.pathname){var n=function(){if(Config.blockUserForumType>0){var t=parseInt($('input[name="fid"]:first').val());if(!t)return{v:void 0};if(1===Config.blockUserForumType&&$.inArray(t,Config.blockUserFidList)===-1)return{v:void 0};if(2===Config.blockUserForumType&&$.inArray(t,Config.blockUserFidList)>-1)return{v:void 0}}var n=Util.getCurrentThreadPage();$(".readidmsbottom > a, .readidmleft > a").each(function(t){var a=$(this),i=Util.inFollowOrBlockUserList(a.text(),Config.blockUserList);if(i>-1){var o=Config.blockUserList[i].type;if(0===t&&1===n&&o>1)return;if((0===t&&1!==n||t>0)&&1===o)return;e++;var r=a.closest(".readtext");r.prev(".readlou").remove().end().next(".readlou").remove().end().remove()}}),$('.readtext fieldset:has(legend:contains("Quote:"))').each(function(){var e=$(this),t=e.text(),n=!0,a=!1,i=void 0;try{for(var o,r=Config.blockUserList[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;if(1!==l.type)try{var d=new RegExp("^Quote:引用(第\\d+楼|楼主)"+l.name+"于","i"),s=new RegExp("^Quote:回\\s*\\d+楼\\("+l.name+"\\)\\s*的帖子","i");(d.test(t)||s.test(t))&&e.html('<legend>Quote:</legend><mark class="pd_custom_tips" title="被屏蔽用户：'+l.name+'">该用户已被屏蔽</mark>')}catch(e){}}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}})}();if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}else"/guanjianci.php"===location.pathname&&Config.blockUserAtTipsEnabled&&$(".kf_share1 > tbody > tr > td:last-child").each(function(){var t=$(this);Util.inFollowOrBlockUserList(t.text(),Config.blockUserList)>-1&&(e++,t.closest("tr").remove())});e>0&&console.log("【屏蔽用户】共有{0}个项目被屏蔽".replace("{0}",e))}},blockThread=exports.blockThread=function blockThread(){if(Config.blockThreadList.length){var isBlock=function isBlock(title,userName){var fid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _iterator3=Config.blockThreadList[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var data=_step3.value,keyWord=data.keyWord,re=null;if(/^\/.+\/[gimy]*$/.test(keyWord))try{re=eval(keyWord)}catch(e){console.log(e);continue}if(userName)if(data.includeUser){if(!data.includeUser.includes(userName))continue}else if(data.excludeUser&&!data.excludeUser.includes(userName))continue;if(fid)if(data.includeFid){if(!data.includeFid.includes(fid))continue}else if(data.excludeFid&&data.excludeFid.includes(fid))continue;if(re){if(re.test(title))return!0}else if(title.toLowerCase().indexOf(keyWord.toLowerCase())>-1)return!0}}catch(e){_didIteratorError3=!0,_iteratorError3=e}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}return!1},num=0;if(_Info2.default.isInHomePage)$(".b_tit4 a, .b_tit4_1 a").each(function(){var e=$(this),t=/》by：(.+)/.exec(e.attr("title")),n="";t&&(n=t[1]),isBlock(e.text(),n)&&(num++,e.parent("li").remove())});else if("/thread.php"===location.pathname){var _ret2=function(){var e=parseInt($('input[name="f_fid"]:first').val());return e?void $('.threadtit1 a[href^="read.php"]').each(function(){var t=$(this);isBlock(t.text(),t.closest("tr").find("td:last-child > a.bl").text(),e)&&(num++,t.closest("tr").remove())}):{v:void 0}}();if("object"===("undefined"==typeof _ret2?"undefined":_typeof(_ret2)))return _ret2.v}else if("/read.php"===location.pathname){if(1!==Util.getCurrentThreadPage())return;var $threadInfo=$('form[name="delatc"] > div:first > table > tbody'),title=$threadInfo.find("tr:first-child > td > span").text();if(!title)return;var $userName=$(".readidmsbottom > a, .readidmleft > a").eq(0);if("楼主"!==$userName.closest(".readtext").prev(".readlou").find("div:nth-child(2) > span:first-child").text())return;var userName=$userName.text();if(!userName)return;var _fid2=parseInt($('input[name="fid"]:first').val());if(!_fid2)return;if(isBlock(title,userName,_fid2)){num++;var $lou=$userName.closest(".readtext");$lou.prev(".readlou").remove().end().next(".readlou").remove().end().remove()}}num>0&&console.log("【屏蔽帖子】共有{0}个帖子被屏蔽".replace("{0}",num))}},modifySideBar=exports.modifySideBar=function(){$("#r_menu").replaceWith('\n<div id="r_menu" style="width: 140px; color: #9999ff; font-size: 14px; line-height: 24px; text-align: center; border: 1px #ddddff solid; padding: 5px; overflow: hidden;">\n  <span style="color: #ff9999;">游戏</span><br>\n  <a href="thread.php?fid=102">游戏推荐</a> | <a href="thread.php?fid=106">新作动态</a><br>\n  <a href="thread.php?fid=52">游戏讨论</a> | <a href="thread.php?fid=24">疑难互助</a><br>\n  <a href="thread.php?fid=16">种子下载</a> | <a href="thread.php?fid=41">网盘下载</a><br>\n  <a href="thread.php?fid=67">图片共享</a> | <a href="thread.php?fid=57">同人漫本</a><br>\n  <span style="color: #ff9999;">动漫音乐</span><br>\n  <a href="thread.php?fid=84">动漫讨论</a> | <a href="thread.php?fid=92">动画共享</a><br>\n  <a href="thread.php?fid=127">漫画小说</a> | <a href="thread.php?fid=68">音乐共享</a><br>\n  <a href="thread.php?fid=163">LIVE共享</a>  | <a href="thread.php?fid=182">转载资源</a><br>\n  <span style="color: #ff9999;">综合</span><br>\n  <a href="thread.php?fid=94">原创美图</a> | <a href="thread.php?fid=87">宅物交流</a><br>\n  <a href="thread.php?fid=86">电子产品</a> | <a href="thread.php?fid=115">文字作品</a><br>\n  <a href="thread.php?fid=96">出处讨论</a>  | <a href="thread.php?fid=36">寻求资源</a><br>\n  <span style="color: #ff9999;">交流</span><br>\n  <a href="thread.php?fid=5">自由讨论</a> | <a href="thread.php?fid=56">个人日记</a><br>\n  <a href="thread.php?fid=98">日本语版</a>  | <a href="thread.php?fid=9">我的关注</a><br>\n  <a href="thread.php?fid=4">站务管理</a><br>\n  <span style="color: #ff9999;">专用</span><br>\n  <a href="thread.php?fid=93">管理组区</a> | <a href="thread.php?fid=59">原创组区</a><br>\n  <a href="/">论坛首页</a><br>\n</div>\n')},addFastNavForSideBar=exports.addFastNavForSideBar=function(){var e=$("#r_menu");e.hasClass("r_cmenu")?e.find("> ul > li:last-child").before('\n<li class="r_cmenuho">\n  <a href="javascript:;">快捷导航</a>\n  <ul class="r_cmenu2">\n    <li><a href="guanjianci.php?gjc='+_Info2.default.userName+'">@提醒</a></li>\n    <li><a href="kf_growup.php">等级经验</a></li>\n    <li><a href="kf_fw_ig_index.php">争夺奖励</a></li>\n    <li><a href="kf_fw_ig_my.php">我的道具</a></li>\n    <li><a href="kf_fw_ig_shop.php">道具商店</a></li>\n    <li><a href="profile.php?action=modify">设置</a></li>\n    <li><a href="hack.php?H_name=bank">银行</a></li>\n    <li><a href="profile.php?action=favor">收藏</a></li>\n    <li><a href="personal.php?action=post">我的回复</a></li>\n    '+_Const2.default.customSideBarContent+"\n  </ul>\n</li>\n"):(Config.modifySideBarEnabled||e.append('<a href="/">论坛首页</a><br>'),e.find("> a:last").before('\n<span style="color: #ff9999;">快捷导航</span><br>\n<a href="guanjianci.php?gjc='+_Info2.default.userName+'">@提醒</a> | <a href="personal.php?action=post">回复</a> | <a href="kf_growup.php">等级</a><br>\n<a href="kf_fw_ig_index.php">争夺</a> | <a href="kf_fw_ig_my.php">道具</a> | <a href="kf_fw_ig_shop.php">商店</a><br>\n<a href="profile.php?action=modify">设置</a> | <a href="hack.php?H_name=bank">银行</a> | <a href="profile.php?action=favor">收藏</a><br>\n'+_Const2.default.customTileSideBarContent+"\n"))},autoSaveCurrentDeposit=exports.autoSaveCurrentDeposit=function(e){if(Config.saveCurrentDepositAfterKfb>0&&Config.saveCurrentDepositKfb>0&&Config.saveCurrentDepositKfb<=Config.saveCurrentDepositAfterKfb){var t=$('a[href="kf_givemekfb.php"]'),n=function(e){if(!(e<Config.saveCurrentDepositAfterKfb)){var n=Math.floor((e-Config.saveCurrentDepositAfterKfb)/Config.saveCurrentDepositKfb);e-Config.saveCurrentDepositKfb*n>=Config.saveCurrentDepositAfterKfb&&n++;var a=Config.saveCurrentDepositKfb*n;a<=0||a>e||(console.log("自动活期存款Start"),$.post("hack.php?H_name=bank",{action:"save",btype:1,savemoney:a},function(n){showFormatLog("自动存款",n),/完成存款/.test(n)&&((0,_Log.push)("自动存款","共有`"+a+"`KFB已自动存入活期存款"),console.log("共有"+a+"KFB已自动存入活期存款"),Msg.show("共有<em>"+a+"</em>KFB已自动存入活期存款"),_Info2.default.isInHomePage&&t.text("拥有"+(e-a)+"KFB"))}))}};if(e)console.log("获取当前持有KFB Start"),$.get("profile.php?action=show&uid="+_Info2.default.uid+"&t="+(new Date).getTime(),function(e){var t=/论坛货币：(\d+)\s*KFB<br/i.exec(e);t&&n(parseInt(t[1]))});else{var a=/拥有(\d+)KFB/.exec(t.text());a&&n(parseInt(a[1]))}}},runCustomScript=exports.runCustomScript=function runCustomScript(){var type=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,script="";if(script=2===type?Config.customScriptEndContent:Config.customScriptStartContent)try{eval(script)}catch(e){console.log(e)}},changeIdColor=exports.changeIdColor=function(){if(Config.changeAllAvailableSMColorEnabled||!(Config.customAutoChangeSMColorList.length<=1)){var e=function(){var e=Util.getDate("+"+Config.autoChangeSMColorInterval+"h");Util.setCookie(_Const2.default.autoChangeSMColorCookieName,e.getTime(),e)};console.log("自动更换ID颜色Start"),$.get("kf_growup.php?t="+(new Date).getTime(),function(t){if(!Util.getCookie(_Const2.default.autoChangeSMColorCookieName)){var n=t.match(/href="kf_growup\.php\?ok=2&safeid=\w+&color=\d+"/g);if(n){var a=function(){var t="",a=/safeid=(\w+)&/i.exec(n[0]);if(a&&(t=a[1]),!t)return e(),{v:void 0};var i=[];for(var o in n){var r=/color=(\d+)/i.exec(n[o]);r&&i.push(parseInt(r[1]))}var l=i;if(!Config.changeAllAvailableSMColorEnabled){l=[];var d=!0,s=!1,p=void 0;try{for(var c,f=Config.customAutoChangeSMColorList[Symbol.iterator]();!(d=(c=f.next()).done);d=!0){var u=c.value;i.includes(u)&&l.push(u)}}catch(e){s=!0,p=e}finally{try{!d&&f.return&&f.return()}finally{if(s)throw p}}}if(l.length<=1)return e(),{v:void 0};var _=parseInt(TmpLog.getValue(_Const2.default.prevAutoChangeSMColorIdTmpLogName));(isNaN(_)||_<0)&&(_=0);var g=0;if("sequence"===Config.autoChangeSMColorType.toLowerCase()){var h=!0,m=!1,v=void 0;try{for(var b,y=l.entries()[Symbol.iterator]();!(h=(b=y.next()).done);h=!0){var k=_slicedToArray(b.value,2),x=(k[0],k[1]);if(x>_){g=x;break}}}catch(e){m=!0,v=e}finally{try{!h&&y.return&&y.return()}finally{if(m)throw v}}0===g&&(g=l[0])}else{var C=!0,w=!1,S=void 0;try{for(var T,L=l.entries()[Symbol.iterator]();!(C=(T=L.next()).done);C=!0){var I=_slicedToArray(T.value,2),D=I[0],E=I[1];if(E===_){l.splice(D,1);break}}}catch(e){w=!0,S=e}finally{try{!C&&L.return&&L.return()}finally{if(w)throw S}}g=l[Math.floor(Math.random()*l.length)]}$.get("kf_growup.php?ok=2&safeid="+t+"&color="+g+"&t="+(new Date).getTime(),function(t){e(),showFormatLog("自动更换ID颜色",t),/等级颜色修改完毕/.test(t)&&(console.log("ID颜色更换为："+g),TmpLog.setValue(_Const2.default.prevAutoChangeSMColorIdTmpLogName,g))})}();if("object"===("undefined"==typeof a?"undefined":_typeof(a)))return a.v}else e()}})}},showElementTitleTips=exports.showElementTitleTips=function(e,t){$(".pd_title_tips").remove(),t&&e.originalEvent&&$('<div class="pd_title_tips">'+t+"</div>").appendTo("body").css("left",e.originalEvent.pageX-20).css("top",e.originalEvent.pageY+15)},bindElementTitleClick=exports.bindElementTitleClick=function(){var e=["A","IMG","INPUT","BUTTON","TEXTAREA","SELECT"];$(document).click(function(t){var n=t.target;!n.title&&!e.includes(n.nodeName)&&n.parentNode&&n.parentNode.title&&(n=n.parentNode),!n.title||e.includes(n.nodeName)||n.id&&n.id.startsWith("wy_")||$(n).is(".pd_editor_btn")?$(".pd_title_tips").remove():showElementTitleTips(t,n.title)})},bindSearchTypeSelectMenuClick=exports.bindSearchTypeSelectMenuClick=function(){$(document).on("click",".pd_search_type",function(){var e=$(this),t=$(".pd_search_type_list");if(t.length>0)return void t.remove();var n=e.data("type");t=$('<ul class="pd_search_type_list"><li>标题</li><li>作者</li><li>关键词</li><li>用户名</li></ul>').appendTo("body");var a=e.offset();t.css("top",a.top+e.height()+2).css("left",a.left+1),"dialog"===n&&t.css({width:"65px",left:a.left-1}),t.on("click","li",function(){var n=$(this),a=n.text().trim(),i=e.closest("form"),o=i.find('input[name="keyword"], input[name="pwuser"]');e.find("span").text(a),"关键词"!==a&&"用户名"!==a&&i.attr("action","search.php?"),"作者"===a?o.attr("name","pwuser"):o.attr("name","keyword");var r=i.find('input[name="search_range"][value="current"]');r.length>0&&r.prop("disabled","关键词"===a||"用户名"===a||!r.data("enabled")),t.remove(),o.focus()})}),$(document).on("submit",'form[name="pd_search"]',function(){var e=$(this),t=$.trim(e.find(".pd_search_type > span").text());"关键词"===t?e.attr("action","guanjianci.php?gjc="+e.find('input[name="keyword"]').val()):"用户名"===t&&e.attr("action","profile.php?action=show&username="+e.find('input[name="keyword"]').val())})},makeSearchByBelowTwoKeyWordAvailable=exports.makeSearchByBelowTwoKeyWordAvailable=function(){$(document).on("submit",'form[action="search.php?"]',function(){var e=$(this),t=e.find('input[name="keyword"]'),n=e.find('input[name="method"]');if(t.length&&n.length){var a=$.trim(t.val());!a||Util.getStrByteLen(a)>2||(t.val(a+" "+Math.floor((new Date).getTime()/1e3)),n.val("OR"),setTimeout(function(){t.val(a),n.val("AND")},200))}})},addSearchDialogLink=exports.addSearchDialogLink=function(){$('<span> | </span><a href="#">搜索</a>').insertAfter('.topright > a[href="message.php"]').filter("a").click(function(e){if(e.preventDefault(),!($("#pd_search").length>0)){var t='\n<div class="pd_cfg_main">\n  <input name="step" value="2" type="hidden">\n  <input name="method" value="AND" type="hidden">\n  <input name="sch_area" value="0" type="hidden">\n  <input name="s_type" value="forum" type="hidden">\n  <input name="f_fid" value="all" type="hidden">\n  <input name="orderway" value="lastpost" type="hidden">\n  <input name="asc" value="DESC" type="hidden">\n  <div style="margin-top: 15px;">\n    <input class="pd_input" name="keyword" type="search" style="float: left; width: 175px; line-height: 26px;" placeholder="关键字">\n    <div class="pd_search_type" data-type="dialog"><span>标题</span><i>∨</i></div>\n    <button class="indloginm" name="submit" type="submit">搜索</button>\n  </div>\n  <div style="margin-bottom:8px; line-height:35px;">\n    <label><input name="search_range" type="radio" value="all" checked> 全站 </label>\n    <label><input name="search_range" type="radio" value="current" disabled> 本版</label>\n  </div>\n</div>',n=Dialog.create("pd_search","搜索",t);n.closest("form").attr({name:"pd_search",action:"search.php?",method:"post",target:"_blank"}).off("submit");var a=parseInt($('input[name="f_fid"]:first, input[name="fid"]:first').val());a&&(n.find('input[name="search_range"]').click(function(){var e=$(this);n.find('input[name="f_fid"]').val("current"===e.val()?a:"all")}),n.find('input[name="search_range"][value="current"]').prop("disabled",!1).data("enabled",!0).click()),n.keydown(function(e){27===e.keyCode&&$(".pd_search_type_list").remove()}).find("h1 > span").click(function(){$(".pd_search_type_list").remove()}),Dialog.show("pd_search"),n.find('input[name="keyword"]').focus()}})},repairBbsErrorCode=exports.repairBbsErrorCode=function(){_Info2.default.w.is_ie=!1,"/read.php"===location.pathname&&(_Info2.default.w.strlen=Util.getStrByteLen)},turnPageViaKeyboard=exports.turnPageViaKeyboard=function(){$(document).keydown(function(e){if((37===e.keyCode||39===e.keyCode)&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){var t=$(".pages:first"),n=t.find('li > a[href="javascript:;"]');if(n.length){var a=Util.getCurrentThreadPage(),i="";if(37===e.keyCode){if(a<=1)return;i=t.find('li > a:contains("上一页")').attr("href")}else{var o=/&page=(\d+)/.exec(t.find("li:last-child > a").attr("href"));if(!o)return;if(a>=parseInt(o[1]))return;i=t.find('li > a:contains("下一页")').attr("href")}"/read.php"===location.pathname&&$.trim($('textarea[name="atc_content"]').val())&&!confirm("发帖框尚有文字，是否继续翻页？")||(location.href=i)}}})},checkRatingSize=exports.checkRatingSize=function(e,t){var n=0,a=e.match(/\D(\d+(?:\.\d+)?)\s?(M|G)/gi);if(a)for(var i=0;i<a.length;i++){var o=/(\d+(?:\.\d+)?)\s?(M|G)/i.exec(a[i]);if(o){var r=parseFloat(o[1]);"G"===o[2].toUpperCase()&&(r*=1024),n+=r}}return n&&t?n>t*(100+_Const2.default.ratingErrorSizePercent)/100+1||n<t*(100-_Const2.default.ratingErrorSizePercent)/100-1?{type:1,titleSize:n,ratingSize:t}:{type:0}:{type:-1}}},{"./ConfigDialog":5,"./Const":6,"./Dialog":7,"./Func":8,"./Info":10,"./Log":12,"./LogDialog":13,"./Msg":15,"./TmpLog":20,"./Util":21}],19:[function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.addSelfRatingLink=n.showAttachImageOutsideSellBox=n.parseMediaTag=n.addMoreSmileLink=n.addCopyCodeLink=n.addUserMemo=n.buyThreads=n.addBatchBuyThreadButton=n.handleBuyThreadBtn=n.modifyKFOtherDomainLink=n.addMultiQuoteButton=n.getMultiQuoteData=n.addStatRepliersLink=n.showStatRepliersDialog=n.addCopyBuyersListLink=n.adjustThreadContentFontSize=n.adjustThreadContentWidth=n.modifySmColor=n.modifyMySmColor=n.modifyFloorSmColor=n.fastGotoFloor=n.addFastGotoFloorInput=n.addFloorGotoLink=void 0;var r=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=e("./Info"),d=i(l),s=e("./Util"),p=a(s),c=e("./Msg"),f=a(c),u=e("./Dialog"),_=a(u),g=e("./Func"),h=e("./Const"),m=i(h),v=e("./Log"),b=e("./Public"),y=a(b),k=e("./Post"),x=a(k),C=(n.addFloorGotoLink=function(){$(".readlou > div:nth-child(2) > span").each(function(){var e=$(this),t=e.text();if(/^\d+楼$/.test(t)){var n=e.closest(".readlou").prev().attr("name");if(n&&/^\d+$/.test(n)){var a=p.getHostNameUrl()+"read.php?tid="+p.getUrlParam("tid")+"&spid="+n;e.html('<a class="pd_goto_link" href="'+a+'" title="复制楼层链接">'+t+"</a>"),e.find("a").click(function(e){e.preventDefault();var t=$(this),n=t.attr("href");t.data("copy-text",n),p.copyText(t,"楼层链接已复制")||prompt("本楼的跳转链接（请按Ctrl+C复制）：",n)})}}})},n.addFastGotoFloorInput=function(){$('<form><li class="pd_fast_goto_floor">电梯直达 <input class="pd_input" style="width:30px" type="text" maxlength="8"> <span>楼</span></li></form>').prependTo($(".readtext:first").prev(".readlou").find("> div:first-child > ul")).submit(function(e){e.preventDefault();var t=parseInt($.trim($(this).find("input").val()));!t||t<0||(location.href=p.getHostNameUrl+"read.php?tid="+p.getUrlParam("tid")+"&page="+(parseInt(t/Config.perPageFloorNum)+1)+"&floor="+t)}).find("span").click(function(){$(this).closest("form").submit()}).end().closest("div").next().css({"max-width":"505px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"})},n.fastGotoFloor=function(){var e=parseInt(p.getUrlParam("floor"));if(e&&!(e<0)){var t=$('.readlou > div:nth-child(2) > span:contains("'+e+'楼")');if(t.length){var n=t.closest(".readlou").prev().attr("name");n&&/^\d+$/.test(n)&&(location.hash="#"+n)}}},n.modifyFloorSmColor=function(e,t){e.is(".readidmsbottom > a")&&e.css("color",t),e.closest(".readtext").css("border-color",t).prev(".readlou").css("border-color",t).next().next(".readlou").css("border-color",t)}),w=(n.modifyMySmColor=function(){var e=$('.readidmsbottom > a[href="profile.php?action=show&uid='+d.default.uid+'"]');e.length||(e=$('.readidmleft > a[href="profile.php?action=show&uid='+d.default.uid+'"]')),e.length>0&&C(e,Config.customMySmColor)},n.modifySmColor=function(){Config.customSmColorConfigList.length&&$('.readidmsbottom > a[href^="profile.php?action=show&uid="], .readidmleft > a').each(function(){var e=$(this),t="";if(e.is(".readidmleft > a")){if(t=e.parent().next(".readidmright").text().toUpperCase(),!/(-?\d+|MAX)/i.test(t))return}else{var n=/(-?\d+|MAX)级神秘/i.exec(e.parent().contents().last().text());if(!n)return;t=n[1].toUpperCase()}var a=!0,i=!1,o=void 0;try{for(var r,l=Config.customSmColorConfigList[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var d=r.value,s=d.min,c=d.max,f=d.color;if(p.compareSmLevel(t,s)>=0&&p.compareSmLevel(t,c)<=0){C(e,f);break}}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}})},n.adjustThreadContentWidth=function(){$("head").append("\n<style>\n  .readtext > table > tbody > tr > td { padding-left: 192px; }\n  .readidms, .readidm { margin-left: -192px !important; }\n</style>\n")},n.adjustThreadContentFontSize=function(){Config.threadContentFontSize>0&&12!==Config.threadContentFontSize&&$("head").append("\n<style>\n  .readtext td { font-size: "+Config.threadContentFontSize+"px; line-height: 1.6em; }\n  .readtext td > div, .readtext td > .read_fds { font-size: 12px; }\n</style>\n")},n.addCopyBuyersListLink=function(){$('<a style="margin:0 2px 0 5px;" href="#">复制名单</a>').insertAfter('.readtext select[name="buyers"]').click(function(e){e.preventDefault();var t=[];if($(this).prev("select").children("option").each(function(e){var n=$(this).text();e&&n!=="-".repeat(11)&&t.push(n)}),!t.length)return void alert("暂时无人购买");if(!($("#pd_copy_buyer_list").length>0)){var n='\n<div class="pd_cfg_main">\n  <textarea style="width: 200px; height: 300px; margin: 5px 0;" readonly></textarea>\n</div>',a=_.create("pd_copy_buyer_list","购买人名单",n);_.show("pd_copy_buyer_list"),a.find("textarea").val(t.join("\n")).select().focus()}})},n.showStatRepliersDialog=function(e){var t='\n<div class="pd_cfg_main">\n  <div id="pd_replier_list_filter" style="margin-top: 5px;">\n    <label><input type="checkbox" checked>显示楼层号</label>\n    <label><input type="checkbox">去除重复</label>\n    <label><input type="checkbox">去除楼主</label>\n  </div>\n  <div style="color: #ff0000;" id="pd_replier_list_stat"></div>\n  <textarea style="width: 250px; height: 300px; margin: 5px 0;" readonly></textarea>\n</div>',n=_.create("pd_replier_list","回帖者名单",t),a=n.find("#pd_replier_list_filter input");a.click(function(){var t=[].concat(o(e)),i=a.eq(0).prop("checked"),l=a.eq(1).prop("checked"),d=a.eq(2).prop("checked");l&&(t=t.map(function(e,t,n){return n.indexOf(e)===t?e:null})),d&&!function(){var e=$(".readtext:first").find(".readidmsbottom, .readidmleft").find("a").text();t=t.map(function(t){return t!==e?t:null})}();var s="",p=0,c=!0,f=!1,u=void 0;try{for(var _,g=t.entries()[Symbol.iterator]();!(c=(_=g.next()).done);c=!0){var h=r(_.value,2),m=h[0],v=h[1];v&&(s+=(i?m+"L：":"")+v+"\n",p++)}}catch(e){f=!0,u=e}finally{try{!c&&g.return&&g.return()}finally{if(f)throw u}}n.find("textarea").val(s),$("#pd_replier_list_stat").html("共有<b>"+p+"</b>条项目")}),n.find("#pd_replier_list_filter input:first").triggerHandler("click"),_.show("pd_replier_list"),n.find("input:first").focus()}),S=(n.addStatRepliersLink=function(){1===p.getCurrentThreadPage()&&$('<li><a href="#" title="统计回帖者名单">[统计回帖]</a></li>').prependTo(".readtext:first + .readlou > div > .pages").find("a").click(function(e){if(e.preventDefault(),!($("#pd_replier_list").length>0)){var t=p.getUrlParam("tid");if(t){var n=$.trim(prompt("统计到第几楼？（0表示统计所有楼层，可用m-n的方式来设定统计楼层的区间范围）",0));if(""!==n){if(!/^\d+(-\d+)?$/.test(n))return void alert("统计楼层格式不正确");var a=0,i=0,o=n.split("-");if(2===o.length?(a=parseInt(o[0]),i=parseInt(o[1])):i=parseInt(o[0]),i<a)return void alert("统计楼层格式不正确");var r=/(\d+)页/.exec($(".pages:eq(0) > li:last-child > a").text()),l=r?parseInt(r[1]):1;0===a&&(a=1),0===i&&(i=l*Config.perPageFloorNum-1);var d=Math.floor(a/Config.perPageFloorNum)+1,s=Math.floor(i/Config.perPageFloorNum)+1;if(s>l&&(s=l),s-d>m.default.statRepliersMaxPage)return void alert("需访问的总页数不可超过"+m.default.statRepliersMaxPage);
f.wait('<strong>正在统计回帖名单中&hellip;</strong><i>剩余页数：<em id="pd_remaining_num">'+(s-d+1)+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');var c=!1;$(document).clearQueue("StatRepliers");var u=[];$.each(new Array(s),function(e){e+1<d||$(document).queue("StatRepliers",function(){$.ajax({type:"GET",url:"read.php?tid="+t+"&page="+(e+1)+"&t="+(new Date).getTime(),timeout:m.default.defAjaxTimeout,success:function(e){var t=e.match(/<span style=".+?">\d+楼<\/span> <span style=".+?">(.|\n|\r\n)+?<a href="profile\.php\?action=show&uid=\d+" target="_blank" style=".+?">.+?<\/a>/gi),n=!0,o=!1,r=void 0;try{for(var l,d=t[Symbol.iterator]();!(n=(l=d.next()).done);n=!0){var s=l.value,p=/<span style=".+?">(\d+)楼<\/span>(?:.|\n|\r\n)+?<a href="profile\.php\?action=show&uid=\d+".+?>(.+?)<\/a>/i.exec(s);if(p){var f=parseInt(p[1]);if(!(f<a)){if(f>i){c=!0;break}u[f]=p[2]}}}}catch(e){o=!0,r=e}finally{try{!n&&d.return&&d.return()}finally{if(o)throw r}}},error:function(){c=!0,alert("因连接超时，统计回帖名单操作中止")},complete:function(){var t=$("#pd_remaining_num");t.text(parseInt(t.text())-1),c=c||t.closest(".pd_msg").data("stop"),c&&$(document).clearQueue("StatRepliers"),c||e===s-1?(f.destroy(),w(u)):setTimeout(function(){return $(document).dequeue("StatRepliers")},m.default.defAjaxInterval)}})})}),$(document).dequeue("StatRepliers")}}}})},n.getMultiQuoteData=function(){var e=[];return $(".pd_multi_quote_chk input:checked").each(function(){var t=$(this).closest(".readlou"),n=/(\d+)楼/.exec(t.find(".pd_goto_link").text()),a=n?parseInt(n[1]):0,i=t.prev("a").attr("name"),o=t.next(".readtext").find(".readidmsbottom > a, .readidmleft > a").text();o&&e.push({floor:a,pid:i,userName:o})}),e}),T=(n.addMultiQuoteButton=function(){var e=$('a[href^="post.php?action=reply"].b_tit2').attr("href");e&&($('<li class="pd_multi_quote_chk"><label title="多重引用"><input type="checkbox"> 引</label></li>').prependTo($(".readlou > div:first-child > ul").has('a[title="引用回复这个帖子"]')).find("input").click(function(){var e=parseInt(p.getUrlParam("tid")),t=localStorage[m.default.multiQuoteStorageName];if(t)try{t=JSON.parse(t),!t||"object"!==$.type(t)||$.isEmptyObject(t)?t=null:"undefined"!=typeof t.tid&&t.tid===e&&Array.isArray(t.quoteList)||(t=null)}catch(e){t=null}else t=null;var n=S();t||(localStorage.removeItem(m.default.multiQuoteStorageName),t={tid:e,quoteList:[]});var a=p.getCurrentThreadPage();n.length>0?t.quoteList[a]=n:delete t.quoteList[a],localStorage[m.default.multiQuoteStorageName]=JSON.stringify(t)}),$(".readlou:last").next("div").find("table > tbody > tr > td:last-child").css({"text-align":"right",width:"320px"}).append('<span class="b_tit2" style="margin-left: 5px;"><a style="display: inline-block;" href="#" title="多重回复">回复</a> '+('<a style="display: inline-block;" href="'+e+'&multiquote=1" title="多重引用">引用</a></span>')).find(".b_tit2 > a:eq(0)").click(function(e){e.preventDefault(),x.handleMultiQuote(1)}))},n.modifyKFOtherDomainLink=function(){$(".readtext a, .thread2 a").each(function(){var e=$(this),t=e.attr("href");if(!/m\.miaola\.info\//i.test(t)){var n=/^(https?:\/\/(?:[\w\.]+?\.)?(?:2dgal|ddgal|9gal|9baka|9moe|kfgal|2dkf|miaola|kfer)\.\w+?\/).+/i.exec(t);n&&e.attr("href",t.replace(n[1],p.getHostNameUrl()))}})},n.handleBuyThreadBtn=function(){$('.readtext input[type="button"][value="愿意购买,支付KFB"]').each(function(){var e=$(this),t=/此帖售价\s*(\d+)\s*KFB/i.exec(e.closest("legend").contents().eq(0).text());if(t){var n=parseInt(t[1]);t=/location\.href="(.+?)"/i.exec(e.attr("onclick")),t&&e.data("sell",n).data("url",t[1]).removeAttr("onclick").click(function(e){e.preventDefault();var t=$(this),n=t.data("sell"),a=t.data("url");n&&a&&(n>=m.default.minBuyThreadWarningSell&&!confirm("此贴售价"+n+"KFB，是否购买？")||(Config.buyThreadViaAjaxEnabled?!function(){var e=f.wait("正在购买帖子&hellip;");$.get(a,function(t){f.remove(e),/操作完成/.test(t)?location.reload():/您已经购买此帖/.test(t)?(alert("你已经购买过此帖"),location.reload()):alert("帖子购买失败")})}():location.href=a))})}})},n.addBatchBuyThreadButton=function(){var e=$('.readtext input[type="button"][value="愿意购买,支付KFB"]');0!==e.length&&(e.each(function(){var e=$(this),t=e.data("sell"),n=e.data("url");t&&n&&e.after('<input class="pd_buy_thread" style="margin-left: 10px; vertical-align: middle;" type="checkbox" data-sell="'+t+'" data-url="'+n+'">')}),$('<span style="margin: 0 5px;">|</span><a class="pd_buy_thread_btn" title="批量购买所选帖子" href="#">批量购买</a>').insertAfter('td > a[href^="kf_tidfavor.php?action=favor&tid="]').filter("a").click(function(e){e.preventDefault(),f.destroy();var t=[],n=0;return $(".pd_buy_thread:checked").each(function(){var e=$(this),a=e.data("url"),i=parseInt(e.data("sell"));a&&!isNaN(i)&&(t.push({url:a,sell:i}),n+=i)}),t.length?void(confirm("你共选择了"+t.length+"个帖子，总售价"+n.toLocaleString()+"KFB，"+("均价"+p.getFixedNumberLocaleString(n/t.length,2)+"KFB，是否批量购买？"))&&(f.wait('<strong>正在购买帖子中&hellip;</strong><i>剩余：<em id="pd_remaining_num">'+t.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),T(t))):void alert("请选择要购买的帖子")}).parent().mouseenter(function(){$('<span style="margin-left: 5px;">[<a href="#">全选</a><a style="margin-left: 5px;" href="#">反选</a>]</span>').insertAfter($(this).find(".pd_buy_thread_btn")).find("a:first").click(function(e){e.preventDefault();var t=$(".pd_buy_thread");t.prop("checked",!0),alert("共选择了"+t.length+"项")}).next("a").click(function(e){e.preventDefault();var t=0;$(".pd_buy_thread").each(function(){var e=$(this);e.prop("checked",!e.prop("checked")),e.prop("checked")&&t++}),alert("共选择了"+t+"项")})}).mouseleave(function(){$(this).find(".pd_buy_thread_btn").next("span").remove()}))},n.buyThreads=function(e){var t=0,n=0,a=0;$(document).clearQueue("BuyThreads"),$.each(e,function(i,o){$(document).queue("BuyThreads",function(){$.ajax({type:"GET",url:o.url+"&t="+(new Date).getTime(),timeout:m.default.defAjaxTimeout,success:function(e){y.showFormatLog("购买帖子",e),/操作完成/.test(e)?(t++,a+=o.sell):n++},error:function(){n++},complete:function(){var o=$("#pd_remaining_num");o.text(parseInt(o.text())-1);var r=o.closest(".pd_msg").data("stop");r&&$(document).clearQueue("BuyThreads"),r||i===e.length-1?(f.destroy(),t>0&&(0,v.push)("购买帖子","共有`"+t+"`个帖子购买成功",{pay:{KFB:-a}}),console.log("共有"+t+"个帖子购买成功，共有"+n+"个帖子购买失败，KFB-"+a),f.show("<strong>共有<em>"+t+"</em>个帖子购买成功"+(n>0?"，共有<em>"+n+"</em>个帖子购买失败":"")+"</strong>"+("<i>KFB<ins>-"+a+"</ins></i>"),-1),(0,g.run)("Read.buyThreads_after_",e)):setTimeout(function(){return $(document).dequeue("BuyThreads")},m.default.defAjaxInterval)}})})}),$(document).dequeue("BuyThreads")});n.addUserMemo=function(){$.isEmptyObject(Config.userMemoList)||$('.readidmsbottom > a[href^="profile.php?action=show&uid="], .readidmleft > a').each(function(){var e=$(this),t=e.text().trim(),n="",a=!0,i=!1,o=void 0;try{for(var r,l=Object.keys(Config.userMemoList)[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var d=r.value;if(d===t){n=Config.userMemoList[d];break}}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}if(n)if(e.is(".readidmleft > a"))e.after('<span class="pd_user_memo_tips" title="备注：'+n+'">[?]</span>');else{var s=n,p=24;n.length>p&&(s=s.substring(0,p)+"&hellip;"),e.after('<br><span class="pd_user_memo" title="备注：'+n+'">('+s+")</span>")}})},n.addCopyCodeLink=function(){$('.readtext fieldset > legend:contains("Copy code")').html('<a class="pd_copy_code" href="#">复制代码</a>'),$(".pd_copy_code").length&&$("#alldiv").on("click","a.pd_copy_code",function(e){e.preventDefault();var t=$(this),n=t.closest("fieldset");if(!p.copyText(n,"代码已复制",t.parent())){var a=n.data("content");if(a)n.html('<legend><a class="pd_copy_code" href="#">复制代码</a></legend>'+a).removeData("content");else{var i=n.html();i=i.replace(/<legend>.+?<\/legend>/i,""),n.data("content",i),i=p.htmlDecode(i);var o=n.height();o-=17,o<50&&(o=50),o>540&&(o=540),n.html('\n<legend><a class="pd_copy_code" href="#">还原代码</a></legend>\n<textarea wrap="off" class="pd_textarea" style="width: 100%; height: '+o+'px; line-height: 1.4em; white-space: pre;">'+i+"</textarea>\n"),n.find("textarea").select().focus()}}})},n.addMoreSmileLink=function(){var e=function(e){var t=$('textarea[name="atc_content"]').get(0);if(t){var n="[s:"+e+"]";p.addCode(t,n),d.default.isMobile?t.blur():t.focus()}},t=$('input[name="diy_guanjianci"]').parent();t.on("click",'a[href="javascript:;"]',function(t){t.preventDefault();var n=$(this).data("id");n&&e(n)}).find('a[onclick^="javascript:addsmile"]').each(function(){var e=$(this),t=/addsmile\((\d+)\)/i.exec(e.attr("onclick"));t&&e.data("id",t[1]).removeAttr("onclick").attr("href","javascript:;")}),$('<a class="pd_highlight" href="#">[更多]</a>').appendTo(t).click(function(n){n.preventDefault();var a=$(this),i=$("#pd_smile_panel");if(i.length>0)return a.text("[更多]"),void i.remove();a.text("[关闭]");for(var o=["48","35","34","33","32","31","30","29","28","27","26","36","37","47","46","45","44","43","42","41","40","39","38","25","24","11","10","09","08","01","02","03","04","05","06","12","13","23","22","21","20","19","18","17","16","15","14","07"],r=[57,44,43,42,41,40,39,38,37,36,35,45,46,56,55,54,53,52,51,50,49,48,47,34,33,20,19,18,17,10,11,12,13,14,15,21,22,32,31,30,29,28,27,26,25,24,23,16],l="",s=0;s<o.length;s++)l+='<img src="'+d.default.w.imgpath+"/post/smile/em/em"+o[s]+'.gif" alt="[表情]" data-id="'+r[s]+'">';l='<div class="pd_panel" id="pd_smile_panel" style="width: 308px; height: 185px;">'+l+"</div>";var p=t.offset();i=$(l).appendTo("body"),i.css("top",p.top+t.height()+4).css("left",p.left+t.width()-i.width()+9).on("click","img",function(){var t=$(this).data("id");t&&e(t)}),(0,g.run)("Read.addMoreSmileLink_after_click_")})},n.parseMediaTag=function(){$(".readtext > table > tbody > tr > td").each(function(){var e=$(this),t=e.html();/\[(audio|video)\](http|ftp)[^<>]+\[\/(audio|video)\]/.test(t)&&e.html(t.replace(/\[audio\]((?:http|ftp)[^<>]+?)\[\/audio\](?!<\/fieldset>)/g,'<audio src="$1" controls preload="none" style="margin:3px 0;">[你的浏览器不支持audio标签]</audio>').replace(/\[video\]((?:http|ftp)[^<>]+?)\[\/video\](?!<\/fieldset>)/g,'<video src="$1" controls preload="none" style="max-width: '+(Config.adjustThreadContentWidthEnabled?627:820)+'px; margin:3px 0;">[你的浏览器不支持video标签]</video>'))})},n.showAttachImageOutsideSellBox=function(){$(".readtext > table > tbody > tr > td").each(function(){var e=$(this),t=e.html();if(/\[attachment=\d+\]/.test(t)){var n=e.closest(".readtext").prev(".readlou").prev("a").attr("name"),a=p.getUrlParam("tid");e.html(t.replace(/\[attachment=(\d+)\]/g,'<img src="job.php?action=download&pid='+n+"&tid="+a+'&aid=$1" alt="[附件图片]" style="max-width:550px" '+("onclick=\"if(this.width>=550) window.open('job.php?action=download&pid="+n+"&tid="+a+"&aid=$1');\">")))}})},n.addSelfRatingLink=function(){var e=parseInt($('input[name="fid"]:first').val());if(e&&m.default.selfRatingFidList.includes(e)){var t=parseInt($('input[name="tid"]:first').val()),n=y.getSafeId();n&&t&&($('.readtext:first fieldset legend:contains("本帖最近评分记录")').length>0||$('a[href^="kf_tidfavor.php?action=favor"]').after('<span style="margin: 0 5px;">|</span><a href="kf_fw_1wkfb.php?do=1&safeid='+n+"&ptid="+t+'" title="仅限自助评分测试人员使用">自助评分</a>'))}}},{"./Const":6,"./Dialog":7,"./Func":8,"./Info":10,"./Log":12,"./Msg":15,"./Post":17,"./Public":18,"./Util":21}],20:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.deleteValue=n.setValue=n.getValue=n.clear=n.write=n.read=void 0;var i=e("./Info"),o=a(i),r=e("./Const"),l=a(r),d="pd_tmp_log",s={},p=n.read=function(){s={};var e=null;if(e="ByUid"===o.default.storageType||"Global"===o.default.storageType?GM_getValue(d+"_"+o.default.uid):localStorage.getItem(d+"_"+o.default.uid)){try{e=JSON.parse(e)}catch(e){return}if(e&&"object"===$.type(e)){var t=[];for(var n in l.default)n.endsWith("TmpLogName")&&t.push(l.default[n]);var a=!0,i=!1,r=void 0;try{for(var p,c=Object.keys(e)[Symbol.iterator]();!(a=(p=c.next()).done);a=!0){var f=p.value;t.includes(f)||delete e[f]}}catch(e){i=!0,r=e}finally{try{!a&&c.return&&c.return()}finally{if(i)throw r}}s=e}}},c=n.write=function(){"ByUid"===o.default.storageType||"Global"===o.default.storageType?GM_setValue(d+"_"+o.default.uid,JSON.stringify(s)):localStorage.setItem(d+"_"+o.default.uid,JSON.stringify(s))};n.clear=function(){"ByUid"===o.default.storageType||"Global"===o.default.storageType?GM_deleteValue(d+"_"+o.default.uid):localStorage.removeItem(d+"_"+o.default.uid)},n.getValue=function(e){return p(),e in s?s[e]:null},n.setValue=function(e,t){p(),s[e]=t,c()},n.deleteValue=function(e){p(),e in s&&(delete s[e],c())}},{"./Const":6,"./Info":10}],21:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.inFollowOrBlockUserList=n.entries=n.getResponseMsg=n.copyText=n.getSelText=n.addCode=n.getStrByteLen=n.getRemoveUnpairedBBCodeQuoteContent=n.getFixedNumberLocaleString=n.getCurrentThreadPage=n.compareSmLevel=n.isEdge=n.isOpera=n.getStatFormatNumber=n.getSortedObjectKeyList=n.getObjectKeyList=n.htmlDecode=n.htmlEncode=n.getGBKEncodeString=n.getUrlParam=n.deepEqual=n.getDifferenceSetOfObject=n.getHostNameUrl=n.isBetweenInTimeRange=n.getTimeDiffInfo=n.getTimeString=n.getDateString=n.getDate=n.getMidnightHourDate=n.getTimezoneDateByTime=n.getDateByTime=n.deleteCookie=n.getCookie=n.setCookie=void 0;var i=function(){function e(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("./Info"),r=a(o),l=e("./Const"),d=a(l),s=(n.setCookie=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.default.uid+"_";document.cookie=""+a+e+"="+encodeURI(t)+(n?";expires="+n.toUTCString():"")+";path=/;"},n.getCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.uid+"_",n=new RegExp("(^| )"+t+e+"=([^;]*)(;|$)"),a=document.cookie.match(n);return a?decodeURI(a[2]):null},n.deleteCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.uid+"_";document.cookie=""+t+e+"=;expires="+p("-1d").toUTCString()+";path=/;"},n.getDateByTime=function(e){var t=new Date,n=e.split(":");return n[0]&&t.setHours(parseInt(n[0])),n[1]&&t.setMinutes(parseInt(n[1])),n[2]&&t.setSeconds(parseInt(n[2])),t.setMilliseconds(0),t}),p=(n.getTimezoneDateByTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.default.forumTimezoneOffset,n=new Date,a=e.split(":");a[0]&&n.setUTCHours(parseInt(a[0])+t),a[1]&&n.setUTCMinutes(parseInt(a[1])),a[2]&&n.setUTCSeconds(parseInt(a[2])),n.setUTCMilliseconds(0);var i=new Date;return(i.getDate()>n.getDate()||i.getMonth()>n.getMonth()||i.getFullYear()>n.getFullYear())&&n.setDate(n.getDate()+1),n},n.getMidnightHourDate=function(e){var t=s("00:00:00");return t.setDate(t.getDate()+e),t},n.getDate=function(e){var t=new Date,n=/^(-|\+)?(\d+)([a-zA-Z]{1,2})$/.exec(e);if(!n)return null;var a="undefined"==typeof n[1]?0:"+"===n[1]?1:-1,i=a===-1?-parseInt(n[2]):parseInt(n[2]),o=n[3];switch(o){case"Y":t.setFullYear(i);break;case"y":t.setFullYear(0===a?i:t.getFullYear()+i);break;case"M":t.setMonth(0===a?i:t.getMonth()+i);break;case"d":t.setDate(0===a?i:t.getDate()+i);break;case"h":t.setHours(0===a?i:t.getHours()+i);break;case"m":t.setMinutes(0===a?i:t.getMinutes()+i);break;case"s":t.setSeconds(0===a?i:t.getSeconds()+i);break;case"ms":t.setMilliseconds(0===a?i:t.getMilliseconds()+i);break;default:return null}return t}),c=(n.getDateString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";e=e?e:new Date;var n=e.getMonth()+1,a=e.getDate();return e.getFullYear()+t+(n<10?"0"+n:n)+t+(a<10?"0"+a:a)},n.getTimeString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.getHours(),i=e.getMinutes(),o=e.getSeconds();return(a<10?"0"+a:a)+t+(i<10?"0"+i:i)+(n?t:"")+(n?o<10?"0"+o:o:"")},n.getTimeDiffInfo=function(e){var t=e-(new Date).getTime();if(t>0){t=Math.floor(t/1e3);var n=Math.floor(t/60/60);if(n>=0){var a=Math.floor((t-60*n*60)/60);a<0&&(a=0);var i=Math.floor(t-60*n*60-60*a);return i<0&&(i=0),{hours:n,minutes:a,seconds:i}}}return{hours:0,minutes:0,seconds:0}},n.isBetweenInTimeRange=function(e,t){var n=t.split("-");if(2!==n.length)return null;var a=s(n[0]),i=s(n[1]);return i<a&&(e>i?i.setDate(i.getDate()+1):a.setDate(a.getDate()-1)),e>=a&&e<=i},n.getHostNameUrl=function(){return location.protocol+"//"+location.host+"/"}),f=(n.getDifferenceSetOfObject=function(e,t){var n={};return"object"!==$.type(e)||"object"!==$.type(t)?n:($.each(t,function(t,a){t in e&&(f(e[t],a)||(n[t]=a))}),n)},n.deepEqual=function e(t,n){if(t===n)return!0;if($.type(t)!==$.type(n))return!1;if("number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n))return!0;if($.isArray(t)&&$.isArray(n)||"object"===$.type(t)&&"object"===$.type(n)){if(t.length!==n.length)return!1;for(var a in $.extend($.isArray(t)?[]:{},t,n)){if("undefined"==typeof t[a]||"undefined"==typeof n[a])return!1;if(!e(t[a],n[a]))return!1}return!0}return!1}),u=(n.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=location.search.substring(1).match(t);return n?decodeURI(n[2]):null},n.getGBKEncodeString=function(e){var t=$("<img>").appendTo("body").get(0);t.src="nothing?sp="+e;var n=t.src.split("nothing?sp=").pop();return $(t).remove(),n},n.htmlEncode=function(e){return e.length?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"<br>"):""},n.htmlDecode=function(e){return e.length?e.replace(/<br\s*\/?>/gi,"\n").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&nbsp;/gi," ").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&"):""},n.getObjectKeyList=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];if("object"!==$.type(e))return n;for(var a in e)n.push(a);return 0!==t&&n.sort(function(e,n){return t>0?e>n:e<n}),n});n.getSortedObjectKeyList=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=u(t,n);return a.sort(function(t,n){return e.indexOf(t)>e.indexOf(n)}),a},n.getStatFormatNumber=function(e){return e>=0?"<em>+"+e.toLocaleString()+"</em>":"<ins>"+e.toLocaleString()+"</ins>"},n.isOpera=function(){return"undefined"!=typeof window.opera},n.isEdge=function(){return navigator.appVersion&&navigator.appVersion.indexOf("Edge")>0},n.compareSmLevel=function(e,t){var n="MAX"===e.toUpperCase()?Number.MAX_VALUE:parseInt(e),a="MAX"===t.toUpperCase()?Number.MAX_VALUE:parseInt(t);return n>a?1:n<a?-1:0},n.getCurrentThreadPage=function(){var e=/- (\d+) -/.exec($('.pages:first > li > a[href="javascript:;"]').text());return e?parseInt(e[1]):1},n.getFixedNumberLocaleString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.toFixed(t).split("."),a=i(n,2),o=a[0],r=a[1],l=parseInt(o).toLocaleString(),d="";return"undefined"!=typeof r&&(d="."+r),l+d},n.getRemoveUnpairedBBCodeQuoteContent=function(e){for(var t=[/\[color=.+?\]/g,/\[backcolor=.+?\]/g,/\[size=.+?\]/g,/\[font=.+?\]/g,/\[align=.+?\]/g,/\[b\]/g,/\[i\]/g,/\[u\]/g,/\[strike\]/g,/\[sup\]/g,/\[sub\]/g],n=[/\[\/color\]/g,/\[\/backcolor\]/g,/\[\/size\]/g,/\[\/font\]/g,/\[\/align\]/g,/\[\/b\]/g,/\[\/i\]/g,/\[\/u\]/g,/\[\/strike\]/g,/\[\/sup\]/g,/\[\/sub\]/g],a=0;a<t.length;a++){var i=e.match(t[a]),o=e.match(n[a]),r=i?i.length:0,l=o?o.length:0;r!==l&&(e=e.replace(t[a],"").replace(n[a],""))}return e},n.getStrByteLen=function(e){for(var t=0,n=2,a=0;a<e.length;a++)t+=e.charCodeAt(a)<0||e.charCodeAt(a)>255?n:1;return t},n.addCode=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=n?t.indexOf(n):t.indexOf("]")+1;if("undefined"!=typeof e.selectionStart){var i=e.selectionStart;e.value=e.value.substring(0,i)+t+e.value.substring(e.selectionEnd),e.selectionStart=i+a,e.selectionEnd=i+a+n.length}else e.value+=t},n.getSelText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},n.copyText=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!("execCommand"in document&&t.length))return!1;var e=t.data("copy-text");e&&(t=$('<span class="text-hide">'+e+"</span>").insertAfter(t)),a&&a.prop("hidden",!0);var i=window.getSelection();i.selectAllChildren(t.get(0));var o=document.execCommand("copy");return i.removeAllRanges(),e&&t.remove(),a&&a.removeProp("hidden"),o&&alert(n?n:"已复制"),o},n.getResponseMsg=function(e){var t="",n=/<span style=".+?">(.+?)<\/span><br\s*\/?><a href="(.+?)">/i.exec(e);if(n)t=n[1]+"；跳转地址："+c()+n[2];else{var a=/操作提示<br\s*\/?>\r\n(.+?)<br\s*\/?>\r\n<a href="javascript:history\.go\(-1\);">返回上一步操作<\/a>/i.exec(e);a&&(t=a[1])}return t},n.entries=regeneratorRuntime.mark(function e(t){var n,a,i,o,r,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,a=!1,i=void 0,e.prev=3,o=Object.keys(t)[Symbol.iterator]();case 5:if(n=(r=o.next()).done){e.next=12;break}return l=r.value,e.next=9,[l,t[l]];case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),a=!0,i=e.t0;case 18:e.prev=18,e.prev=19,!n&&o.return&&o.return();case 21:if(e.prev=21,!a){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}),n.inFollowOrBlockUserList=function(e,t){return t.findIndex(function(t){return t.name&&t.name===e})}},{"./Const":6,"./Info":10}]},{},[1]);